---
layout: post
title:  "【已解决】WordPress搭建过程" 
categories: Blog&amp;CMS PHP&amp;mySQL
tags: Blog&amp;CMS PHP&amp;mySQL
author: LZN
---

* content
{:toc}

安装过程的确不太轻松，可能最初php和mysql设置有问题吧。痛苦的安装过程记录一下，下学期有了新电脑正式建站的时候作参考。

官方安装说明：http://codex.wordpress.org/zh-cn:%E5%AE%89%E8%A3%85WordPress

1.下载解压后，查看 /etc/rc.d/init.d/mysqld status 是否启动，否则启动mysql
#service mysqld start

按照说明运行mysql -u命令出现ERROR 1045 (28000)错误，其实可能是root没有密码，我没有多尝试，直接查到了mysql强行重新修改密码的方法，如下：
<blockquote>
<p style="padding-left: 30px;">/etc/init.d/mysql stop (service mysqld stop )
/usr/bin/mysqld_safe --skip-grant-tables
另外开个SSH连接
[root@localhost ~]# mysql
mysql&gt;use mysql
mysql&gt;update user set password=password("123456") where user="root";
mysql&gt;flush privileges;
mysql&gt;exit</p>
<p style="padding-left: 30px;">pkill -KILL -t pts/0 可将pts为0的**用户(之前运行mysqld_safe的用户窗口)强制踢出
正常启动 MySQL：/etc/init.d/mysql start (service mysqld start)</p>
</blockquote>
打开install.php，出现提示
<blockquote>您的PHP似乎没有安装运行WordPress所必需的MySQL扩展。</blockquote>
查到问题是php没有加载mysql模块所致，查看/etc/php.d/目录，如果只有dbase.ini,idpa.ini，而没有 mysql.ini,mysqli.ini,pdo.ini,pdo_mysql.ini,pdo_mysqli.ini,同时查看/usr/lib /php/modulse目录，如果没有 mysql.so,mysqli.so,pdo.so,pdo_mysql.so,pdo_sqlite.so,phpcpus.so,那么可判断为 php没有加载mysql模块。
#yum install php-mysql

php-pdo貌似centos已经默认安装。安装后/usr/lib/php/modulse目录下会有上述所需文件

配置/etc/php.ini，在任意地方加入下列语句

extension=mysql.so
extension=mysqli.so

extension=pdo_mysql.so

保存，重启apache，如果还是出现问题，重启了一下mysql，刷新网页，问题基本能够解决。

Done！

#20140729#

mysql默认为空密码，重置密码方式：
<div><em>    3. 然后用空密码方式使用root用户登录 MySQL；</em></div>
<div><em>    mysql -u root</em></div>
<div><em>    4. 修改root用户的密码；</em></div>
<div><em>    mysql&gt; update mysql.user set password=PASSWORD（'新密码'） where User='root'；</em></div>
<div><em>    mysql&gt; flush privileges；</em></div>
<div><em>    mysql&gt; quit</em></div>
<div><em>    5. 重新启动MySQL，就可以使用新密码登录了</em></div>
<div></div>
<div>使用密码登陆的正确姿势</div>
<div>mysql -u root -p 回车！！！</div>
<div>输入新密码</div>
<div>回车……</div>
<div>奇葩吧</div>
---
layout: post
title:  "【已解决】Dokuwiki搭建过程" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

dokuwiki的搭建还是比较简单的，反正比wordpress轻松多了。

1. doku官方页面下载最新版本的压缩包并解压。

https://www.dokuwiki.org/dokuwiki

2. 按照install guide里面的要求，主要是secuity配置比较麻烦。修改位置在/etc/httpd/httpd.conf，也就是apache的配置文件，加入要求的标签，位置按照要求就可以，不过具体应该没大关系。需要读一读官网Deny Directory Access in Apache模块。这样才可以使用data目录下的权限文件，防止data目录被匿名访问遍历。

security：https://www.dokuwiki.org/security

3. 修改./data等权限到755，允许dokuwiki读写。
<blockquote>
data/ and data/tmp/ directory: All files in and below these directories must be writable by the web process for DokuWiki to work.
lib/plugins/ directory: This directory must be writable by the web process for the plugin-Manager to work
lib/ directory: This directory must be readable by the public for style sheets to display. 755 works fine.</blockquote>
https://www.dokuwiki.org/install:permissions
---
layout: post
title:  "【已解决】Wordpress上传时“是否上级目录没有写权限”解决办法" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

想放一个顶部图像，谁知道上传的时候出现上述错误，按照路径创建了uploads目录，755权限依然不行，改为777后成功。

这其实不是一个好方法，说明wordpress在操作的时候是作为“others”的，777代表谁都能上，不安全。

正确方法可能要从mysql的数据库改，mysql几乎没有接触，时间宝贵起见，不管了，姑且这样解决吧。
---
layout: post
title:  "【已解决】Wordpress访问慢的问题解决" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

2014年六月以来，由于大陆对google的封锁，导致wordpress访问变慢。主要原因是wordpress调用了google的一些公共库。经查资料，采用360做的镜像库可以解决该问题。

需要修改的文件
<blockquote>wp-includes/script-loader.php

wp-includes/js/tinymce/plugins/compat3x/css/dialog.css

wp-content/themes/twentytwelve/functions.php

wp-content/themes/twentythirteen/functions.php

wp-content/themes/twentyfourteen/functions.php</blockquote>
搜索<strong>googleapis</strong>全部替换为<strong>useso</strong>即可。

其实目前默认采用twentyfourth了，只修改最后面三个文件中的最后一个应该可以。

参考资料：

http://jingyan.baidu.com/article/4f7d5712aaca631a20192720.html

http://www.wind88.net/news/news-125.html

&nbsp;

<strong><span style="color: #008000;">#Up to 20140729#</span></strong>

这两天出现了不登录的情况下速度很快，但是登录之后却非常缓慢。经查，发现依然是由于后台调用google字体等造成。安装Disable Google Fonts插件后问题解决。

参考资料：http://www.whyqi.com/318.html

<strong><span style="color: #008000;">#Up to 20140824#</span></strong>
---
layout: post
title:  "【未解决】CESM1.2.2移植到中大hpc4平台出问题" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

有1.2.0的基础，想必1.2.2应该是好搞定的，很多配置文件可以从1.2.0里拷贝过来。如法炮制，在天河二号上应该也可以这么搞定。

首先cd到新版的Machines目录下，然后拷贝旧版中的<em>config_machines.xml config_compilers.xml</em> 以及 <em>mkbatch.${MACH}</em>这三个配置文件过来（${MACH}代表自定义的机器名）
<blockquote>#cd ~/CESM/cesm1_2_2//scripts/ccsm_utils/Machines

#cp ~/CESM/cesm1_2_0/scripts/ccsm_utils/Machines/config_machines.xml ./

#cp ~/CESM/cesm1_2_0/scripts/ccsm_utils/Machines/config_compilers.xml ./

#cp ~/CESM/cesm1_2_0/scripts/ccsm_utils/Machines/mkbatch.sigon ./</blockquote>
回到scripts目录，再采用create_newcase的方法进行X Compset的测试，
<blockquote>#./create_newcase -case testnew -res f45_g37 -compset X -mach sigon</blockquote>
结果出现了意想不到的错误：

<em>WARNING:</em>
<em>    The perl module XML::LibXML is needed for XML parsing in the CESM script system.</em>
<em>        Please contact your local systems administrators or IT staff and have them install it for</em>
<em>        you, or install the module locally.</em>

回到1.2.0的目录测试，发现1.2.0是没有问题的。感觉像是新版加了perl的神马库去解析xml文件，google之，发现应该是这样。

https://bb.cgd.ucar.edu/cesm-12-stempede-problem

https://bb.cgd.ucar.edu/warning-cesm122

按照贴子里的说法下载 XML::LibXML  安装，发现安装说明一头雾水完全看不懂，cpan命令无效，退出到workstation居然有cpan命令，呃……看起来是hpc4又没装神马东西，回来再慢慢捣鼓吧……
---
layout: post
title:  "大气所学习小记20140728" 
categories: Living&amp;thinking
tags: Living&amp;thinking
author: LZN
---

* content
{:toc}

今天应该是来大气所这三天里获得信息量最大的一天（半天）了，收益非凡！

首先是GFDL Prof. Yi Ming 和佛罗里达大学 Prof. Zhaohua Wu的报告。Prof. Yi Ming用英文演讲，可能一方面因为内容太深，另一方面英文实在是太成问题了，根本听不懂，只能感慨自己水爆了。大概能听出来是讲了三方面内容（其实周天军老师最后提示才知道……）。一是通过某种手段估计可以减少人类活动中aerosol排放造成的气候反馈过程的不确定性，就是有方法能够缩短IPCC报告中aerosol效应error bar。确实帅呆！ 二是热带环流的一些内容，只记得wet get wetter，dry get dryer 和 stable get stabler这些，实在是听不懂……囧。 第三方面讲了GFDL model的一些发展状况。

Prof. Zhaohua Wu的报告大概还是能够听明白的，可能主要是因为没有讲技术细节而且还是中文吧。从IPCC AR5中model historical run与观测的Ts对比那张经典的figure引出，指出了model对突变把握中存在的问题。以及采用统计方法在研究气候问题中的局限性、片面性。讲的很好，从平均值到方差，到基于平均值和方差的一系列方法，包括EOF等，实际都由于简化而掩盖了大量的信息，又产生了虚假信号。随后引入EMD方法，感觉应该就是杨老师让国军师兄重点研究和采用的那个吧，要不Zhaohua Wu这个名字怎么这么耳熟呢。这个方法的原理确实绝，时序信号最大值包络线最小值包络线做个差，就提出低频信号了，帅呆！当然具体技术细节上还是需要很多数学技巧的。列了很多的文献，大概记了下，需要的时候下载看，正好能够和杨老师的课题契合。今年Wu老师还发了Nature Climate Change的文章，佩服啊！做了好多年方法，从最初的为人不屑为人唾骂到现在逐渐被接受以及能够利用该方法发Nature……板凳坐得十年冷，坚韧不拔，自强不息！是以为戒！

随后紧接着是LASG模式开发组的组会，见到了龚华师兄以及包庆老师，包老师主导，明显是一位活力四射开朗有趣的老师。我介绍了CESM在天河二号上移植的情况，有点小紧张。包老师表示很好，也希望作为模式组未来机器选择的一个参考，讲了很多有意思的事情 ，比如NCAR的超级计算机（估计是yellowstone）是装在3000+m的山上的，可以利用环境散热，TH-2装在广州，天天那么热，这个散热费肯定海了，最后还不是承担在用户身上，价格居高不下。对呀！很有道理。又讲中国硬件是有啦，软件却是个大瓶颈啊，和国外差的远了。所以我们必须要跟上，必须自主研发才行啊。暗暗佩服，包老师确实是懂得深明大义的牛人啊。

中午一起去吃饭，中餐似的快餐店，名字忘了，在路对面商业区，点了份东坡肉，味道还可以，就是搭配可乐感觉有点诡异。

下午去东航售票点取票，北土城地铁站还是挺远的，中间路过微电子所，三元桥下了地铁后还是走了好长一段路才到东航的售票点，那个片区叫静安里。大气所这边叫华严里，才发现北京好多“里”啊，可能和胡同有关？

嗯，大概就这些啦。

&nbsp;
---
layout: post
title:  "【已解决】vim左列显示行号" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

打开

:set nu

关闭

:set nonu

但是想将这个设置写进VI的配置文件，就

# vi ~/.vimrc

在这个文件中，添加

set nu

就行了
<p style="text-indent: 2em;">:set number
:set nu 这个是简写</p>
<p style="text-indent: 2em;"></p>
<p style="text-indent: 2em;">参考：http://happyolucky.blog.163.com/blog/static/12235640020096235012610/</p>
---
layout: post
title:  "【已解决】大气所链接天河二号终端流输出卡的问题" 
categories: HPC
tags: HPC
author: LZN
---

* content
{:toc}

大气所包庆老师希望测试一下cam5在天河二号上的速度表现情况。连上去编译的时候发现非常卡，表现为编译命令行在终端输出一部分后卡在某个位置3-5分钟，之后才能继续正常继续运行。编译一次会卡这么十几二十个位置，实在让人没法接受。超算方面解释为网络问题。试着将输出流重定向到文本文件后，速度正常了。其他命令如top、w、yhq等也会出现类似卡顿。基本可以确定应该是因为某种网络或者说是超算登陆节点分时算法对网络延时处理的原因，远程终端的流输出过大时会进行限制，从而产生卡顿。经验就是，出现这类问题时，尽量减少远程终端上的流输出。
---
layout: post
title:  "【已解决】shell中的数值计算" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

在天河二号上，想在bash中根据申请的节点数自动计算核心数，其实就是一个n= N*24这样简单的计算，但是bash中的变量是没有数据类型的，所以还是查了下资料才解决。很简单，用中括号，中括号包含的数学式子是可以被shell识别的。主要中括号最外面还要<strong>$</strong>展开一下，否则下例echo时会返回“100+200”

例子：
<blockquote><span style="background-color: #ffffff;"><span style="color: #333399;">[root@localhost ~]# cat  test.sh</span></span>

<span style="background-color: #ffffff;"><span style="color: #333399;">#!/bin/bash
var1=100
var2=200
var3=$[$var1+$var2]
echo $var3</span></span>

<span style="background-color: #ffffff;"><span style="color: #333399;">[root@localhost ~]# sh test.sh
</span></span></blockquote>
<span style="background-color: #ffffff;"><span style="color: #333399;">300</span></span>

参考资料：http://www.baidu.com/link?url=GwzHXLxzHdFb549J1fGR5gcyoRlCuW48q6LH7yRqmbSfGYrFITZ6pIXMy-bJ3yImnZ6XPBBjL3wKt6xer1Fvqq

&nbsp;
---
layout: post
title:  "大气所学习小记20140729" 
categories: Living&amp;thinking
tags: Living&amp;thinking
author: LZN
---

* content
{:toc}

早起公交，早饭。饭后去家乐福买了香皂和纸巾，发现把杯子丢在了宿舍，于是又买了一瓶水。

到所里发现办公室没有开门，没钥匙。发短信问国魁师兄什么时间过来。没回。便先去了611孟军师兄的办公室小坐。九点多下来一次还是没人，好在十点钟有报告。

报告内容：http://www.lasg.ac.cn/xsbg/2014/7/q1c61fkk14.htm。前两天杨老板发消息说中大八月份的一个报告便是这个。

Prof. Wang没有讲数学细节，依然听不懂。大概内容是通过最大熵增原理去计算地表能量收支，可以理解为一个模型或者说通用方法。信息熵的观点引入到地学研究的一个成功范例。前面讲和Bulk Transfer Model的对比，一般陆面模式的Bulk Transfer Model缺点倒是记得清楚：1.计算过程中能量缺乏守恒性，2.存在梯度计算，测量误差很大，3.风速的不确定性，粗糙度的难以测量，4.一阶闭合本身就是近似，精确度有限。

Model的数学基础有四点：1.贝叶斯概率论；2.信息熵；3.最大熵原理；4.最大熵增原理

讲了一个简单的并联电路求分流的例子，大家都知道用欧姆定律。从最大熵原理的角度进行解析的话，系统会使得总的热耗散最小（why？），方程很好列，乘上个拉格朗日算子就解出来了。虽然我不知道怎么解……

计算地面能量收支的过程基本类似：物理上，无非就是净辐射进来，感热潜热出去；冰面雪面水面冠层适当进行一些调整。根据这个物理情景构造热耗散函数，乘拉格朗日算子，如法炮制。解出来的结果是Prof. Wang Highlight的。参数就是热惯量，潜热的惯量又正比于感热的惯量，不知怎么又把方程的自由度限制了一下，发现只和入射净辐射、Ts和比湿有关。优点很明显，没有风速了，不用粗糙度了，也不用梯度了，pia的一下把测量中最困难的几个量给扔了，帅呆！

最后拿这个model算了些东西，和观测对比，貌似日变化之类还是能对上的，强度差的挺大。又和NCEP提供的资料对比，发现两者差的更大了，但是NCEP的潜热通量看上去是觉得不对，六七八月南半球日极值到了500W，换算成蒸发有6-7mm，而且南半球的潜热通量要比北半球高；Prof. Wang的Model是整个反过来的，从直观上想一下，貌似还是应该北半球夏季蒸发多一点，潜热通量大一些吧。

听完报告回办公室发现有人来了，放下包吃饭。吃完饭回来打算给办公室的师兄师姐分好丽友，刚刚拿出来，包庆老师就来找我。叫到他办公室，说有没有查邮件啊，我说没。说清华有个薛老师也是移植CESM有些问题，你和他交流下等等，他是做计算机出身的，基本超级计算领域清华应该是国内的top1了，可以学习啊云云。我说好好好。包老师办公室不大，也不小。有长沙发，开放式的办公桌，桌上应该是Mac Pro。其他地方没细看，应该有一部打印机。办公椅看上去非常舒服，整个人都可以陷进去一般，虽然包老师坐着，但给人一种埋在沙发里躺着的感觉，这么工作起来还是挺惬意的。以后我也搞这么个椅子，再适当运动运动。就不用总担心颈椎腰椎了。后来三点多钟到走廊走了走，恰巧包老师端着杯子上来，说三楼有现磨咖啡豆，你喝不喝咖啡，免费的，我们所已经共产主义了哈哈哈~包老师确实是很能干，也很会干的人，前途无量啊。

下午准备晚上找何编聊的内容，张方案的源文件接近四千行代码，搜索cape十几二十个结果，看上去完全没头绪。反正文件锁定了，晚上再问问吧。对何编的试验设计还是有疑问，做了ppt备注。晚上一并去问问。

下午吃过饭回来，发现门又锁了。从六点半直等到八点半，本来还想再过一遍ppt，结果师兄回来开门之前何编老师就打电话让我过去了。两个多小时等待期间背了背托福单词，又跑到四十号楼转了一圈参观。四十号楼和科研楼是连体的，在楼内直接可以走过去。发现人很少，走廊又没有窗户，很封闭的感觉，晚上还有些恐怖。开门后拿了电脑就去找何编，从科研楼509到40#楼711，路挺绕。

问明白了试验设计，方案，何老师的基本思路还是希望我能把每个积分步中的物理过程调用的顺序搞清楚，接口搞明白，之后再往Ttendency上加这个Heating的强迫项，不是直接改张方案这么简单，shallow convection和large-scale 里面也有Q啊，不是说直接在张方案里注入就行。又解释了一番A那篇文章的试验设计。其实很多地方还是和我想的比较类似的，从物理合理的角度出发，方法可以自己确定，Annual Cycle这类信号肯定是会去掉的，作者没必要说那么详细。想来想去，还是自己读的太少。很多方法和技术的运用，基本是约定俗成的，看到response差不多了，也就应该明白怎么操作的了，没必要细究（或者说不细究也就明白了）。说到做Model的苦与乐。技术活居多，门槛高，动手要勤快，Paper不好发，但真正钻进去才是窥探物理本质，才有意思。对我来说，coding本身就是很有挑战性满足支配欲的事情嘛~更何况深入的是物理而不是回归来合成去看到似是而非的现象就扯所谓的本质。“为赋新词强说愁”。说到做model的好处，也很明显，本身门槛就高，做的人少，所以一旦有人会，那便很抢手，吃香。突然想到了前段时间flash编程突然大受欢迎，因为互联网发展，网页游戏繁荣，而会flash编程的人又太少，所以瞬间此类人才价格疯涨。不知道目前怎么样了，估计应该昙花一现吧，前端不是html5+css3的天下了么，毕竟IT新陈代谢太快了。又太久没关注了啊~

说道这里，瞬间有些不太美好的感觉。做model会不会也昙花一现呢？风险高的几点就在于，首先气象这个领域出路太狭窄，太专太封闭；其次，而仅仅做model又很难从一般科研人员堆paper的路子爬上去，因此一旦气象科研的路数变了，或者整个领域出现了因宏观政策性调整等不确定因素造成的坍缩，做model的人很难将已经深入的专业知识转移到其他领域，从而威胁到个人及家庭的底层生存需求。

话说回来，毕竟能做model能做技术活的人肯定要有较好的计算机、网络以及Linux等基础，动手能力自然不差。所以明确的路子还是支起一行副业，而且是与专业相关的比较靠谱。开网店、投资期货、炒股等基础投入大、风险高而且经验几乎没有，没有一定资本前还是暂且不作考虑。当然首先还是要踏踏实实地积累好本专业基础知识，试着发paper；同时继续保持对IT行业的高敏感度及热情，了解整个业界动向，不断学习新技术积累建站搭站、硬件及操作系统维护、网页编程、网站管理经验，拓展渠道试着去接手一些外包项目，多结交技术型人才，拓展信息源。大致能够理清三条线吧：1.夯实基础，深入数值模式；2.广泛涉猎，提好科学问题，paper发好、发多；3.保持对本专业及IT行业的热情，终身学习，试着发展相关副业。

&nbsp;
---
layout: post
title:  "【已解决】天河二号上CAM5强可扩展性测试" 
categories: CESM HPC
tags: CESM HPC
author: LZN
---

* content
{:toc}

应包老师要求，在天河二号上进行CAM5的强可扩展性测试。进行一个节点测试的时候发现积分速度才2.7yr/day，着实吓了一大跳。CAM4可是12.7yr啊，速度还赶不上CAM4的1/4？？！！换其他计算节点后还是这个速度，看起来CAM5的计算量增加的不是一点半点啊。最后测试结果如下，基本只有CAM4四分之一的速度。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/07/QQ图片20140730164146.jpg"><img class="alignnone size-medium wp-image-49" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/07/QQ图片20140730164146.jpg" alt="QQ图片20140730164146" width="600" /></a>

晚上看NCAR Tutorial的时候看到了几张图，从上到下分别是CAM5的物理过程，CAM4和CAM5的积分步流程。可以看到CAM5各个物理过程之间也存在通信（这才合理嘛！）。再加上辐射方案的改进，计算时间也大增，据包庆老师说辐射计算时间占到总计算时间的一半以上。CAM5会这么慢其实也合情合理吧。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/07/图片1.png"><img class="alignnone size-medium wp-image-52" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/07/图片1.png" alt="图片1" width="600"/></a><a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/07/QQ截图20140731084017.gif"><img class="alignnone size-medium wp-image-50" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/07/QQ截图20140731084017.gif" alt="QQ截图20140731084017" width="600"  /></a><a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/07/QQ截图20140731084049.jpg"><img class="alignnone size-medium wp-image-51" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/07/QQ截图20140731084049.jpg" alt="QQ截图20140731084049" width="600" /></a>
---
layout: post
title:  "【已解决】CESM源码查阅技巧（Linux下文本文件处理技巧）" 
categories: Linux CESM
tags: Linux CESM
author: LZN
---

* content
{:toc}

在经历两天完全没有头绪的痛苦过程后，终于想起来去年十一月刚刚开始试着移植CESM的时候在工作站上下载的CAM Tutorial。抓过来一看，果然有physics和接口的介绍，虽然Tutorial已经是09年的了，但当时居然已经是CAM5的版本……NCAR五年前就已经转的起来CAM5的物理包了么……天河二号上转起来都这么慢，反正Tianhe-2性能指标基本都是靠Phi顶起来的，也不奇怪。扯远了。

这套tutorial的interface模块介绍写得正合我胃口，基本都是介绍CAM源码结构，运行流程的。看过Neale的Physics in CAM的Tutorial，对大致的物理过程运行流程清楚后，这个interface模块介绍的tutorial看起来还是很顺的。而且值得窃喜的三点是：

1.我居然下载了它，因为目前CESM官网上已经删除了10年以前的培训材料。当然这会有一个比较大的问题，10年之后基本都是针对CESM的，每个模块都讲，但是都讲不细致。所以已经找不到针对CAM Interface的培训资料了。我很幸运。

2.它里面举的例子居然是针对convect_deep.F90诶~就是要改你丫的嘛啊哈哈哈

3.2009年NCAR就已经用起来CAM5了诶！啊哈哈哈！

不扯了，说正题。其实就是为了记录一下vi已经linux的一些使用技巧，尤其是处理文本的时候（比如源代码）。

vi下查找
<blockquote>:/the_content_you_search</blockquote>
查找下一个用n键

<strong><span style="color: #008000;">#Up to 20140729#</span></strong>

在physics的主调用程序下查找所有的物理包，这个命令很好用。
<blockquote>grep call tphys*c.F90</blockquote>
tphys*c.F90通配了before和after coupling的两个物理包调用文件，grep这两个文件中的call语句（亮点！），因此抓出来的都是参数化过程。

<strong><span style="color: #008000;">#Up to 20140731#</span></strong>

上述语句配合管道符可以改写为
<blockquote>cat tpys*c.F90 | grep call</blockquote>
<strong><span style="color: #008000;">#Up to 20140802#</span></strong>
<div class="entry-content">

<strong>统计源码行数：</strong>比如位于CAM的源码根目录下，统计CAM的源码总行数（去掉空格）
<blockquote>$find ./ -name “*.F90″ |xargs cat|grep -v ^$|wc -l</blockquote>
答案是——————————499742

居然不到50万行，比我想象要少诶……

参考资料中还有记录空行等命令格式

http://www.cnblogs.com/fullhouse/archive/2011/07/17/2108786.html

<strong><span style="color: #008000;">#Up to 20140815#</span></strong>

</div>
---
layout: post
title:  "【已解决】CESM F Compset指定SST和CO2外强迫的方法" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

打算开始在CESM的框架下做何编老师的试验，试着从CESM的scripts出发编译F Compset，结果神奇地发现居然还需要下载数据。问题是之前已经可以通过standalone的方式运行CAM5了呀，神奇的地球。决定用standalone的方式转转，对比下到底有什么不一样。

CESM的编译方式还是遇到些阻碍，问题及解决方法记录在这里。

1.F_2000_CAM5下载数据后编译失败，编译输出目录为out-of-box设置时config_machines.xml指定的位置。解决方案：xmlchange改env_build.xml重新指定编译输出目录。通过！

2.查看env_run.xml发现rundir也是默认的，果断要改。xmlchange同时改运行时间。

3.修改user_nl_cam，加入针对CAM的namelist更改项目。最初直接把SST和CO2强迫都加这里，结果create_namelist都通过不了。还是一点点来吧。关于海温强迫的方法，standalnoe和F的方式是不一样的。参考帖子：

https://bb.cgd.ucar.edu/node/1001744

UG上有一篇讲B SST OUT, F SST IN的，里面提出要修改env_run.xml。

CO2最初只修改了cam中的co2vmr这个变量，结果CLM崩了，应该是两边CO2不匹配，standalone实在不知道怎么对CLM进行修改，F下找到响应变量修改后，运行到第四天出现sigfault。后来发现居然有一个统一变量叫CCSM_CO2_PPMV啊！坑爹，修改后没问题。

4.qsub提交任务的时候出问题，需要注意 run脚本中第一行 csh后面的-f参数需要去掉，这是最初移植的时候遗漏的问题。

&nbsp;

&nbsp;

以上问题最终的解决办法写在下面：

1. 在 $CCSMROOT/scripts/ccsm_ut

能够通过的步骤写在下面，以1999-2008变暖后的clim SST及CO2强迫为例：
<blockquote>$ create_newcase -case awcam5 -compset F_2000_CAM5 -res <strong>f19_f19 </strong>-mach sigon #注意$CCSMROOT/scripts已经加入PATH环境变量

$ ./xmlchange EXEROOT=`pwd`/exe #反点号括起来的pwd会被执行，其输出并同/exe输入给exeroot变量

$ ./xmlchange RUNDIR=`pwd`/exe

$./cesm_setup

$./awcam5.build</blockquote>
build后修改外强迫。

首先是CO2：
<blockquote>$.xmlchange CCSM_CO2_PPMV=385.59 # 2009年数据，这个变量在env_run.xml当中</blockquote>
再是海温，首先将总input数据链接过来，防止路径被新提供的inputdata污染，再修改响应变量。

$link_dirtree $CSMDATA ./input

$./xmlchange DIN_LOC_ROOT=`pwd`/input

cp处理后的SST数据到相应位置，修改响应namelist变量，包括起止年份及文件名称。这个名字太长，建议直接vi。

$./qsub awcam5.run

此外有一点发现是，F_2000采用的不是AMIP形式的观测资料强迫，而是气候态海温循环强迫。
---
layout: post
title:  "看CESM Tutorial CAM Physics (Video)的一点想法" 
categories: CESM Living&amp;thinking
tags: CESM Living&amp;thinking
author: LZN
---

* content
{:toc}

今天看完了Tutorial里关于Physics in CAM的视频。下载发现从2010年到2013年每一年的Tutorial释放出的pdf都差不多，但是13、12年却都没有这一场lecture的视频，这部还是从11年的resource里下到的。报告者是Neale，很年轻小伙，思维灵活，语速很快，基本跟不上，长相看起来很干练。有那么一两分像Prof. Yi Ming，当然啦，一个华人一个老外。

快讲到最后几张ppt的时候Neale吐了个槽很好玩，大概意思是我们搞Atm Model真是悲了个剧啊，我们要处理云啊你造么，各种姿态各种高度各种分布各种奇葩的云啊你造么，云里面水也有冰也有雪也有霰也有水汽还有，固液气一家三口都在里面啊你造么，都是二话不说直接扔给我们搞Atm Model的来处理啊……哪像人家Ocean Model，天天转的都是液态水，海表蒸发出水汽了，人家不要了，直接扔给大气模块；海表冻出冰了，人家也不要了，这是冰雪模块干的事……

一哂过后，想到前段时间在PNAS上看到的一篇文章，大概是说给CESM来了个Super-parameterization，看高CO2情景下的响应。所谓Super-Parameterization，实际就是在CESM的每一个大网格里都套了一个更小尺度的专门对付积云对流的模式，结果好像是发现在全球这个尺度的响应上，和CESM默认的Zhang方案有差不多的效果，说明CESM的对流参数化还是做得不错的。话说回来，Neale吐得槽以后能不能用这种类似方法来解决呢？即专门开发积云模式，然后做好接口工作套在全球模式里就可以了。广而言之，能否把参数化过程都独立成一个个的模块，由该领域的专业人员进行开发，使得这些模块独自能够运行（比如专门的边界层模式、辐射传输模式），也可以嵌入到CESM这种全球模式中。

想来想去，其实现在已经有了呀。专门的边界层模式、辐射传输模式（RRTM不就是商业公司的产品么，由于太优秀了所以被引入气象模拟……）、积云模式等等，模块化必然也是全球模式的趋势吧：CESM等已经做了大圈层的模块化，如大气模块海洋模块冰雪模块等等，下一步圈层级模块内部物理过程的模块化应该也是必须的。当然，对全球模式来说，挑战还是很多的：首先必须要出台统一的接口标准，貌似ESMF、MCT这些就是干这个的，不过不了解，也不知道委员会成员的野心大不大，能搞出一套类似通信网络OSI 7层模型这种高大上的接口标准那就牛逼了；其次还是计算的问题，如果每一个大网格点都要在次网格的尺度上去转很多小模式，那计算时间肯定会暴涨，对计算机的计算能力也是个不小挑战。

嗯~就YY这么多啦，还是要继续深入了解才行。全球模式开发越来越成为一个系统工程了，越来越向物理学中的LHC等大项目看齐了，这无疑是很好的嘛，这也应该是逐渐地把地学建立在牢靠的数学物理基础上的最佳方式了吧。
---
layout: post
title:  "【已解决】Linux下安装Wmware虚拟机" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

下午包庆老师过来询问天河二号的使用体验如何，卡不卡。我说还可以，越来越稳定吧。然后打开putty测试了一下，vim等编辑软件都不卡。传输速度怎样？我说不知道，没有在大气所这边试过。因为内网有IP冲突
---
layout: post
title:  "【已解决】CESM输出频率和变量的调节" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

在被上一篇（http://222.200.180.66:1234/L_Zealot/blog/wordpress/?p=64）文章中所出现的问题折腾很久后，决定不再直接转30年那么久，还是一点点先调整再说。默认转5天，为了检测，就需要把输出也调节为逐日输出。这一点在CESM的users' guide上写的比较清楚。

比如逐日输出，标准输出变量场中加入QFLX变量，cesm_setup前将以下namelist变量的修改加入user_nl_cam
<blockquote>
<p style="padding-left: 30px;">nhtfrq= -24</p>
<p style="padding-left: 30px;">fincl1='QFLX'</p>
</blockquote>
之后采用cesm_setup可以验证namelist的修改是否正确。

假设运行5days，希望每天生成一个文件的话，加入如下语句
<blockquote>
<p style="padding-left: 30px;">mfilt=1</p>
</blockquote>
---
layout: post
title:  "【已解决】天河二号CESM自动编译环境搭建" 
categories: Linux CESM HPC
tags: Linux CESM HPC
author: LZN
---

* content
{:toc}

今晚想在天河二号上把bw和aw的几个case跑起来，顺道把所有的脚本都规整一遍，以便将来自动化。

没想到困难多多。第一次编译倒是顺利，适当修改run脚本后，yhbatch却提交不了任务。回去查看mkbatch，把与PBS相关的都给干掉后，结果生成的run文件直接没有yhrun语句。无语了。好在第一次编译的程序可以通过yhrun提交任务，哪知道提交半小时一个输出也没有。情况和最初用14编译器编译时一样，节点直接down掉。查看了一下ifort -v，果然又是14编译器作怪！为什么会这样呢，环境变量里分明设置好了。

后来发现，原来之前从ln20 ssh到了ln22，返回后就出现了这个问题。而直接登陆ln20不进行ssh则不存在问题。实在是诡异……
---
layout: post
title:  "【已解决】CAM增加自定义输出变量" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

做何老师在FGOALS上的试验，需要把加热率的输出，但是不在Master list里，要hard-coded进去。官方文档（CAM3 ug）和tutorial上都有介绍方法，不过写的都很简单，甚至连在哪一个文件里改都没有介绍。几经周折，发现大部分输出都在cam的physics包下的cam_diagnostics.F90下。预计是就把三条语句直接加在了这里，结果运行后长时间没有输出，看起来不对。

之后的思路是仿照已经在master list里的变量加入history output的方法，去查找这些非默认加入的变量，在cam_diagnostics.F90这些变量的响应位置加入对加热率的输出，结果出现了编译不通过的情况。具体错误为大致数组没有声明。

查看physpkg.F90，发现加热率在每一个物理包运行后都会被physics_update归零，所以变量应该只能在调用deep_convect后而update前进行输出，于是吧addfld和add_defalult加载cam_diagnostics文件下，而outfld加在刚刚所说的位置。目前可以输出，还没有检查输出是否有问题。

<strong><span style="color: #008000;">#Up to 201408071349#</span></strong>

回到住宿处用ncl查看，将26层全部输出，确实中高空都是有数值的，看起来问题不大。但是量级上达到0.1K/kg/s，1分钟加热6摄氏度？考虑到对流的时间尺度，或许是这样吧……等回来真正开始做试验的时候具体看看。

<strong><span style="color: #008000;">#Up to 201408072319#</span></strong>
---
layout: post
title:  "【已解决】CESM Source Code Modified编译后运行无输出" 
categories: CESM HPC
tags: CESM HPC
author: LZN
---

* content
{:toc}

学校四期平台，程序能够成功编译和运行，但是提交任务后不输出。del掉后log文件出现

Could not chdir to home directory /users/XXXX: No such file or directory

后来或者索性没有输出。应该是节点通信错误，无法找到文件系统？多次尝试重新提交有时可以解决该问题。
---
layout: post
title:  "【已解决】统计某目录下源码文件的代码行数" 
categories: Linux CESM
tags: Linux CESM
author: LZN
---

* content
{:toc}

比如位于CAM的源码根目录下，统计CAM的源码总行数（去掉空格）
<blockquote>$find ./ -name "*.F90" |xargs cat|grep -v ^$|wc -l</blockquote>
答案是——————————499742

居然不到50万行，比我想象要少诶……

参考资料中还有记录空行等命令格式

http://www.cnblogs.com/fullhouse/archive/2011/07/17/2108786.html
---
layout: post
title:  "【更新中】CAM SourceMod加热廓线强迫的引入" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

在physpkg.F90引入理想加热廓线，设定为第32个calday（2月1日）在整个垂直层面上加入0.2K/kg/s的加热率，随同深对流update入环境场，结果运行到第46天某个时候down掉了，log输出为
<blockquote>BalanceCheck: soil balance error nstep = 2176 point = 4646 imbalance = -0.000000 W/m2
QNEG3 from vertical diffusion/SO2:m= 8 lat/lchnk= 682 Min. mixing ratio violated at 1 points. Reset to 1.0E-36 Worst =-5.1E-12 at i,k= 4 30
QNEG3 from convtran2/DMS:m= 9 lat/lchnk= 825 Min. mixing ratio violated at 1 points. Reset to 1.0E-36 Worst =-1.8E-12 at i,k= 9 30
filew failed, worst i, j, qtmp, q = 1 66
-21885.3982648784 5.567182215867588E-009
QNEG3 from TPHYSBCb:m= 4 lat/lchnk= 220 Min. mixing ratio violated at 2 points. Reset to 0.0E+00 Worst =-3.9E+00 at i,k= 12 17
<strong>urban net longwave radiation balance error -4.05656153273048</strong>
<strong> clm model is stopping</strong></blockquote>
城市长波出问题？小怀疑了一下。后面clm先停掉了，莫非与surface交换有问题，想起来这个加热率其实下面几层都是没有的，第一次尝试将下面几10层的加热强迫情况设置为0，结果还是不行，不到45day就down掉了。后来发现居然是有个北纬30°以南的判定条件忘了化成弧度制！！坑爹啊，换弧度后，为了响应较快，将强迫加入时间调整为day3到day30，居然没有断掉。Okay！3day后全年加入！

<strong><span style="color: #008000;">#Up to 20140802#</span></strong>

接上回。全年加入后断掉了。ncl看前一组3-30day强迫的响应，发现加热源位置强度都没问题，但是T的响应位置有点偏北，很奇怪。U风看到了气旋式响应貌似正常。何老师也对此表示奇怪，但是认为基本问题不大，可能是量级太高造成，大气层顶响应都到了20+℃了，后面太高可能因此崩掉。建议减小量级，并且把400-500hPa左右设置为最大值，关注injection的位置分别在deep convection前后有什么不同。简单起见我先把量级缩小到0.05K/kg/s，从day3到day365加了接近一整年，居然没有出问题，顺利积分完成。打算回学校再按照何老师的说法试试。

<strong><span style="color: #008000;">#Up to 20140815#</span></strong>

继续接上回。会学校后各种杂事，倒是正巧超算各种不稳定。这两天终于的空，机器可用了。将加热量级最大值缩小到0.05K/kg/s，最大值固定在500ha附近，两侧线性递减到0。分别测试将这个forcing profile加在deep convection前后以及shallow convection后，强迫时间JJA，区域90-120E，0-30N；除了加在deep convection前模式SIGFAULT崩溃外（没有找到原因，可能进入物理包后模式才会进行tendency变量分配？所以加前面会造成数组越 界？），加在shallow后或deep后仅一年月平均的结果就无本质区别，可以确信做ensemble后更相差更小，与我们之前讨论时的预想一致，结果 详见附件。目前在测试加在PBL过程后，预料差别应该也不会大。终于看到期望中的结果啦～

加在deep convection与shallow convection后6月响应的对比如下图

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/08/Screenshot.png"><img class="alignnone size-full wp-image-128" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/08/Screenshot.png" alt="Screenshot" width="1100" height="745" /></a> <a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/08/Screenshot-1.png"><img class="alignnone size-full wp-image-129" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/08/Screenshot-1.png" alt="Screenshot-1" width="1084" height="746" /></a>

总结一下修改方法。

1.输出，按照addfld add_default outfld 三个步骤来，在cam_diagnostics.F90中依葫芦画瓢，在physpkg.F90中响应的位置outfld。

2.加热强迫的加入在physpkg.F90中做injection，有两个module记得引入，一个是time_manager，应用get_curr_calday返回日序数，控制加热强迫的作用时间。另一个就是outfld对应的cam_history的module。

physics_state里的lon和lat成员控制空间位置，注意弧度制。其所在的physics_types这一module物理包运算时一定会引入，因此不必再做重复工作。

3.pver控制垂直层面，chunk目前还是可以当黑箱的，知道它是若干columns的集合即可，作用时需要遍历chunk中的每个column。

core injction code:
<blockquote>1499 calday = get_curr_calday();
1500 if (calday &gt; 151 .and. calday &lt; 244) then
1501   do i = 1,ncol
1502     if ((state%lon(i) &lt; (2._r8/3._r8)*3.14159265 ) .and. &amp;
1503     (state%lon(i) &gt;0.5*3.14159265) .and. &amp;
1504     (state%lat(i) &gt; 0._r8) .and. &amp;
1505     (state%lat(i) &lt; 3.14159265/6._r8)) then
1506       ptend%s(i,17) = ptend%s(i,17) + 0.01
1507       ptend%s(i,18) = ptend%s(i,18) + 0.03
1508       ptend%s(i,19) = ptend%s(i,19) + 0.05
1509       ptend%s(i,20) = ptend%s(i,20) + 0.03
1510       ptend%s(i,21) = ptend%s(i,21) + 0.01
1511     end if
1512   end do
1513 end if</blockquote>
<strong><span style="color: #008000;">#Up to 20140825#</span></strong>

前两天终于把SEN和CON两组试验跑完，终于可以把真正的试验廓线差求出来，正式做HEATING试验了。还没有画图，看了下数值大概分布，基本合理。具体试验设计

<strong>incSCS组</strong>

<span style="color: #0000ff;">0-30N, 105-150E, JJA, CON SST &amp; CO2</span>

<strong>outSCS组</strong>

<span style="color: #0000ff;">0-30N, 120-150E, JJA, CON SST &amp; CO2</span>

承诺下周给何老师结果。囧zn

<strong><span style="color: #008000;">#Up to 20140903#</span></strong>
---
layout: post
title:  "一线城市房价现下跌，评论一条" 
categories: Living&amp;thinking
tags: Living&amp;thinking
author: LZN
---

* content
{:toc}

今天腾讯弹出新闻看到一线城市房价整体现下跌，http://finance.qq.com/a/20140819/010416.htm?pgv_ref=aio2012&amp;ptlang=2052

有人说，十年涨了1000%跌了1%，没用。下面有一则长评倒是说得事实：
<blockquote>贪官和炒房客都在低价抛售，想忽悠老百姓接盘好脱身上岸，开发商市面上一手房存量巨大，售楼处门可罗雀，空城鬼城遍地都是，还有海量新建及待建楼盘蜂拥上 市，加之老百姓买涨不买跌的心理作祟，房产登记为房产税的征收铺平道路，前几天的倒楼事件又为房产的使用寿命大打折扣，现在当降价的多米诺骨牌轰然倒下， 崩盘将势如破竹，一发不可收拾（毕竟房地产这十年来上涨了十倍，早就不是一般工薪阶层所能企及，开发商除了赚取不菲的利润，银行的利息及高利贷，就连贪官 包二奶的钱都是购房者出）崩盘也只是让房价回归到原始价值，就看谁是最后一个接棒者了，房价没有最低，只有更低！</blockquote>
---
layout: post
title:  "CESM1_2_0源码行数统计" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

跑起来了Heating的试验，outfld也没出来到能画图的地步，忙里偷闲，用上次提到的统计行数的办法（http://222.200.180.66:1234/L_Zealot/blog/wordpress/?p=92），统计了一下cesm1.2.0总代码行数，结果如下
<blockquote><strong>1,199,145</strong></blockquote>
居然一共才不到120万行，与我想象的有差距啊。一个active的CAM就占到了接近一半，地球系统这个东西还是大气比较复杂 ……

其中，各个分量模块（包括接口等）及Active分量的行数如下
<table style="height: 47px;" width="354">
<tbody>
<tr>
<td rowspan="2">
<h3 style="text-align: center;">atm</h3>
</td>
<td colspan="2"><strong><span style="color: #ff6600;">511,843</span></strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">CAM</span></strong></td>
<td><span style="color: #ff6600;"><strong>499,741</strong></span></td>
</tr>
<tr>
<td>
<h3 style="text-align: center;"><strong>csm_share</strong></h3>
</td>
<td colspan="2"><span style="color: #ff6600;"><strong>34,142</strong></span></td>
</tr>
<tr>
<td>
<h3 style="text-align: center;">dead_share</h3>
</td>
<td colspan="2"><span style="color: #ff6600;"><strong>341</strong></span></td>
</tr>
<tr>
<td>
<h3 style="text-align: center;">drv</h3>
</td>
<td colspan="2"><span style="color: #ff6600;"><strong>25,439</strong></span></td>
</tr>
<tr>
<td rowspan="2">
<h3 style="text-align: center;">glc</h3>
</td>
<td colspan="2"><strong><span style="color: #ff6600;">93,206</span></strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">CISM</span></strong></td>
<td><span style="color: #ff6600;"><strong>22,370</strong></span></td>
</tr>
<tr>
<td rowspan="2">
<h3 style="text-align: center;">ice</h3>
</td>
<td colspan="2"><span style="color: #ff6600;"><strong>75,558</strong></span></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">CICE</span></strong></td>
<td><span style="color: #ff6600;"><strong>72,950</strong></span></td>
</tr>
<tr>
<td rowspan="2">
<h3 style="text-align: center;">lnd</h3>
</td>
<td colspan="2"><strong><span style="color: #ff6600;">216,309</span></strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">CLM</span></strong></td>
<td><span style="color: #ff6600;"><strong>175,937</strong></span>
<span style="color: #ff6600;"><strong><span style="color: #3366ff;"> CLM4.0</span> 71,250</strong></span>
<span style="color: #ff6600;"><strong><span style="color: #3366ff;"> CLM4.5</span> 93,857</strong></span></td>
</tr>
<tr>
<td rowspan="2">
<h3 style="text-align: center;">ocn</h3>
</td>
<td colspan="2"><strong><span style="color: #ff6600;">144,761</span></strong></td>
</tr>
<tr>
<td><span style="color: #3366ff;"><strong>POP2</strong></span></td>
<td><span style="color: #ff6600;"><strong>142,292</strong></span></td>
</tr>
<tr>
<td rowspan="2">
<h3 style="text-align: center;">rof</h3>
</td>
<td colspan="2"><strong><span style="color: #ff6600;">10,126</span></strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">RTM</span></strong></td>
<td><span style="color: #ff6600;"><strong>7,778</strong></span></td>
</tr>
<tr>
<td>
<h3 style="text-align: center;">utils</h3>
</td>
<td colspan="2"><strong><span style="color: #ff6600;">86,072</span></strong></td>
</tr>
<tr>
<td>
<h3 style="text-align: center;">wav</h3>
</td>
<td colspan="2"><strong><span style="color: #ff6600;">1,348</span></strong></td>
</tr>
</tbody>
</table>
---
layout: post
title:  "【已解决】CAM垂直坐标转换" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

做Heating试验的时候，何老师提示将Profile中的最大值放在500-600hPa附近。但是CAM中采用的是σ-P混合坐标系统，需要进行坐标转换。之所以采用这种坐标系统，是因为底层为了描述好地形的作用采用σ坐标系统，而高层则采用P坐标系统。而我们通常关心的是P坐标系统下某一层面的情况，比如500hPa位势高度场等。CAM3.0的users' guide 上提供了CAM坐标系统向P坐标系统转化的方法
<blockquote>
<p style="padding-left: 30px;"><strong>p(i,j,k)= Ak P0+ Bk Ps(i,j)</strong></p>
</blockquote>
其中p(i,j,k)为指定点处的气压，A，B，P0均为常数。Ps是模式当前地表气压；P0在模式源码中已被给定。AB在模式输出数据中已经存在，界面处系数分别为hyai和hybi，层面中间点为hyam和hybm。其中主要关注的U V T等变量应该使用hyam和hybm（<strong>对应下图Level Index</strong>），而通量场变量则多位于交界面（<strong>对应下图Interface Index</strong>）。引用CAM 3.0 ug中的图如下

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/08/vc.jpg"><img class="alignnone size-full wp-image-108" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/08/vc.jpg" alt="vc" width="814" height="873" /></a>

在CAM4和CAM5下，中间点对应的气压如下表所示（假设PS=1000hPa，Hard Coded P0=1000hPa）
<table width="470">
<tbody>
<tr>
<td colspan="4" width="470">CAM4 Vertical Transform</td>
</tr>
<tr>
<td>Num</td>
<td>byam</td>
<td>hybm</td>
<td>presure</td>
</tr>
<tr>
<td>1</td>
<td>0.003544638</td>
<td>0.000000000</td>
<td>3.544638</td>
</tr>
<tr>
<td>2</td>
<td>0.007388814</td>
<td>0.000000000</td>
<td>7.3888135</td>
</tr>
<tr>
<td>3</td>
<td>0.013967214</td>
<td>0.000000000</td>
<td>13.967214</td>
</tr>
<tr>
<td>4</td>
<td>0.023944625</td>
<td>0.000000000</td>
<td>23.944625</td>
</tr>
<tr>
<td>5</td>
<td>0.037230290</td>
<td>0.000000000</td>
<td>37.23029</td>
</tr>
<tr>
<td>6</td>
<td>0.053114605</td>
<td>0.000000000</td>
<td>53.114605</td>
</tr>
<tr>
<td>7</td>
<td>0.070059150</td>
<td>0.000000000</td>
<td>70.05915</td>
</tr>
<tr>
<td>8</td>
<td>0.077912570</td>
<td>0.007526545</td>
<td>85.439115</td>
</tr>
<tr>
<td>9</td>
<td>0.076607010</td>
<td>0.023907685</td>
<td>100.514695</td>
</tr>
<tr>
<td>10</td>
<td>0.075071085</td>
<td>0.043179250</td>
<td>118.250335</td>
</tr>
<tr>
<td>11</td>
<td>0.073264150</td>
<td>0.065851245</td>
<td>139.115395</td>
</tr>
<tr>
<td>12</td>
<td>0.071138385</td>
<td>0.092523685</td>
<td>163.66207</td>
</tr>
<tr>
<td>13</td>
<td>0.068637535</td>
<td>0.123902400</td>
<td>192.539935</td>
</tr>
<tr>
<td>14</td>
<td>0.065695415</td>
<td>0.160817850</td>
<td>226.513265</td>
</tr>
<tr>
<td>15</td>
<td>0.062234155</td>
<td>0.204247000</td>
<td>266.481155</td>
</tr>
<tr>
<td>16</td>
<td>0.058162165</td>
<td>0.255339100</td>
<td>313.501265</td>
</tr>
<tr>
<td>17</td>
<td>0.053371680</td>
<td>0.315446300</td>
<td>368.81798</td>
</tr>
<tr>
<td>18</td>
<td>0.047735925</td>
<td>0.386159300</td>
<td>433.895225</td>
</tr>
<tr>
<td>19</td>
<td>0.041105755</td>
<td>0.469349500</td>
<td>510.455255</td>
</tr>
<tr>
<td>20</td>
<td>0.033305700</td>
<td>0.567218500</td>
<td>600.5242</td>
</tr>
<tr>
<td>21</td>
<td>0.024968440</td>
<td>0.671827850</td>
<td>696.79629</td>
</tr>
<tr>
<td>22</td>
<td>0.017095910</td>
<td>0.770606150</td>
<td>787.70206</td>
</tr>
<tr>
<td>23</td>
<td>0.010214710</td>
<td>0.856946050</td>
<td>867.16076</td>
</tr>
<tr>
<td>24</td>
<td>0.004803175</td>
<td>0.924845700</td>
<td>929.648875</td>
</tr>
<tr>
<td>25</td>
<td>0.001260680</td>
<td>0.969294150</td>
<td>970.55483</td>
</tr>
<tr>
<td>26</td>
<td>0.000000000</td>
<td>0.992556100</td>
<td>992.5561</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td colspan="4">CAM5 Vertical Transform</td>
</tr>
<tr>
<td>Num</td>
<td>byam</td>
<td>hybm</td>
<td>presure</td>
</tr>
<tr>
<td>1</td>
<td>0.003643466</td>
<td>0.000000000</td>
<td>3.643465694</td>
</tr>
<tr>
<td>2</td>
<td>0.007594820</td>
<td>0.000000000</td>
<td>7.594819646</td>
</tr>
<tr>
<td>3</td>
<td>0.014356632</td>
<td>0.000000000</td>
<td>14.35663225</td>
</tr>
<tr>
<td>4</td>
<td>0.024612220</td>
<td>0.000000000</td>
<td>24.61222</td>
</tr>
<tr>
<td>5</td>
<td>0.038268300</td>
<td>0.000000000</td>
<td>38.26829977</td>
</tr>
<tr>
<td>6</td>
<td>0.054595480</td>
<td>0.000000000</td>
<td>54.59547974</td>
</tr>
<tr>
<td>7</td>
<td>0.072012451</td>
<td>0.000000000</td>
<td>72.01245055</td>
</tr>
<tr>
<td>8</td>
<td>0.087821230</td>
<td>0.000000000</td>
<td>87.82123029</td>
</tr>
<tr>
<td>9</td>
<td>0.103317127</td>
<td>0.000000000</td>
<td>103.3171266</td>
</tr>
<tr>
<td>10</td>
<td>0.121547241</td>
<td>0.000000000</td>
<td>121.5472408</td>
</tr>
<tr>
<td>11</td>
<td>0.142994039</td>
<td>0.000000000</td>
<td>142.9940388</td>
</tr>
<tr>
<td>12</td>
<td>0.168225080</td>
<td>0.000000000</td>
<td>168.2250798</td>
</tr>
<tr>
<td>13</td>
<td>0.178230673</td>
<td>0.019677414</td>
<td>197.9080867</td>
</tr>
<tr>
<td>14</td>
<td>0.170324326</td>
<td>0.062504293</td>
<td>232.828619</td>
</tr>
<tr>
<td>15</td>
<td>0.161022909</td>
<td>0.112887908</td>
<td>273.9108168</td>
</tr>
<tr>
<td>16</td>
<td>0.150080286</td>
<td>0.172161616</td>
<td>322.2419024</td>
</tr>
<tr>
<td>17</td>
<td>0.137206860</td>
<td>0.241894044</td>
<td>379.1009039</td>
</tr>
<tr>
<td>18</td>
<td>0.122061938</td>
<td>0.323930636</td>
<td>445.9925741</td>
</tr>
<tr>
<td>19</td>
<td>0.104244713</td>
<td>0.420442462</td>
<td>524.6871747</td>
</tr>
<tr>
<td>20</td>
<td>0.084979154</td>
<td>0.524799541</td>
<td>609.7786948</td>
</tr>
<tr>
<td>21</td>
<td>0.066501696</td>
<td>0.624887735</td>
<td>691.3894303</td>
</tr>
<tr>
<td>22</td>
<td>0.050196789</td>
<td>0.713207692</td>
<td>763.4044811</td>
</tr>
<tr>
<td>23</td>
<td>0.037188658</td>
<td>0.783669710</td>
<td>820.8583687</td>
</tr>
<tr>
<td>24</td>
<td>0.028431948</td>
<td>0.831102818</td>
<td>859.5347665</td>
</tr>
<tr>
<td>25</td>
<td>0.022208977</td>
<td>0.864811271</td>
<td>887.0202489</td>
</tr>
<tr>
<td>26</td>
<td>0.016407382</td>
<td>0.896237165</td>
<td>912.6445469</td>
</tr>
<tr>
<td>27</td>
<td>0.011074558</td>
<td>0.925123841</td>
<td>936.1983985</td>
</tr>
<tr>
<td>28</td>
<td>0.006254954</td>
<td>0.951230526</td>
<td>957.4854795</td>
</tr>
<tr>
<td>29</td>
<td>0.001989409</td>
<td>0.974335998</td>
<td>976.3254074</td>
</tr>
<tr>
<td>30</td>
<td>0.000000000</td>
<td>0.992556095</td>
<td>992.5560951</td>
</tr>
</tbody>
</table>
---
layout: post
title:  "关于办户口迁移囧事的一点思考" 
categories: Living&amp;thinking
tags: Living&amp;thinking
author: LZN
---

* content
{:toc}

记得本科把户口从烟台迁到东校的时候，就非常不顺利，跑了初家派出所两三次费尽口舌。没想到，这次从东校迁到南校，也被坑了一把。

按照新生手册说法，只需要把身份证复印件和录取通知复印件准备好，交到学校（学院）处，学校自会处理这种校内升学的户口迁移。看到这些安排一时偷乐，想到俊文说他们那一级还要自己去东校办理，看来我们这一次赶上改革了，群众路线，办事人性化了嘛。没想到结果依然不是一般的折腾。

21日报到，准备好材料交付报到处户籍科，被告知哪里说只需要身份证和录取通知复印件呀，必须要有户口迁移证才行，我说新生手册写的啊。不行不行不行，要自己去办。好吧，看起来还是老样子，不知是群众路线群不到我们这些本科毕业的干部身份呢还是根本就没改革，但丫的新生手册怎么不说清楚。

22日随亚娜珊珊回东校办户口迁移，先学校保卫办后小谷围派出所，没想到派出所没人，办得很迅速，一上午就搞定，以为后面就简单了，下午也懒得回南校，去新开的行政楼餐厅吃了一顿，名副其实郡城的价格四饭的味道，下午在东校实验室折腾杨老师的网站DEMO，不表。

23，24日周末，考虑到南校保卫办不上班，懒得白跑一趟。25下午开学典礼，顺道去保卫办交表。没想到进去就傻眼了——录取通知复印件、迁移证复印件、一寸照片、身份证复印件，一件不能少。我吐槽说之前没通知啊，新生手册就写说录取通知+身份证复印件啊，哪里知道这么折腾。周围不少同学也是相同遭遇，一肚子不满。

不满也没用，白跑就是白跑，还是得回去要通知书上联复印。这种囧事，学校或者说相关部门吧，做的不到位是必然难辞其咎，但毕竟大环境如此，这种小事碰上再正常不过，客观因素改变不了。不妨从个人的角度来想想，如何能够避免麻烦，其实也很简单，找亚娜细细询问一下需要准备的材料，或者打个电话到保卫办问清楚，也就是了。归根结底，自己在已知被提供的资料不足的情况下依然消极被动地对待，想当然地认为XXX，也是造成最终麻烦的重要主观因素。前事不忘后事之师，这次吸取教训了，希望自己下次遇到类似情况能够足够重视，以免更大的麻烦。
---
layout: post
title:  "【已解决】SSH多机无密码访问" 
categories: Linux Internet HPC
tags: Linux Internet HPC
author: LZN
---

* content
{:toc}

ssh无密码访问是实现MPI、以及自动化批处理如scp ssh远程命令等操作的必要设置。单机A对B单向或者B对A双向的操作类似，网上一查一大堆。一对多方向容易搞混，注意复制公钥方向。如A要无密码访问B，将A的公钥(id_rsa.pub)复制到B机的authorized_keys下。

<strong>注意authorized_keys权限为600，.ssh目录权限700</strong>

参考资料：

http://blog.sina.com.cn/s/blog_75b0e2ad010185id.html
---
layout: post
title:  "【已解决】CESM-CAM积分步长调节" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

<h3>CAM Standalone</h3>
namelist修改加入

dtime=1200, nsplit=6, nspltrac=2, nspltvrm=2

第一句是把积分时长调整到1200s每步

后面三个如果不加入会报错，出错信息中会有建议更改的数值，看起来估计是与物理步长中与动力步长的匹配有关，但是依然搞不清楚这几个变量的意义……

以上几个namelist的解释：
<pre><strong>nsplit----</strong>Number of dynamics timesteps per physics timestep. If zero, a best-estimate
will be automatically calculated.</pre>
<pre><strong>nspltrac</strong>----Number of tracer advection timesteps per physics timestep.
Nsplit is partitioned into nspltrac and nsplit/nspltrac,
with the latter being the number of dynamics timesteps per
tracer timestep, possibly rounded upward; after initialization,
the code quantity nsplit is redefined to be the number of
dynamics timesteps per tracer timestep.</pre>
<pre><strong>nspltvrm----</strong>Number of vertical re-mapping timesteps per physics timestep.
Nspltrac is partitioned into nspltvrm and nspltrac/nspltvrm,
with the latter being the number of tracer timesteps per
re-mapping timestep, possibly rounded upward; after initialization,
the code quantity nspltrac is redefined to be the number of
tracer timesteps per re-mapping timestep.</pre>
<h3>CESM Script</h3>
这个除了需要处理standalone中的变量外，还需要更改run_env.xml中存在相应的字段：
<blockquote>&lt;entry id="NCPL_BASE_PERIOD"   value="day"  /&gt;

&lt;entry id="ATM_NCPL"   value="48"  /&gt;</blockquote>
上面那行的设置代表coupler耦合频率的单位，value对应为日，下面那行是在coupler耦合单位内，ATM通过coupler和其他模块耦合的次数，值为48，即每天耦合48次，可以理解为积分步长为1800s（半小时），如果要更改积分步长为900s，将48改为96即可。同时我们可以注意到这个值在后面的语句中分别被赋给了LND OCN等其他模块，保证各个模块的耦合频率一致。如果没有正确修改dtime, nsplit, nspltrac, nspltvrm这些变量，则会出现<strong>Bad namelist settings for FV subcycling报错。</strong>

当然，这里还有疑问就算，我们即便把standalone里修改的几个变量拿过来，也仅仅是修改了CAM的积分步而已，其他分量并没有修改，是会自动更改么？还是怎样？目前测试积分了三年，没有出现问题。

<strong><span style="color: #008000;">#Up to 20140831#</span></strong>

前段时间忘了更新了。对于F05的配置，似乎直接在user_nl_cam中修改dtime=900就可以，什么都不用动……似乎split与dtime呈一定的倍数关系，dtime减半并不影响这个倍数关系的调整。当然，依然没有搞懂……

<strong><span style="color: #008000;">#Up to 20141108#</span></strong>
---
layout: post
title:  "【已解决】大气所拷贝回CESM Input Data硬盘挂载问题" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

从大气所带回来的硬盘用Orico的硬盘座接e-SATA口，windows下直接提示要格式化，这还得了，记得当初这个分区是我做的，ext4格式，重启到Linux下，fdisk -l傻眼了，居然成了NTFS格式，测试mount -t ntfs-3g或ext4都不行，百般无奈以为出现坏道了。结果双击文件系统下的2TB文件系统却可以挂载了，显示为ext格式。无语……

<strong><span style="color: #008000;">#Up to 20140831#</span></strong>

到超算中心拷贝出现同样问题，钟英师姐帮忙发现其实问题很好解决，直接不使用-t参数指定的话，系统会自动检测类型挂载。反正不知道系统怎么检测出的，能挂上就是了……以在/dev/sdc5为例
<blockquote>mount /dev/sdc5 ./</blockquote>
DONE！

<strong><span style="color: #008000;">#Up to 20140903#</span></strong>
---
layout: post
title:  "【已解决】rsync命令的使用" 
categories: Linux Internet HPC
tags: Linux Internet HPC
author: LZN
---

* content
{:toc}

同步CESM的input数据到hpc4，但是已有的文件不希望被覆盖掉，scp不能用，只能采用rsync命令。以从东校区工作站传回数据为例
<blockquote><strong>rsync -vzrtopg --progress -e 'ssh -p 80' workstation@222.200.180.66:/home/workstation/L_Zealot ./</strong></blockquote>
参数解释：
<blockquote>-v, --verbose 详细模式输出
-z, --compress 对备份的文件在传输时进行压缩处理
-r, --recursive 对子目录以递归模式处理
-t, --times 保持文件时间信息
-p, --perms 保持文件权限
-o, --owner 保持文件属主信息
-g, --group 保持文件属组信息
--progress 在传输时现实传输过程
-e 'ssh -p 80' ssh方式传输，端口80</blockquote>
---
layout: post
title:  "【更新中】Wordpress主题模板修改" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

杨老师网站要求wordpress主题模板采用浮动框的形式显示内容。类似学校网站http://www.sysu.edu.cn/2012/cn/index.htm这种组织形式，搜索半天，似乎没有类似主题，没办法，这个只能自己动手丰衣足食了，无奈对wordpress主题php及css组织结构毫无概念，请教俊文大概了解实现方向后只得从基础开始学起。这里算是个笔记吧。
<h4>模板文件及工作流程</h4>
一套完整的WordPress模版应至少包括如下文件：
<blockquote>
<p style="padding-left: 30px;">style.css : 样式表文件
index.php : 首页模板
archive.php : 文章归档/分类目录模板
404.php : 404 模板
comments.php : 留言/回复模板
footer.php : 底部模板
header.php : 顶部模板
sidebar.php : 侧栏模板
page.php : 页面模板
single.php : 文章页面模板
functions.php : 模板函数
search.php : 搜索结果模板</p>
</blockquote>
模板文件的工作机制如下图所示，可以看到每当有WordPress页面（你愿意额话可以称之为WordPress引擎）被调用时，它会判断（通过排除法）页面的类型。 这类似于询问“我在哪儿？”。 WordPress回答“我在…类型的页面上”，然后以特定顺序调用页面。 WordPress找不到需要的PHP文件时，会使用“index.php”文件来代替所需文件。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/B7WuAagY.gif"><img class="alignnone size-full wp-image-156" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/B7WuAagY.gif" alt="B7WuAagY" width="720" height="430" /></a>

对应的基本加载流程如下：
<h6>1. 调用页眉
2. 开启the loop（主循环）
3. 调用永久链接与一些网页上的meta
4. 调用以通知WordPress该获取的信息
5. 调用以获取获取文章内容或摘要
6. （或许）更多的meta
7. 关闭the loop（主循环）
8. 调用侧边栏
9. 调用页脚</h6>
这里主要介绍一下循环调用数据库the loop（主循环）
“WordPress Loop”会在数据库中持续调用文件，直到WordPress终止调用。 “the loop”的结构随显示页面类型而变，WordPress尝试加载的每个基本类型页面都有一个“loop”。 下面是开启the loop的代码：
<strong>&lt;?php if ( have_posts() ) : &lt;?php if ( have_posts() ) : the_post(); ?&gt; </strong>

我们可以看到，代码被拆分开来，have_posts用以定义条件标签，while和the_post则各成一部分，但这仍然是the loop，在所有页面中基本都是这样。 多行loop时的一个用法是：用query_posts在“if have_posts”和代码的剩余部分之间放置一个参数，用来显示单篇文章、某一时段的文章、最近一篇文章或者某一类别中的文章，也可以改变the loop中迭代文章的顺序

在修改模板的过程中，firefox的开发者工具非常好用，下图可以看到，配合双屏，开发者工具能够快速定位元素在代码流中的位置，并且锁定css选择器等，而且拥有实时修改测试的沙盒功能。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/test.jpg"><img class="alignnone size-full wp-image-153" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/test.jpg" alt="test" width="3286" height="1080" /></a>

参考资料：

http://blog.sina.com.cn/s/blog_a02d97db0101d2b0.html

http://www.2cto.com/kf/201209/154009.html

http://webbeta.org/2009/05/21/how-to-hack-wordpress-theme-template-pages/（讲解加载流程）
---
layout: post
title:  "【已解决】CentOS7初体验与grub启动项windows丢失的问题" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

暑假的时候就发现CentOS推出了7版本，download下来iso镜像后，不知道是UltraISO出了问题还是镜像本身的问题，无法进行刻录。今天下午在王腾同学测试后，便在老板发的X240s上测试安装。相比于6代，改变真的很大。首先，安装环境完全变了，基本思路从之前的串行单线安装变成了并发多线式的，即需要设置的部分都在一个统一的导航架构下，以任意顺序完成。更为人性化的同时，也发现并不能够很好地进行6时代较为全面的安装设置，有些设置需要进入系统后才可以进行。

GNOME界面更加漂亮，可能是向Ubuntu或者Mac OS的方向接近吧，看上去确实是非常舒服的。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/2014-09-03-152019-的截屏.png"><img class="alignnone size-full wp-image-159" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/2014-09-03-152019-的截屏.png" alt="2014-09-03 15:20:19 的截屏" width="1366" height="768" /></a> <a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/2014-09-03-152045-的截屏.png"><img class="alignnone size-full wp-image-160" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/2014-09-03-152045-的截屏.png" alt="2014-09-03 15:20:45 的截屏" width="1366" height="768" /></a>

第一次启动时发现grub下Windos选项丢失，这个问题在首先安装windows的条件下还是很好解决的（六七年了，鸟哥的建议依然是攧扑不破的真谛），修改grub即可。不过centos7升级到grub2了。有点意思。具体不搬过来了，参见作者原贴。

http://tieba.baidu.com/p/3154031191
---
layout: post
title:  "【已解决】CentOS修改" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

---
layout: post
title:  "【已解决】Thinkpad U盘安装win7出现“安装程序无法创建新的系统分区……”" 
categories: Windows Hardware
tags: Windows Hardware
author: LZN
---

* content
{:toc}

这个问题很奇葩，有点意思。老板发的Thinkpad，换SSD后装系统，格式化硬盘无法下一步进入复制和展开安装文件阶段，报错“安装程序无法创建新的系统分区 也无法定位……”

百度之，发现解决方法非常奇葩：
<blockquote>先格式化一下你要装的那个盘，然后，拔出U盘，啥也别动，只拔出U盘究行，再装上U盘，然后刷新一下【选硬盘那里的高级选项中有格式化和刷新】，再选择要安装的硬盘点下一步，OK了，可以正常安装了</blockquote>
我勒个去，这是因为个鸟毛？在好奇心驱使下，继续搜索，发现这个回答比较靠谱：
<blockquote>这个问题只出现在使用U盘安装win7的时候。具体原因很难讲，我猜测是当在这个界面选择安装到C盘时，安装程序会搜索（hd0，0），但实际的（hd0，0）不是C盘而是U盘（因为U盘是启动盘，如果你有用过grub4dos就知道了），所以就出现了这个错误提示。

我的解决方法很简单:
解决方法1：
拔掉U盘，安装就可以继续了。
解决方法2：
用ultraiso写到U盘。原因很简单，ultraiso是模拟cd-rom方式写入，启动后U盘占用的是光盘盘符，因此C盘还是（hd0，0）</blockquote>
看起来WT这个镜像不是拿UltraISO刻录的呀，还是软碟通好使……

参考资料：

http://zhidao.baidu.com/link?url=PcRCaz9PrfsPv4rHRDdZhWXIWxxP-XFLwUXeGpuUPFpR3L1xK3lSLwgVwWHqP9DmMr-mQinII46M5HalpWllKK

http://zhidao.baidu.com/link?url=bT8DZQs3jr6WSRf7J_ruYf7Divgqlrc3z8Kpi1LJRu79wHf1rjLXJn13Qt3FrjJSK76j74BbE9w17H7YvYOujXI9KUOpcpSo-mIOHj9Pc4a
---
layout: post
title:  "【已解决】四期平台ys队列排队机制问题" 
categories: Linux HPC
tags: Linux HPC
author: LZN
---

* content
{:toc}

前几天发现ys队列的排队机制存在问题，即若某节点已经被前一个任务独占，排队机制似乎没有摒除该节点，后一个任务依然可能被提交到该节点，造成负载过大。发邮件给学校超算中心后如石沉大海，没有回复。想到之前给杨老师集群做测试的时候，直接手动指定hostfiles，于是自己动手，丰衣足食。

先写hostfile文件，比如使用c74到c77四个节点，每个节点16个核心，hostfile可以这样写

c74:16

c75:16

c76:16

c77:16

然后mpirun -hosts后面指定到这个文件。

需要注意的是，提交pbs的话会被忽视这个设定，所以只能采用screen的方式运行脚本。pestat qstat下都不能查到任务号。
---
layout: post
title:  "【已解决】Grub2默认启动Windows的设置" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

前两天给X240s换了固态硬盘，重装系统后一直没再折腾。今天终于有空处理下CentOS7默认启动项的问题了。解决方法应该比较暴力：

grub2/grub.cfg下
<blockquote>if [ "${next_entry}" ] ; then
set default="${next_entry}"
set next_entry=
save_env next_entry
set boot_once=true
else
<strong>set <span style="color: #ff0000;">default=0</span></strong>
fi</blockquote>
直接把${saved_entry}展开变量改成Windows所在列表号就可以。反正谁也不会动辄改动grub
---
layout: post
title:  "【已解决】CESM continue run的使用方法" 
categories: CESM HPC
tags: CESM HPC
author: LZN
---

* content
{:toc}

重复何老师试验，跑CAM5的物理，学校集群太慢，于是到天河二号上跑。CTRL试验跑的顺风顺水，一路到30年。SEN试验第一次在第八年断了，第二次第四年，第三次恼了，开continue run，发现错误提示是找不到rpointer文件，原来需要在开始跑的时候就在env_run.xml里设置好REST_N变量才行，默认给的是=$STOP_N。也就是仅仅在程序运行完成后的最后一年生成rpointer文件。只得改成1后继续从头运行，果然每年都生成了每个模块对应的rpointer（rpointer.xxx）。不出所料，程序到第六年又断掉了，把continue run设置为TRUE后可以正常运行。嗯嗯还不错~查看cam的输出发现输出文件莫名其妙大了一些，莫非会输出一些与重启运行有关的变量？

后话是，continue run跑了10个月又挂了，开始怀疑编译存在问题……重新编译继续continue中，囧……

<strong><span style="color: #008000;">#Up to 20140922#</span></strong>

经后来检查发现，确实是NetCDF 4.0.1的问题，CESM UG上建议采用4.1.2以上的版本，就是因为之前的版本存在corrept write的问题，尤其是在IO拥堵的情况下。Shift到4.3.2后，没有出现这类问题，但是4.3.2在天河二号上似乎还不能够使用ncdump，近期天河二号IO有很大改善，改回4.0.1后出问题的频率大大降低了。

<strong><span style="color: #008000;">#Up to 20141019#</span></strong>
---
layout: post
title:  "Novarizark's PC" 
categories: Blog&amp;CMS Hardware Living&amp;thinking
tags: Blog&amp;CMS Hardware Living&amp;thinking
author: LZN
---

* content
{:toc}

上学期自己买了E2414H，这学期的笔记本和台式机也都下来了，差不多装好了系统，起名，合照。White Cube和Crystal Shadow，伴我度过了九年岁月，我对这个世界很大一部分的了解和探索，都是通过她们实现的。新台式机和笔记本的名字想了好久，还是决定去纪念伴我度过了十多年的Blizzard的游戏——Diablo II，从二年级不懂事的小屁孩看老爸公司里的叔叔刷血鸟，到初中三年级和hunger的纯招NEC pass dy，再是中考结束整个暑假研究pass各种char各种build，一直甚至到大二实习还和烨琪一起开荒pass，太多记忆与怀念了。

台式机决定取名为Blackleach，黑是主色调，坚韧而厚重，本因台式机性能优越希望取为Stormspire，但Black的属性久久萦绕脑海，不得已，故名。其实溯源的话，Blackleach是苏格兰一个地名，这套暗金装备全名为Blackleach Blade Bill (黑水之刃-比尔长刀)，因Blackleach这个地方生产Bill这种钩镰枪，故名。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/blackleach.jpg"><img class="alignnone size-full wp-image-182" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/blackleach.jpg" alt="blackleach" width="674" height="222" /></a>

笔记本取名为Wizardspike吧，level mana + 75% mana + 50% FCR + 75% 4R，换上浦科特的SSD后还是非常神似的嘛，哈哈！Wizardspike Bone Knife （巫师之刺-骸骨匕首），居家旅行，杀人越货，必备之选。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/wizardspike.jpg"><img class="alignnone size-full wp-image-184" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/wizardspike.jpg" alt="wizardspike" width="833" height="212" /></a>

来张大合照啦，除了White Cube在烟台，其他都在这里啦。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/IMG_20140922_202625.jpg"><img class="alignnone size-full wp-image-185" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/09/IMG_20140922_202625.jpg" alt="IMG_20140922_202625" width="3200" height="2368" /></a>
---
layout: post
title:  "笼中鸟" 
categories: Living&amp;thinking
tags: Living&amp;thinking
author: LZN
---

* content
{:toc}

今天感觉非常不好。欠缺太多，差了太多，非常失望落寞。刚刚用新装的google输入法打自己名字，只输入首字母，出现了“笼中鸟”这个词，呵呵，或许我就是这样的状态吧，其实自己禁锢了自己，自嘲一下。
---
layout: post
title:  "【已解决】ntfs-3g移动硬盘自动挂载" 
categories: Linux Hardware
tags: Linux Hardware
author: LZN
---

* content
{:toc}

ntfs格式的硬盘要通过ntfs-3g在linux下才能挂载，开机挂载相应修改fstab即可。对于移动硬盘，为了能达到即插即用的效果，还需要做以下工作。

用root权限建立/sbin/mount.ntfs文件，内容如下：
<blockquote>#!/bin/sh
export LANG=en_US.UTF-8
exec /sbin/mount.ntfs-3g "$@"</blockquote>
保存后重新插入移动硬盘，看看NTFS格式的分区是不是跟FAT32的分区一样自动加载了？

<strong>记得给/sbin/mount.ntfs文件权限哦 chmod a+x /sbin/mount.ntfs</strong>

参考资料

http://blog.163.com/cmh_lj/blog/static/100812304201252522119264/
---
layout: post
title:  "【已解决】高分辨率CAM模式MPI buffer溢出" 
categories: CESM HPC
tags: CESM HPC
author: LZN
---

* content
{:toc}

f05配置，CAM4没有问题，CAM5运行两次出现
<blockquote>Fatal error in PMPI_Bcast: Message truncated, error stack:
MPIDI_CH3U_Request_unpack_uebuf(685): Message truncated; 95 bytes received but buffer size is 32</blockquote>
的错误，纯粹是尝试的心态，调整环境变量，加入如下语句

<strong>MPI_BUFFER_SIZE=128</strong>

默认MPI缓存增加到128个字节么？反正增加了，居然能够运行。Done!
---
layout: post
title:  "【更新中】高分辨率CAM更改PE Layers的测试" 
categories: Hardware CESM HPC
tags: Hardware CESM HPC
author: LZN
---

* content
{:toc}

应老板项目要求，CAM的分辨率早晚要shift到F05的水平，前两天在学校四期平台上测试了下，默认配置，CAM4物理，96个核，900s积分时间，运行情况实在惨不忍睹：

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/10/QQ截图20141014222809.png"><img class="alignnone size-full wp-image-199" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/10/QQ截图20141014222809.png" alt="QQ截图20141014222809" width="1054" height="763" /></a>

运行一个月用了整整一晚上，十几分钟才能输出一天，一个文件1.2G，我擦嘞。

转到天河二号，直接调用了1200个核心，物理包用的CAM5，大概三四分钟出来一天的样子，发现IO是个大瓶颈。测试改PE层，只有atm用1200个核心，其他用120个核心，依然是sequential执行，效果差不多。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/10/QQ截图20141014220543.png"><img class="alignnone size-full wp-image-198" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/10/QQ截图20141014220543.png" alt="QQ截图20141014220543" width="1066" height="757" /></a>

决定尝试采用concurrent的方式进行，UG上给的1800+个核心，而且用了多线程的方式，还是先不冒险多线程了吧，atm缩减到768，其他大概凑天河二号节点情况24核心的倍数，具体配置如下，几个concurrent的层次模块与UG上一致。<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/10/QQ截图20141014223453.png"><img class="alignnone size-full wp-image-202" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/10/QQ截图20141014223453.png" alt="QQ截图20141014223453" width="958" height="1575" /></a>

&nbsp;

运行速度貌似差别不大，可以省核时了。但是IO实在是太慢了，1秒钟才能写入10-20M+？我擦嘞，这是网速来着……1分钟+才能写出一个日平均，真是丧心病狂啊……回来得问问超算中心，PIO究竟能不能实现。
---
layout: post
title:  "Linux查找文件所在位置" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

Linux下查找命令find， locate，find选项太多，每次查文件都记不住怎么搞，最常用的当前目录递归深入查找写在这里了，以后记住
<blockquote>find ./ -name "*keyword*"</blockquote>
---
layout: post
title:  "【已解决】CESM continue run出现Internal pop2 clock not in sync with Sync Clock的问题" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

晚上查天河二号的spin-up任务，发现下午的时候居然断掉了，已经积分了99年，队列状态一直是CG状态卡死，貌似是某个节点的一个进程被kill掉了，其他节点陆续因为超时退出。

好吧，不管那个CG。重新提交任务，continue run，没想到initial的时候给我弹出了，纳尼……

查看log文件发现如下错误

<strong>Internal pop2 clock not in sync with Sync Clock</strong>

POP2的时钟不同步? 这么有意思，貌似之前碰到过，因为转的时间不久，索性直接重新start-up了，这次可是转了10天啊我擦嘞，要是重新返工岂不是要命了。果断google，然后发现了这个：
<blockquote>https://bb.cgd.ucar.edu/internal-pop2-clock-not-sync-sync-clock</blockquote>
这个意思是直接重走一遍cesm_setup就可以，clean再setup，改build状态，提交任务——依然出错。其他google出来的信息几乎没用，诶，又入无人之境……

既然是初始化的时候时钟同步出问题，想到模式运行生成restart文件的时候会同步配置一个rpointer文件，应该是记录重启点的文件，果断查看，发现问题：只有ocn的相关rpointer文件中指向100年的1月1日，其他都是99年1月1日，明白了，应该是ocn模块指定rpointer的方式与其他module不同，先于其他模块指定了新的重启点，可是其他模块的重启文件还没生成呢。长舒一口气，改rpointer.ocn.restart里面的文件为99年咯，Okay，提交任务！

这次依然提交不久就断掉了，万念俱灰有木有，查看log文件，发现错误不一样了，有点欣喜，说明改rpointer有效。新错误是：

<strong>nlfilename_rof does NOT exist:rof_in</strong>

这么奇葩，径流模式出问题，老子又不关心你丫的径流，小兔崽子还找事……看起来是找不到rof_in的什么东西，google直接没结果，想到刚刚cesm重新setup过，是不是改了build后的一些namelist？重新build尝试，目前可以运行了，长舒一口气……但愿今晚能顺利跑过断点～
---
layout: post
title:  "【已解决】CESM标准流输出" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

实现CESM额外的标准流输出其实并不困难，只要use cam_logfile就可以了，其实看一下cam_logfile.F90文件，就可以发现，里面主语句只有一个
<blockquote>iulog=6</blockquote>
因此write语句这样写就可以将额外的信息流输出到log文件：
<blockquote>write(iulog,*) "Hello World!"</blockquote>
---
layout: post
title:  "【已解决】vim针对ncl的语法高亮及自动补全" 
categories: Linux NCL
tags: Linux NCL
author: LZN
---

* content
{:toc}

官网上查到了几个编辑器增强插件，浏览了一下，发现针对vim的属git上那个最好(Courtesy of Xin Xie [School of Marine and Atmospheric Sciencs, Stony Brook University].)

方法比较简单，相关文件已经打包放在文章最后，拷贝到~/.vim相应位置即可。需要注意.vimrc是放在主目录下的，且一定不要直接mv过去，否则会覆盖掉原有的设置，需要拷贝内容复制。

命令补全快捷键是CTRL+n

【参考资料】

http://www.ncl.ucar.edu/Applications/editor.shtml#vim

【附件】

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/10/ncl_vim_highlight.zip">ncl_vim_highlight</a>
---
layout: post
title:  "【已解决】putty在vim下使用小键盘" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

putty默认在vim下小键盘是不启动的，启动方式：
选项Terminal-&gt;Features里，找到Disable application keypad mode，选上
---
layout: post
title:  "【已解决】vim空格tab键转换及多行缩进" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

tab键缩进往往采用4个空格代替会有更好的兼容性，vi中设置如下，配置.vimrc文件：
<blockquote>set ts=4  (注：ts是tabstop的缩写，设TAB宽4个空格)
set shiftwidth=4

set expandtab</blockquote>
&nbsp;

对于已经存在的文件：
<blockquote><strong>TAB替换为空格：</strong>
:set ts=4
:set expandtab
:%retab!</blockquote>
多行缩进在命令行模式下
<blockquote>n&gt;</blockquote>
向右缩进n行，左用&lt;代替

【参考资料】

http://blog.csdn.net/vsooda/article/details/7296676

http://blog.163.com/squall_smile/blog/static/6034984020136304402583/
---
layout: post
title:  "【已解决】NCL写binery文件Fortran读出错——BigEndian问题" 
categories: HPC NCL Fortran
tags: HPC NCL Fortran
author: LZN
---

* content
{:toc}

ncl写二进制文件非常方便，setfileoption+fbinrecwrite语句即可。处理模式输出的加热数据测试了一下，非常迅速搞定。随后需要用到fortran代码来读写二进制文件，没想到却遇到大问题。

ncl下采用fbinrecwrite写入的文件为fortran下的sequential读取方式（貌似这个才是符合ieee标准的），按照<a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/fbinrecwrite.shtml">官网指示</a>，代码很容易编译通过，但是执行出错。ifort编译执行错误结果：
<blockquote>forrtl: severe (98): cannot allocate memory for the file buffer - out of memory, unit 100, file /users/yangsong3/L_Zealot/F/f90/CAM4_PTENDT_DIFF_mon.dat</blockquote>
采用gfortran编译，同样执行出错：
<blockquote>At line 12 of file read_heat_diff.f90 (unit = 100, file = '../data/model_post/CAM4_PTENDT_DIFF_mon.dat')
Fortran runtime error: End of file</blockquote>
第一次在linux平台下编译自己写的fortran代码，多少还是有些心虚。ifort表示内存不足，gfortran表示读到文件末尾，有些莫名其妙，检查路径文件名，文件大小，读取方式，貌似都没问题，折腾许久没有结果。

问题只能回溯到ncl那么简单的二进制写入上，fbinrecwrite看上去没什么问题，setfileoption中的几个选项值得怀疑，查了下BigEndian的问题，是这样描述的：
<blockquote>其实big endian是指低地址存放最高有效字节（MSB），而little endian则是低地址存放最低有效字节（LSB）。

用文字说明可能比较抽象，下面用图像加以说明。比如数字0x12345678在两种不同字节序CPU中的存储顺序如下所示：

<strong>Big Endian</strong>

低地址                                   高地址
-----------------------------------------&gt;
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   12  |   34  |   56  |   78   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

<strong>Little Endian</strong>

低地址                                   高地址
-----------------------------------------&gt;
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   78|   56  |   34  |   12   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</blockquote>
虽然看上去出错信息并不是这么指向的，但还是要试一试，查了下fortran在字节序处理的问题，果然，一行open语句赫然入眼：

open(...,<strong><em>convert="big_endian"</em></strong>)

加入测试，我擦嘞……居然可以了，果然是字节序的问题。原来fortran默认的是非人的little endian，好吧……关键是运行出错给出的那些错误信息，完全无厘头，真是对编译器失望了。另外SGI编译器默认为BigEndian。

另外fortran读ncl写出的多维二进制数据的时候，注意维数方向是相反的哦！如ncl数组（33，44），fortran（44，33）

【参考资料】

http://blog.csdn.net/sunshine1314/article/details/2309655 BigEndian和LittleEndian

http://bbs.lasg.ac.cn/?action-viewthread-tid-13303

http://www.360doc.com/content/11/0216/10/2609140_93438395.shtml

&nbsp;
---
layout: post
title:  "【已解决，转】vi多文件编辑" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

转自：http://www.cnblogs.com/end/archive/2012/06/12/2546757.html

1、在同一窗口中打开多个文件：

vi file1 file2 file3
:n 切换到下一个文件 (n=next)
:N 切换到上一个文件
2、在不同窗口中打开多个文件：

如果已经打开一个了一个文件，
则在vi的命令输入状态下输入 :sp 另外一个文件的路径及文件名，
如此就可以在一个窗口打开多个文件了。

或者用 vi -o file1 file2 file3....用分割屏幕窗口方式同时打开多个文件。
可以使用 ctrl + 两次按 w 或者ctrl + w 然后按上下键在上下窗口间切换。
2.窗口分割实现编辑多文件
*先使用vi打开一个文件，例如vi actinia_proenrule.sh
*分割窗口打开另外的文件
命令行模式下输入 sp 另外一个文件 就可以水平分割继续打开第二个文件，如果想纵向分割，可以使用vsp 文件名
注：sp=split，vsp=vsplit. 上面的写法是vi支持的简略写法，v实际就是vertical，从中我们可以看出改命令的含义，另外vi不仅仅支持两个文件，还支持更多个文件同时在一个 大的窗口中显示编辑，同时还支持同时打开的两个文件是同一个文件。
*窗口切换
可以使用 ctrl +两次按 w，这样就可以在各个文件中切换

之前觉得vi的多文档编辑用着很不方便，现在接触了几个，用过了MiniBufExplorer，发现看着不是很舒服。还是使用ｌｓ比较好看一些。

:ls 展示全部的打开文档

:xn 切换到向下的第x个文档

n ctrl+6 ： 切换到第n个buffer

ctrl+6 或 :e# 回到前一个编辑文件

分屏

:new xxx

ctrl+w s 对当前文档内容分屏显示

ctrl+w q 关闭所处分屏

ctrl+w o 仅显示当前分屏内容

ctrl+w j k 上下选择分屏

个人觉得最值得用的命令就是ctrl+w w 快速在分屏的两个屏幕中切换

&nbsp;

下面写的还没用过~看了大家的分享觉得这几个还不错

:n1,n2 co n3: 将n1行到n2行之间的内容拷贝到第n3行下
:n1,n2 m n3:将n1行到n2行之间的内容移至到第n3行下
:n1,n2 d: 将 n1行到n2行之间的内容删除
:n1,n2 w!command: 将文件中n1行至n2行的内容作为command的输入并执行之，
若不指定n1，n2，则表示将整个文件内容作为command的输入
方式2的优点在可以直接使用nyy和pp命令在各个窗口的文件之间进行拷贝和粘贴，操作比较方便。
---
layout: post
title:  "搬砖期……" 
categories: Living&amp;thinking
tags: Living&amp;thinking
author: LZN
---

* content
{:toc}

还有10天就到月底了，这个月有好几个deadline，估计是没法全部完成了，spin-up了半个多月终于快完了，月底前必须要稀里哗啦把结果都搞出来发给何老师，paper的deadline指定是完成不了了，一张图都没有pannel出来，囧。还要上课，还要课堂展示，还要组会还要报告还要培训～Anyway，事情虽多，但是没有感到厌烦，内心还是很有斗志很有激情的，这种状态很好，最后十天加大工作强度提高效率，继续保持！

heating试验结果发给何老师后将是一个段落，确定paper的figures后也是一个段落。一步步来，自顶向下，分而治之，问题终归能够解决。最近真的不再打怵改源码的事情了，接下来把技术巩固好，虽然在搬砖期，图书馆不能少去，英语和运动和文献涉猎要坚持，更不能忽略感情和保持稳定良好的心态，加油！
---
layout: post
title:  "一定要仔细呀" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

---
layout: post
title:  "【已解决】CESM进行branch run" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

coupled spin-up run终于快接近尾声了，可以开始进行Heat试验的branch run了。UG上给出了branch run的设置方法，不过as it always，依然洗练，依然是yellowstone+HPSS上的配置，坑爹啊……照着来了一遍，问题记录在这里：

create_newcase，不要setup。

<strong><span style="color: #ff0000;">1.</span></strong>
<blockquote>./xmlchange RUN_TYPE=branch

./xmlchange RUN_REFCASE=B_CON

./xmlchange RUN_STARTDATE=0150-01-01

./xmlchange RUN_REFDATE=0150-01-01</blockquote>
<strong><span style="color: #ff0000;">2.拷贝user_nl_*文件</span></strong>

<strong><span style="color: #ff0000;">3.拷贝SourceMods文件</span></strong>

<strong><span style="color: #ff0000;">4.cesm_setup</span></strong>，出错：
<blockquote>ERROR(Build::Namelist::_parse_next): expect a equal '=' sign instead got: .rtm.r.0150-01-01-00000.nc
ERROR: rtm.buildnml.csh failed
ERROR: /users/yangsong3/L_Zealot/couple/B_brch/preview_namelists failed: 25344</blockquote>
又是rtm出问题，goole之

https://bb.cgd.ucar.edu/cesm-120-rtmbuildnmlcsh-branch-run

表示居然是一个bug！按照帖子更改./Buildconf/rtm.buildnml.csh 58与62行：
<blockquote>set nrevsn_rtm = "nrevsn_rtm='${RUN_REFCASE}.rtm.r.${RUN_REFDATE}-${RUN_REFTOD}.nc'"</blockquote>
可以通过setup。

<span style="color: #ff0000;"><strong>4.编译</strong></span>

<span style="color: #ff0000;"><strong>5.拷贝restart与ini文件 cp ..../*0150* ./</strong></span>

<span style="color: #ff0000;"><strong>6.提交作业</strong></span>，第一次错误：

csh运行中出现如下提示：
<blockquote>File status unknown: B_CON.clm2.r.0150-01-01-00000.nc
File status unknown: B_CON.rtm.r.0150-01-01-00000.nc</blockquote>
出现错误，找不到rpointer文件
<blockquote>forrtl: severe (29): file not found, unit 98, file /users/yangsong3/L_Zealot/couple/B_brch/exe/rpointer.drv</blockquote>
拷贝 rpointer* 到目录下，并更改restart日期，重新提交作业。

居然可以运行，逐日输出暂时没有发现问题！

<strong>#Up to 20141030#</strong>

cesm1.2.1已经修正cesm_setup中的bug

<strong>#Up to 20150106#</strong>
---
layout: post
title:  "与何编老师合作的feedback试验过程总结" 
categories: Living&amp;thinking
tags: Living&amp;thinking
author: LZN
---

* content
{:toc}

留个坑，回来慢慢填。

同何编老师进行feedback试验的合作，从七月底正式前往学习heating injection的技术到现在，整整三个月了。如今，何老师的初稿已经发过来了，我却徒挂一个第三作者的名字，从头到尾却没有一张自己做的图。心里很不是滋味。客观原因永远找不完，主观上自己的问题，必须要一一总结反思。

1.Double Check的重要性！

2.不能够办到的事情，就不要承诺！

3.如何在尽量不让他人感到被打扰与自己能够获取足够的信息顺利开展合作之间平衡，很难。

4.事情不要因为看上去不容易做，就往后拖，越拖越烦，越拖越觉得难做，越拖越让人觉得你的能力存在问题。
---
layout: post
title:  "【已解决】NCL大文件支持" 
categories: NCL
tags: NCL
author: LZN
---

* content
{:toc}

写2GB以上文件

setfileoption("nc","Format","LargeFile")

or

setfileoption("nc","Format","NetCDF4Classic")

参考

http://www.ncl.ucar.edu/Support/talk_archives/2011/0599.html
---
layout: post
title:  "google hosts" 
categories: Internet
tags: Internet
author: LZN
---

* content
{:toc}

hosts文件是个很好的东西哦，还可以屏蔽激活神马的烦心事

C:\Windows\System32\drivers\etc

实时更新：

http://www.360kb.com/kb/2_122.html
---
layout: post
title:  "【】ncl大规模批量文件处理" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

couple spin-up出来的data，文件有几百GB，画TS的曲线，全部读进来内存肯定吃不消，分批读入再输出是一种办法：

&nbsp;
---
layout: post
title:  "【更新中】couple Branch Run出现找不到目录的奇怪问题" 
categories: CESM Fortran
tags: CESM Fortran
author: LZN
---

* content
{:toc}

spin-up了200年，看了下TS的变化，其实三十年就已经基本平衡了。150年以后的部分可以当cp_con来用肯定没问题。因为晓明姐需要地表比湿变量，所以打算从150年开始跑个restart。奇葩的是，改了restart文件到150年，跑得非常之慢，同样配置，之前12分钟左右出结果，现在要三十分钟。跑了一两年断掉了，出错
<blockquote>forrtl: severe (121): Cannot access current working directory for unit 65 （UNKNOWN）</blockquote>
某个未知文件找不到，莫名其妙。重新提交任务还是一样的错误。索性依葫芦画瓢来个branch run。提交上去貌似没问题，但是同样运行非常慢，也运行了两年挂掉了。提示错误一致，发生位置貌似在restart相关的源代码处。莫非生成restart文件的问题，断掉每年生成一个restart文件，并且不再用branchrun，开CONTINUE RUN，貌似现在可以跑。

<strong><span style="color: #008000;">#Up to 20141027#</span></strong>

这几天发现这类错误非常随机，估计是IO问题造成，也有可能是NetCDF版本的问题（ug中提到的bug）。回来可以测试下更高版本的NetCDF。

<strong><span style="color: #008000;">#Up to 20141102#</span></strong>
---
layout: post
title:  "【已解决】CESM rebuild restart后不认SourceMods及namelist内容" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

今天下午画CAM5 Heat试验的图，发现不能通过显著性检验，非常令人费解。毕竟已经重复跑过多遍了，再次重来，而且还是时空代价这么高的CAM5，终归让人沮丧。检查强迫输入文件没问题，fortran源代码中inject的读写函数也没问题，想到最初检查03-09年的数据通过显著性是没有问题的，于是检查10年之后的输出……完全不能通过。

返回查找log文件，发现25日那天我为了增快运行速度，更改pe_layers之后rebuild重启了一次，貌似rebuild过程中完全无视了我SourceMods中的内容！restart之后的结果转的其实是control，完全没有inject heating！简直无语了，为什么会这样。现在只能重新编译，在10年处restart试试看了。非常郁闷。

突然想到couple的试验还没有检查，暗暗祈祷画了个响应场，傻眼了，发现all value=0，以为脚本出错，查错时发现最不愿看到的事情还是发生了，所有的branch run的结果和原始的control结果一模一样……OMG！又不认SourceMods！实在是非常不能够理解。测试在修改的代码里加入错误，运行build程序时确乎是能够读到错误的，说明是可以读到SourceMods的，非常的奇怪，莫非与cesm_setup被clean后或者第一次build的时候是不去读SourceMods的？为了做测试，更改了pe layers，clean了setup，在代码里故意注入iulog文件句柄输出，重新build。

<strong><span style="color: #008000;">#Up to 20141029#</span></strong>

今天来查看结果，还是不行。不知道为什么，即便编译的时候会去检查Sourcemods的错误以及后来测试加入iulog也是可以输出的，但就是不会去执行。

今天中午回来索性直接查个遍。calday过1直接log输出heatf的所有数据。编译成功运行，查看输出——全部都是0！这种情况最大的可能当然是没有读取heatf的强迫文件。分明记得heatf的强迫在physics initial这个subroutine里呀，难道restart的时候就不会去做initial么？向上翻了翻代码，查了下restart的关键词，发现惊天地泣鬼神的三行语句：
<blockquote>750 if (nsrest .eq. 0) then
751 call phys_inidat(cam_out, pbuf2d)
752 end if</blockquote>
反查了下nsrest是什么，在control目录下，cam_control_mod这个module写的那叫一个清楚啊
<blockquote>11 integer :: nsrest ! run type flag (0=initial, 1=restart-continuation, 3=restart-branch.)</blockquote>
而我那可怜的读取外强迫文件的语句，被我扔在了phys_inidat这个subroutine下读取，OMG！原来你丫的inidat只在startup的case下采去读，我restart不出问题才怪，<span style="color: #ff0000;"><strong>物理包真正的initial在phys_init这个soubroutine里！</strong></span>找到这个问题，重新编译测试，没想到提交任务的时候c73节点down掉了，真是那个叫什么来着，屋漏偏逢连阴雨，哪壶不开提哪壶么……

好在找到问题了，couple的问题也是一样的，当然也能迎刃而解。经测试，确实是这个问题造成的。

<strong><span style="color: #008000;">#Up to 20141102#</span></strong>
---
layout: post
title:  "【已解决】restart改变CAM输出变量场" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

CESM模式运行过程中如果想要更改CAM的输出频率或者输出的变量场，单纯的restart是不行的，因为ug上说了，restart的话，pop和ice model会再次读取namelist，但是atm模块不理的，ug上给了一个巨坑爹的解决办法，先给case换个名字，再建个case做branch run。这不是扯淡么。

不信邪，试了下这个办法是可以的，前提是之前run的时候一定要把restart文件记录下来。

该env_run.xml几个变量，把run的类型改成branch，时间点指定到restart file上，改rpointer，改rtm的bug，其实跟branch run的方式一样，只不过不用重新建立case而已。

当然不要忘了改user_nl_xxx

done！
---
layout: post
title:  "【已解决】利用php函数强制下载链接（即不允许浏览器打开文本文件）" 
categories: Internet PaperHub Project PHP&amp;mySQL
tags: Internet PaperHub Project PHP&amp;mySQL
author: LZN
---

* content
{:toc}

今天做paperhub v0.01的时候，生成的enw文件会自动在浏览器中打开，而我们希望能够采用下载的形式在endnote中打开。百度了下，解决方法原来可以直接用php去修改html请求头:
<blockquote>$filename = '/path/'.$_GET['file'].'.txt'; //文件路径
header("Content-Type: application/force-download");
header("Content-Disposition: attachment; filename=".basename($filename));
readfile($filename);</blockquote>
最初写在了solve_enw.php中，结果是整个页面的html流都返回了，原来是这样。于是又建立了一个down_enw.php文件，不输出html流，可以正常下载enw文件。

参考资料：

http://www.jb51.net/article/26907.htm
---
layout: post
title:  "【已解决】Wordpress按修改顺序排列文章" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

确实按修改时间排序才是比较符合一般人浏览习惯的，<span style="color: #ff6600;"><strong>（原来除了我之外还有其他读者呀，好感动，不介意就冒个泡呗，留个nickname+邮箱就好，嘿嘿）</strong></span>查了下，改index.php下的loop中的一个属性即可，加在while主循环之前，主循环后再来个<span class="pln">wp_reset_query</span><span class="pun">();即可。粗体标注更改属性：</span>
<pre class="wp-code-highlight prettyprint prettyprinted"><span class="pln">$paged = (get_query_var('paged')) ? get_query_var('paged') : 1;
$args </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">(</span><strong><span class="str">'orderby'</span><span class="pun">=&gt;</span><span class="pln">modified</span></strong><span class="pun"><strong>,</strong>
</span><span class="str">              'showposts'</span><span class="pun">=&gt;</span><span class="lit">10</span><span class="pun">,
              </span><span class="str">'paged'</span><span class="pun">=&gt;</span><span class="pln"> $paged
	      </span><span class="pun">);</span><span class="pln">
query_posts</span><span class="pun">(</span><span class="pln">$args</span><span class="pun">);</span></pre>
&nbsp;

【参考资料】

http://i7298.com/archives/55
---
layout: post
title:  "【】" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

---
layout: post
title:  "【paperhub】专文——版本动态与使用者情况--v0.51--内测" 
categories: PaperHub Project PHP&amp;mySQL
tags: PaperHub Project PHP&amp;mySQL
author: LZN
---

* content
{:toc}

<table style="height: 115px;" width="466">
<tbody>
<tr>
<th style="text-align: center;" colspan="3"><strong>版本路线表</strong></th>
</tr>
<tr>
<td><strong>版本号</strong></td>
<td><strong>更新日期</strong></td>
<td><strong>重要改动备注</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.10</span></strong></td>
<td><strong><span style="color: #008000;">20141102</span></strong></td>
<td><strong>创建</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.11</span></strong></td>
<td><strong><span style="color: #008000;">20141104</span></strong></td>
<td><strong>容错性与友好性</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.12</span></strong></td>
<td><strong><span style="color: #008000;">20141105</span></strong></td>
<td><strong>友好性</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.13</span></strong></td>
<td><strong><span style="color: #008000;">20141116</span></strong></td>
<td><strong>友好性</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.20</span></strong></td>
<td><strong><span style="color: #008000;">20141117</span></strong></td>
<td><strong>功能：集中打包下载</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.21</span></strong></td>
<td><strong><span style="color: #008000;">20141120</span></strong></td>
<td><strong>容错性与友好性</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.22</span></strong></td>
<td><strong><span style="color: #008000;">20141123</span></strong></td>
<td><strong>bug fix</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.30</span></strong></td>
<td><strong><span style="color: #008000;">20141125</span></strong></td>
<td><strong>功能：参考文献格式生成</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.31</span></strong></td>
<td><strong><span style="color: #008000;">20141126</span></strong></td>
<td><strong>功能扩展</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.32</span></strong></td>
<td><strong><span style="color: #008000;">20150113</span></strong></td>
<td><strong>功能扩展</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.40</span></strong></td>
<td><strong><span style="color: #008000;">20150321</span></strong></td>
<td><strong>功能扩展:RIS解析</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.41</span></strong></td>
<td><strong><span style="color: #008000;">20150402</span></strong></td>
<td><strong>容错性:新文章命名</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.42</span></strong></td>
<td><strong><span style="color: #008000;">20150403</span></strong></td>
<td><strong>bug fix: ris结尾解析</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.43</span></strong></td>
<td><strong><span style="color: #008000;">20150424</span></strong></td>
<td><strong>bug fix: ris关键词解析</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.44</span></strong></td>
<td><strong><span style="color: #008000;">20150519</span></strong></td>
<td><strong>bug fix: Journal short解析
</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.50</span></strong></td>
<td><strong><span style="color: #008000;">20150714</span></strong></td>
<td><strong>重要功能扩展
</strong></td>
</tr>
<tr>
<td><strong><span style="color: #3366ff;">v0.51</span></strong></td>
<td><strong><span style="color: #008000;">20150728</span></strong></td>
<td><strong>功能扩展； bug fix: record尸体处理
</strong></td>
</tr>
</tbody>
</table>
早就有计划做一个服务器端的文献管理、共享和备份的资料库，由于最近要开始大量阅读文献，再也受不了随意乱放的pdf。终于被逼做这件事情了，花了一整天的时间完成v0.01，距离最终理想目标还太远太远，但v0.01已经能够实现最基本的核心功能，只写了四个php文件加一个期刊简写的ascii文件，数据仓储直接用目录+enw实现，毕竟重要的还是文件名归类和云端备份，这两点都实现了。

目前实现的功能：
<ol>
	<li><strong>上传google生成的endnote导入enw文件</strong></li>
	<li><strong>解析enw文件结构，生成唯一标志的文件名</strong></li>
	<li><strong>在enw文件中写入url及label，直接打开导入endnote</strong></li>
	<li><strong>上传对应的pdf文件</strong></li>
	<li><strong>采用唯一标志的文件名命名enw文件与pdf文件于仓储目录</strong></li>
</ol>
测试：

1.从google获得enw导入文件

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/1.jpg"><img class="alignnone size-full wp-image-277" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/1.jpg" alt="1" width="1256" height="726" /></a>

2.上传enw文件到Lab服务器

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/2.png"><img class="alignnone size-full wp-image-278" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/2.png" alt="2" width="476" height="70" /></a>

3.solve_enw.php解析enw文件并生成唯一标志的文件名，写url和label信息进入enw文件，并提供重新导出：

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/3.jpg"><img class="alignnone size-full wp-image-279" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/3.jpg" alt="3" width="528" height="212" /></a>

4.上传对应pdf文件，并命名唯一化，唯一化命名可以在本地同样使用：

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/4.png"><img class="alignnone size-full wp-image-280" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/4.png" alt="4" width="786" height="99" /></a>

5.enw和pdf命名唯一化后放入仓库：

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/6.png"><img class="alignnone size-full wp-image-281" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/6.png" alt="6" width="718" height="243" /></a>

6.可以直接通过endnote中的url打开Lab服务器的在线文件：<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/7.jpg"><img class="alignnone size-full wp-image-282" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/7.jpg" alt="7" width="1916" height="960" /></a>

毕竟是v0.01，输入没有做合法性检查，美工几乎没有，距离自动通过doi进行解析下载以及引文信息生成还差太远。将来如果要实现类似endnote那种方便的查询增删功能，而且如果要共享涉及到账户用户权限的问题，不用关系数据库是不可能的，目前这种单纯用目录组织数据结构肯定行不通，可是mySQL一窍不通，我还是太水了，有空闲下来再慢慢玩吧，现在功能对我个人基本够用:-)

<strong><span style="color: #008000;">#Up to 20141102#</span></strong>

<strong>【注】文件名唯一标志：</strong>

<span style="color: #00ccff;"><strong>%A1-%J-%V_%N_%Ps-%Pe</strong></span>

<span style="color: #00ccff;"><strong>第一作者-期刊（简写）-卷号_期号_起始页-终了页</strong></span>

<span style="color: #00ccff;"><strong>Giannini-Science-2003-302_5647_1027-1030</strong></span>

<strong><span style="color: #008000;">#Up to 20141103#</span></strong>

考虑到工程量不大，决定重新命名版本号：
<ul>
	<li><strong>miner mod  (细微更改)</strong> 占用第二位小数，例如友好性提高</li>
	<li><strong>major mod  (重要更改)</strong> 占据第一位小数，例如功能添加</li>
	<li><strong>kernel mod (内核更改)</strong> 占据个位数字，例如新技术的引入（mySQL、R等），数据库结构调整，正式发布版本等。</li>
</ul>
目前最新版本为

<strong><em>v0.11</em></strong>

Miner Mods：
<ol>
	<li><strong>增加了对仓储的重复性检查，仓储数据列表位于list.dat中，提高容错性与健壮性</strong></li>
	<li><strong>考虑了对仅有vol编号或者doi编号的文献命名的，提高容错性与健壮性</strong></li>
	<li><strong>在个别页面增加了主页跳转链接，提高用户友好性</strong></li>
</ol>
<strong><span style="color: #008000;"> </span></strong>

今天花了一个多小时时间，上传了80多篇文献，命名全部归一化，enw全部生成完毕，随时可以导入endnote。比起之前第一次手工整理时的效率，还是提升了很多的。

<strong>考虑：加入以日期命名的enw生成目录，以便将来定期整理文献时方便导入endnote。</strong>

<strong><span style="color: #008000;">#Up to 20141104#</span></strong>

<strong><em>v0.12</em></strong>

今天增加了一些更为客户友好的操作，提高文献归库效率

Miner Mods：
<ol>
	<li><strong>增加按日期命名的record目录，方便用户集中下载当日整理过的enw文件导入endnote</strong></li>
	<li><strong>采用file_get_contents函数直接勾取google的enw文件，免除用户先下载后上传的麻烦</strong></li>
	<li><strong>采用file_get_contents函数直接勾取pdf文件，免除用户先下载后上传的麻烦</strong></li>
	<li><strong>在个别页面增加了主页跳转链接，提高用户友好性</strong></li>
</ol>
Show一张endnote导入后的截图

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/QQ图片20141105192017.jpg"><img class="alignnone size-full wp-image-301" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/QQ图片20141105192017.jpg" alt="QQ图片20141105192017" width="1928" height="1056" /></a>

<strong><span style="color: #008000;">#Up to 20141105#</span></strong>

<strong><em>v0.13</em></strong>

增加更为客户友好的操作，提高文献归库效率

Miner Mod：
<ol>
	<li><strong>增加上传文献结束后直接进入文献的链接</strong></li>
</ol>
<strong><span style="color: #008000;">#Up to 20141116#</span></strong>

<em><strong>v0.20</strong></em>

用了一晚上的时间进行了Major mod，终于可以升级一级版本号啦。增加了文献打包下载的功能，php调用一堆系统函数实现，我真是弱爆了，数据量大的时候估计效率会是个问题，不过还好，个人使用的情况绝不会动辄几百篇文献地down吧，考虑版本公开后不允许批量下载pdf，只可以下载enw。目前计划公开版的版本本号为v1.xx

增加的文件：

<em>package.php</em>

<em>package_down.php</em>

打包页面示例：

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/QQ图片20141117213318.png"><img class="alignnone size-full wp-image-324" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/QQ图片20141117213318.png" alt="QQ图片20141117213318" width="491" height="233" /><img class="alignnone size-full wp-image-325" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/QQ图片20141117213445.png" alt="QQ图片20141117213445" width="350" height="275" /></a>

Major Mod：
<ol>
	<li><strong>增加集中打包下载的功能</strong></li>
</ol>
（提醒：需要加入文献删除功能了）

<strong><span style="color: #008000;">#Up to 20141117#</span></strong>

<strong><em>v0.21</em></strong>

Miner Mods：
<ol>
	<li><strong>增加了文献名模糊匹配搜索（子串匹配，大小写不敏感），提高文献归库效率</strong></li>
	<li><strong>重复提交的文献提供旧文件链接，用户友好。</strong></li>
</ol>
<strong><span style="color: #008000;">#Up to 20141120#</span></strong>

<strong><em>v0.22</em></strong>

Miner Mods：
<ol>
	<li><strong>修正集中打包下载buffer bug</strong></li>
</ol>
<strong><span style="color: #008000;">#Up to 20141123#</span></strong>

<strong><em>v0.30</em></strong>

晚上画图，ncl出图太慢，间隙用来给paperhub加入文献格式生成的功能，加着加着就忘了画图了，索性今天搞定这个major mod。目前仅仅对 paper to be submitted to Climate Dynamics进行了设置。引入了1页php和一个针对CD的期刊名缩略库short_ref_cd.dat。每增加一个submit的期刊就要引入一个缩略库，目前在没有办法将数据封装到json或者用关系数据库的情况下只能这样，当然也只能作为个权宜之计，以后submit的文章多了（如果能办到的话～），一堆文件看着都头疼……寒假如果可以的话，学学R，把组织格式shift到json上。

Major Mods：
<ol>
	<li><strong>加入针对投稿期刊的参考文献样式自动生成，目前仅针对Climate Dynamics，考虑到中文名缩写问题，生成first name缩写与不缩写两种形式，正式写入文章时需要调整下
</strong></li>
</ol>
范例图

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/QQ图片20141125211320.png"><img class="alignnone size-full wp-image-341" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/QQ图片20141125211320.png" alt="QQ图片20141125211320" width="498" height="245" /></a>index.php输入生成的唯一标志符，然后通过目录查询找到文件，解析enw生成参考文献格式
<pre><code>Chou Chia, Neelin J David (2004) Mechanisms of global warming impacts on regional tropical precipitation*. J Clim 17: 2688-2701.
Chou C, Neelin JD (2004) Mechanisms of global warming impacts on regional tropical precipitation*. J Clim 17: 2688-2701. </code></pre>
<strong><span style="color: #008000;">#Up to 20141125#</span></strong>

<strong><em>v0.31</em></strong>

Minor Mods：
<ol>
	<li><strong>加入针对JC的参考文献样式自动生成</strong></li>
</ol>
<strong><span style="color: #008000;">#Up to 20141126#</span></strong>

<strong><em>v0.32</em></strong>

Minor Mods：
<ol>
	<li><strong>加入文献本地pdf附件的链接</strong></li>
</ol>
<strong><span style="color: #008000;">#Up to 20150113#</span></strong>

<strong><em>v0.40</em></strong>

Major Mods：
<ol>
	<li><strong>加入对RIS格式记录的解析与支持，重写了solve_enw.php核心函数，加入对RIS标志字段识别与解析，默认存储格式取决于输入格式（RIS--&gt;RIS,enw--&gt;enw）</strong></li>
</ol>
<strong><span style="color: #008000;">#Up to 20150321#</span></strong>

<strong><em>v0.41</em></strong>

Minor Mods：
<ol>
	<li><strong>加入对online但未定vol/number/page文章的命名考虑，规则：
</strong></li>
</ol>
$author, $journal, strrev($year0)首字母ASCII码决定。范例：
<pre>Huang-GCB-2015-fv72_fn71_fp53.pdf</pre>
<strong><span style="color: #008000;">#Up to 20150402#</span></strong>

<strong><em>v0.42</em></strong>

Minor Mods：
<ol>
	<li><strong>BUG FIX: 修正了对RIS结尾标志符的判断问题</strong></li>
</ol>
<strong><span style="color: #008000;">#Up to 20150403#</span></strong>

<strong><em>v0.43</em></strong>

Minor Mods：
<ol>
	<li><strong>BUG FIX: 修正了对RIS某类期刊关键词标志符的判断问题</strong></li>
</ol>
<strong><span style="color: #008000;">#Up to 20150426#</span></strong>

<strong><em>v0.44</em></strong>

Minor Mods：
<ol>
	<li><strong>BUG FIX: 修正了对Nature子刊ris中对short term解析的问题
</strong></li>
</ol>
<strong><span style="color: #008000;">#Up to 20150519#</span></strong>

<strong><em>v0.50</em></strong>

要写文章，paperhub要更舒服才有动力！两天时间做了几处大改动。

Major Mods：
<ol>
	<li><strong>增加了对ris的参考文献格式生成</strong></li>
	<li><strong>增加了对多行记录的参考文件格式生成</strong></li>
	<li><strong>修改打包算法，按修改时间排序，直接在warehouse中选择操作，减少了record额外记录空间，并且能够精确定位文章</strong></li>
	<li><strong>增加warehouse下僵尸记录检测删除，每次打开index.php自动检测</strong></li>
</ol>
<strong><span style="color: #008000;">#Up to 20150714#</span></strong>

<strong><em>v0.51</em></strong>

Minor Mods：
<ol>
	<li><strong>BUG FIX: 修正了对upload_page.php 中对record尸体目录的操作
</strong></li>
	<li><strong>功能扩展：集中打包页面更改为管理页面，增加记录删除功能，列表增加&lt;a&gt;标签指向warehouse文献pdf</strong></li>
</ol>
<strong><span style="color: #008000;">#Up to 20150519#</span></strong>
---
layout: post
title:  "【已解决】在Wordpress文章及页面中插入可被执行的php" 
categories: Blog&amp;CMS PHP&amp;mySQL
tags: Blog&amp;CMS PHP&amp;mySQL
author: LZN
---

* content
{:toc}

Wordpress应该是考虑到安全的原因，文章及页面中的各种脚本，无论是服务器端的还是客户端的，都会把标签转义或者抽掉。虽然安全，但是很不方便管理员，查找了一下发现了这个插件：<strong>Allow PHP in Posts and Pages</strong>

用的人很多而且对代码执行还有权限检查，看起来应该没有什么问题，安装后接着就可使用了，不过php的标签做一下改变为方括号[]开闭，并把问号改为/即可。

加了个<a href="http://222.200.180.66:1234/L_Zealot/blog/wordpress/?page_id=2">编辑者的资源</a>页面，其中的时间戳是php生成，实时更新的。
---
layout: post
title:  "A Walk in the Rain" 
categories: Living&amp;thinking
tags: Living&amp;thinking
author: LZN
---

* content
{:toc}

邮件收到了继续返工的消息，旁边又开始endless whisper，烦躁而且压抑，受不了只能戴上耳机听Yanni。a walk in the rain，之前没有注意到的一首，还是很不错的。HP同学推荐，说是感觉像是走在雨后的草地上，嗯，热情而阳光。

&nbsp;

光腚总菊一声令下，MP3都下不了咯，贴个链接：

http://www.baidu.com/s?wd=a%20walk%20in%20the%20rain&amp;ie=utf-8&amp;f=8&amp;rsv_bp=1&amp;tn=monline_5_dg&amp;rsv_pq=f40a682a0000744f&amp;rsv_t=782cZVhHu0LhKuwkr029%2Bsc1%2B%2BBZDvR19ANVw8dNJrzqLk7nxSrt&amp;bs=a%20walk%20in%20%E5%A4%A9%E6%B2%B3
---
layout: post
title:  "【已解决】vi获取系统命令标准流输出" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

写一些脚本文件时，可能时常需要用到脚本文件所在目录的路径，而相对路径有的时候不一定可以（比如提交作业的脚本），而需要直接回显绝对路径，另开一个终端或者退出再复制当然可以，但是麻烦，查了下，vi原来有如此神奇的功能，可以直接捕获系统命令（甚至可能是自己写的程序脚本等？没有尝试过）的标准流输出，然后倒入编辑器。比如需要获得当前绝对路径的话，依次键入
<blockquote><strong>:.!pwd</strong></blockquote>
即可将当前绝对路径插入编辑点。
---
layout: post
title:  "wanna quit" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

---
layout: post
title:  "【已解决】ncl高效输出netCDF格式文件" 
categories: NCL
tags: NCL
author: LZN
---

* content
{:toc}

从模式原始输出中抽变量出来，采用默认输出方式输出50年全球（144x96）的ZMDT，程序会卡半天，而且最后时不时还会弹出write failed的错误。查了下，发现这种默认的输出方式非常低效（虽然不知道为什么），高效的方式是完全自行定义维数名称、属性等等。测试下速度确实快很多，而且不存在上面的问题，但是代码量增加了三四十行左右。兹举例如下：
<blockquote>48 ;************************************************
49 ; Write the file
50 ;************************************************
51
52 ;Get dimsize
53 dims=dimsizes(ctrl_var1p(0,:,:,:))
54 nlvl=dims(0)
55 nlat=dims(1)
56 nlon=dims(2)
57
58 ;Set fileoption
59 system("rm "+pdata_fn)
60 fout = addfile(pdata_fn ,"c") ; open output netCDF file
61 setfileoption(fout,"DefineMode",True)
62
63 ;Set All field attribution
64 fileAtt = True
65 fileAtt@creation_date=systemfunc("date")
66 fileattdef(fout,fileAtt)
67
68 ;Define Coordinate
69 dimNames =(/"time","lev_p","lat","lon"/)
70 dimSizes =(/-1,nlvl,nlat,nlon/)
71 dimUnlim =(/True,False,False,False/)
72 filedimdef(fout,dimNames,dimSizes,dimUnlim)
73
74 ;Define var, type and dim
75 filevardef(fout,"time",typeof(ctrl_var1p&amp;time),getvardims(ctrl_var1p&amp;time))
76 filevardef(fout,"lev_p",typeof(ctrl_var1p&amp;lev_p),getvardims(ctrl_var1p&amp;lev_p))
77 filevardef(fout,"lat",typeof(ctrl_var1p&amp;lat),getvardims(ctrl_var1p&amp;lat))
78 filevardef(fout,"lon",typeof(ctrl_var1p&amp;lon),getvardims(ctrl_var1p&amp;lon))
79 filevardef(fout,"ZMDT",typeof(ctrl_var1p),getvardims(ctrl_var1p))
80
81 ;Define Attribute
82 filevarattdef(fout,"ZMDT",ctrl_var1p)
83
84 fout-&gt;time=(/ctrl_var1p&amp;time/)
85 fout-&gt;lev_p=(/ctrl_var1p&amp;lev_p/)
86 fout-&gt;lat=(/ctrl_var1p&amp;lat/)
87 fout-&gt;lon=(/ctrl_var1p&amp;lon/)
88 fout-&gt;ZMDT=(/ctrl_var1p/)</blockquote>
<strong><span style="color: #008000;">#Up to 20141108#</span></strong>

这种输出模式下，注意应到将时间维和坐标维度单列变量输出到nc文件，坐标维度应当设置degree定义方向，否则绘图时需要重设。

另外这种方法大部分时间还是比较高效的，但是有时会出现奇怪的远远超出一般用时的卡顿，在数据量较大时容易出现。

<strong><span style="color: #008000;">#Up to 20141109#</span></strong>
---
layout: post
title:  "【已解决】CAM_F05 Resolution Out of Memory" 
categories: Hardware CESM HPC
tags: Hardware CESM HPC
author: LZN
---

* content
{:toc}

之前在天河二号（包括学校超算集群）测试的F05的CAM，都没有出现什么问题，最近在天河二号上重新跑CAM5 F05，却出现了out of memory的错误，重新配置了CAM4，还是一样的错误：
<blockquote>Fatal error in PMPI_Alltoallv: Other MPI error, error stack:
PMPI_Alltoallv(540)....................: MPI_Alltoallv(sbuf=0x806f43e0, scnts=0xe6c75e0, sdispls=0xe764390, dtype=0x4c000829, rbuf=0x805f7650, rcnts=0xe765ba0, rdispls=0xe7673b0, dtype=0x4c000829, comm=0x84000006) failed
MPIR_Alltoallv_impl(378)...............:
MPIR_Alltoallv(341)....................:
MPIR_Alltoallv_intra(192)..............:
MPIC_Waitall(720)......................:
MPIR_Waitall_impl(163).................:
MPIDI_CH3I_Progress(363)...............:
MPID_nem_mpich_blocking_recv(906)......:
MPID_nem_glex_poll(234)................:
MPIDI_nem_glex_ER_progress_PUT(74).....:
MPIDI_nem_glex_ER_recv_progress(378)...:
MPID_nem_handle_pkt(635)...............:
MPIDI_CH3_PktHandler_EagerSend(640)....: failure occurred while posting a receive for message data (MPIDI_CH3_PKT_EAGER_SEND)</blockquote>
重新配置PE层，增多节点数，调整MPIBUFFER，都没用。目前搁置。forum上有贴子：

https://bb.cgd.ucar.edu/node/1001941

eaton提到检查内存leak can be a very challenging exercise.

<strong>#Up to 20141108#</strong>

俊文寒假前将model统一升级到1.2.2后似乎没有这个问题了。不过我也退出折腾高分辨率啦，还是看paper学英语重要～嘿嘿

<strong>#Up to 20150519#</strong>
---
layout: post
title:  "【已解决】Adobe Acrobat X安装" 
categories: Windows
tags: Windows
author: LZN
---

* content
{:toc}

Acrobat X安装后出现Adobe Application Manager损坏的问题，安装包下有个amtlib.dll的动态链接库，复制到安装路径的根目录下即可解决问题。至此，Acrobat+Illustrator已经占据paper reading &amp; producing阵地，reading再有paperhub和endnote的助阵，终于把看文献的前期工作准备好了嗯～接下来……T_T
---
layout: post
title:  "【已解决】ncl中关于Land Sea Mask的问题" 
categories: NCL
tags: NCL
author: LZN
---

* content
{:toc}

模式中为了防止海陆边界不连续造成积分不稳定，往往会将海温插值到陆地上，画图时当然不希望这些数据出现，求海温区域平均时也不希望出现，所以必须要处理下。
根据目的是画图还是计算，处理的方式不一样。画图的话，我们希望海陆边缘不要出现<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/QQ图片20141122160718.jpg"><img class="alignnone size-full wp-image-337" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/11/QQ图片20141122160718.jpg" alt="QQ图片20141122160718" width="749" height="508" /></a>

比如这样就很好。其实不需对原数据进行操作，只要改变绘图的属性让地图底图后画就可以：
<pre>res@mpFillDrawOrder="PostDraw"</pre>
如果要进行计算，就需要mask了，如果是规整的1x1的数据可以用landsea_mask解决
<pre>load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/<a href="http://www.ncl.ucar.edu/Document/Functions/Shea_util/shea_util.shtml">shea_util.ncl</a>"</pre>
<pre>a    = <a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/addfile.shtml"><strong>addfile</strong></a>("$NCARG_ROOT/lib/ncarg/data/cdf/landsea.nc","r")
lsdata = a-&gt;LSMASK
lsm  = <strong>landsea_mask</strong>(lsdata,data&amp;lat,data&amp;lon)
data = <a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/mask.shtml"><strong>mask</strong></a>(data,lsm.eq.1,False)
data = <a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/mask.shtml"><strong>mask</strong></a>(data,lsm.eq.3,False)</pre>
如果数据不是规整的1x1，需要先做一下插值处理，比如包含极点的场变量转换
<pre> var4    = f2fsh_Wrap(var4s1,(/180,360/))</pre>
---
layout: post
title:  "【已解决】ncl中的cd_calendar" 
categories: NCL
tags: NCL
author: LZN
---

* content
{:toc}

处理CFSR的数据，已经是团队其他成员处理过的了，由于她用的是GrADS，清一色的二进制bin+描述文件ctl，不是自描述的nc文件，ncl处理起来没有任何的metadata，所以都要自己指定。数据文件名是YYYYMM的，循环不是很好写，查了一下，<a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/cd_calendar.shtml#Examples">cd_calendar</a>这个函数很好用，官网上给的例子是hours since和days since的，实际上用months也是可以的。
<pre> <strong>16    </strong> time = ispan(0,383,1)
 <strong>17    </strong> time@units  =   "months since 1979-01-01"
 <strong>18</strong>
 <strong>19    </strong> date = cd_calendar(time,-1)</pre>
得到的date变量返回integer形式的YYYYMM，从79年1月到10年12月，perfect！
而且使用cd_calendar函数，发现之前做起来很麻烦（要算位置）的合成和截取，都可以很方便实现了。还是教程看得不够细致呀 = =

<span style="color: #808080;"><strong>#Up to 20151216#</strong></span>

用cd_calendar可以很好地转换days since之类的时间格式，用于长序列数据的切片读取非常有效。例如下面的例子就可以截取197901-201312的SST片。
<pre> 29 ymstrt = 197901
 30 ymlast = 201312 ; 
 31
 32 data_path = "../../data/sst/monthly"
 33 ctrl_file1 = data_path+"sst_HadOIBl_bc_1.9x2.5_1850_2011_c130301.nc"
 34 ctrl_in1 = addfile (ctrl_file1, "r") 
 35
 36 time = ctrl_in1-&gt;time
 37 yyyymm = cd_calendar(time,-1)
 38 istrt = ind(yyyymm .eq. ymstrt)
 39 ilast = ind(yyyymm .eq. ymlast)
 40 var1 = ctrl_in2-&gt;SST_cpl(istrt:ilast,:,:)</pre>
<span style="color: #808080;"><strong>#Up to 20150107#</strong></span>
---
layout: post
title:  "【已解决】NCL input in flex scanner failed错误" 
categories: NCL
tags: NCL
author: LZN
---

* content
{:toc}

最近使用ncl总是在最后成图的时候出现input in flex scanner failed这种错误。可以肯定是GUI的问题，<a href="http://www-01.ibm.com/support/docview.wss?uid=swg21254823">查了下资料感觉也无从下手</a>，错误触发原因看起来比高级图形接口更加底层，动弹不得。

这个错误最初是由于把字号改大而出现的，于是我将字号改小，果然没问题……不太懂什么原因
---
layout: post
title:  "【已解决】ncl求线性回归系数的问题" 
categories: NCL
tags: NCL
author: LZN
---

* content
{:toc}

求线性回归系数画图，直接用regCoef函数出现维度问题，出不来图。看了下varSummary，奇奇怪怪一大堆，估计是误差估计之类的东西。于是对返回变量做取值操作，没有问题。

例子：
<pre>391 reg_var4 = season_var4(0,:,:)
392 reg_var4 = (/regCoef(sst_ts(i,:),season_var4_anoLLT)/)</pre>
---
layout: post
title:  "【已解决】vim注释语法高亮" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

vim默认注释为深蓝色，太暗太难看。查了下改成了亮绿色，发现有些关键词高亮也是亮绿，后改为亮蓝色，难看点也就这样吧……

其中6是颜色号
<pre>highlight Comment ctermfg=6 guifg=6</pre>
<table style="height: 115px; border-color: #969595;" border="1" width="180">
<tbody>
<tr>
<td style="width: 80px; background-color: #000000;"><span style="color: #ffffff;"><strong>颜色号</strong></span></td>
<td style="width: 80px; background-color: #000000;"><span style="color: #ffffff;"><strong>颜色</strong></span></td>
</tr>
<tr>
<td style="width: 80px; background-color: #000000;"><span style="color: #ffffff;">0</span></td>
<td style="width: 80px; background-color: #000000;"><span style="color: #999999;"><strong>Black</strong></span></td>
</tr>
<tr>
<td style="width: 80px; background-color: #000000;"><span style="color: #ffffff;">1</span></td>
<td style="width: 80px; background-color: #000000;"><span style="color: #ff0000;"><strong>Red</strong></span></td>
</tr>
<tr>
<td style="width: 80px; background-color: #000000;"><span style="color: #ffffff;">2</span></td>
<td style="width: 80px; background-color: #000000;"><span style="color: #00ff00;"><strong>Green</strong></span></td>
</tr>
<tr>
<td style="width: 80px; background-color: #000000;"><span style="color: #ffffff;">3</span></td>
<td style="width: 80px; background-color: #000000;"><span style="color: #ff9900;"><strong>Yellow</strong></span></td>
</tr>
<tr>
<td style="width: 80px; background-color: #000000;"><span style="color: #ffffff;">4</span></td>
<td style="width: 80px; background-color: #000000;"><span style="color: #0000ff;"><strong>Dark Blue</strong></span></td>
</tr>
<tr>
<td style="width: 80px; background-color: #000000;"><span style="color: #ffffff;">5</span></td>
<td style="width: 80px; background-color: #000000;"><span style="color: #ff00ff;"><strong>Pink</strong></span></td>
</tr>
<tr>
<td style="width: 80px; background-color: #000000;"><span style="color: #ffffff;">6</span></td>
<td style="width: 80px; background-color: #000000;"><span style="color: #33cccc;"><strong>Light Blue</strong></span></td>
</tr>
<tr>
<td style="width: 80px; background-color: #000000;"><span style="color: #ffffff;">7</span></td>
<td style="width: 80px; background-color: #000000;"><span style="color: #ffffff;"><strong>White</strong></span></td>
</tr>
</tbody>
</table>
&nbsp;
---
layout: post
title:  "【已解决】vim块选择" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

之前一直用“v”进入可视模式，今天查替换的资料，发现可以通过大写“V”进入可是模式，直接进入行选择，这样进行块复制会方便很多。其他块选择及辅助命令的说明记在这里：
<pre>v------------块选择，字符模式
V------------块选择，行模式
Ctrl+v-------块选择，矩形模式

gg-----------移动到文件头
G------------移动到文件尾
0------------移动到行首
$------------移动到行尾</pre>
---
layout: post
title:  "【更新中】跳闸故障排查:Windows事件查看器" 
categories: Windows Hardware
tags: Windows Hardware
author: LZN
---

* content
{:toc}

最近三天办公室计算机用电（桌位底插座对应线路）总是在凌晨跳闸，而其他路（包括空调）良好，非常奇怪。由于电脑一直开着，所以从系统日志入手查看问题。

win7有eventvwr.exe，直接通过开始运行打开。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/12/QQ图片20141225101006.jpg"><img class="alignnone size-full wp-image-371" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2014/12/QQ图片20141225101006.jpg" alt="QQ图片20141225101006" width="1160" height="558" /></a>

可以看到左侧选中【windows日志】--&gt;【系统】，查看最近日志发现service control manager每个整点过三分会发出ID为7036的事件，而24日和25日这两天都是在凌晨4:03发出最后一个事件报告后缄默，23日在3:03发出最后一个事件报告后缄默。也就是说停电都发生在凌晨三点到五点之间。这样的凌晨时间，而又并非固定时间（可以锁定某些定时开启类电器），非常吊诡。

参考资料

http://blog.sina.com.cn/s/blog_518b64290100fewh.html
---
layout: post
title:  "【更新中】ncl读取ASCII文件" 
categories: NCL
tags: NCL
author: LZN
---

* content
{:toc}

帮CDH做sst forcing的试验，需要用ncl读入个规整的index （35x12），回归出sst anomalies pattern，测试了下asciiread函数，非常好用，有点类似MATLAB的load函数，能够直接识别分隔符。

拷个example过来

<b>Example 1</b>

Assume you have an ASCII data file called "data.asc":
<pre> 1.  2.  3.
 4.  5.  6.
 7.  8.  9.
10. 11. 12.
13. 14. 15.
</pre>
You can read it various ways as shown with the following NCL script:
<pre>begin  
  z1 = <strong>asciiread</strong>("data.asc",(/5,3/),"float")
  z2 = <strong>asciiread</strong>("data.asc",(/4,2/),"float")
end
</pre>
The results of <tt>z1</tt> and <tt>z2</tt> would be:
<pre>z1(0,0) = 1.
z1(0,1) = 2.
z1(0,2) = 3.
z1(1,0) = 4.
z1(1,1) = 5.
z1(1,2) = 6.
z1(2,0) = 7.
.
.
.
z1(4,0) = 13.
z1(4,1) = 14.


z2(0,0) = 1.
z2(0,1) = 2.
z2(1,0) = 3.
z2(1,1) = 4.
z2(2,0) = 5.
z2(2,1) = 6.
z2(3,0) = 7.
z2(3,1) = 8.
</pre>
Example of using -1:
<pre>begin
	z3 = <strong>asciiread</strong>("data.asc",-1,"float")
end
</pre>
<pre>z3(0) = 1.
z3(1) = 2.
z3(2) = 3.
.
.
.
z3(14)= 15.
</pre>
The above <tt>z3</tt> could be reshaped via use of <a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/onedtond.shtml"><strong>onedtond</strong></a>:
<pre>     Z3 = <a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/onedtond.shtml"><strong>onedtond</strong></a>(z3, (/5,3/) )
</pre>
---
layout: post
title:  "【paperhub】格式导出与pdf附件信息" 
categories: PaperHub Project
tags: PaperHub Project
author: LZN
---

* content
{:toc}

研究了半天终于搞明白了怎么用endnote导出ris或者enw，这样终于可以弄清楚几个关键属性对应的keyword了，又可以扩展paperhub的功能。目前考虑加入本地附件链接，doi怎么搞目前还没头绪。

第一步，确定ris或者enw导出在样式中被选中

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/01/Snap2.jpg"><img class="alignnone size-full wp-image-378" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/01/Snap2.jpg" alt="Snap2" width="422" height="541" /></a>

第二步，选中文献，文件--&gt;导出，可以看到输出样式可选ris或者enw输出

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/01/Snap3.jpg"><img class="alignnone size-full wp-image-379" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/01/Snap3.jpg" alt="Snap3" width="577" height="537" /></a>

一个导出文件的例子，其中L1 标签后面对应ris导出格式的本地pdf路径。
<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/01/Snap3.jpg"><img class="alignnone size-full wp-image-380" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/01/QQ图片20150105185757.jpg" alt="QQ图片20150105185757" width="758" height="516" /></a>

&nbsp;
---
layout: post
title:  "【已解决】shell大法好——用here document生成脚本" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

CESM从新建一个case，更改pe layers，到最后提交run脚本执行，还是需要折腾一番的，尤其是四期动辄就对csh傻眼（貌似最近好了），还是提交标准的bash pbs妥当，不过更改pbs，又要费一番功夫。最好就是在create newcase的时候直接把bps生成好，change pe layers的脚本里也加入对pbs修改的语句，这样就可以省下很多功夫。按照【shell 生成文本】的关键词查了下资料。发现here document可以解决问题。
<blockquote>
<div>例如下面的here.sh 文件</div>
<div>cat &lt;&lt; EOF &gt; output.sh</div>
<div>echo "hello"</div>
<div>echo "world"</div>
<div>EOF</div>
<div>使用 sh here.sh 运行这个脚本文件，会得到output.sh 这个新文件，里面的内容如下</div>
<div>echo "hello"</div>
<div>echo "world"</div>
<div></div></blockquote>
<div>还是很简单的说～而且可以识别母脚本中的变量。另外here document还可以用来与数据库或者终端交互，功能确实强大。</div>
<div></div>
<div>参考资料：</div>
<div>http://www.2cto.com/os/201307/231010.html</div>
<div></div>
<div>http://jeremiah.blog.51cto.com/539865/339211</div>
<div></div>
---
layout: post
title:  "【已解决】" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

---
layout: post
title:  "【已解决】自动生成pbs的create_newcase.sh" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

在上一篇<a href="http://222.200.180.66:1234/L_Zealot/blog/wordpress/?p=387">【已解决】shell大法好——用here document生成脚本</a>中介绍了如何使用here document自动生成脚本文件，折腾了一番，搞定了新的create_newcase.sh，可以自动生成pbs文件啦，不用每次调核心数调节点调路径啦。话说shell的if语法真是折腾，调试了快半个小时才通过三行if语句。注意各种空格！

核心代码：
<pre>97 #Deal with que and nodes
98 NNODES=$[NTASKS/16]
99
100 if [ $QUENAME = "ys" ]; then
101 WALLTIME=999
102 elif [ $QUENAME = "few" ]; then
103 WALLTIME=720
104 elif [ $QUENAME = "medium" ]; then
105 WALLTIME=168
106 else
107 WALLTIME=48
108 fi
109
110 #--------------------------------------
111 #------Now generate the pbs file-------
112 #--------------------------------------
113 cat &lt;&lt; EOF &gt; run.pbs
114 #!/bin/sh
115 #PBS -N $CASENAME
116 #PBS -q $QUENAME
117 #PBS -l walltime=$WALLTIME:00:00
118 #PBS -l nodes=$NNODES:ppn=16
119 #PBS -r n
120 #PBS -o cesmrun.log
121 #PBS -e cesmrun.err
122 echo "This jobs is "\$PBS_JOBID@\$PBS_QUEUE
123 MPIBIN=/public/mpi/mvapich2-18-intel/bin
124 EXEROOT=/users/yangsong3/L_Zealot/F/$CASENAME/exe
125 cd \$EXEROOT
126 \$MPIBIN/mpirun -np $NTASKS -hostfile \$PBS_NODEFILE ./cesm.exe &gt;&amp; ../run.log
127 EOF</pre>
---
layout: post
title:  "【已解决】Linux对时命令" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

<pre>#ntpdate us.pool.ntp.org</pre>
---
layout: post
title:  "【已解决】pbs指定作业节点" 
categories: Linux HPC
tags: Linux HPC
author: LZN
---

* content
{:toc}

之前捣鼓了半天没有成功，这次终于知道指定语法怎么写了。

惯例，申请两个节点，每个节点16进程
<pre>#PBS -l nodes=2:ppn=16</pre>
如果需要指定到c72 c73两个节点，需要这么写就可以了：
<pre>#PBS -l nodes=c72:ppn=16+c73:ppn=16</pre>
但是这样在qstat上显示会有问题，显示进程数为0，不过不影响作业正常运行。
---
layout: post
title:  "【自愈术】久病不愈，何不自成良医" 
categories: Self-treat
tags: Self-treat
author: LZN
---

* content
{:toc}

从高中开始，大病没有，小病陆陆续续缠上身，而且都是慢性病，或者过敏等免疫系统问题造成疾病，久了的确非常痛苦。尤其是大三下持续左下腹不适，基本能肯定，慢性结肠炎，这病的确太影响生活，也影响心情。今天突然想，既然医学期刊在中大都是开放的、可以下载的；既然医生诊治，除了药物和仪器我们得不到，基本的知识储备也是依靠教材（过时的文献综述）、进取心强的医生跟进新进研究进展，这些都是可以获得的；既然自己得的也多是不能治愈而只能调养的慢性病 ，为何不自己做文献综述、自己跟进新进文献、自己设定针对自己的调养甚至治疗方案呢？久病成良医，尤其在如今计算机网络，资源获取成本如此低的现代社会，我想只要用心，坚持，自愈术是可以实现的。
<h3>先总结下这几年的毛病吧。</h3>
高二开始，感冒诱因，过敏性鼻炎，大一大二愈演愈烈，大二实在不能忍受早晨起床十数个连珠炮一般的喷嚏和一天不停歇的鼻涕，过敏性鼻炎本就是常见病，偶然向MCHH提到，推荐尝试采用糖皮质激素治疗，辅舒良，丙酸氟替卡松，很贵，六十多一瓶喷剂，尝试下吧，没想到激素真是好东西，奇效。三天过后达到最大疗效，感觉整个人都焕然一新，那种久违的通彻感和清新感，难于言表。而且实际上每日2-4喷，用上一两个月时没问题的。不过尽管摄入量极少，但是长期使用依然担心那些诸多骇人听闻的副作用。前两个月开始逐渐减量，偶尔有复发倾向多喷几次，目前间隔数天一喷，竟然基本不会发作，只是鼻塞（似乎大二时还没有），没有改善。前段时间鼻粘膜略微出血，持续了几天，不安了一段时间后居然没事了，如果再出现，还是应当去做个鼻腔镜。

慢性咽炎，这个不知道什么时候开始的，估计要么是高三，要么是大一，估计也是感冒诱因，没辙。但是症状不重，最近一次感冒，似乎又把咳嗽
---
layout: post
title:  "【已解决】Linux下查看目录树" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

希望查看某一项目的目录结构，有目录树的形式最好了。查了下，这个可以
<pre>find . -type d -print</pre>
但是效果并不美观
<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/02/QQ截图20150228195715.png"><img class="alignnone size-full wp-image-408" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/02/QQ截图20150228195715.png" alt="QQ截图20150228195715" width="740" height="314" /></a>

终极解决方案是root下装个tree命令
<pre>yum install tree</pre>
然后tree就可以了

效果：
<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/02/QQ图片20150228195852.png"><img class="alignnone size-full wp-image-409" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/02/QQ图片20150228195852.png" alt="QQ图片20150228195852" width="934" height="1152" /></a>

如果只显示目录：
<pre>tree -d</pre>
---
layout: post
title:  "【已解决】CESM绘制、修改模式地形高度" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

修改inputdata/cam/topo下USGS的地形数据。变量为PHIS（地表位势高度[m^2/s^2]），除以9.81[m/s^2]即可。

参见<a href="https://www2.cesm.ucar.edu/working-groups/pwg/documentation/cesm1-paleo-ug/near-modern/atmosphere">这里</a>，这是一个古气候模拟的用户手册。
---
layout: post
title:  "【已解决】团队服务器搭建记录" 
categories: Blog&amp;CMS Linux
tags: Blog&amp;CMS Linux
author: LZN
---

* content
{:toc}

1月底团队服务器到货，因假期没有进行搭建。这几天财务急需付款，遂与Jack_Cw一起进行搭建。操作系统：CentOS 6.5，安装过程略去不表。安装完成后配置网络着实折腾了一把，具体情况记录如下：
<h3>1.硬件及操作系统安装</h3>
<ol>
	<li>Linux安装步骤中配置IP及MAC地址，进入系统后完全不能上网，经检查IP地址过期。</li>
	<li>更换IP地址及MAC，ping网关和DNS通畅，内网ssh通畅，外网（跨交换机）极其缓慢，网页打开极其困难。</li>
	<li>BIOS设置取消网卡IP自动分配，问题没有解决。</li>
	<li>检查交换机，更换网线，设置路由，串联路由做交换，均不能解决。</li>
	<li>拿笔记本做诊断，发现Linux系统都存在这一问题。</li>
	<li>到Jack_Cw房间交换机诊断，同样存在问题。</li>
	<li>尝试增加新的网络配置后，发现原有配置正常，但无法链接到新的网络配置。</li>
	<li>采用给服务器增加一个新的无效的网络配置，原有配置即正常。问题解决。</li>
</ol>
<strong>结论：CentOS Linux系统bug，6.4/6.5/7.0均存在，不采用DHCP手动指定IP和MAC的情况下，必须再设置一个额外的网络配置（可以无效）原配置方能够正常使用。</strong>
<span style="color: #008000;"><strong>#Up to 20150314#</strong></span>
<h3>2.软件包安装</h3>
<h4>2.1 Intel2015 C/C++/Fortran编译器</h4>
团队服务器落成，进行软件包安装，尝试安装intel2015编译器。过程与2013版本基本类似，第二步Lcense选项选择
<pre>3. I want to evaluate my product or activate later</pre>
缺少32位库，采用yum安装。
<pre># yum install libstdc++.i686 --setopt=protected_multilib=false</pre>
参数用于忽略版本兼容检查。（默认系统已经安装64位库）

C/C++和Fortran编译器安装非常快，一共不到5分钟，不知是新版本优化了至强核心的编译还是RAID的原因。

安装完成后，拷贝intel.lic文件到/opt/intel/licenses下。
<h4>2.2 HDF5 1.8.14</h4>
先要安装zlib
<pre>#yum install zlib-devel
#yum install zlib-devel
#./configure --prefix=/usr/hdf5-1814 --with-zlib=/usr/lib64
#make
#make check
#make install</pre>
<h4>2.3 NETCDF 4.3.3.1</h4>
安装C库
<pre>./configure --prefix=/usr/netcdf-4331 --enable-netcdf-4 LDFLAGS="-L/usr/hdf5-1814/lib -L/usr/lib64" CPPFLAGS="-I/usr/hdf5-1814/include -I/usr/include" CC=icc
$./make
$./make check
#./make install
</pre>
安装fortran库，注意fortran库对应的netcdf版本号为4.4.2，但是也需要安装到与C库相同的目录下。
<pre>$./configure --prefix=/usr/netcdf-4331 LDFLAGS="-L/usr/netcdf-4331/lib" CPPFLAGS="-I/usr/netcdf-4331/include" FC=ifort
$./make
$./make check
#./make install</pre>
检查安装情况
<pre>$nf-config --all
$nf-config --flibs</pre>
<h4>2.4开启www服务</h4>
<pre>chkconfig mysqld on
chkconfig httpd on
service httpd start
service mysqld start
</pre>
<pre>vi /etc/httpd/conf/httpd.conf
</pre>
修改 User和Group行
User yangsong3
Group yangsong3
<pre>chown -R yangsong3:yangsong3 www/
</pre>
<span style="color: #008000;"><strong>#Up to 20150317#</strong></span>
---
layout: post
title:  "【已解决】NCL输出grads可读的dat文件" 
categories: NCL
tags: NCL
author: LZN
---

* content
{:toc}

其实就是输出二进制文件，和<a href="http://222.200.180.66:1234/L_Zealot/blog/wordpress/?p=221">【已解决】NCL写binery文件Fortran读出错——BigEndian问题</a>一文所提到的一样，需要注意大小端问题。

&nbsp;

文件输出语句如下：

setfileoption("bin","WriteByteOrder","LittleEndian")
fbinrecwrite(g_out_fn,-1,ctrl_var)
---
layout: post
title:  "【已解决】全互联同步备份系统的搭建" 
categories: Linux Windows
tags: Linux Windows
author: LZN
---

* content
{:toc}

信息的组织管理的的确确是个大学问，就像桌面整理都能作为一门课程来教授一样，能把数据和规则进行安全、规整地组织存储是非常不容易的。

数据安全的意义毋庸置疑，早就希望做一套全互联同步备份的系统，这两天终于开始着手做了，架构设计上还有诸多不完善，有待将来优化解决。基本原则：
<ul>
	<li>数据与规则分离</li>
	<li>冗余备份</li>
</ul>
整个备份系统（rsync+NFS）的基本架构图如下：
<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/03/bck_sys.png"><img class="alignnone size-full wp-image-685" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/03/bck_sys.png" alt="bck_sys" width="756" height="1134" /></a>
<h4>NFS实现手段概要：</h4>
<ol>
	<li>Team_Server组建NFS服务端，设置开机启动</li>
	<li>Blackleach配置Windows客户端，设置开机启动mount脚本</li>
</ol>
相关资料网上有很多。实现过程中遇到的问题：

Windows客户端挂载后没有写权限的问题。

首先修改服务端/etc/exports：
<pre>/home/yangsong3/L_Zealot 202.116.*.*(rw,sync,<strong>all_squash,anonuid=500,anongid=500</strong>)</pre>
再修改客户端，注册表加入新键：

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ClientForNFS\CurrentVersion\Default，DWORD项：AnonymousUid，AnonymousGid，值为10进制500

mount语句写入bat脚本，加入计划任务，即可开机启动。

有一点是，Blackleach上X盘符一直是断开状态，但是可以访问，可以完全读写……不知道为什么，囧。（见20150420更新）
<h4>rsync实现手段概要：</h4>
rsync参数很有考究，文件覆盖的时候要进行判断，若对方文件版本修改时间比拿去覆盖的文件要晚，则不能覆盖旧有文件，目前不加入delete以防万一。考虑到文件创建顺序，所有终端应做到时间同步，可惜HPC4无法办到，超算方面没有做对时处理。所以同步都在凌晨进行，防止误覆盖。

同步语句范例:
<pre>rsync -vzrtulopg -progress -e 'ssh -p *' /home/yangsong3/L_Zealot/project/ workstation@*.*.*.*:/home/workstation/L_Zealot/project/</pre>
配置crontab，使得同步能在凌晨按如下顺序进行：

3:01 A.M.

Team_Server发起同步请求，请求顺序Team_Server--&gt;Workstation--&gt;Team_Server

4:01 A.M.

HPC4发起同步请求，请求顺序

HPC4--&gt;Workstation--&gt;HPC4

5:01 A.M.

Workstation发起同步请求，请求顺序

Workstation--&gt;Team_Server

三方同步完成！

参考资料：

<a href="http://www.cnblogs.com/mchina/archive/2013/01/03/2840040.html">http://www.cnblogs.com/mchina/archive/2013/01/03/2840040.html</a>

<a href="http://www.cnblogs.com/itech/archive/2009/08/10/1542945.html">http://www.cnblogs.com/itech/archive/2009/08/10/1542945.html</a>

<a href="http://www.jb51.net/LINUXjishu/66859.html">http://www.jb51.net/LINUXjishu/66859.html</a>

<span style="color: #339966;"><strong>#Up to 20150321#</strong></span>

114那个IP果然有问题，不能下CISL上的数据，nfs挂载到blackleach上是断线状态但是能连接……

因为不能下CISL的数据，换了21的IP，瞬间上述两个问题都解决了……

<span style="color: #339966;"><strong>#Up to 20150420#</strong></span>

加入对paperhub工程的备份

1:01 A.M.

EES_Web_Server发起同步pull请求，请求顺序Lab_Server--&gt;EES_Web_Server

2:01 A.M.

Team_Server发起同步pull请求，请求顺序Lab_Server--&gt;Team_Server

<span style="color: #339966;"><strong>#Up to 20150906#</strong></span>
---
layout: post
title:  "【已解决】" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

---
layout: post
title:  "php遍历目录" 
categories: PHP&amp;mySQL
tags: PHP&amp;mySQL
author: LZN
---

* content
{:toc}

整理所有报告用于下载，希望用php自动遍历目录读入，采用scandir函数实现。直接返回目录到字符串数组，第0与第1个元素是"."和".."，空过即可。

&nbsp;

参考资料：

http://www.jb51.net/article/43186.htm
---
layout: post
title:  "【已解决】矢量+位图混编eps保证位图质量转最小体积pdf" 
categories: Software
tags: Software
author: LZN
---

* content
{:toc}

帮YQ妹妹做简历，她用PS出eps版，高质量位图+矢量（主要是文字）混编，投简历要求肯定是<strong>标准A4 pdf，保证图像质量，体积又不能大（1-2MB吧，至多）</strong>，传过来的单页eps就接近50M，介么有挑战性的任务……

实现步骤还是比较简单的，尝试错误多次找到最佳组合：

AI存pdf，选项如下：

1.最小文件

2.150dpi彩图压缩

3.最高质量

出品pdf 530KB，满足需求！相比印刷质量出品10MB，压缩20倍，基本不影响浏览打印效果。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/04/Snap1.gif"><img class="alignnone size-full wp-image-454" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/04/Snap1.gif" alt="Snap1" width="677" height="561" /></a>

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/04/Snap2.jpg"><img class="alignnone size-full wp-image-457" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/04/Snap2.jpg" alt="Snap2" width="1137" height="804" /></a>
---
layout: post
title:  "关于shell循环wget与tar" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

又到了批量下数据的时候，linux批量wget真是顺畅无比，脚本直接用C/C++语法即可。
<pre>#!/bin/bash
for ((i=1979;i&lt;2014;i++))
{
  wget xxxxx.$i.xxxx
}</pre>
批量解压文件，依然用循环解决
<pre>for tar in *.tar.gz; do tar -xvf $tar; done</pre>
---
layout: post
title:  "【已解决】PDF/A标准文章标注问题" 
categories: Windows Software
tags: Windows Software
author: LZN
---

* content
{:toc}

CD的文章默认都是这个。改下设置就可以

打开PDF文件，依次点击“编辑”、“首选项”、“文档”(种类)中选择“从不”选项并确定，默认的为“使用 PDF/A 模式下

参考资料：http://blog.sciencenet.cn/blog-211702-415720.html
---
layout: post
title:  "【已解决】用ncl6.3.0计算Q1" 
categories: ClimateChange NCL
tags: ClimateChange NCL
author: LZN
---

* content
{:toc}

NCL v6.3.0发布后，发现新增了advect_variable函数，这对于一些复杂诊断方程的计算无疑非常方便，于是决定用ncl来计算Q1.没想到advect_variable函数与垂直积分函数一样，运行后告诉我找不到这个函数，这什么情况，新feature没加好就发布还说有了有了……坑爹啊。

后来用<a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/center_finite_diff_n.shtml">center_finite_diff_n</a>中央差分函数配合完成，计算效率感觉比之前错误得用EC monthly数据算时高非常多（主要是short2flt函数慢），何况NCEP-DOE这套资料还是daily，1度和2.5度分辨率差这么多？没仔细算数据规模，不知道为什么……

写程序时基本没有出什么错误，对这类诊断方程编程时，最需要注意的就是统一国际单位制，量纲要分析正确。还有平流项是严重的非线性项，一定要用daily算再平均到monthly哦～

第一次出图，1979年年均菲律宾海一带Q1与Day200时的Q1，一看就是对的吧:-)

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150505183500.jpg"><img class="alignnone size-full wp-image-482" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150505183500.jpg" alt="QQ图片20150505183500" width="420" height="374" /></a>
---
layout: post
title:  "Annamalai-JC-2013" 
categories: PaperReading 2015
tags: PaperReading 2015
author: LZN
---

* content
{:toc}

<h4><span style="color: #339966;"><strong>2015/04/23</strong></span></h4>
<pre><strong>题目：Global Warming Shifts the Monsoon Circulation, Drying South Asia</strong>
<strong>原文：<a href="http://222.200.180.66:1234/L_Zealot/paperhub/warehouse/Annamalai-JC-2013-26_9_2701-2718.pdf">Annamalai-JC-2013-26_9_2701-2718.pdf</a></strong></pre>
<strong>笔记：</strong>本文对近几十年来南亚地区季风降水减少的原因进行了探索。前人研究已经指出，随着人类活动造成的气候变化，全球的降水有了微弱的增多，但主要的降水增长在中高纬度地区，北纬10-20纬度带上降水却有着显著的减少(<a href="http://222.200.180.66:1234/L_Zealot/paperhub/warehouse/Zhang-Nature-2007-448_7152_461-465.pdf">Zhang et al. 2007</a>)。而南亚季风区正处于这一纬度带，过去几十年里经历了降水的减少。

作者随后从观测资料和CM2.1 historical run去考察了降水减少的情况，发现与此同时，西北太平洋地区的降水确实增加的，出现了反位相变化。而这种长期的降水变化，在不包括人类强迫的PI Control试验中是不能看到的。于是作者提出他们的假说：人类强迫下（主要是CO2）西北太平洋降水的增多会引起大气环流异常，导致南亚地区降水减少。

为了证明这一假说，作者通过4组AGCM试验来考察印太地区海温增暖对南亚地区降水的影响，结果发现，无论是SST的趋势加在西北太平洋，还是整个印太暖池，南亚地区的降水都是减少的，而西北太平洋地区的降水是增加的。作者通过对湿静力能收支的诊断，发现南亚地区蒸发的减少以及西北太平洋地区蒸发的增多对两个区域都有较大贡献。而环流方面，西北太平洋出现的气旋性变化使得出现从副热带地区指向南亚地区的北方扰动，这一扰动使得异常的冷平流和干平流进入南亚地区，造成南亚地区降水的减少。最后的讨论部分作者指出，2xCO2和4xCO2情景下，南亚地区降水是增多的。说明transient响应可能和平衡态是不一致的，未来究竟如何，还是存疑的。

<strong>亮点和借鉴：</strong>

<strong>1.从观测去找信号，提出假设，进而用model去验证是非常重要的能力，一定要重视和锻炼 （套路）</strong>

<strong>2.MSE的诊断方法可以借鉴，Moisture advection的诊断方法可以借鉴</strong>

<strong>3.考察观测现象时，将CMIP5的结果引入，指出人类活动的影响，这种方法在研究人类活动对全球变化的作用时非常值得借鉴</strong>
---
layout: post
title:  "Kim-CD-2015" 
categories: PaperReading 2015
tags: PaperReading 2015
author: LZN
---

* content
{:toc}

<h4><span style="color: #339966;"><strong>2015/04/27</strong></span></h4>
<pre><strong>题目：Observed changes of global and western Pacific precipitation associated with global warming SST mode and mega‑ENSO SST mode</strong>
<strong>原文：<a href="http://222.200.180.66:1234/L_Zealot/paperhub/warehouse/Kim-CD-2015-fv75_fn67_fp53.pdf">Kim-CD-2015-fv75_fn67_fp53.pdf</a></strong></pre>
<strong>笔记：</strong>本文对近几十年来全球尤其是西太平洋降水的变化进行了研究，并试图分离由于人类活动及自然变率对这一变化的相对贡献。在过去的几十年里（1980年以来），研究表明无论是陆地、海洋，以及具体到全球季风的降水，总体上都是在增加的；而且，气候模式普遍预估未来全球降水也是增加的，当然这存在很大的不确定性；最近有研究指出，过去几十年降水的增加，不仅与人类活动造成的全球变暖有关，也与自然变率有关。作者的研究就是为了定量描述自然变率和人类活动对降水变化的贡献。

作者首先对3年滑动平均降水和SST做SVD分解，发现与降水场相关的海温第一模态表现出decadal ENSO的pattern(<a href="http://222.200.180.66:1234/L_Zealot/paperhub/warehouse/Wang-PNAS-2013-110_14_5347-5352.pdf">Wang et al. 2013</a>).但是这并不能够区分出人类活动和自然变率。随后作者对Pr、SST以及垂直积分的水汽通量散度(convergence of vertical integrated moisture flux, CVIMF)进行MVEOF，发现第一模态对应全球变暖的长期趋势信号，第二模态对应类似PDO或mega-ENSO的信号，作者认为这样能够很好的对人类活动影响和自然变率进行区分。

随后作者对CVIMF动力作用项和热力作用项进行诊断，发现无论是人类活动作用还是自然变化作用，通过动力作用（辐散辐合）去影响CVIMF都是主要的，进一步地，作者仿照风场散度对势函数和辐散风的定义，对CVIMF的动力项求势函数和辐散风通量，以求锁定不同变率对应的水汽通量散度的源汇区：结果发现人类活动倾向于在太平洋出现三极型响应，西太和东太是汇区，而中太是源区；自然变率则倾向于形成西太汇而东太源的情况。

接下来，作者又用雷诺平均的方法，诊断定常波（stationary part）和瞬变波（eddy part）对势函数和辐散风通量的贡献，发现定常波在其中起到主要贡献。具体到西北太平洋近几十年降水的变化，作者认为是decadal ENSO的La Nina位相和人类强迫引起的印度洋增强的西风输送所引起。

总之，作者认为利用MVEOF是一种很好的区分人类强迫和自然变率的方法并深入分析了伴随这两种模态的水汽输送通量散度的变化，并试图对西太地区降水的增多进行解释。

<strong>亮点和借鉴：</strong>

<strong>1.这是一篇非常好的利用观测资料进行深入的动力学诊断的文章，利用MVEOF工具巧妙区分了人类强迫和自然变率的影响，进而深入利用高超的动力学分析工具去考察人类强迫和自然变率的对降水变化的贡献作用。环环相扣，渐入佳境。</strong>

<strong>2.MVEOF的方法，非同时SVD的方法在区分信号、联系因果的作用</strong>

<strong>3.CVIMF的诊断分析方法，很好的动力学诊断工具。</strong>

问题（2015.4.29邮件作者-2015.5.8收到回复）：

1.MVEOF的区分终归是线性的，人类活动对ENSO的影响又该如何表现出来？或者说，这一影响存在于第二个模态中么？

2.为什么要用三年滑动平均来做MVEOF？

3.定常扰动和瞬变扰动是如何区分的？

作者解答
<blockquote>Q1. I am impressed to see the power of MVEOF method to separate the effects of anthropogenic forcing and natural variability. However, since the anthropogenic forcing may also influence the natural variability such as ENSO (Vecchi et al., 2008), is that possible to see this kind of effect in the MVEOF2?

<span style="color: #008000;"> * We tried to separate natural variability and anthropogenic forcing, eventually we used the third variable, moisture flux covergence, which may be linked to the dynamic and thermodynamic aspects for climate variability, in using MVEOF. As you know, MVEOFS qurantees independency with orthogonality of base functions. However, as Vecchi et al mentioned, we have assumption: although these two modes are independent, actually ENSO mode has a low-frequency variability such as Mege-ENSO, IPO-related one, which may be associated with anthropogenic component.</span>

Q2. I don’t know why 3-year running mean is used to analyze this phenomenon. What’s the advantage than using primitive annual mean or 5-year or 7-year running mean?

<span style="color: #008000;"> * We attempted various cases in term of averaging time period, to remove interannual variability such as ENSO. Three-year running average is sufficient to show this and loss of data is relatively small. The advantage of running mean seems that we can show a long-term or low-frequency variabilities.</span>

Q3.    How to separate stationary and eddy parts of potential function and divergent component of moisture flux? Has a 3-7 day band-pass filter method been used to acquire the eddy parts?

<span style="color: #008000;">* Actually eddy part was estimated with perturbation from annual mean. It has many sub-annual components such as seasonal cycle, sub-seasonal oscillation, high-frequency synoptic eddy, and so on. So my student Byung-Hee Kim (see CC email address), as a co-author has analyzed with separarting various components including eddy component only.</span></blockquote>
---
layout: post
title:  "Li-Nature-2014" 
categories: PaperReading 2014
tags: PaperReading 2014
author: LZN
---

* content
{:toc}

<pre><strong>题目：Impacts of the north and tropical Atlantic Ocean on the Antarctic Peninsula and sea ice</strong>
<strong>原文：<a href="http://222.200.180.66:1234/L_Zealot/paperhub/warehouse/Li-Nature-2014-505_7484_538-542.pdf">Li-Nature-2014-505_7484_538-542.pdf</a></strong></pre>
<strong>笔记：占坑，回填(2015.5.11)</strong>
---
layout: post
title:  "Wang-PNAS-2013" 
categories: PaperReading 2015
tags: PaperReading 2015
author: LZN
---

* content
{:toc}

<h4><span style="color: #339966;"><strong>2015/05/01</strong></span></h4>
<pre><strong>题目：Northern Hemisphere summer monsoon intensified by mega-El Niño/southern oscillation and Atlantic multidecadal oscillation</strong>
<strong>原文：<a href="http://222.200.180.66:1234/L_Zealot/paperhub/warehouse/Wang-PNAS-2013-110_14_5347-5352.pdf">Wang-PNAS-2013-110_14_5347-5352.pdf</a></strong></pre>
<strong>笔记：</strong>不同于以往将全球各个季风系统分开独立研究的方法，作者从全球的角度考察了整个北半球夏季风的变化，认为从这一角度来看，北半球整体夏季风都是增强的，沃克环流增强；作者认为整个北半球夏季风的增强是归因于mega-ENSO（作者自己定义的一种跨尺度自然变率，跨越年际-年代际尺度）以及AMO的共同作用，以及半球间增暖的不同步。

<strong>问题：</strong>文章整体读来感觉平铺直叙，索然寡味，很容易就会走神。而且作者后来提出mega-ENSO后很是自卖自夸了一番：
<pre>1.3年滑动平均定义，使用方便，不用搞什么EOF第二模态或者滤波
2.适用范围比ENSO、PDO、IPO更广泛
<strong>3.多时间尺度的特性，联系年际-年代际变率</strong>
4.与NHSM有很好的相关性</pre>
作者认为mega-ENSO具有定义简单等诸多优点，但是在讨论Hadley环流变化时，采用的是复杂的质量流函数的跨半球运输效果来评价的，当然，作者本身也强调了由于季风辐合区的巨大变动，评估Hadley环流变化是不容易的。可能是由于篇幅限制，作者并没有对mega-ENSO、AMO、半球增暖不均一对北半球季风作用的具体机制进行诠释，关于Hadley和Walker环流增强的机制也没有进行具体阐述。

不过，这篇文章发出后，引用非常高。之前某次开会，似乎也听到两位老师评价所说的“很会写文章，现象提出了，指数也定义好了，只要你做，绕不开它”指的似乎也是这篇文章。不能否认的是，这篇文章有多值得思考借鉴的地方，当然也包括技巧。

<strong>亮点和借鉴：</strong>
<ol>
	<li>尽管平铺直叙索然寡味，洞察力和技巧是这篇文章的最大特点：（1）曾经研究季风，都是在区域尺度上捣鼓，少有全球尺度捣鼓的（作者也提到，在他之前有人玩了，但只是玩玩降水），作者现在玩大了，环流也搞进来，于是来一个指数（怎么样，以后搞全球季风，绕得开这个指数么？）（2）我们早就知道ENSO和PDO的pattern非常类似，可是没有人想着去定义一个指数，将这两者联系起来，作者现在这么做了，于是又有了一个指数（怎么样，想说ENSO和PDO关系，想说最近几十年太平洋自然辨率，来吧来吧用我吧）。</li>
	<li>AMO对NHSM影响的model试验很神奇，耦合模式然后做SST的nudging，技术细节还值得深思，也值得将来参考应用，考虑发邮件询问。</li>
	<li>Fig. S2判断两套资料趋势信噪比的方法值得借鉴。</li>
</ol>
---
layout: post
title:  "兰若高山处" 
categories: Living&amp;thinking
tags: Living&amp;thinking
author: LZN
---

* content
{:toc}

<pre style="text-align: center;">谒真谛寺禅师
杜甫
兰若山高处，烟霞嶂几重。冻泉依细石，晴雪落长松。
问法看诗忘，观身向酒慵。未能割妻子，卜宅近前峰。</pre>
最早是在06年暗黑吧一吧友签名里看到“兰若高山处，烟霞嶂几重”两句，只觉意境深远，心向往之，便铭记在心。

如今已快十年，前段时间大半夜听写完TPO，劳顿困倦，关机准备上床的时候脑海里突然闪过这两句话，一下子清醒了许多，躺在床上细细品味，或许诗人只是用来描写拜谒真谛寺时所见山上景色吧，我却多想了几分意思。汉语功底不深，只得依托查找搜索。“兰若”指兰草与杜若，都是香草，很明显是美好事物的意象；兰若高山处，香草生长在高山上。“烟霞”大家都懂，就是山上的云雾，去过黄山，印象深刻，风吹云移，一倾万变，相隔十几米的景物，也是时隐时现，所谓仙境。

美好的香草是长在高高的山岭上的，又有数重布满烟霞的山峰相隔，很难到达见识。或许作者只是描绘一下真谛寺在高山上，周围有兰若，也能看到几重烟霞嶂，抑或作者也在暗示追求美好的事物，总要克服许多困难，才能最终得到。无论是居上而观，还是居下而瞻，似乎都把王国维提到的大学者三重境界都包含了：高楼望尽天涯路，衣带渐宽终不悔，回首灯火阑珊处。求不得，舍不得，终自然而得。这是马拉松，是厚积薄发，是跬步千里。这是一万小时定律，我信奉这个。

近两年的迷惘和思索，观念价值受冲击也改变了很多，未来不确定，现实不满意，却在思索和内省中渐渐明晰了自己究竟想要什么：再看高中时的想法，当时向往的完全出世是不可以的，“未能割妻子，卜宅近前峰。”杜甫这么说，妻儿舍不下，把家安在山前呗，去山上拜谒并不远，又能在家陪老婆孩子。出世不离世，入尘不染尘。其实作者是在前两句“问法看诗妄，观身向酒慵”中走出来的：问道佛法，却发现自己写的诗是虚妄；反省自身，只觉酒为乱性污物，不喜自己酒后懒散颓靡之姿。

“冻泉依细石，晴雪落长松。”这两句意象绝妙。清泉在冰冻的细石上汩汩涌出，晴天里却落雪在长松枝上，读得这两句，只觉脑海中一片高山清冷凛冽，却又处处透露着生机的矛盾之感。不知何故，却联系到了“昔我往矣，杨柳依依；今我来思，雨雪霏霏”，一时语塞。这意境已然玄妙，阅历不足，不可妄论。

细细品来，其实全诗始末，也是作者的一番心路历程吧。

开头两句做了微信签名，跬步千里，祝福自己吧！

&nbsp;
---
layout: post
title:  "【已解决】用winRAR+计划任务定期备份文件夹" 
categories: Windows Software
tags: Windows Software
author: LZN
---

* content
{:toc}

三月份做好了linux下的<a href="http://222.200.180.66:1234/L_Zealot/blog/wordpress/?p=426">全备份互联系统</a>，Blackleach上工作用文件夹本想备份到Linux下，奈何没有做要数据和规则的分离，体积过大（40+G），winscp/NSF等可能也很费时不方便，用WinDirStat做了大文件分离后，还剩10+G，所以参考了这个帖子：

http://jingyan.baidu.com/article/3052f5a1ddb11097f31f8688.html

直接用winRAR+计划任务备份到另一块database硬盘上，我们文件过大，不需要存留旧版本，所以生成文件不挂时间戳，文中有几点需要设置的地方没有说清楚：
<ol>
	<li>需要选定【备份】选项卡下“压缩前清除目标磁盘内容”的选项，否则第二次压缩时，由于同名文件存在，C盘无论多大都会被压缩过程中的临时文件占满。（估计可能是一个bug）</li>
	<li>需要选定立刻执行，否则计划任务到时会弹出对话框，而不是立刻执行备份压缩。</li>
	<li>压缩程度直接选存储级别，否则查看就会特别慢。</li>
</ol>
---
layout: post
title:  "【已解决】EXCEL+Shell抓取扇贝COCA TOP 20000" 
categories: Linux Internet English
tags: Linux Internet English
author: LZN
---

* content
{:toc}

<pre>COCA 20000高频词汇。 COCA=Corpus of Contemporary American English (COCA) 这是英语国家使用频率最高的词汇集合。 从众多语料库（corpus）中提取。用大数据的方法从各种文体中自动生成一个词频表。这是当今最准确的词频表：美国当代语料库 coca 中的前20000个单词。 简单的说，coca就是把1990-2012年美国最有代表性的报纸，杂志，小说，学术，口语（口语可能是用的电视剧或者脱口秀之类的节目转录的）汇集起来，每部分各占1/5，生成4.5亿单词量语料库。 背完这个，应当就可以愉快的阅读纽约时报了。 希望你能成功。</pre>
上面是扇贝单词中<a href="http://www.shanbay.com/wordbook/103867/">COCA20000单词书</a>的介绍。

不知道大家看完是不是之前就有这个想法：为什么我们背单词，不能集中下能搜集到的语言材料，然后将词汇出现的频次排个序呢？按照出现频次背上top一两万，日常能碰到的词汇不就都涵盖了么。确实是这样。

上个月在知乎一英语学习贴子上接触到了corpus（语料库）的概念，的确有人在用大数据自然语言分析的方法做这个事情。网上能搜到的有BNC和COCA，BNC公布了前15000，但是语料内容过于老旧，据说是80年代的，而COCA则是美国的，统计数据从90年代初到2012年，绝对的精华，非常优秀非常珍贵，但是只公开了前5000的高频词，20K的要接近40刀价格出售，没办法……

这几天托福4K已经差不多背完了，正在想着怎么把BNC15000导入，又查了一下扇贝单词书，大吃一惊，原来几天前（5月20日）已经有人把COCA top20000做成了单词书，而且售价199贝壳，相比于40USD，这可真是普度众生功德无量啊，果断收藏之！BNC15000也不用搞了，真爽。

正洋洋得意之时，突觉哪里不对，毕竟有个版权问题，万一哪天COCA找到扇贝，说你丫侵权，删掉删掉，一则词库没了要搁置一段时间，二则购买的话，又是接近三百块钱，这不完蛋了。虽然只是个概率问题，但毕竟还是存在风险的，计算下成本收益，与其承担这个不确定性，不妨写个脚本把单词全抓下来，万一删了还是有留底的，对冲风险，万无一失。下面来展示EXCEL+Linux的完美解决方案，当然，重点是分析问题的思路：

<strong>1. 地址分析</strong>

对于如此批量数据的处理，最基础的，我们要先搞清楚两个问题：
<p style="padding-left: 30px;">（1）查看数据是否有权限要求？</p>
<p style="padding-left: 30px;">（2）数据组织结构是怎样的，源地址是否有规律？</p>
对于第一个问题，如果不需要登录权限就可以查看单词书以及单词书下所有词汇，对我们来说无疑是非常有利的，因为不需要认证，很可能使用shell下的wget命令或者php get_file_contents就可以实现下载；

第二个问题，如果地址有规律，前面两个命令或函数配合循环直接搞定，问题将被大大简化，如果没有规律的话，就需要想办法进行遍历了。

首先在团队服务器用wget测试一下<a href="http://www.shanbay.com/wordlist/103867/194194/">wordlist0-100</a>这个页面能不能抓到，bingo！没问题，第一个问题直接解决。

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525221100.jpg"><img class="alignnone size-full wp-image-521" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525221100.jpg" alt="QQ图片20150525221100" width="878" height="734" /></a>

对于第二个问题，我们分析一下地址：
<pre>http://www.shanbay.com/wordlist/103867/194194/</pre>
这是list0-100第一页的地址，可以末尾目录地址分为两个部分，10387是单词书编号，这个退回到单词书首页就可以发现，194194应该是单元编号，我们再跳到第二页，地址变成了这个：
<pre>http://www.shanbay.com/wordlist/103867/194194/?page=2</pre>
没错，只需要挂一个get参数就可以决定页数。而且扫了下每个单元，都是5页。Bingo，接下来的问题是，单元号是否有规律呢？

我们依次往下切几个单元看看：
<pre>http://www.shanbay.com/wordlist/103867/194194/ 0-100
http://www.shanbay.com/wordlist/103867/194197/ 100-200
http://www.shanbay.com/wordlist/103867/194200/ 200-300
http://www.shanbay.com/wordlist/103867/194203/ 300-400 
http://www.shanbay.com/wordlist/103867/194230/ 1100-1200
http://www.shanbay.com/wordlist/103867/194863/ 20100-20200</pre>
从前几个单元来看，似乎单元号依次+3，这样很容易找到规律，按照这一规律推算，最后一个单元应该是194194+3*(20100/100)=194797，纳尼！实际却是194863，中间那几十个单元号哪里去了！！

估计这可能与单词书创建时单元提交错误，作者又重新提交有关，数据库没有删除错误的单元号。这么说，单元号可能是间断无规律的，换个思路，我们只能枚举了。

<strong>2. 枚举地址
</strong>

首先查看源代码，发现词汇书首页单元链接部分共享统一的代码结构：

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525222015.jpg"><img class="alignnone size-full wp-image-522" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525222015.jpg" alt="QQ图片20150525222015" width="851" height="262" /></a>

二话不说，全选复制，放到EXCEL中，A列：

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525222245.jpg"><img class="alignnone size-full wp-image-523" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525222245.jpg" alt="QQ图片20150525222245" width="611" height="590" /></a>

重点来了：由于每个单元结构都是固定格式，所以这些单元所占行数是固定的，因此我们所关注的链接地址出现的位置也是固定的：6行、36行、66行依次类推，所以，我们采用函数把这些行抽出来放到一个列中，随意百度，<a href="http://zhidao.baidu.com/link?url=r1C-aSjR_OY-HgGC1BWRXNTiQ8tESvlN4b-gdaZL2y5QV5lhdAm4uMwqPO-jQXJl-gIC07qW7DAQa3FVwdQQS_">你就知道</a>：
<pre>=INDEX(A:A,(ROW()-1)*30+6)
结果：
 &lt;a href="/wordlist/103867/194194/"&gt;wordlist 0-100&lt;/a&gt;</pre>
接下来则是喜闻乐见的拖啊托，然后分列，抽出链接部分，索性直接把命令补全：

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525222734.jpg"><img class="alignnone size-full wp-image-524" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525222734.jpg" alt="QQ图片20150525222734" width="730" height="281" /></a>

<strong>3. 脚本下载
</strong>

接下来就水到渠成啦！复制粘贴，查找更换下多余tab空格，套个循环，sh执行！全部list down下来大概只用了5分钟左右，ls之：

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525223013.jpg"><img class="alignnone size-full wp-image-525" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525223013.jpg" alt="QQ图片20150525223013" width="995" height="616" /></a>

满满的成就感，且慢～grep一下html的关键label，再数个个数，看下是否都下载到了：

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525223245.jpg"><img class="alignnone size-full wp-image-526" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/05/QQ图片20150525223245.jpg" alt="QQ图片20150525223245" width="961" height="289" /></a>

BINGO！不过单词书里16000+单词，为什么grep出18000+关键标签……查了个文件貌似除了汉语意思部分木有这个class了呀，不懂……回来满满找吧

&nbsp;

ps: 5分钟能把这些单词upload到我脑子中不？LOL

&nbsp;
---
layout: post
title:  "【COAP】大气科学类文献语料库建立" 
categories: Internet Project COAP Python
tags: Internet Project COAP Python
author: LZN
---

* content
{:toc}

背单词找方法<a href="http://www.zhihu.com/question/26814125/answer/47549326">刷知乎</a>的时候接触到了corpus（语料库）的概念，昨晚睡不着随便刷知乎，看到了<a href="http://zhuanlan.zhihu.com/talk-about-english/20044356">这篇回答</a>，也是利用语料库统计词频的方法，筛选出《经济学人》中专业词汇，从而有针对性地进行记忆，高效快速地训练自己能够读懂相关文章的能力。而作者没有局限于此，又对统计出的词频做了数据挖掘和数据分析，比如近几年经济学人对中国关注度的变化，对中国哪家互联网企业关注最多等等。看到这些，突然眼前一亮，为什么我们不能建立一个专业期刊的语料库，然后进行数据挖掘和分析呢？这下更睡不着了，决定取名为COAP (Corpus of Atmospheric Papers)。简单构思实现方法，认为这是可行的：
<ol>
	<li>首先我们需要将指定期刊所有文章（带摘要的引文信息也可以，与paperhub联系），爬下来。</li>
	<li>写词频统计程序和分析程序，对语料库进行整理分析。</li>
</ol>
可能遇到的困难:

1. 期刊方自我保护：谁都不希望有人把自己所有的家当爬走，很可能会对下载进行限制。比如频率（这个可以通过延时解决）、数量（如果限制IP，没办法，只能换）、地址加密（这个也比较麻烦，所以需要学习爬虫）等等。今天简单看了JC的情况，发现地址虽然进行了加密，但是用爬虫应该还是能解决问题。

2. 语义分析、正则表达式一直是弱项，这点需要额外加强，另外目前对语料库总数据量还不能确定（10-1000GB）区间吧，真正分析起来时间成本也是个问题，多线程需要考虑。

上述可能遇到的问题并非不能解决，简单设想，最好的工具就是python了，正好以此项目作为契机，入门python。一些资料留在这里，希望今年能把这个事情做出来！

<a href="http://www.zhihu.com/question/20899988">【知乎】如何入门python爬虫</a>

<a href="http://www.cnblogs.com/fnng/p/3576154.html">python实现简单爬虫功能</a>
---
layout: post
title:  "【Friends】S01E01" 
categories: English FriendsNotebook Season1
tags: English FriendsNotebook Season1
author: LZN
---

* content
{:toc}

sb have a hump 某人驼背 hump 隆起的东西，驼峰

hairpiece 假发

chalk 粉笔

All of a sudden

turn out 结果发现 v.

sweetie 甜心（昵称）

intestine 肠子

cookie=biscuit

aura 灵气，光环

murky 阴暗的，模糊的

lesbian 蕾丝边，女同性恋

fixate 注视 v.

hysterical 歇斯底里的

strip joint 脱衣舞酒店

hormones 激素 荷尔蒙

decaffeinated 去咖啡因咖啡

bridesmaid 伴娘

gravy 卤的

freak out （I got really freaked out）惊慌

kinda = kind of

drift apart 渐行渐远

pipe organ 管风琴

Tuna 吞拿鱼 金枪鱼

purse 女式钱包

metaphor 隐喻

bluebell 风信子

mitten 手套

diary 日记

I didn't catch your name

eyelash 眼睫毛

just gonna hang out here tonight 呆在这里一晚上

wondrous 奇妙的

pigeon 鸽子

crap 废话，排泄

the new ones are <b>crap</b>

换新都是<b>扯淡</b>

bracket 托架

I am supposed to attach a brackety thing to the side things, using a bunch of these little worm guys. 我认为应该把这个托架用蜗杆装到侧面。

stereo 立体声

get screwed 收到不公正的待遇，受骗

catch on 理解明白，变得流行

shred 切碎 撕碎

steer clear of 避开，绕开

rip your heart out 撕开你的心

whipped cream 生奶油

revelation 启示 揭露 出乎意料的事

smash 粉碎 v.

screamer 尖叫的人

get it together 【俚】圆满处理 Even if I could get it together enough to ask a woman out

be on a roll 运气好，超常发挥，很顺利

omelet 煎蛋卷

raise 筹集 v.

abuse 辱骂 v.

hanger 衣架

take credit for 归功于

I take credit for selling the socks. 袜子卖出去了归功于我

I take credit for Paul. Paul欠我人情。

beacon 灯塔 烽火

upbeat 乐观的 上升的

step-dad 继父

albino 白化病

aromatherapy 香料按摩

crush on 暗恋

butt 屁股

&nbsp;
---
layout: post
title:  "【Shanbei News Notes】20150621" 
categories: ShanbeiNews
tags: ShanbeiNews
author: LZN
---

* content
{:toc}

US Calls on Greece for Tough Fiscal Decisions to Avert Default 美国呼吁希腊采取强硬财政措施以避免债务违约

Default 债务违约

Default on 拖欠债务

FILE在新闻中作“资料”理解

set to air 播出，例如

The full interview is set to air Sunday on CNN's "Fareed Zakaria GPS". 完整的采访将于周日在CNN的《法里德·扎卡里亚全球扫描》中播出。

International Monetary Fund 国际货币基金组织

Athens has so far balked at austerity demands from creditors in exchange fr further cash. 希腊一直不愿意实行债权人要求的紧缩政策，导致无法相应地获得更多的现金。

balk at 回避

austerity 紧缩，苦行

Negotiations remain at a standstill 谈判一直停滞不前

The summit was called after multinational talks about terms of the ongoing $17.5 billion bailout ended in acrimony Thursday. 周四时，欧盟多国就现行的175亿美元紧急援助的条款进行了商谈，但最终不欢而散，随后决定召开紧急峰会。
---
layout: post
title:  "【COAP】python学习抓取页面之cookie处理" 
categories: Internet Project COAP Python
tags: Internet Project COAP Python
author: LZN
---

* content
{:toc}

正式开始进行COAP计划，尝试使用虫师文章中的方法，第一步尝试抓页面，没想到抓<a href="http://journals.ametsoc.org/toc/clim/27/1">AMS页面</a>直接出错，获取到如下信息：
<pre><strong>An Error Occurred Setting Your User Cookie</strong>
This site uses cookies to improve performance. If your browser does not accept cookies, you cannot view this site.</pre>
看起来需要python模拟cookie，查到了这篇资料：
http://www.jb51.net/article/57161.htm

用firefox开发者工具查看到如下cookie于消息头：
__utma=16122406.1750209584.1411475670.1431938642.1432023770.7; __utmz=16122406.1432023770.7.6.utmcsr=gfsoso.net|utmccn=(referral)|utmcmd=referral|utmcct=/; is_returning=1; MAID=dzAjIuUXaPeh6b+Yq+nUfw==; MAID=dzAjIuUXaPeh6b+Yq+nUfw==; __utma=204447755.516480521.1411475728.1433503003.1435135708.81; __utmz=204447755.1431959196.71.52.utmcsr=gfsoso.net|utmccn=(referral)|utmcmd=referral|utmcct=/scholar; __atuvc=2%7C18%2C0%7C19%2C10%7C20%2C14%7C21%2C1%7C22; __atssc=google%3B11; _ga=GA1.2.1750209584.1411475670; SERVER=WZ6myaEXBLEBggwSoVsKlQ==; SERVER=WZ6myaEXBLEBggwSoVsKlQ==; JSESSIONID=aaabcsH1XJkK18aZ3n83u; JSESSIONID=aaabcsH1XJkK18aZ3n83u; __utmb=204447755.6.10.1435135708; __utmc=204447755; __utmt=1

完全没头绪……

关于cookie的操作

http://www.jb51.net/article/57144.htm

换用urllib2，去请求该页面的cookie，然后输出html，done！这样就将页面获得了，还是很简单的。不过那些方法属性，确实不懂……

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/06/QQ截图20150624220531.png"><img class="alignnone size-full wp-image-567" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/06/QQ截图20150624220531.png" alt="QQ截图20150624220531" width="1688" height="450" /></a>
---
layout: post
title:  "【note】关于MOOC和coursera" 
categories: Notebook
tags: Notebook
author: LZN
---

* content
{:toc}

<table>
<tbody>
<tr>
<td><strong>Material</strong>

google

MOOC结果： 8,690,000 条

Coursera结果：5,950,000 条

Coursera是MOOC的一个课程平台

http://36kr.com/p/213014.html MOOC证书，就业市场

把MOOC作为课程内容的一部分，加入线下讨论，最后通过线下考试来认证本校学分

<strong>MOOC 证书能够证明一个人在某个领域里面“相对标准化的中等程度的自学能力”</strong>

学一门MOOC的时候，你大概将要花费7.63 周，平均每周 4.63 至 6.88 小时（数据来源于MOOC学院所有课程均值）来学习一门课，而且有很多作业和练习需要完成，那么你对这个领域的知识大概能够掌握到识记细节的程度。

Coursera推出“专项认证“要求与一门本科专业相似，10^3小时水平

MOOC证书至少保证了所有学习者投入的时间在一个平均水平上，这实际上是所有文凭，证书的通用目的，尽量把人摆到学习曲线的某一个标准线上，并保持这个标准线的考核可信，有效。

市场就业价值：

1. 证明学习能力，覆盖面广，标准化。（核心）

2. 帮助新人了解，<strong>雇主进行大规模低成本新手培训。</strong>

3. 帮助条件不好的天才崭露头角。

&nbsp;

http://36kr.com/p/213199.html 把MOOC推荐给市场中的谁？

有人通过MOOC转行CS

<strong>MOOC最能够解决的痛点：1、应届毕业生增加竞争力。2、跨行业、跨专业就业。</strong>

211以上水平学生不信任社会培训机构，一部分具有MOOC学习能力（英文水平+自学能力），希望跨专业就业--》这就是MOOC市场

在中国的高校毕业生中，3年内有30%左右的人会转换职业甚至行业，以700万毕业生为基数，3年内210万人会选择转换职业路径，平均每年70万，这里 大约10%左右是同时具备学习MOOC的能力和需求的学生，和每年的应届毕业生有需求的人数相加，大约是40-70万人。

市场定位：

1. 大学教育补充，中等自学能力证明

2. 刚需：提升竞争力+跨专业就业

3. 211以上高校不认可职业教育培训（达内、尚德），扩招，就业压力放大，从而有需求

4. 课程顶级有顶级高校的魅力，被认可，需要普及证书在雇主和学生之间的认可度。

例子：神经生物学硕士，旧金山10+门Mooc，申请成功CS硕士。申请帮助很大，有很多课程由于上过MOOC都免修了，这对跨专业申请的人绝对是个福音。

大大降低了系统性自学的成本和难度，把学习者从单一的学位体系下解放出来，让跨专业学习成为常态，从而帮助学习者在职业选择和继续教育的道路上，迈出的关键一步。

http://www.zhihu.com/question/26187877 网易中国MOOC课程证书的用处？

意义不大，纪念性质。

CON：难度不大，口碑未起，基本靠自觉，作弊容易

展望： 严格课程会出现，连锁机构监考MOOC？

http://www.guokr.com/blog/763936/ 果壳 MOOC证书的用处？

多数课程要坚持1-2个月的学习，每周要考试才能拿到证书

就算你是真正靠自己学完，你拿到的证书上也会写清楚：（免费版）我们不能保证是本人参与了学习考试。本证书在本校（提供课程的学校）不记学分。如果是收费版，则会有一些<a href="https://www.coursera.org/signature/" target="_blank">技术手段</a>，比如Coursera的创始人<a href="http://baike.baidu.com/view/10853998.htm" target="_blank">吴恩达</a>就是这方面的专家（他现在去百度美国做首席科学家了=。=），人脸识别、键盘打字识别来鉴定是否所有考试都是同一人所为。但是我觉得这样还是很好破的呀，如果从头到尾都是同一个人代考的话……

识别技术：打字习惯、人脸身份识别；提交作业提供打字样本和照片；

2014.10开始有较多学校承认MOOC学分

领英可以绑定MOOC学习
<div class="cmt-content cmtContent gbbcode-content">

MOOC是一个统称，就像“卷筒纸”

Coursera是其中一个MOOC平台，就像某个卷筒纸的品牌，比如舒洁

MOOC学院是收录了所有MOOC课程的地方，就像超市~

而大学在颁发MOOC证书时也会相当谨慎以维护自己的声誉，不可能让它越位取代大学正规的学位证书。

</div></td>
<td><strong>Point</strong>教育体系并不完全承认MOOC的学分

&nbsp;

dd

&nbsp;

&nbsp;

&nbsp;

ddd</td>
</tr>
<tr>
<td colspan="2"> <strong> Measure</strong></td>
</tr>
</tbody>
</table>
&nbsp;
---
layout: post
title:  "【Shanbei News Notes】20150624" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h3>Drought-Related Hardship Raises HIV Risk, Study Finds</h3>
<h3>研究表明干旱带来的困难增大艾滋病感染的风险</h3>
saving account 储蓄账户

New research concludes buffering people from financial shocks may help keep them from resorting to risky behaviors that spread the virus.

新的研究揭示受经济打击影响小的人能够减少发生传播病毒的高危行为。

这句不是很好翻译，buffering people，buffer，缓冲，缓冲的人，意译为有缓冲准备，受影响小的

resort这个词总是记不住，名词词性有 “凭借，手段，度假胜地”之意义；动词词性有“求助，诉诸；常去”的意思，这里采用动词词性，经常（操作，使用，实施）之意义。

名词例句：

Nuclear wapons should be used only as a last <strong>resort</strong>.

核武器应该只被用作最后手段。

Hawaii is an all-the-year-round <strong>tourist resort</strong>.

夏威夷一年四季都是旅游胜地。（建议tourist resort连用，消除歧义）

动词例句：

His punishing work schedule had made him resort to drugs.

他那类人的工作日程已经使得他不得不求助于毒品了。

Congress has a responsibility to ensure that all peaceful options are exhausted before resort to war.

过会有义务确保在所有和平手段用尽之后再诉诸武力。

cope with = deal with 应对

The study says measure such as better access to savings accounts and credit, weather-indexed crop insurance and more drought-tolerant crops could <strong>cushion</strong> the <strong>blow</strong> from money troubles, and ultimately <strong>curtail</strong> the spread of HIV.

研究显示，诸如能够方便使用储蓄和信用卡，<a href="http://baike.baidu.com/link?url=97xKtj3TuF12CEZ_PkFo_TZww-k7l3DEqUsiL_QrdycUED3Lkr2MyF9hdNcyTz3wGMs9ry77qGIzVmo-r2Xodq">农业气象指数保险</a>，以及种植耐旱作物能够减缓经济冲击，最终减少艾滋病的传播。

life without a net 没有保障的生活

spouse 配偶
---
layout: post
title:  "【Shanbei News Notes】20150627" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h3>SpaceX Capsule to Deliver New Parking Spot for Space Station</h3>
&nbsp;

on the heels of 紧随xxx之后

unmanned 无人操作的

Once again, SpaceX is picking up the slack. 再一次，SpaceX着手收拾起这个烂摊子。

Nearly 5,300 pounds (2,400 kilograms) of <strong>gear (设备)</strong> is packed for the trip

unpressurized trunk 密封舱

hook up 钩住

crew capsule 载人太空舱

manned flights are still at least two years off. Until then, Americans will continue to <strong>hitch rides to</strong> the space station on Russian rockets for tens of millions of dollars per seat.载人飞行都要至少等到两年以后，在此之前，美国需要继续利用俄罗斯的火箭<strong>“搭便车”</strong>前往空间站，每个席位需要支付数百万美元。

Minutes after Sunday's liftoff, in a test on its own dime, SpaceX will make another attempt to vertically land a Falcon 9's discarded first-stage booster on an ocean platform off the north Florida coast.

周日的发射后不久，SpaceX机经自费进行一次测试，这次测试将试图把猎鹰九号抛下的一级助推火箭垂直着陆在佛罗里达北海岸的海上平台。
<h3>Twitter's M&amp;A team loses second member</h3>
Garg, who led the company's mergers and acquisition team. Grag负责领导该公司的并购团队。

Google Ventures 谷歌风投
---
layout: post
title:  "【COAP】python学习网页自动化" 
categories: Project COAP Python
tags: Project COAP Python
author: LZN
---

* content
{:toc}

download引文信息的citition按钮需要点击，如果不用按键精灵，一切都希望靠python解决，能否办到呢，答案肯定是可以的。参考：http://www.cnblogs.com/fnng/archive/2013/05/29/3106515.html

前期安装非常easy，centos安装了python-installtools，pip官网google一下就可以找到源码包。
---
layout: post
title:  "【Shanbei News Notes】20150628" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h3>Eurozone Refuses Greek Bailout Extension 欧元区拒绝延长对希腊的援助计划</h3>
Greek authorities on Friday unilaterally ended negotiations to extend the financial assistance that's set to expire June 30 and <strong>called for a referendum on the proposed reforms needed to get the loans.</strong> 周五，就即将于6月30日到期的经济援助进行延长一事，希腊当局单方面终止了谈判，并随后号召，<strong>就是否要实行提议的改革计划以此来获得援助贷款一事，举行 一场全民公投。</strong>

Eurogroup members, <strong>minus Greece, （出去希腊之外）</strong> said in a joint statement Saturday

The European Central Bank is set to meet on Sunday <strong>amid fears that</strong> (在……恐慌当中) Greece's banks will be unable to open Monday, while Germany said the eurozone would do "everything" to <strong>protect contagion through the single currency</strong>. （通过单一货币制度阻止债务危机蔓延)

the people must decide free of any blackmail. 注意free of xxx是否定，不接受xxx的意思。人们必须决定不接受任何妥协。blackmail 敲诈，勒索

repay nearly $2 billion<strong> in loans to</strong> the International Monetary Fund 偿还接近20亿美元的债务给国际货币基金组织。

in loans to 欠xxx的债

impose withdrawal limits to keep deposits in the country 政府为了保持国有存款而强迫设定取款限额
<h3><a href="http://www.shanbay.com/read/article/34048/">China's Slowing Economy Poses Challenges <strong>中国经济发展放缓带来挑战</strong></a></h3>
congressional hearing国会听证会

double-digit figures两位数数字

go downhill每况愈下，下坡路，衰退

state-owned enterprises国营企业

signs of stagnation停滞预兆、迹象

economic collapse经济崩溃

stay stuck保持停滞

flow into流入

alienate疏远，离间

stall熄火，停止(虽然翻译很粗暴，但着实很形象)

ferment 发酵→动乱

fade衰退，褪色(impact影响的减弱，生动形象～

recede退回，减弱

eclipse侵蚀，黯然失色
---
layout: post
title:  "" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

stand-up comedian 一个脱口秀节目

bang 有男女ooxx的意思

mastodon 乳齿象

<span class="op_dict3_font24 op_dict3_marginRight">carpet</span> 地毯

paranoid 偏执狂，疑心病

fluff 绒毛 n   变松软 v

ammunition 子弹，弹药

cruel 残酷的

twirly 惊慌 n

dread 害怕 担心 v

stomp 跺脚 v

lasagne 千层面
---
layout: post
title:  "【Shanbei News Notes】20150630" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h3><a href="http://www.shanbay.com/read/article/34129/">Obama Signs 2 Trade Bills Into Law 奥巴马签署两项贸易法案成为法律</a></h3>
Cabinet officials 内阁官员

cabinet一般指橱柜，大写指内阁

members of congress 国会议员

Defending Public Safety Employees' Retirement Act 保护公共安全部门雇员退休权益的法令

Trade Preferences Extension Act 2015贸易优惠延长法案

hard-won bills 艰难通过的、来之不易的法令

bill和act做名词都有<strong>法案</strong>的意思

He <strong>hailed (致敬 v，注意这个意思)</strong> the <strong>bipartisan</strong> cooperation that was needed to get the legislation through Congress. 他向两党为了使得这一立法通过国会的合作致以敬意。

An intense lobbying campaign <strong>pitted</strong> the president <strong>against </strong>(与 xxx 较量、 pit A against B 使A与B对立) congressional Democrats and created a rare alliance with Republicans. 强大的游说运动帮助总统与国会中的民主党人士抗衡，并使得总统与共和党之间建立难得的联盟关系。

competitive edge 竞争优势 （锋利）

lobbying campaign 游说运动

This legislation will help turn global trade, which can often be a race to the bottom, into a race to the top (竞优)

a race to the bottom，竞次，指的是通过剥夺劳动、耗费资源、损坏环境而达到增长的做法

The trade promotion authority legislation, also known as fast track, is expected to speed through completion of Trans-Pacific Partnership negotiations with 11 other Pacific Rim nations in the coming weeks. 贸易促进授权法案，也被称作快速通道法案，预计将在未来数周内加快美国及其他11个环太平洋国家之间的“泛太平洋伙伴关系”的谈判完成速度。

The Senate approved the legislation Wednesday, following the House of Representative's authorization. 继众议院批准之后，参议院于上周三通过了此法案。

Senate 参议院 上议院

the House of Representative 众议院 下议院

&nbsp;
---
layout: post
title:  "【Shanbei News Notes】20150701" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h3><a href="http://www.shanbay.com/read/article/reviews/34171/http://">US Export-Import Bank Expires as Political Fight Continues 美国政治角逐持续，进出口银行面临关门</a></h3>
Default Rate 违约率

houses of Congress 国会两院

Democratic supporters of the bank said they plan to use parliamentary maneuvers to attach the bank’s reauthorization to a piece of unrelated legislation that most members view as vital to their districts. 支持该银行的民主党人表示，他们计划使用国会调遣策略，将银行的再授权事项关联到与之无关的法律的某一部分，而大多数议员都认为该法律对其所在地区很重要。

Ex-Im has been targeted by some of the most conservative Republicans in Congress, who say the agency is “corporate welfare” that allows <strong>bureaucrats</strong> to choose economic “winners and losers” in a process that would be better left to market forces. 美国进出口银行已经成为国会中某些最保守的共和党议员的靶子，他们认为该机构就是让官僚主义者选择“赢家和输家”的“公司福利”，而这一过程最好是交由市场的力量来选择。

the United Arab Emirates 阿拉伯联合酋长国
---
layout: post
title:  "li兼容" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

http://blog.csdn.net/tb12315/article/details/8519862
---
layout: post
title:  "【Shanbei News Notes】20150706" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h3><a href="http://www.shanbay.com/read/article/34345/">With Hours Left, Greek Vote on Austerity Measures Is Tossup 希腊关于经济紧缩的公投结果将于数小时后揭晓</a></h3>
tossup 成败各半

tax hike 税收增加

bailout 纾困， 缓解困难

too close to call 难分伯仲

too costly for both sides 两败俱伤

Gross Domestic Product GDP

lead up to 为……做准备

enslaved by 受……奴役

reflect on 反思

throw stun grenade 投掷闪光雷

clash with 与……起冲突
---
layout: post
title:  "【Shanbei News Notes】20150707" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h3><a href="http://www.shanbay.com/read/article/reviews/34402/">Analysts: Greece Now More Likely to Leave Euro 分析师：希腊目前更可能离开欧元区</a></h3>
deeper austerity and greater cuts in spending <strong>in exchange for</strong> additional loans （通过）更深入的财政紧缩和更大的削减开支以换取额外的贷款

issue ious 发布借据 issue动词作“发布”意， iou=I owe you 借据，欠款

repay loans denominated in the euro currency 以欧元的名目还贷

go bust 破产

resume bargaining 恢复谈判

pressing 紧迫的

Goldman Sachs 高盛集团

egregious mismanagement 过分的管理不善

parlous state 危险的境地

a staunch opponent of debt relief 债务减免的坚决反对者

or be forced to pay a “risk premium” [high interest rate] to get loans 被迫支付一个高的“风险溢价”（高息）以获得贷款

she expects the crisis to cause volatility and sell-offs in European markets and have potentially serious long-term political implications for Europe 她预计这场危机将导致欧洲市场的波动和抛售，并有可能造成潜在的长期政治影响。

reaction in the bond market has been "muted" so far 债券市场的反应一直是“静音状态”

&nbsp;
---
layout: post
title:  "【Shanbei News Notes】20150708" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h2 class="head-title"><a href="http://www.shanbay.com/read/article/34414/">Lawyers: Cosby's Drugs-Sex Admission Could Aid Women's Cases 律师称：考斯比承认使用安眠酮，或有助于性侵指控</a></h2>
civil case 民事诉讼

criminal charge field 刑事指控领域

admission 承认

bolster: to give support to sth

file in 编入
<h3><a href="http://www.shanbay.com/read/article/34441/">Carnival Aims to Launch Miami-Cuba Cruises in May 2016 嘉年华集团获得美国政府批准于2016年五月开通迈阿密-古巴邮轮航线</a></h3>
a handful of 少量

charter fight 包机
---
layout: post
title:  "【Coursera】Data Scientist's Toolbox" 
categories: Notebook Coursera
tags: Notebook Coursera
author: LZN
---

* content
{:toc}

<table>
<tbody>
<tr>
<td><strong>Material</strong><strong>W1-L1</strong>core: how to use data to solve questionsdata deluge 数据泛滥 Big data统计学是毕业生职场的敲门砖We are lucky: explosive data growing利用数据设计算法、分析预报获得结论的比赛 projectWhy R

1. various packages

2. free

3.

<strong>Stack Overflow</strong>

mining the web

处理技巧-数学和统计知识-专业知识

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/07/QQ图片20150713150848.jpg"><img class="alignnone  wp-image-613" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/07/QQ图片20150713150848.jpg" alt="QQ图片20150713150848" width="267" height="262" /></a>

<strong>W1-L2
</strong>

利用R的IDE RStudio

R script xxx.R

# 注释符号

Rmd R markdown document

portfolio github仓库

<strong>W1-L3</strong>

use message board

Often the fastest answer is the one you find yourself

R帮助

？function_name

help.search("rnorm")

args("rnorm")

--&gt; fuction (n, mean = 0, sd =1)

NULL

直接输入函数名称，可以得到函数的解释

提问的艺术：

Provide the minimum information

good question:

R 2.15.0 lm() function on Mac OS X 10.6.3 seg fault

<strong>W1-L4</strong>

数据的分散性决定了Hacking Skills的重要性

Cross Validated

永远学习，永远勇于接受新事物！

采用Stack overflow搜索关于R的内容时，要采用标签 如[r]，仅用r作为关键词会搜索到很多无用的东西

用google的时候：

"[data type] data analysis"

"[data type] R package" (better)

<strong>W1-L5</strong>

subsetting data 抽取数据

readlines function

lapply 很有趣的函数，对一个列表中的所有元素采用某一个函数去执行

<strong>W1-L6</strong>

clustering 聚类分析

<strong>W1-L7</strong>

数据科学家最基本的素质：reproducible research

需要用到LaTex

<strong>W1-L8</strong>

likelihoods 似然估计

common distribution 常用概率分布

confidence interval 置信区间

hypothesis test 假设检验

bootstrapping 自助法 * 自抽样？

power 统计功效

<strong>W1-L9</strong>

回归分析的调整分析 adjusting analysis

<strong>W1-L10</strong>

boosting

bagging

<strong>W1-L11</strong>

Shiny 交互式R共享

<strong>W1-L12</strong>

Windows下安装R

<strong>www.Rseek.org</strong>

<strong>W2-L2</strong>

Command Line Interface:

<strong>command flags arguments</strong>

cp -r ./ ../test

<strong>W2-L3</strong>

Introduction to Git

$git config --list

$git config --global user.name ""

$git config --global user.email ""

&nbsp;

<strong>W2-L7</strong>

markdown

readme<strong>.md</strong>

##hello   (## means secondary heading)

* hello

* world (unordered list)

<strong>W2-L8</strong>

R packages

install.packages("slidify")

library("xxx")    #load the function

W3-L4

http://figshare.com

&nbsp;</td>
<td><strong>Point</strong></td>
</tr>
<tr>
<td colspan="2"> <strong> Measure</strong></td>
</tr>
</tbody>
</table>
&nbsp;
---
layout: post
title:  "【Shanbei News Notes】20150713" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h3><a href="http://www.shanbay.com/read/article/34603/">Taiwan courts tech start-ups to drive economic growth 台湾吸引科技创业公司以期获得经济增长</a></h3>
home-grown 本土的

e-commerce 电子商务

Qualcomm 高通

reduce export-driven economy's reliance 降低对出口导向型经济的依赖性

hold the key to 对...起决定性作用

lose out to 输给

in a bid to 为了
<h3><a href="http://www.shanbay.com/read/article/34579/"> Eurozone Discusses Latest Greek Bailout Proposals 欧元区讨论最新的希腊紧急财政援助计划</a></h3>
ahead of = before
on substance 在实质问题上

hard line 强硬路线

hang back 由于

conciliatory tone 和解的语调

satisfy their demand 满足他们的要求

&nbsp;
---
layout: post
title:  "修改vim注释颜色以及ls目录颜色" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

vim下的注释和ls出来的目录字体颜色都是深蓝色的，在终端黑色背景下看起来非常累，修改这个颜色也很简单。

vim注释颜色修改：
<pre>$vi ~/.vimrc
hi Comment ctermfg=6;
:wq</pre>
这样就可以把注释改成青色的了。

ls出来的目录颜色修改，黄色
<pre>$vi ~/.bashrc
LS_COLORS=$LS_COLORS:'di=0;33:'; 
export LS_COLORS
:wq</pre>
---
layout: post
title:  "【R】Installing R on Windows" 
categories: Windows Software R
tags: Windows Software R
author: LZN
---

* content
{:toc}

<h3>R</h3>
Download from http://cran.r-project.org/

Choose the "Basic"

Wait the download 10+ min, and click, click, click... Done
<h3>RStudio</h3>
Download from https://www.rstudio.com/products/rstudio/download/

choose the PC version and for OS Windows

Download (a few minutes) and install, easy!

&nbsp;

&nbsp;
---
layout: post
title:  "【已解决】CESM Tibetan Plateau无PBL加热试验" 
categories: CESM Fortran
tags: CESM Fortran
author: LZN
---

* content
{:toc}

wzq师兄希望做一个没有青藏高原PBL加热的试验，因为有之前改deep convection的经验，这个应该不复杂。

wzq tends to test an experiment without sensible heating from the TP. As I've got the experience from deep convection heating experiments,  this shouldn't be very complex.

首先希望能用model自身读入netcdf格式的TP mask文件。grep到了 control目录下的cam_initfiles.F90文件，其中是读init数据和topo数据的，果断就follow格式加入如下语句：

First, we hope to get var from the netcdf file directly via the packeged method in the model. Using command 'grep', we located a source file called cam_initfiles.F90, which was programmed to read init data and topo data. Thus, we follow the style of this file to add the changes as follows:
<pre>20d19
&lt; tpmask_file_get_id, &amp;! returns filehandle for tp mask file
23c22
&lt; type(file_desc_t), pointer :: fh_ini, fh_topo, fh_tpmask
---
&gt; type(file_desc_t), pointer :: fh_ini, fh_topo
39,42d37
&lt; function tpmask_file_get_id()
&lt; type(file_desc_t), pointer :: tpmask_file_get_id
&lt; tpmask_file_get_id =&gt; fh_tpmask
&lt; end function tpmask_file_get_id
59,61d53
&lt; character(len=256) :: bnd_tpmask_loc ! filepath of topo file on local disk
&lt;
&lt; bnd_tpmask_loc = "/users/yangsong3/wzq/TP_noPBL_HEAT/data/TPmask.nc"
72c64
&lt; call getfil(bnd_topo, bnd_topo_loc) !getfil is check process
---
&gt; call getfil(bnd_topo, bnd_topo_loc)
78,82d69
&lt;
&lt; ! 20150721 Add for TP mask
&lt; allocate(fh_tpmask)
&lt; call cam_pio_openfile(fh_tpmask, bnd_tpmask_loc, PIO_NOWRITE)
&lt;
106,110d92
&lt;
&lt;
&lt; call pio_closefile(fh_tpmask)
&lt; deallocate(fh_tpmask)
&lt; nullify(fh_tpmask)</pre>
TPmask数据放到了case的新建data目录下，编译，成功！已经把文件打开了，然后去找读入topo文件的代码！<code></code>

We then put the TPmask.nc to a new foolder "data" in the case directory, and compile the model. Successed! We now go back to the code in cam_initfiles.F90 and find that there is no read data keyword for topo. However, a "readinitial" keyword operated to the initial data found in the file.

grep the keyword with "readinitial", we found a file called readinitial.F90. Check it! To our disappointment, it is only for the validation check. Next, we change another keyword "topo" to grep, we found <strong>startup_initialconds.F90</strong>, in this file, we then locate a sentence
<pre> call read_inidat(fh_ini, fh_topo, dyn_in)</pre>
Very interesting! we believe this could be the true method to read data from the topo file. Another grep!

In fact, we found keyword "dycore" appeared in a number of files. Then we locate $SRC/dynamic/fv, then we grep <strong>inidat.F90. </strong>In this file, we finally found how the model deal with the topo field
<pre>    fieldname = 'PHIS'
    readvar   = .false.
    if (ideal_phys .or. aqua_planet) then
       dyn_in%phis(:,:) = D0_0
    else
       allocate(phis_tmp(im, jm))
       <strong>call infld(fieldname, ncid_topo, 'lon', 'lat', ifirstxy, ilastxy, jfirstxy, jlastxy, &amp;</strong>
<strong>            dyn_in%phis, readvar, grid_map='dyn')</strong>
       if (.not. readvar) &amp;
            call endrun(trim(subname)//' ERROR: PHIS not found on topo dataset.')
      <strong> call process_inidat(ncid_ini, ncid_topo, grid, dyn_in, 'PHIS')</strong>
    end if</pre>
Apparently, infld is a method that read a field from a specific file. grep "infld" and locate the file ./control/<strong>ncdio_cam.F90 </strong>to refer the usage. Since "infld" is a common usage in many source files, we try to search it in the main interface of the physics package <strong>physpkg.F90, </strong>bingo! We got it in subroutine phys_initdat(). We are familiar with this source file because we have changed the deep convection in this file. Phys_initdata() is a subroutine that only be called during the startup run. Therefore, we add a infld in <strong>phy_init()</strong>, which would be called during every run type.

Be careful with the "use module_name" statement, never leave a wild variable. Then we need to add another field to the surface field. Definition code is in <strong>comsrf.F90</strong>
<pre>&lt;   public landm, sgh, tpmask, sgh30, fv, ram1, soilw, fsns, fsds
---
&gt;   public landm, sgh, sgh30, fv, ram1, soilw, fsns, fsds
43d42
&lt;   real(r8), allocatable:: tpmask(:,:)    ! Tibetan Platau Mask flag
105d103
&lt;        allocate (tpmask  (pcols,begchunk:endchunk))
128d125
&lt;        tpmask   (:,:) = nan</pre>
Try to build it again. Successful! Now we have read the TP mask in.

<strong>#Up to 20150722#</strong>

The final code has been uploaded to my <a href="https://github.com/Novarizark/project/tree/master/TP_HEAT_wzq-2015/SourceMods/src.cam">github</a>. So, no more update here.

<strong>#Up to 20150924#</strong>
---
layout: post
title:  "【已解决】Firefox打开拼写检查" 
categories: Internet Software
tags: Internet Software
author: LZN
---

* content
{:toc}

firefox工具--&gt;选项--&gt;高级中的拼写检查默认是打开的，但是似乎没有作用。查了一下，原来是没有字典。在文本框右键点击添加字典，即可。但是富文本框似乎不能检查。
---
layout: post
title:  "" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

birrthday test

&nbsp;

PHP alllo
---
layout: post
title:  "【solved, R】problems during installing devtools" 
categories: Windows Software R
tags: Windows Software R
author: LZN
---

* content
{:toc}

Finished installing R and Rstudio, we come to the installation of Rtools. (Please check the <a href="https://class.coursera.org/datascitoolbox-031/lecture/55">tutorial vedio</a> in coursera) It seems all went fine before installing devtools. However, typing
<pre>&gt;install.packages("devtools")</pre>
really took a long time to download a series of packages. When finished, a pop-up info indicated an error: <strong>"https://class.coursera.org/datascitoolbox-031/lecture/55"</strong>

google it, and we found this would work:
<pre>Sys.setlocale('LC_ALL','C')</pre>

Reasons are complex, here post the reference:
http://cos.name/cn/topic/157794/
---
layout: post
title:  "【Shanbei News Notes】20150819" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h2 class="head-title"><a href="http://www.shanbay.com/read/article/35983/">New US Rules Promise Deep Cuts in Methane Emissions 最新的美国法规承诺大幅减少甲烷排放</a></h2>
fracking wells 水力压裂井

volatile organic compounds VOC
<h2 class="head-title"><a href="http://www.shanbay.com/read/article/35971/">Hackers dump data from cheating website Ashley Madison online: reports 黑客从偷腥网站AsheleyMadison导出数据</a></h2>
cheating spouses webstie 已婚人士偷情网站

follow through on 完成

sprout up 涌现

&nbsp;
---
layout: post
title:  "【Underway】Teamserver huge .xsession-errors file" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

Yesterday, I have found that the
---
layout: post
title:  "【git&github】the first move on git push" 
categories: Git&amp;GitHub
tags: Git&amp;GitHub
author: LZN
---

* content
{:toc}

Finally we come to the deadline of data science course project on coursera. In fact, most of the questions are very easy to answer or cope with, except one aiming at try the git push. I got some problems when test this:

As the question requests, I created a file named "HelloWorld.md" and write something in it. When I type the command
<pre>&gt;git push</pre>
Waiting for about 1 min, an error occors:

<strong>error:src refspec master does not match any</strong>

Then I found this was because no file in the dir yet. The solution is as follow:
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter"></td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="shell functions">touch</code> <code class="shell plain">README</code></div>
<div class="line number2 index1 alt1"><code class="shell plain">git add README </code></div>
<div class="line number3 index2 alt2"><code class="shell plain">git commit -m </code><code class="shell string">'first commit'</code></div>
<div class="line number4 index3 alt1"><code class="shell plain">git push origin master</code></div>
</div></td>
</tr>
</tbody>
</table>
Of course, we don't need README, then I trid git add, commit and push commands, it works!

Through, I am not really understand the exact reason.

Referrence:

http://www.open-open.com/lib/view/open1366080269265.html#_label0
---
layout: post
title:  "【Shanbei News Notes】20150822" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h2 class="head-title"><a href="http://www.shanbay.com/read/article/36112/">China Worries Push Down Global Stocks 中国担忧推低全球股市</a></h2>
brokerage 证券公司

faltering growth经济增长下行

on edge 急切不安的

stock market 股票市场

devaluation 货币贬值

&nbsp;
---
layout: post
title:  "【Shanbei News Notes】20150823" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h2 class="head-title"><a href="http://www.shanbay.com/read/article/36136/">Banned From Protest, Kazakhstanis Joke, Grumble Over Currency's Fall</a></h2>
哈萨克斯坦货币贬值备受抱怨，但是不允许反对示威

<span id="A36136P254142S224232" class="sentence">Kazakhstan <strong><span class="unlearned active">weathered</span></strong> a 19-percent devaluation of the tenge in February last year 经受住
</span>

&nbsp;
---
layout: post
title:  "【Shanbei News Notes】20150826" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<span id="A36247P260670S229194" class="sentence"> and certainly I’m asking is how, just how this gets <strong>stemmed</strong></span>

stem是茎的意思，也有“起源于”的意思
---
layout: post
title:  "【solved】Teamserver huge .xsession-error problem" 
categories: Linux Software
tags: Linux Software
author: LZN
---

* content
{:toc}

A few days ago I have found that the available disk space on Teamserver was shrunk to 60%. This is very weird because most datasets on the machine were uploaded by me and I know they only occupy about 30% in 22TB. Once I thought they might come from one of my teammate, uploading CMIP5 data or something. However, when I checked individual directory in home, I found nothing. Then I checked “ll -ah” in home. Holly shit! One file named “.xsession-error” takes up about 6TB, and still enlarging! So I google it and found it might be a bug of Linux, regardless of the distribution. Many people delete it or use file permission to restrict its expansion, without any source seeking. I followed them, while nothing happened to the available size from df command. I used DirStat and the original software to check this, nothing.
What the fuck! I just let it alone and do my staff until I found there is only 2TB available today. Another similar file named as “.xsession-error.XXXXX” did the evil things. In fact this file was a text file, thus I “tail” it and found the flowing statement:
<pre>sslvpn_read_packet: SSL_read failed!
Error while reading SSL packet
keep alive recv failed!
TCP_KEEP_ALIVE_SOCK_ENVENT
sslvpn_read_packet: SSL_read failed!
Error while reading SSL packet
keep alive recv failed!
TCP_KEEP_ALIVE_SOCK_ENVENT
sslvpn_read_packet: SSL_read failed!</pre>
VPN! So it must be the vpn soft which aimed at connecting TH-2 that wrongly redirect the std out flow to this poor file and made the shit. Without any hesitate, I uninstall the VPN soft. Everything's back to normal.
---
layout: post
title:  "【solved, git&github】first move to push my project" 
categories: Internet Git&amp;GitHub
tags: Internet Git&amp;GitHub
author: LZN
---

* content
{:toc}

Try to push paperhub project on Lab server to github. The following are steps and barriers when I did this.

1. create a new repo on github, same name as "paperhub"

2. Try one file down_enw.php
<pre><strong>$git init</strong> # to regard paperhub dir as a git repo
<strong>$git add down_enw.php
$git commit -m "first commit"
$git push origin master</strong></pre>
Get error:
<pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git push origin master
error: The requested URL returned error: <span class="m">403</span> Forbidden <span class="k">while</span> accessing https://github.com/Novarizark/paperhub.git

fatal: HTTP request failed</code></pre>
Follow this:

<a href="http://jim-y.me/linux/2015/04/01/setting-up-git-for-error-403-forbidden/">http://jim-y.me/linux/2015/04/01/setting-up-git-for-error-403-forbidden/</a>
<a href="http://stackoverflow.com/questions/7438313/pushing-to-git-returning-error-code-403-fatal-http-request-failed"> http://stackoverflow.com/questions/7438313/pushing-to-git-returning-error-code-403-fatal-http-request-failed</a>

Change:
<pre>$vi .git/config
url = https://<strong>Novarizark@</strong>github.com/Novarizark/paperhub.git
:wq</pre>
Another error:
<pre><code>(gnome-ssh-askpass:29241): Gtk-WARNING **: cannot open display:</code></pre>
Follow this:
<a href="http://stackoverflow.com/questions/16077971/git-push-produces-gtk-warning#">http://stackoverflow.com/questions/16077971/git-push-produces-gtk-warning#</a>
<pre><code>unset SSH_ASKPASS</code></pre>

Done!
---
layout: post
title:  "【Coursera】R Language" 
categories: Notebook Coursera R
tags: Notebook Coursera R
author: LZN
---

* content
{:toc}

&nbsp;
<table>
<tbody>
<tr>
<td>
<h3><strong>Background Material</strong></h3>
<h4><strong>L4</strong></h4>
get the current working directory

<strong>&gt;getwd()  #same in MAC
</strong>

read the csv (comma-seperated values) file

<strong>&gt;read.csv("xx.csv")</strong>

list the file and directory under the current directory

<strong>&gt;dir()</strong>

change the working directory

<strong>&gt;setwd("F:/workspace/")</strong>

To list out all the functions in one script

<strong>&gt;ls()</strong>
<h3>Week1</h3>
<h4>L4</h4>
assignment

<strong>&gt;x &lt;- 5</strong>

comments

<strong># hi, this is a comment</strong>
<h4>L5</h4>
5 basic "atomic" classes
<ul>
	<li>character</li>
	<li>numeric (real numbers)</li>
	<li>integer</li>
	<li>complex</li>
	<li>logical (True/False)</li>
</ul>
basic object: vector

<strong>vector function: vector(type_of, length_of)</strong>

basically, R think all number as real type, if you want a integer 1, type:

<strong>1L</strong>

Infinity:

<strong>Inf</strong>

not a number:

0/0=NAN (or as missing value)

R objects can have attributes:
<ul>
	<li>names, dimnames</li>
	<li>dimensions</li>
	<li>class (numeric)</li>
	<li>length</li>
</ul>
function to modify attributes

<strong>attributes()</strong>
<h3>L6</h3>
c() function is to create a vector:

<strong>x &lt;- c(0.5,0.6)</strong>

<strong>x &lt;- c(True, Flase)</strong>

vector() function acts alike, with initial value 0 for numeric.

<strong>x &lt;- vector("numeric", length = 10)</strong>

mixed classes

<strong>x&lt;- c(True, 3) # will be numeric</strong>

Explicit Coercion

<strong>&gt; x&lt;-0:2</strong>

<strong>&gt; class(x)</strong>

<strong>[1] "integer"</strong>

<strong>&gt; as.logical(x)</strong>

<strong>[1] FALSE TRUE TRUE</strong>

we use list() to create list.

<strong>&gt;y&lt;-list("a", 1, TRUE)</strong>
<h3>L7</h3>
create matrix

<strong>&gt;m&lt;-matrix(nrows=2, ncols=3)</strong>

<strong>&gt;attributes(m)</strong>

$dim

[1] 2 3

matrix is <strong>column wise</strong>

change vector to matrix

&gt;m&lt;-1:10

<strong>&gt;dim(m)&lt;-c(2,5)</strong>

&nbsp;

or use cbind or rbind

&gt;x&lt;-1:3

&gt;y&lt;-10:12

&gt;cbind(x,y)

1 10

2 11

2 12

&gt;rbind(x,y)

similar but in row
<h3>L8</h3>
factors are ordered or unordered, like key for the php array, factors could be treated as numeric vector with labels

give an example

&gt;x&lt;-factor(c("yes","yes","no"))

&gt;x

[1] yes yes no

Levels: no yes

&gt;table(x)

yes no

2     1

&gt;unclass(x)

221

that is how factor x expressed in R underneath!

The first level is called the baseline level, it is determined by the alphabet rank, however, you could change the order.

<strong>&gt;x&lt;-factor(c("yes","yes","no"),levels=c("yes","no"))</strong>

and yes will be in the first place.
<h3>L9-Missing Values</h3>
is.na()

is.nan()

NaN value all be treated as NA, but the converse is not true.
<h3>L10-Data Frames</h3>
tabular 表格的

data frames ~ matrices

list ~ vector

Yes, that the class doesn't matter in data frames.

Special attributes: <strong>row.names</strong>

created by

<strong>read.table() or read.csv()</strong>

convert to matrix

<strong>data.matrix()</strong>

an example:

<strong>&gt;x&lt;- data.frame(foo=1:4, bar = c(T,T,F,F))</strong>

<strong>&gt;x</strong>

<strong>   foo    bar</strong>

<strong>1    1    TRUE</strong>

<strong>2    2    TRUE</strong>

<strong>3    3    FALSE</strong>

<strong>4    4    FALSE</strong>
<h3>L10-Names Attribute</h3>
<strong>&gt;x &gt;- 1:3</strong>

<strong>&gt; names(x) &lt;- c("foo","bar","norf")</strong>

<strong>&gt;x</strong>

<strong>foo bar norf</strong>

<strong>   1     2     3</strong>
<h3>L12-Reading Tabular Data</h3>
<ul>
	<li><strong>read.table, read.csv</strong></li>
	<li><strong>readLines</strong></li>
	<li><strong>source</strong>, for reading in R code files (inverse of dump)</li>
	<li> <strong>dget</strong>, same as above, but for dparsed code (inverse of dput)</li>
	<li><strong>load, </strong>for reading in saved workspaces</li>
	<li><strong>unserialize, </strong>for reading single R objects in binary form</li>
</ul>
write
<ul>
	<li>write.table</li>
	<li>writeLines</li>
	<li>dump</li>
	<li>dput</li>
	<li>save</li>
	<li>serialize</li>
</ul>
<h4><strong> read.table</strong></h4>
<ul>
	<li>file, the name of a file, or a connection</li>
	<li>header, logical indicating if the file has a header line</li>
	<li>sep, a string indicating how the columns are separated</li>
	<li>colClasses, a character vector indicating the class of each column in the dataset</li>
	<li>nrows, the number of rows in the dataset</li>
	<li>comment.char, a character string indicating the comment character</li>
	<li>skip, the number of lines to skip from the beginning</li>
	<li>stringsAsFactors, should character variables be coded as factors?</li>
</ul>
no argument is fine, and the result would be in a data frame.

read.table default separator is space.

<strong>be sure to read the document of read.table</strong>
<h3>L12-Reading Large Tables</h3>
set the arguments!

all numeric, one is fine:

colClasses = "numeric"
<h3>L13-Textual Data Format</h3>
<h3>L17-Subsetting-Basics</h3>
&gt;x &lt;- c("a","b","c")

&gt;x[1]

[1]  "a"

&gt; x[1:3]

&gt;x[x&gt;"a"]

&gt;u &lt;- x&gt;"a"

&gt;u

[1] FALSE TRUE TRUE
<h3>L17-Subsetting-Lists</h3>
&gt;x &lt;- list (foo =1:4, bar =0.6)

&gt;x[1]

$foo

[1] 1 2 3 4

<strong>we got a list!</strong>

&gt;x[[1]]

[1]  1 2 3 4

<strong>we got a sequence!</strong>

&gt;x$bar

[1]  0.6

&gt;x[["bar"]] #this is equal

&gt;x["bar"]  # we got a list

&gt;x[c(1, 3)]

&nbsp;

&gt;name = "foo"

&gt;x[[name]]

this is useful
<h3>L17-Subsetting-Matrices</h3>
&gt;x[1, ]    # missing is fine

No dropping forcing:

&gt;x[1, 2, drop =FALSE]
<h3>L18-partial matching</h3>
&gt;x&lt;-list(aardvark=1:5)

&gt;x$a

[1] 1 2 3 4 5

&gt;x[["a"]]

NULL

&gt;x[["a", exact = FALSE]]

[1] 1 2 3 4 5
<h3>L19-Removing NA Values</h3>
&gt;x &lt;- c(1, 2, NA, 4, NA, 5)

&gt;bad &lt;- is.na(x)

&gt;x[!bad]

&nbsp;

&gt;good&lt;-complete.cases(x, y)
<h3>L20-Vectorized Operations</h3>
matrix

x*y #by rank

x%*%y # by true matrix multiplication
<h3>Week1</h3>
<h4>L2 if-else</h4>
if(x&gt;3) {

y&lt;-10

}else{

y&lt;-0

}

<strong>also true:</strong>

y&lt;- if(x&gt;3) {

10

}else{

0

}
<h4>L2 For loops</h4>
for (i in 1:10){

}

&nbsp;

x &lt;- c("a","b","c","d")

for (i in seq_along(x)){

print(x[i])

}

for (letter in x){

print(letter)

}
<h4>L4 Functions</h4>
set default value:

abc = function(a = 10){

}

columnmean &lt;- function(y, removeNA = TRUE){

nc &lt;- ncol(y)

means &lt;- numeric(nc)

for(i in 1:nc) {

mean[i] &lt;- mean(y[,i], na.rm = removeNA)

}

}
<h4>L6 Functions</h4>
... argument indicate a variable number of arguments that are usually passed on to other funcitons.

myplot &lt;- function(x, y, type = "l", ...) {

plot (x, y, type = type, ...)

}

explicityly matching after dot dot dot
<h4>L7 Functions could be made dynamically!</h4>
<strong> lexical vs. dynamical scoping</strong>

make.power &lt;- function(n) {

pow &lt;- function(x) {

x^n

}

pow

}

&nbsp;

&gt;cube &lt;- make.power(3) # note cube is a function

&gt; cube(3)

[1] 27

&nbsp;

ls(environment(cube))
<h4>L8 code style</h4>
indenting 缩进
<h4>L10 Date and times</h4>
x &lt;- as.Date("1970-01-01")

x &lt;- Sys.time()</td>
<td>
<h3><strong>Point</strong></h3>
&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

here, we can see the sytle is very like windows/dos

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

cute assignment sign

&nbsp;

same comment sign as bash

&nbsp;

&nbsp;

&nbsp;

complex! Like fortran

&nbsp;

&nbsp;

interesting...

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

Attributes! Like NCL!

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

be careful with c(), not like other language

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

in fact, I think this is really convenient

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

merge vectors to matrix, this is really user-friendly!

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

Impressive! like PHP array, but much easier to understand

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

Like NCL or MATLAB

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

See it? Plenty of data types, very user-friendly. You could imagine how simple when use data frames to process EXCEL type files.

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

Briliant!!!

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;

Very like $$ in ncl

&nbsp;

&nbsp;

Dim down or not, it is a problem</td>
</tr>
<tr>
<td colspan="2"> <strong> Measure</strong></td>
</tr>
</tbody>
</table>
&nbsp;
---
layout: post
title:  "【solved, git&github】URL problem" 
categories: Git&amp;GitHub
tags: Git&amp;GitHub
author: LZN
---

* content
{:toc}

When I pushed all ncl file in project to github, I got this error:
<pre>[yangsong3@localhost project]$ git push -u origin master
Password:
To https://Novarizark@github.com/Novarizark/project.git<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>
 ! [rejected] master -&gt; master (non-fast-forward)
error: failed to push some refs to 'https://Novarizark@github.com/Novarizark/pro ject.git'
To prevent you from losing history, non-fast-forward updates were rejected
Merge the remote changes before pushing again. See the 'Note about
fast-forwards' section of 'git push --help' for details.</pre>
Google it, found the solution on Stackoverflow
<pre>You need to add the origin remote:

    Delete the current one

    git remote rm origin

    Add the git remote link ex: (https://user@bitbucket.org/test.git or https://github.com/user/test.git)

    git remote add origin link

    git pull origin master (or other branch)</pre>
It is the Username@github made the bad result. So there should be other ways to solve the 403 or ssh error.
---
layout: post
title:  "【Shanbei News Notes】20150915" 
categories: English ShanbeiNews
tags: English ShanbeiNews
author: LZN
---

* content
{:toc}

<h2 class="head-title"><a href="http://www.shanbay.com/read/article/37042/">Trillenium takes virtual reality into online shopping Trillenium为网购带来虚拟现实体验</a></h2>
<span id="A37042P86103S71040" class="sentence">"The current dot.com experience is pretty <span class="learning-all"><strong>sterile</strong>. 此处有“枯燥无味的”意思
</span></span>

venture capical 风险投资（VC）

&nbsp;
---
layout: post
title:  "【vim, 已解决】使用vim批量插入/删除 行首行尾" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

设想这样一个应用情景，需要下载一批文件，不想写循环或者文件名分散或随机的情况，拿到了枚举list，可以下了吧。当然，我们还需要wget 以及重命名等任务。也就是说，我们需要在每一行前面或者后面加上关键词，比如wget空格，或者其他什么的

vim可以很好解决这个问题，两个语句：

<strong>行首加入 :%s/^/Hello, this is your word/</strong>

<strong>行尾加入 :%s/$/Bye, this is your word/</strong>

CTRL+V 可以很好解决局部问题

或者

<strong>2-50行加入 :2,50 s/^/#/g</strong>
---
layout: post
title:  "【Shanbei News Notes】20150915" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

<h2 class="head-title"><a href="http://www.shanbay.com/read/article/37138/">China’s Economic Challenges Persist中国继续面临经济挑战</a></h2>
equity n. 产权，股票； 公正

shift away 移走

box office 票房
<h2 class="head-title"><a href="http://www.shanbay.com/read/article/37141/">Uncertainty About Possible US Interest Rate Hike Grows美国利率攀升的不确定性持续增长</a></h2>
The U.S. Federal Reserve 美联储

&nbsp;
---
layout: post
title:  "【已解决】NCL脚本的参数传递" 
categories: Linux NCL
tags: Linux NCL
author: LZN
---

* content
{:toc}

When used in conjunction with an NCL script, command line arguments can set a variable's value, help determine initial conditions, and so forth:
<pre>% cat modelRun.ncl
begin
  [...]

  if (.not. isvar("nyrStrt")) then      ; is nyrStrt on command line?
      nyrSrt = 1960
  end if

  if (.not. isvar("nyrLast")) then      ; is nyrLast on command line?
      nyrLast = 2002;
  end if

  print(nyrStrt)                        ; for illustrative purposes
  print(nyrLast)

  [...]
end
</pre>
(Variables nyrStrt and nyrLast are set on the command line)
<pre>% ncl nyrStrt=1900 nyrLast=1968 modelRun.ncl

Variable: nyrStrt
Type: integer
Total Size: 4 bytes
            1 values
Number of Dimensions: 1
Dimensions and sizes:   [1]
Coordinates: 
(0)     1900


Variable: nyrStrt
Type: integer
Total Size: 4 bytes
            1 values
Number of Dimensions: 1
Dimensions and sizes:   [1]
Coordinates: 
(0)     1968

</pre>
Consider the following
<pre>ncl nyrStrt=1930 'fName="Model*"' gravity=9.8 opt=True cyclic=False latS=-30 latN=30 lonL=130 lonR=290 modelRun.ncl
</pre>
When the number of CLOs is large, it might be clearer to enter only one or two per line. The Unix line continuation character, <b>\</b>, can be used to accomplish this:
<pre> ncl nyrStrt=1930      <b>\</b> 
     'fName="Model*"'  <b>\</b>
     gravity=9.8       <b>\</b>
     latS=-30 latN=30  <b>\</b>
     lonL=130 lonR=290 <b>\</b>
     modelRun.ncl

</pre>
---
layout: post
title:  "【CESM】B compset CAM5_PM设置" 
categories: CESM ClimateChange
tags: CESM ClimateChange
author: LZN
---

* content
{:toc}

Since we don't care about the chemical process when investigate the physical climate system, we hope to close the prognostic chemistry model in CAM5. For F compset, it is easy because a specific PM compset without active chemistry model has been provided by CESM. For B compset, there is no option like this.

Therefore, we try to capture the differences in FC5PM and FC5. We first see the differences in output flow after create_newcase command.
<pre>6c6
&lt;   2000_CAM5_CLM40%SP_CICE%PRES_DOCN%DOM_RTM_SGLC_SWAV (F_2000_CAM5) (FC5)
---
&gt;   2000_CAM5%PM_CLM40%SP_CICE%PRES_DOCN%DOM_RTM_SGLC_SWAV (F_2000_CAM5_PM) (FC5PM)
8c8
&lt;   CAM: CLM: RTM: CICE: DOCN: SGLC: SWAV: present day: cam5 physics: clm4.0 physics: clm4.0 Satellite phenology: prescribed cice: docn data mode:
---
&gt;   CAM: CLM: RTM: CICE: DOCN: SGLC: SWAV: present day: cam5 physics: CAM prescribed modal aerosols: clm4.0 physics: clm4.0 Satellite phenology: prescribed cice: docn data mode:
23c23
&lt;   CAM_CONFIG_OPTS: -phys cam5
---
&gt;   CAM_CONFIG_OPTS: -phys cam5 -chem none
58,63c58,63
&lt; Creating /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_CHEM
&lt; Created /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_CHEM/env_case.xml
&lt; Created /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_CHEM/env_mach_pes.xml
&lt; Created /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_CHEM/env_build.xml
&lt; Created /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_CHEM/env_run.xml
&lt; Locking file /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_CHEM/env_case.xml
---
&gt; Creating /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_NO_CHEM
&gt; Created /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_NO_CHEM/env_case.xml
&gt; Created /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_NO_CHEM/env_mach_pes.xml
&gt; Created /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_NO_CHEM/env_build.xml
&gt; Created /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_NO_CHEM/env_run.xml
&gt; Locking file /WORK/sysu_hjkx_ys/L_Zealot/cesm/F/CAM5_NO_CHEM/env_case.xml</pre>
Clearly, a PM option has been added to the CAM5 component. We try put this full name to B compset.

Things never get so smooth~
<pre>set_compset: no match for compset 2000_CAM5%PM_CLM40%SP_CICE_POP2_RTM_SGLC_SWAV
            to see supported compsets issue</pre>
It seems that we have to change it in the specific configuration file.

We then try to seek the differences in xml files. In <strong>env_build.xml,  </strong>we found an interesting differences:
<pre>40c40
&lt; &lt;entry id="EXEROOT" value="/HOME/sysu_hjkx_ys/WORKSPACE/L_Zealot/cesm/F/F2000_F09_CAM5_CTRL/bld" /&gt;
---
&gt; &lt;entry id="EXEROOT" value="/HOME/sysu_hjkx_ys/WORKSPACE/L_Zealot/cesm/F/F2000_F09_CAM5PM_CTRL/bld" /&gt;
72c72
&lt; &lt;entry id="CAM_CONFIG_OPTS" value="-phys cam5" /&gt;
---
&gt; &lt;entry id="CAM_CONFIG_OPTS" value="-phys cam5 -chem none" /&gt;</pre>
That is fine. We then add argument "<strong><span style="color: #ff0000;"><em>-chem none</em></span></strong>" to the env_build.xml in B2000CAM5 case, setup and build, smoothly!

Now we come to the atm_in differences between FC5 and FC5PM
<pre>1,3c1,8
&lt; &amp;aerosol_nl
&lt; dust_emis_fact = 0.35D0
&lt; soil_erod = '/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/dst/dst_0.9x1.25_c100121.nc'
---
&gt; &amp;aerodep_flx_nl
&gt; aerodep_flx_cycle_yr = 2000
&gt; aerodep_flx_datapath = '/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mam/aero'
&gt; aerodep_flx_file = 'mam3_1.9x2.5_L30_2000clim_c130319.nc'
&gt; aerodep_flx_specifier = 'bc_a1DDF', 'bc_c1DDF', 'pom_a1DDF', 'pom_c1DDF', 'soa_a1DDF', 'soa_c1DDF', 'soa_a2DDF', 'soa_c2DDF',
&gt; 'dst_a1DDF', 'dst_c1DDF', 'dst_a3DDF', 'dst_c3DDF', 'bc_a1SFWET', 'bc_c1SFWET', 'pom_a1SFWET', 'pom_c1SFWET',
&gt; 'soa_a1SFWET', 'soa_c1SFWET', 'dst_a1SFWET', 'dst_c1SFWET', 'dst_a3SFWET', 'dst_c3SFWET'
&gt; aerodep_flx_type = 'CYCLICAL'
10d14
&lt; print_energy_errors = .false.
16,34d19
&lt; aer_drydep_list = 'bc_a1', 'dst_a1', 'dst_a3', 'ncl_a1', 'ncl_a2', 'ncl_a3', 'num_a1', 'num_a2', 'num_a3', 'pom_a1', 'so4_a1',
&lt; 'so4_a2', 'so4_a3', 'soa_a1', 'soa_a2'
&lt; aer_wetdep_list = 'bc_a1', 'dst_a1', 'dst_a3', 'ncl_a1', 'ncl_a2', 'ncl_a3', 'num_a1', 'num_a2', 'num_a3', 'pom_a1', 'so4_a1',
&lt; 'so4_a2', 'so4_a3', 'soa_a1', 'soa_a2'
&lt; clim_soilw_file = '/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart/dvel/clim_soilw.nc'
&lt; depvel_file = '/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart/dvel/depvel_monthly.nc'
&lt; depvel_lnd_file = '/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart/dvel/regrid_vegetation.nc'
&lt; exo_coldens_file = '/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart/phot/exo_coldens.nc'
&lt; ext_frc_specifier = 'SO2 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so2_elev_2000_c090726.nc',
&lt; 'bc_a1 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_bc_elev_2000_c090726.nc',
&lt; 'num_a1 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_num_a1_elev_2000_c090726.nc',
&lt; 'num_a2 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_num_a2_elev_2000_c090726.nc',
&lt; 'pom_a1 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_oc_elev_2000_c090726.nc',
&lt; 'so4_a1 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so4_a1_elev_2000_c090726.nc',
&lt; 'so4_a2 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so4_a2_elev_2000_c090726.nc'
&lt; ext_frc_type = 'CYCLICAL'
&lt; fstrat_list = ' '
&lt; rsf_file = '/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/waccm/phot/RSF_GT200nm_v3.0_c080416.nc'
&lt; season_wes_file = '/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart/dvel/season_wes.nc'
36,54d20
&lt; srf_emis_specifier = 'DMS -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/aerocom_mam3_dms_surf_2000_c090129.nc',
&lt; 'SO2 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so2_surf_2000_c090726.nc',
&lt; 'SOAG -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_soag_1.5_surf_2000_c100217.nc',
&lt; 'bc_a1 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_bc_surf_2000_c090726.nc',
&lt; 'num_a1 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_num_a1_surf_2000_c090726.nc',
&lt; 'num_a2 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_num_a2_surf_2000_c090726.nc',
&lt; 'pom_a1 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_oc_surf_2000_c090726.nc',
&lt; 'so4_a1 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so4_a1_surf_2000_c090726.nc',
&lt; 'so4_a2 -&gt; /HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/emis/ar5_mam3_so4_a2_surf_2000_c090726.nc'
&lt; srf_emis_type = 'CYCLICAL'
&lt; tracer_cnst_cycle_yr = 2000
&lt; tracer_cnst_datapath = '/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mozart_aero/oxid'
&lt; tracer_cnst_file = 'oxid_1.9x2.5_L26_1850-2005_c091123.nc'
&lt; tracer_cnst_filelist = 'oxid_1.9x2.5_L26_clim_list.c090805.txt'
&lt; tracer_cnst_specifier = 'O3','OH','NO3','HO2'
&lt; tracer_cnst_type = 'CYCLICAL'
&lt; use_cam_sulfchem = .false.
&lt; xactive_prates = .false.
&lt; xs_long_file = '/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/waccm/phot/temp_prs_GT200nm_jpl06_c080930.nc'
61d26
&lt; flbc_list = ' '
114c79
&lt; cam_chempkg = 'trop_mam3'
---
&gt; cam_chempkg = 'none'
137a103,114
&gt; &amp;prescribed_aero_nl
&gt; prescribed_aero_cycle_yr = 2000
&gt; prescribed_aero_datapath = '/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/chem/trop_mam/aero'
&gt; prescribed_aero_file = 'mam3_1.9x2.5_L30_2000clim_c130319.nc'
&gt; prescribed_aero_specifier = 'num_c1', 'bc_c1', 'dst_c1', 'ncl_c1', 'pom_c1', 'so4_c1', 'soa_c1', 'num_c2',
&gt; 'ncl_c2', 'so4_c2', 'soa_c2', 'num_c3', 'dst_c3', 'ncl_c3', 'so4_c3', 'num_a1_logm',
&gt; 'bc_a1_logm', 'dst_a1_logm', 'ncl_a1_logm', 'pom_a1_logm', 'so4_a1_logm', 'soa_a1_logm', 'num_a2_logm', 'ncl_a2_logm',
&gt; 'so4_a2_logm', 'soa_a2_logm', 'num_a3_logm', 'dst_a3_logm', 'ncl_a3_logm', 'so4_a3_logm', 'num_a1_logv', 'bc_a1_logv',
&gt; 'dst_a1_logv', 'ncl_a1_logv', 'pom_a1_logv', 'so4_a1_logv', 'soa_a1_logv', 'num_a2_logv', 'ncl_a2_logv', 'so4_a2_logv',
&gt; 'soa_a2_logv', 'num_a3_logv', 'dst_a3_logv', 'ncl_a3_logv', 'so4_a3_logv'
&gt; prescribed_aero_type = 'CYCLICAL'
&gt; /
150,158c127,135
&lt; mode_defs = 'mam3_mode1:accum:=', 'A:num_a1:N:num_c1:num_mr:+',
&lt; 'A:so4_a1:N:so4_c1:sulfate:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/sulfate_rrtmg_c080918.nc:+', 'A:pom_a1:N:pom_c1:p-organic:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ocpho_rrtmg_c101112.nc:+',
&lt; 'A:soa_a1:N:soa_c1:s-organic:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ocphi_rrtmg_c100508.nc:+', 'A:bc_a1:N:bc_c1:black-c:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/bcpho_rrtmg_c100508.nc:+',
&lt; 'A:dst_a1:N:dst_c1:dust:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/dust4_rrtmg_c090521.nc:+', 'A:ncl_a1:N:ncl_c1:seasalt:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ssam_rrtmg_c100508.nc',
&lt; 'mam3_mode2:aitken:=', 'A:num_a2:N:num_c2:num_mr:+',
&lt; 'A:so4_a2:N:so4_c2:sulfate:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/sulfate_rrtmg_c080918.nc:+', 'A:soa_a2:N:soa_c2:s-organic:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ocphi_rrtmg_c100508.nc:+',
&lt; 'A:ncl_a2:N:ncl_c2:seasalt:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ssam_rrtmg_c100508.nc', 'mam3_mode3:coarse:=',
&lt; 'A:num_a3:N:num_c3:num_mr:+', 'A:dst_a3:N:dst_c3:dust:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/dust4_rrtmg_c090521.nc:+',
&lt; 'A:ncl_a3:N:ncl_c3:seasalt:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ssam_rrtmg_c100508.nc:+', 'A:so4_a3:N:so4_c3:sulfate:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/sulfate_rrtmg_c080918.nc'
---
&gt; mode_defs = 'mam3_mode1:accum:=', 'N:num_a1:N:num_c1:num_mr:+',
&gt; 'N:so4_a1:N:so4_c1:sulfate:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/sulfate_rrtmg_c080918.nc:+', 'N:pom_a1:N:pom_c1:p-organic:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ocpho_rrtmg_c101112.nc:+',
&gt; 'N:soa_a1:N:soa_c1:s-organic:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ocphi_rrtmg_c100508.nc:+', 'N:bc_a1:N:bc_c1:black-c:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/bcpho_rrtmg_c100508.nc:+',
&gt; 'N:dst_a1:N:dst_c1:dust:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/dust4_rrtmg_c090521.nc:+', 'N:ncl_a1:N:ncl_c1:seasalt:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ssam_rrtmg_c100508.nc',
&gt; 'mam3_mode2:aitken:=', 'N:num_a2:N:num_c2:num_mr:+',
&gt; 'N:so4_a2:N:so4_c2:sulfate:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/sulfate_rrtmg_c080918.nc:+', 'N:soa_a2:N:soa_c2:s-organic:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ocphi_rrtmg_c100508.nc:+',
&gt; 'N:ncl_a2:N:ncl_c2:seasalt:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ssam_rrtmg_c100508.nc', 'mam3_mode3:coarse:=',
&gt; 'N:num_a3:N:num_c3:num_mr:+', 'N:dst_a3:N:dst_c3:dust:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/dust4_rrtmg_c090521.nc:+',
&gt; 'N:ncl_a3:N:ncl_c3:seasalt:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/ssam_rrtmg_c100508.nc:+', 'N:so4_a3:N:so4_c3:sulfate:/HOME/sysu_hjkx_ys/WORKSPACE/cesm/input/atm/cam/physprops/sulfate_rrtmg_c080918.nc'
191,193d167
&lt; &amp;wetdep_inparm
&lt; gas_wetdep_list = 'H2O2','SO2'
&lt; /</pre>
Such a lot differences in input files as we expected.

We test the <strong>atm_in</strong> differences between B with / without "-chem none" argument, everything goes fine!

Now we run the model for several months to test the final results.

Configuration:

B2000_CAM5

0.9x1.25

Tianhe-2: 192PEs

&nbsp;

output with" phys cam5 -chem none":
<pre> -rw-r--r-- 1 sysu_hjkx_ys sysu_hjkx 299965072 <strong>Sep 24 15:10</strong> B_NO_CHEM_CAM5_TEST.cam.h0.0001-01.nc
-rw-r--r-- 1 sysu_hjkx_ys sysu_hjkx 299965072 <strong>Sep 24 15:30</strong> B_NO_CHEM_CAM5_TEST.cam.h0.0001-02.nc

</pre>
output without "phys cam5":
<pre>-rw-r--r-- 1 sysu_hjkx_ys sysu_hjkx 305056100 <strong>Sep 24 15:23</strong> B_CHEM_CAM5_TEST.cam.h0.0001-01.nc
-rw-r--r-- 1 sysu_hjkx_ys sysu_hjkx 305056100 <strong>Sep 24 15:49</strong> B_CHEM_CAM5_TEST.cam.h0.0001-02.nc</pre>
So without the aerosol active, it saves (49-23)-(30-10) = 6 min in each month. About 6/26*100% = 23% time saved.
---
layout: post
title:  "【已解决】Preferable PE layers for BC5 compset on tianhe2" 
categories: Hardware CESM HPC
tags: Hardware CESM HPC
author: LZN
---

* content
{:toc}

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/09/QQ图片20150924162913.jpg"><img class="alignnone size-full wp-image-728" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2015/09/QQ图片20150924162913.jpg" alt="QQ图片20150924162913" width="582" height="234" /></a>

72 #Change PE layers
73 ./xmlchange NTASKS_ATM=480
74 ./xmlchange NTHRDS_ATM=1
75 ./xmlchange ROOTPE_ATM=0
76
77 ./xmlchange NTASKS_LND=240
78 ./xmlchange NTHRDS_LND=1
79 ./xmlchange ROOTPE_LND=120
80
81 ./xmlchange NTASKS_ICE=120
82 ./xmlchange NTHRDS_ICE=1
83 ./xmlchange ROOTPE_ICE=0
84
85 ./xmlchange NTASKS_OCN=96
86 ./xmlchange NTHRDS_OCN=1
87 ./xmlchange ROOTPE_OCN=480
88
89 ./xmlchange NTASKS_CPL=120
90 ./xmlchange NTHRDS_CPL=1
91 ./xmlchange ROOTPE_CPL=360
92
93 ./xmlchange NTASKS_GLC=240
94 ./xmlchange NTHRDS_GLC=1
95 ./xmlchange ROOTPE_GLC=0
96
97 ./xmlchange NTASKS_ROF=120
98 ./xmlchange NTHRDS_ROF=1
99 ./xmlchange ROOTPE_ROF=240
100
101 ./xmlchange NTASKS_WAV=120
102 ./xmlchange NTHRDS_WAV=1
103 ./xmlchange ROOTPE_WAV=360
---
layout: post
title:  "【NOT solved】GFDL atmosphere dycore porting" 
categories: Linux GFDL_FMS
tags: Linux GFDL_FMS
author: LZN
---

* content
{:toc}

Now we try to setup GFDL dycore model on our Neptune platform. Following steps has been used:

1. We exec the ./exp/fv/fms_runscript, then got the netcdf and mpi error. It seems that the model does not recognize the environmental variables associated with these lib. We add the flags directly to the compile sentence.
<pre>L35: $mkmf -p fms.x -t $template -c "-Duse_libMPI -Duse_netCDF -DUSE_LIMA -DSPMD -DLAND_BND_TRACERS" -a $sourcedir $pathnames /usr/local/include $sourcedir/shared/mpp/include $sourcedir/shared/include /home/yangsong3/soft/mpich314-intel/include /usr/netcdf-4331/include</pre>
And mkmf.template.ia64 file
<pre>LDFLAGS = -L/usr/local/lib -L/usr/netcdf-4331/lib -L/home/yangsong3/soft/mpich314-intel/lib #-lsma</pre>
We comment the "-lsma" flag because it is a flag specific to Cray machine.

Next, we compile again, frequently got this
<pre>ifort:  '-i_dynamic' not supported</pre>
google it, got this

https://software.intel.com/en-us/forums/intel-fortran-compiler-for-linux-and-mac-os-x/topic/486830
<blockquote>Regarding 1:<strong> -i_dynamic</strong> (the underscore form) was a option spelling used many many releases ago that was later mapped to <strong>-i-dynamic</strong> (the hyphen form) and then that form was depreciated in more current releases and it now maps to<strong> -shared-intel</strong></blockquote>
So, we change it to <strong>-shared-intel</strong>, no more warning.

However, when it compiles for a long time (5min), we got error again, lots of:
<pre>/home/yangsong3/soft/GFDL_atm_dycores/exp/fv/../../src/shared/mpp/include/mpp_transmit_mpi.h:79: undefined reference to `mpi_recv_'</pre>
Then we change the ifort compile flag into mpif90, we got this
<pre>/home/yangsong3/soft/GFDL_atm_dycores/exp/fv/../../src/shared/mpp/include/mpp_io_misc.inc:116: undefined reference to `nf_inq_libvers_'</pre>
It really sucks<strong><span style="color: #339966;">.</span></strong>

#Last Edited on 20151004#

<strong><span style="color: #339966;">We finally stop trying and turn to CAM dynamical core simulation and it works really smooth over the CESM construction.</span></strong>

#Last Edited on 20151114#

&nbsp;
---
layout: post
title:  "【ongoing】use grads to read cesm output" 
categories: CESM NCL
tags: CESM NCL
author: LZN
---

* content
{:toc}

Some points to be aware:

2D fields, not same by binary output and netcdf (high efficiency) output, one point value missing, might be the polar point. Therefore, *.bin control and *.nc sensitive is not under the same structure.

2D fields work fine under <strong>v1.9</strong> of grads. However, 3D fields might meet some trouble. Try to use the "standard" attribution, dimention to tackle this problem. An example from NCEP-DOE dataset:

float level(level) ;
level:units = "millibar" ;
level:long_name = "Level" ;
level:positive = "down" ;
level:GRIB_id = 100s ;
level:GRIB_name = "hPa" ;
level:actual_range = 1000.f, 10.f ;
level:axis = "Z" ;
&nbsp;
---
layout: post
title:  "【ongoing】php返回图片方法获知邮件是否被查阅" 
categories: Linux PHP&amp;mySQL
tags: Linux PHP&amp;mySQL
author: LZN
---

* content
{:toc}

突然想到能否有什么方法知道发出去的某封邮件是否被别人查阅，查了下，有人提到图片挂参的方法可以办到，回想之前IP验证和php自动发邮件，突然想到可以做这么一套东西，每天固定时间统计一下今天发出去的邮件多少被查阅了，然后做个报告发到邮箱。将来撒海网套磁的时候，绝对是利器啊。LOL

说搞就搞：

首先，测试一下php返回图片

参照<a href="http://www.oschina.net/code/snippet_572802_11655">这个帖子</a>，bingo，原来是改一下http的header就可以。

然后引入访问IP的检测，直接抄13年检测服务器访问沿海自动站IP的程序，调用IP138结果记录。

居然就可以了～给php文件挂个参数标志是哪一个邮件，嗯嗯

最后设置下crontab，每天固定时间把log发到邮箱，bingo～再写一个可以随时访问的查看页面，done～

&nbsp;
---
layout: post
title:  "【CESM】slab ocean coupling" 
categories: CESM ClimateChange
tags: CESM ClimateChange
author: LZN
---

* content
{:toc}

Here is a <a href="https://www.quora.com/What-are-slab-ocean-models-in-climate-science">quora answer </a>about the slab ocean
<blockquote><span class="rendered_qtext">Slab ocean models consider this whole upper layer as one single body of water, or a 'slab' with one single velocity vector (u,v), and density. The Navier-Stokes equation is modified accordingly to compute the resultant velocity of that slab based on wind forcing and coriolis force. The mixed-layer depth in such models is usually kept fixed. </span></blockquote>
Here is a <a href="https://bb.cgd.ucar.edu/faq-data-ocean-slab-mode-docn-som">FAQ </a>about the slab ocean model. Two things to note:

1. SOM is a kind of data model, can be switched in a namelist variable F compset, env_run.xml.

2. Some standard SOM forcing is available in the inputdata repository.

Now we may start to test the slab ocean. compset choose: E_1850_CAM5

ERROR comes:
<blockquote>svn: URL 'https://svn-ccsm-inputdata.cgd.ucar.edu/trunk/inputdata/ocn/docn7/SOM/UNSET' non-existent in that revision</blockquote>
There should be something wrong with the set of the ocean forcing files. So come to <a href="https://svn-ccsm-inputdata.cgd.ucar.edu/trunk/inputdata/ocn/docn7/SOM/">this dir</a>, no problem.

We need to set the specific foring files in the env_run.xml file. (check FAQ)

We choose <strong>pop_frc.b.c40.B1850CN.f19_g16.100105.nc for </strong>test.

In env_run.xml, only give the name of the file is okay to continue.

After downloading the file, you can build and submit the case. Yet there is no problem even after altering the physics into cam5 -chem none.

Perfect!

&nbsp;

&nbsp;
---
layout: post
title:  "【MATLAB】数字OCR" 
categories: MATLAB
tags: MATLAB
author: LZN
---

* content
{:toc}

之前截取了一些羽绒服的销量数据，以为能凑着这次<a href="http://met.sysu.edu.cn/?p=6153">广州飞雪的超强寒潮</a>写一点东西，最后发现数据并不是很有说服力。由于淘宝反爬虫的策略，因此过程中用浏览器配合按键精灵每小时截图，最后也是搜集到了不少位图数据，因此有一个问题就怎样在这些位图中将数字抽取出来，因为数字几乎没有干扰，这是个很基本的OCR（Optical Character Recognition，光学字符识别）问题。

考虑还是用MATLAB做图像处理熟悉，简单查了下资料，思路很简单：

1. 预处理，剪裁出需要识别的区域，灰度化，二值化。

2.（关键）字符分隔，这个其实很简单，向x轴y轴分别投影，找出0和正整数之间的过渡位置，即字符和间隙的分隔位置

3. 将图像字符串分隔为单个字符，分别向x轴y轴投影，记录投影特征，遍历10个阿拉伯数字

4.待识别的新样本重复1和2的操作，计算与记录特征的标准偏差，设定一合理阈值偏差，小于该偏差即可认为识别成功。

对于标准的屏幕显示的数字（或者字母），可以想象上述过程基本能做到极高的识别率了。手写体识别估计就更复杂了，需要用到机器学习等方法，木有涉猎，暂且不表。

识别部分程序代码如下

<pre><code>
function img_number()
    clear all;
    close all;
    echo off;
	
	
	%---------------Read features---------------
	x_mat=load('../feature/x_project.txt');
	y_mat=load('../feature/y_project.txt');
	
    I = imread('../img/2016011920.bmp');
    I=I(612:625,900:946,:);
    I_int = rgb2gray(I);
    
    I_int=~im2bw(I_int,0.5);   %binary and reverse
    I_x_pro = sum(I_int,1);    % project to the x axis
    imshow(I_int)
	num_x_start=strfind(I_x_pro~=0,[0 1])+1; %find the start point of a specific figure
	num_x_end=strfind(I_x_pro==0,[0 1]); %find the end point of a specific figure
	
	I_y_pro = sum(I_int,2);   % project to the y axis
    num_y_start=strfind(I_y_pro'~=0,[0 1])+1; %find the start point of a specific figure
	num_y_end=strfind(I_y_pro'==0,[0 1]); %find the end point of a specific figure
	
	fig_num = size(num_x_start);   % how many figures in the image
	fig_stdwidth = 6;
	fig_stdheight = num_y_end-num_y_start+1;
	for ii=1:fig_num(2)
        I_std_ele_fig = imresize(I_int(num_y_start:num_y_end,num_x_start(ii):num_x_end(ii)), [fig_stdheight fig_stdwidth]);
		std_x_pro = sum(I_std_ele_fig,1);
		std_y_pro = sum(I_std_ele_fig,2)';
		for jj=1:10
			if(sum((std_x_pro-x_mat(jj,2:end)).^2)<10 & sum((std_y_pro-y_mat(jj,2:end)).^2)<10)
				jj-1
			end
		end 
    end 
</code></pre>
---
layout: post
title:  "【DOS】文件系统操作" 
categories: Windows
tags: Windows
author: LZN
---

* content
{:toc}

DOS下文件系统操作与Linux下有区别也有相同，比如切换目录都是cd命令，但在dos下切换驱动器，需要加上 /d选项，这个略坑。或者直接输入盘符F：

ls在dos下用dir替代。
---
layout: post
title:  "【python】学习笔记·基础篇" 
categories: Python Notebook
tags: Python Notebook
author: LZN
---

* content
{:toc}

#20160202#

print() 双引号单引号均可，字符串之间用逗号分隔会自动加入空格

直接写变量名回车可以打印出变量值（类似matlab）

name=input('please input your name...')

if结构
<pre>if a&gt;1:
    print a
else:
    print -a
</pre>
python强制缩进，大小写敏感

#20160204#

<img src="http://www.liaoxuefeng.com/files/attachments/001387245992536e2ba28125cf04f5c8985dbc94a02245e000/0" alt="rw-file-utf-8" />

<img src="http://www.liaoxuefeng.com/files/attachments/001387245979827634fd6204f9346a1ae6358d9ed051666000/0" alt="web-utf-8" />

Python 3版本中，字符串是以Unicode编码的，也就是说，Python的字符串支持多语言

ord()函数 字符--》编码

chr()函数 编码--》字符
<pre><code class="python"><span class="prompt">&gt;&gt;&gt; </span><span class="string">'\u4e2d\u6587'</span>
<span class="string">'中文'</span>
</code></pre>
python默认字符串类型为str，一个字符对应若干字节；传输或者保存为byte类型，以字节为单位。

x=b'xxx'

字节码转回ASCII或utf-8 (decode方法)

&gt;&gt;&gt;b'abc'.decode('ascii')

'abc'

取字符串长度函数 len()

中文经过utf-8编码后占3个字节，英文仅占1个字节

&gt;&gt;&gt;len('我们'.encode('utf-8'))

6

格式化输出

&gt;&gt;&gt;'hi, %s, you have %d' % ('xxx', 100)

'hi, xxx, you have 100'

%%用于转义

【lists】

&gt;&gt;&gt;classmates=['Alice','Bob']

&gt;&gt;&gt;classmates

['Alice','Bob']

&gt;&gt;&gt;len(classmates)

2

若取用最后一个元素，用-1做索引；-2，-3类推

追加元素，append方法

&gt;&gt;&gt;classmates.append('Adam')

删除最后一个元素，pop方法

&gt;&gt;&gt;classmates.pop

指定位置

&gt;&gt;&gt;classmates.pop(i)

加入到指定位置，比如，index=1的位置

&gt;&gt;&gt;classmates.insert(1,'Alex')

替换指定位置元素，直接赋值即可

&gt;&gt;&gt;classmates[1]='Frank'

list可以放入不同的数据类型，甚至可以list套list，例如

&gt;&gt;&gt;language=['VB','C++',['php','asp']]

引用'asp'

&gt;&gt;&gt;language[2][1]

有序列别tuple，不可更改，小括号

&gt;&gt;&gt;classmates=('Bob','Jane','Dennis')

引用依然用中括号。

若定义只有一个元素的tuple，不能用 test=(1)的形式，小括号被解释为数学运算符，加入逗号消除歧义test=(1,)

<img src="http://www.liaoxuefeng.com/files/attachments/001387269768140c7d5ca167342402989dfc75343fe900b000/0" alt="tuple-1" />

tuple指的是指向不变

IF

强制缩进代表块语句
<pre>if xxx:
    xxxx
elif xxx:
    xxxx
else:
    xxxx</pre>
input输入的是str()类型，必须通过int()函数转换才能与数值类型进行比较。

FOR

遍历list
<pre>names=['Bob','Steve','John']
for name in names:
    print name</pre>
range(n)函数用于生成小于整数n的序列

如0-100的序列求和
<pre>num=range(101)
sum=0
for x in num:
    sum=sum+x
print(sum)</pre>
WHILE
<pre>s=100
sum=0
while s&gt;0:
    sum=sum+s
    s=s-1</pre>
DICT和SET

dictionary，key-value对

dic={'Mike':100,'Alice':90}

dic['Mike']

dic['Mike']=10

判断key是否存在，用in

&gt;&gt;&gt;'Tom' in dic

False

get方法

&gt;&gt;&gt;dic.get('Tom',-999)

-999

pop方法删除字典元素

dic.pop('Mike')

和list比较，dict有以下几个特点：
<ol>
	<li>查找和插入的速度极快，不会随着key的增加而增加；</li>
	<li>需要占用大量的内存，内存浪费多。</li>
</ol>
而list相反：
<ol>
	<li>查找和插入的时间随着元素的增加而增加；</li>
	<li>占用空间小，浪费内存很少。</li>
</ol>
key是不可变对象，做Hash运算后确定value地址

SET

只保存key，用list初始化

&gt;&gt;&gt;s=set([1,2,3])

&gt;&gt;&gt;s

{1,2,3}

无重复，无序，集合，可以交集并集等

&gt;&gt;&gt;s1=set([1,2,3])

&gt;&gt;&gt;s2=set([2,3,4])

&gt;&gt;&gt;s1 &amp; s2

{2,3}

&gt;&gt;&gt;s1 | s2

{1,2,3,4}

注意了解不可变对象的概念，<a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/00143167793538255adf33371774853a0ef943280573f4d000">最后一部分</a>

对于不变对象来说，调用对象自身的任意方法，也不会改变该对象自身的内容。相反，这些方法会创建新的对象并返回，这样，就保证了不可变对象本身永远是不可变的。

&nbsp;
---
layout: post
title:  "【python】中文编码问题" 
categories: Linux Windows Python
tags: Linux Windows Python
author: LZN
---

* content
{:toc}

文件头加入如下内容
<pre><code class="ruby"><span class="comment">#!/usr/bin/env python3</span>
<span class="comment"># -*- coding: utf-8 -*-</span>
</code></pre>
第二行注释是为了告诉Python解释器，按照UTF-8编码读取源代码，否则，你在源代码中写的中文输出可能会有乱码。

申明了UTF-8编码并不意味着你的<code>.py</code>文件就是UTF-8编码的，必须并且要确保文本编辑器正在使用UTF-8 without BOM编码
---
layout: post
title:  "【python】学习笔记·函数篇" 
categories: Python
tags: Python
author: LZN
---

* content
{:toc}

built-in函数

int() str() float() bool()

函数名可以赋值给变量，相当于alias

自定义函数
<pre>def function(x):
    if x&lt;10:
        print('too low')
    else:
        print('good')
        return x+1</pre>
return用于返回函数，若无操作对象，则返回None，也可以返回多个值，tuple类型，也可以给多个变量

若在当前目录test.py中定义了function()函数，可以通过模块方式引用

&gt;&gt;&gt;from test import function

无语句的缩进中可以用 pass过

if x&gt;10:

pass

参数可以给予默认值

power(x,n=2)

n在调用时若不传递，则为2；不按顺序提供可选参数时，需要在调用时提供参数名。若默认参数指向可变对象，如list，则每次调用函数，均会使得可变对象发生改变。（传址）
<pre><code class="python"><span class="function"><span class="keyword">def</span> <span class="title">add_end</span><span class="params">(L=None)</span>:</span>
    <span class="keyword">if</span> L <span class="keyword">is</span> <span class="built_in">None</span>:
        L = []
    L.append(<span class="string">'END'</span>)
    <span class="keyword">return</span> L</code></pre>
L每次默认参数均为None，这样可以避免该问题。

可变参数标识，前缀*，可传入0-任意多参数
<pre>def sum_all(*numbers):
    sum=0
    for num in numbers:
        sum=sum+num
    return sum</pre>
可以传入任意多个数字

如

sum_all(2,3,5,4)

若为list

l=[3,4,5,6,8]

sum_all(*l)

挂前缀传入

&nbsp;

关键字参数，按字典进行组装
<pre>def test_student(name,gender,**kw)
    print('name:',name,'gender:',gender,'other:',kw)</pre>
调用时若传入其他参数

&gt;&gt;&gt;test_student('Mike','Male',city='Beijing')

name: Mike gender: Male other: {'city': 'Beijing'}

直接传入dict则获得dict的拷贝（传值）

&gt;&gt;&gt;test_student('Mike','Male',**extra)

若通过*分隔，则定义了命名关键字参数
<pre>def test_student(name,gender,*,city)</pre>
命名关键字参数与位置参数不同，必须传入参数名

参数定义的顺序必须是：<strong>必选参数、默认参数、可变参数/命名关键字参数和关键字参数。</strong>

复习

*arg 可变参数，接受tuple

**kw 关键字参数，接受dict

递归超过一定栈帧长度会溢出，1000的阶乘是无法计算的。
---
layout: post
title:  "【python】学习笔记·高级篇" 
categories: Python Notebook
tags: Python Notebook
author: LZN
---

* content
{:toc}

L=['Mary','Steve','Mike','Dennis']

L[0:3]切片操作，从0开始，到3（不包括3脚标）

&gt;&gt;&gt;L[0:3]

'Mary','Steve','Mike'

支持负数切片，如[-2:-1]，为倒数第一个。

L[:10]，前十个元素

L[:10:2]，前十个元素，每隔一个取一个

[0,2,4,6,8]

L[::5]所有数，每五个取一个

字符串，tuple都可以进行切片

&gt;&gt;&gt;'ABCD'[:2]

'AB'

迭代

用循环遍历的操作称为迭代，可迭代对象范围很广，包括dict

如

for key in dict:

for value in dict.value():

都可以

同时迭代key和value

for  k,v in dict.items():

带索引迭代

&gt;&gt;&gt;for i,value in enumerate(L):

多引用

&gt;&gt;&gt;for i,j in [(1,2), (3,4), (5,6)]

列表生成器

如[1 4 9 16]

[x*x for x in range(1,5)]

[x*x for x in range(1,11) if x%2==0]

[4, 16, 36, 64, 100]

[m+n for m in 'ABC' for n in 'CDE']

遍历目录

import os

[d for d in os.listdir('.')]
---
layout: post
title:  "wordpress禁用找回密码" 
categories: Blog&amp;CMS PHP&amp;mySQL
tags: Blog&amp;CMS PHP&amp;mySQL
author: LZN
---

* content
{:toc}

转自http://www.wpmee.com/disable_reset_lost_password/

&nbsp;

今天给大家分享一个<a title="查看更多关于wordpress优化的教程" href="http://www.wpmee.com/tag/wordpress%E4%BC%98%E5%8C%96/" target="_blank">wordpress优化</a>中的一个防黑小妙招，禁用密码找回功能，为什么要禁用如此优秀的功能呢？因为可能被有心之人滥用，如果你也像wordpress迷一样装了<a title="postfix发信程序的安装教程" href="http://www.wpmee.com/lnmp1-0-centos-postfix/" target="_blank">postfix发信</a>程序，那么很有可能被无数个发信线程卡死。所以如果你只是单用户的站点，直接禁用了吧。

将下面的代码添加到你主题的functions.php中即可：
<div class="dp-highlighter nogutter">
<ol class="dp-c" start="0">
	<li class="alt"><span class="comment">/* </span></li>
	<li><span class="comment">*禁用密码找回功能 </span></li>
	<li class="alt"><span class="comment">*http://www.wpmee.com/disable_reset_lost_password/</span></li>
	<li><span class="comment">*/</span></li>
	<li class="alt"><span class="keyword">function</span> disable_reset_lost_password()</li>
	<li> {</li>
	<li class="alt">   <span class="keyword">return</span> false;</li>
	<li> }</li>
	<li class="alt">add_filter( 'allow_password_reset', 'disable_reset_lost_password');</li>
</ol>
</div>
---
layout: post
title:  "【shell】文本处理-金价" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

awk工具可以很好的用来剔除html标签

awk 'BEGIN {FS="&gt;"} NR==19 {print $2}' gold-1602041300 | awk 'BEGIN {FS="&lt;"} {print $1}'

分别把左侧关标签和右侧开标签作为分隔符，最后print $1即可。

字符串变量截取${var:7}，从第八个字符开始向后。

参考：http://blog.csdn.net/misskissc/article/details/8217877

&nbsp;
---
layout: post
title:  "【mysql】测试wordpress与mysql数据库的关系" 
categories: Blog&amp;CMS PHP&amp;mySQL
tags: Blog&amp;CMS PHP&amp;mySQL
author: LZN
---

* content
{:toc}

第一次建立wordpress站点的时候搞得不明不白，这次建站，决定测试一下进入mysql的具体流程

经典步骤：
<pre>$ mysql -u adminusername -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 5340 to server version: 3.23.54
 
Type 'help;' or '\h' for help. Type '\c' to clear the buffer.
 
mysql&gt; CREATE DATABASE databasename;
Query OK, 1 row affected (0.00 sec)
 
mysql&gt; GRANT ALL PRIVILEGES ON databasename.* TO "wordpressusername"@"hostname"
    -&gt; IDENTIFIED BY "password";
Query OK, 0 rows affected (0.00 sec)
  
mysql&gt; FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; EXIT
Bye
$</pre>
第一次测试，所有都用root用户名和密码，成功！

第二次，一般用户下，一般用户名登录mysql，无法创建数据库。

第三次，一般用户下，root登录，创建数据库，grant时用 "yangsong3"@"localhost"，wordpress设置下用yangsong3，失败！

用root，成功～说明wordpress实际是用的root用户名访问mysql的。

&nbsp;

&nbsp;
---
layout: post
title:  "【Linux】Windows上传文件名乱码解决" 
categories: Linux Windows
tags: Linux Windows
author: LZN
---

* content
{:toc}

由于windows和linux对文件系统的编码方式不同，从windows上传或者从linux下载的文件名总存在乱码，解决方法很简单。实际上linux程序包里存在一个convmv的转换程序。

首先，检测下是否有这个程序，如果没有，yum安装一下。

转换命令

convmv -f GBK -t UTF-8 -r yourdir/ --notest

-f是源编码格式

-t为目标编码格式

--notest代表直接进行mv操作

-r代表递归

yourdir/为操作目录
---
layout: post
title:  "sp-cam移植" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

<span style="color: #ff0000;">/*注意采用较早版本（2013）的编译器和MPI*/</span>

按照cesm1.2.2的配置build，最后一步出错

mpif90  -o /users/yangsong3/L_Zealot/F/SP-test-sam1mom/exe/cesm.exe ccsm_com
<strong> 26 ld: cannot find -lblas</strong>
27 gmake: *** [/users/yangsong3/L_Zealot/F/SP-test-sam1mom/exe/cesm.exe] Error

查了下

http://stackoverflow.com/questions/27033243/usr-bin-ld-cannot-find-llapack

看起来缺少lapack的包

查log发现已经安装了lapack包，只是缺少libblas.a文件，liblapack.a是有的，目录下有libpreblas.a，感觉比较像，直接ln出来一个libblas.a，编译通过！

提交任务运行，立刻出现segfault，显示似乎有netcdf库的问题。

测试去掉pnetcdf，不行

改lapack，不行

都是同样的错位。怀疑是编译器或者MPI的问题，于是将model传输到天河二号，采用天河二号13版本的编译器进行编译，居然可以顺利运行！

坑爹的是，m2005的case在运行到nstep=4的时候会卡死……

mom1mam的case没有问题！
---
layout: post
title:  "Linux 查看磁盘读写状态" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

$iostat -x 1
---
layout: post
title:  "SP-CAM AMIP run" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

1. 注意下载完整restart文件以及rpointer

2. AMIP run默认输出中fincl1文件变量cb_sulf_c在SP下不存在，因此运行前删掉atm_in中fincl1这一行即可。

3. 不要用xxx.run提交，用yhbatch直接提交包含yhrun的脚本
---
layout: post
title:  "VBA学习笔记" 
categories: EXCEL/VBA
tags: EXCEL/VBA
author: LZN
---

* content
{:toc}

打开开发工具功能选项卡

文件--&gt;选项--&gt;自定义功能区

选定区域，F5，定位，可以定位选中到想要的区域
---
layout: post
title:  "【未解决】python安装pandas等数据处理类库" 
categories: Python
tags: Python
author: LZN
---

* content
{:toc}

首先按照<a href="http://youerning.blog.51cto.com/10513771/1711008">这个网站</a>yum这些东西，然后pip安装，

出现错误：Command "python setup.py egg_info" failed with error code 1 in /tmp/pip-build-Cblre2/pandas/

之后的剧情就是个坑了，查了个资料，说把python用yum给remove了，然后编译安装新版本的就行，我居然TMD信以为真，remove过程中突然出现一个提示说cannot remove yum，纳尼……啥时候要remove yum。

不管了，编译安装python2.7，发现yum还是不能安装pandas，这个时候我做了个最错误的决定，将系统原有的/usr/下所有python的lib include全删了，用2.7去替换……天真如我啊啊啊 = =

之后yum就不正常了，出现：

No module named yum这种错误

查了下，正确安装新版本python的姿势：

http://ruiaylin.github.io/2014/12/12/python%20update/#%E4%BF%AE%E5%A4%8D_yum_%E5%B7%A5%E5%85%B7

原来系统安装的python 与许多组件有依赖关系，随意搞掉是不可以的，吐血。于是找办法去解决，下载了python，yum等几个关联包，重新rpm安装，再运行yum出现新错误：No module named rpm，纳尼……

想到之前自己删除了所有原本的python相关库，估计是这个问题。

折腾半天，去workstation上yum update了，然后scp所有/usr下与python相关的文件夹过来……

yum可以用了，update过程中出现许多不匹配的错误，这应该是workstation上rpm管理的软件信息与team server不同造成……

yum update后，似乎没什么问题了。

附带官方所有软件包地址：http://mirror.centos.org/centos/6/os/x86_64/Packages/

重新编译安装python2.7，按照<a href="http://ruiaylin.github.io/2014/12/12/python%20update/#%E4%BF%AE%E5%A4%8D_yum_%E5%B7%A5%E5%85%B7">这个帖子</a>，需要安装setuptools和PIP，之后用PIP安装pandas等库，成功！
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter"></td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">pip </code><code class="bash functions">install</code> <code class="bash plain">matplotlib -i http:</code><code class="bash plain">//pypi</code><code class="bash plain">.douban.com</code><code class="bash plain">/simple</code> <code class="bash plain">--trusted-host pypi.douban.com</code></div>
<div class="line number2 index1 alt1"><code class="bash plain">pip </code><code class="bash functions">install</code> <code class="bash plain">numpy -i http:</code><code class="bash plain">//pypi</code><code class="bash plain">.douban.com</code><code class="bash plain">/simple</code> <code class="bash plain">--trusted-host pypi.douban.com</code></div>
<div class="line number3 index2 alt2"><code class="bash plain">pip </code><code class="bash functions">install</code> <code class="bash plain">pandas -i http:</code><code class="bash plain">//pypi</code><code class="bash plain">.douban.com</code><code class="bash plain">/simple</code> <code class="bash plain">--trusted-host pypi.douban.com</code></div>
<div class="line number4 index3 alt1"><code class="bash plain">pip </code><code class="bash functions">install</code> <code class="bash plain">seaborn scipy</code></div>
</div></td>
</tr>
</tbody>
</table>
---
layout: post
title:  "yh数据处理" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

iconv转码函数非常好用，可以直接在命令行下进行数据转码，例子：

iconv weawher_coop1 -f gbk -t UTF-8 -o weather_coop1.utf-8

split函数可以按行分隔文件：

split -l 10000 -d -a 4 weather_coop1.utf-8 ./splited-noreject/weather<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

10000行一个文件，后缀为4位数字。
---
layout: post
title:  "【python】Ipython安装" 
categories: Python
tags: Python
author: LZN
---

* content
{:toc}

想安装ipython，直接用pip貌似出错

pip install ipython，出错

OSError: [Errno 2] No such file or directory: '/usr/local/lib/python2.7/site-packages/setuptools-1.4.2-py2.7.egg'<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

根据<a href="http://ipython.org/ipython-doc/stable/install/install.html">官方安装说明</a>，加入

pip install "ipython[all]"

即可。
---
layout: post
title:  "查看进程及对应IP" 
categories: Linux Internet
tags: Linux Internet
author: LZN
---

* content
{:toc}

# lsof -Pnl +M -i4<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

php       10684      500    3u  IPv4 1890733      0t0  TCP 202.116.70.21:48785-&gt;140.90.101.63:80 (SYN_SENT)
sshd      10692        0    3r  IPv4 1890422      0t0  TCP 202.116.70.21:22-&gt;58.254.4.117:2268 (ESTABLISHED)
sshd      10702      500    3u  IPv4 1890422      0t0  TCP 202.116.70.21:22-&gt;58.254.4.117:2268 (ESTABLISHED)
sshd      10702      500    9u  IPv4 1890569      0t0  TCP 127.0.0.1:6010 (LISTEN)
sshd      10754        0    3r  IPv4 1890641      0t0  TCP 202.116.70.21:22-&gt;202.116.70.153:60307 (ESTABLISHED)
---
layout: post
title:  "【Supermarket】执行情况计划及进度" 
categories: Blog&amp;CMS Project
tags: Blog&amp;CMS Project
author: LZN
---

* content
{:toc}

2016.5.14执行计划应完成
<ul>
	<li>逐日客流时间序列（四门店同图）</li>
	<li>小波分析其中一两店，给出图</li>
	<li>平均周变化
<ul>
	<li>排除节假日调休的周变化，如果来得及</li>
	<li>排除超过1个标准差的周变化，如果来得及</li>
</ul>
</li>
	<li>平均日变化
<ul>
	<li>工作日和周末各自的日变化<span id="transmark" style="display: none; width: 0px; height: 0px;"></span></li>
</ul>
</li>
	<li>尝试套用ARIMA模型进行预测</li>
</ul>
下一步计划：
<ul>
	<li>特殊事件因子
<ul>
	<li>法定节假日及调休</li>
	<li>高温热浪、强降水、寒潮</li>
	<li>促销活动</li>
</ul>
</li>
</ul>
---
layout: post
title:  "【python】matplotlib配置文件" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

开始用python画图啦，发现matplotlib功能强大到令人发指，ug整整两千多页！我了个去！除了地图数据可能不及NCL强大，一般性的line bar等等图画起来简直是炫爆了。

有相应的配置文件可以设置默认样式，寻找配置文件可以先import matplotlib，然后

[1] matplotlib.matplotlib_fname()

可以找到相应的配置文件路径。
---
layout: post
title:  "Linux下切换shell环境" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

默认为bash，支持的环境存储在

/etc/shells,vi可以查看。

若切换，用chsh命令，有问题，ypchsh命令。

重新登录tty后生效。
---
layout: post
title:  "【CESM】couple the SP-CAM with POP" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

试图将SP-CAM和POP耦合起来，依然采用修改env_build atm physics的方式进行，build到链接一步出错，居然是CRM下有module名和POP下重名。（moudule grid）

找到相应module改名，sed查找所有use module的地方改名，修改module定义的源文件名，build，done！
---
layout: post
title:  "Ehn-Nature-2014" 
categories: PaperReading 2016
tags: PaperReading 2016
author: LZN
---

* content
{:toc}

<h4><span style="color: #339966;"><strong>2016/09/22</strong></span></h4>
<pre><strong>题目：A large source of low-volatility secondary organic aerosol</strong>
<strong>原文：<a href="http://202.116.70.21/L_Zealot/workspace/paperhub/warehouse/Ehn-Nature-2014-506_7489_476-479.pdf">Ehn-Nature-2014-506_7489_476-479.pdf</a></strong></pre>
<strong>笔记：</strong>森林会释放大量的VOC，其氧化产物可以形成SOA.SOA会通过直接辐射效应和充当云凝结核来影响气候，但是其来源依然不清楚。通过模拟大气环境的箱试验，来探究terpene的是氧化。发现一条直接的反应路径：尤其对于monoterpenes，会反应成低挥发性的vapours。这些气态的vapour不可逆地沉积到气溶胶表面形成SOA。这可以帮助解释为什么观测的SOA和模拟之间存在巨大差异。

Possible questions:

1. Could you explain more about the chamber experiment? How did they set up the experiment?

2. What is the particular process of SOA formation by vapour condensation?

&nbsp;

&nbsp;

萜烯：terpene， 是一系列萜类化合物的总称，是分子式为异戊二烯的整数倍的烯烃类化合物。萜烯是一类广泛存在于植物体内的天然来源碳氢化合物，可从许多植物，特别是针叶树得到。它是树脂以及由树脂而来的松节油的主要成分。根据近年来的研究，除了在植物中大量存在萜类化合物外，在海洋生物体内也提取出了大量的萜类化合物，据统计，目前已知的萜类化合物的总数超过了22000种。

&nbsp;
---
layout: post
title:  "Mollner-Science-2010" 
categories: PaperReading 2016
tags: PaperReading 2016
author: LZN
---

* content
{:toc}

<h4><span style="color: #339966;"><strong>2016/10/02</strong></span></h4>
<pre><strong>题目：Rate of Gas Phase Association of Hydroxyl Radical and Nitrogen Dioxide</strong>
<strong>原文：<a href="http://202.116.70.21/L_Zealot/workspace/paperhub/warehouse/Mollner-Science-2010-330_6004_646-649.pdf">Mollner-Science-2010-330_6004_646-649.pdf</a></strong></pre>
<strong>内容概述：</strong>氢氧自由基（Hydroxyl Radical）和NO2（Nitrogen Dioxide）反应生成气态硝酸这一过程是大气化学中最具影响的反应。但是目前关于这一反应在对流层内条件下速率的测量依然研究不足，主要原因是 1. 实验室测量760torr（毫米汞柱）气压下反应速率的困难 2. 该反应存在的二次反应通道，产物：过氧亚硝酸（peroxynitrous）量。更加加剧了测量的不确定性。研究者结合了两种激光光谱学（Spectroscopy）技术来测量两个反应通道的总速率以及在25摄氏度，760毫米汞柱下的反应分配比例。结果相比于（之前的）反应常数，当然是更准确啦，所以我们将测量的东西拿到model里去试了一下对洛杉矶地区Ozone的预报模拟，结果我猜肯定是更好啦。

<strong>笔记：</strong>文章思路很简单，就是把之前没测准的东西想个办法测准了，然后用model测试了下，挺好。所以他们主要想装逼的是：用了牛逼方法搞定了之前大家搞不定的技术难题。反正就是测量反应速率里的系数k，说了一堆看似高端的原理机制，也就是这么一回事。Fig S1里他们设计的高端实验机器系统那张图可以说下，反正不懂，可以留给老师解释下那些仪器是搞什么鬼的……大概意思是用个泵抽气，然后对着气放了两道（浅蓝和深蓝）激光，之后分析这两道激光散射光谱确定物质的量，进一步确定反应速率常数。

图1示意了这两个channel反应，图1上面的文字介绍了分支反应的特殊特点：在较低的压力下，过氧亚硝酸的生成是个小分支，但是随着气压增大，分支率增大。随后一段引出目前矛盾：实验室测定这一反应速率系数的时候，只是测定NO2存在下OH的减小，因此只是测定的分支1+分支2反应的总系数。（k1=k1a+k1b）

之后的段落阐述了困难的两个方面。

&nbsp;

图2对比了作者的牛逼方法测量的结果和之前几个组织（有个JPL，喷气动力实验室，加州理工的实验室，曾经很牛逼，钱学森在的时候）的结果，这张图很容易看啦。反正就是他们测得k1小，误差小；阿尔法系数他们独一无二的给出来了，k1a测量情况有点像JPL 2000.

之后他们用自己测量的系数去模拟南加州的正午ozone污染，A是JPL2006推荐的，B是他们测得，C是被吐槽的IUPAC推荐的高k1a模拟结果，（注意他们没有观测图呢）。总之他们强调k1a小10%，ozone浓度提高10%（这就说明他们准么？难道模拟O3从来就是偏低的？）。我觉得这篇文章最大不足就是没有观测对比呀，宝宝要提出来！

&nbsp;

背景知识：化学反应速率

发现高中的东西全忘了 = =

维基百科复习下：https://zh.wikipedia.org/wiki/%E9%80%9F%E7%8E%87%E6%96%B9%E7%A8%8B

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2016/10/139718010280082228.jpg"><img class="alignnone wp-image-866 size-full" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2016/10/139718010280082228-e1476131794502.jpg" alt="139718010280082228" width="1280" height="948" /><span id="transmark" style="display: none; width: 0px; height: 0px;"></span></a>

&nbsp;
---
layout: post
title:  "大浦仔租房" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

好资源，清水湾论坛：http://msss.ust.hk/forum/
<ul>
	<li><strong><a href="http://msss.ust.hk/forum/thread-27822.html">大浦仔短租，宝宝如果这几天真受不了可以联系下问问，注意不是微信，应该是WhatsApp的电话号码</a></strong>
<ul>
	<li>大埔仔下村1F单人间，自带阳台晾衣方便，步行科大5min，含洗衣机、冰箱、微波炉，整套房子常住2人，所以非常自由，舍友人非常好
价格：3400或200/天包水电 时间：10月起租 联系<strong>WhatsApp： 5536 9881</strong></li>
</ul>
</li>
	<li><strong><a href="http://msss.ust.hk/forum/thread-28001.html">大浦仔，房间小点，可能有点旧，看起来还行（有图）</a></strong>
<ul>
	<li>代房东出租大埔仔下村近7-11位于2F(三楼)有窗单间，房内有全新床，电脑桌，储物柜，空调。公共厨卫大露台，新装修环境整洁，洗衣机冰箱微波炉齐全。月租3800包水电网，押一付一，中介费全​免。

10月20日起租，有意请联络本人(注明租房)：
<strong>QQ: 151711797, WeChat: 151711797, 电话: 60450344</strong></li>
</ul>
</li>
	<li><a href="http://msss.ust.hk/forum/thread-27977.html"><strong>这个养了六只猫……</strong></a>
<ul>
	<li>大埔仔下村有住家式单人女子房租，租金全包，全屋一女子和六隻猫猫，有意<strong>Q Q3169546515</strong></li>
</ul>
</li>
</ul>
<ul>
	<li><a href="http://msss.ust.hk/forum/thread-27971.html"><strong>这个感觉不错，就是稍微贵了点(有图)<span id="transmark" style="display: none; width: 0px; height: 0px;"></span></strong></a>
<ul>
	<li>楼主科大PhD即将毕业，故将现在住的单间转租。
房间位于大埔仔上村，就在711对面的方位（但不临街，不会被汽车噪音打扰到），非常靠近大埔仔小巴站，地理位置优越。
房间内装有冷气机及风扇。洗衣机，冰箱，微波炉，晾衣架是公用，另外还有抽湿机和吸尘器。这家还带一个大院子，有充足的晾衣架，晾晒衣服也非常方便。此外，房东夫妇在科大工作，也住在大埔仔，非常的热心。有任何问题都可以随时联系房东，而且一般当天或第二天就能解决。楼主住的一年内房东就先后把洗衣机，微波炉，冰箱，抽湿机全部换成了新的，方便我们使用。而且，卫生间和其他公共空间房东会定期过来打扫倒垃圾，所以住户完全不需要操心。
我住的这个单间月租4100，水电网全包，房间内设施齐全，储物空间充足，拎包入住即可（具体情况请看照片）。并且墙是石墙，不是后来隔出来的那种，隔音效果好。房间11月起租（楼主会在10月底搬走），长短租皆可（短租的话按月计算）。同住的都是在科大读书的女生，作息规律且安静。</li>
</ul>
</li>
</ul>
---
layout: post
title:  "SMOKE-learn" 
categories: AirQualityModeling
tags: AirQualityModeling
author: LZN
---

* content
{:toc}

HKUST使用空间查看：

quota -uvs huangyeq<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

&nbsp;

Assign files是一堆设置环境变量的文件。

SMKROOT

&nbsp;

&nbsp;
---
layout: post
title:  "Mac OS终端与Linux终端的使用区别" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

John给了组里Mac Mini的账号，后面确实要开始用Mac工作了，先把NCL配置好，使用过程中发现了一些和Linux终端不同的地方，配置过程记录在这里：

1.登录终端后默认载入环境变量的位置不同：Mac为.bash_profile，Linux为.bashrc

2.配置终端显示颜色：

alias ls='ls -G'

http://www.2cto.com/os/201205/133944.html

3.配置vim

git clone https://github.com/Novarizark/config_files

4. git clone project

5. 按NCL官网 http://ncl.ucar.edu/Download/macosx.shtml 步骤安装NCL

5.1  注意登录时看到remote server禁止x11访问，

WARNING! The remote SSH server rejected X11 forwarding request

调整xhost发现似乎有错误，应该是有东西没装，先不管。

5.2 安装XQuartz，

Mac下用curl命令下载，格式

<strong>curl -o 文件名 ‘url’</strong>

<strong>curl -O 'url'</strong>

https://cnbin.github.io/blog/2015/06/14/mac-os-zhong-duan-xia-shi-yong-curl-ming-ling-xia-zai-wen-jian/<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

gcc与gfortran出现错误用brew doctor解决。

&nbsp;

&nbsp;

&nbsp;

&nbsp;

&nbsp;
---
layout: post
title:  "Fortran direct recl problem" 
categories: Fortran
tags: Fortran
author: LZN
---

* content
{:toc}

recl = n or recl = 4*n?

this is a problem from a non-standard extensions of fortran: VMS fortran.<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

http://www-mipl.jpl.nasa.gov/portguide/subsection3.9.7.html

https://docs.oracle.com/cd/E19957-01/805-4939/6j4m0vnct/index.html#c40004b91a0e

&nbsp;

typically, using ifort, dont do that.
---
layout: post
title:  "Externalities and the Coase Theorem" 
categories: Ecnomics
tags: Ecnomics
author: LZN
---

* content
{:toc}

Coursera

The price changes, the quantity of the demand changes, not the demand change!

compliment of xxx / complementary good互补品

Change in demand: demand curve change!

inferior good 低档商品
<h2><span class="keyword">ceteris paribus其他条件不变<span id="transmark" style="display: none; width: 0px; height: 0px;"></span></span></h2>
<ul>
	<li></li>
	<li>Externalities
<ul>
	<li>Positive
<ul>
	<li>Example: Education</li>
</ul>
</li>
	<li>Negative
<ul>
	<li>Example: Pollution</li>
	<li>Measure Example: Pigouivain tax--&gt;Pareto Optimality</li>
</ul>
</li>
</ul>
</li>
</ul>
&nbsp;
<ul>
	<li>Coase theorem
<ul>
	<li>
<div class="para"><a href="http://baike.baidu.com/view/298321.htm" target="_blank">科斯</a>定理的两个前提条件：明确<a href="http://baike.baidu.com/view/73580.htm" target="_blank">产权</a>和<a href="http://baike.baidu.com/view/45349.htm" target="_blank">交易成本</a>　钢铁厂生产钢，自己付出的代价是铁矿石、煤炭、劳动等，但这些只是“<a href="http://baike.baidu.com/view/354998.htm" target="_blank">私人成本</a>”；在<a href="http://baike.baidu.com/view/610395.htm" target="_blank">生产过程</a>中排放的污水、废气、废渣，则是社会付出的代价。如果仅计算私人成本，生产钢铁也许是合算的，但如果从社会的角度看，可能就不合算了。于是，经济学家提出要通过征税解决这个问题，即政府出面干预，赋税使得成本高了，生产量自然会小些。但是，恰当地规定税率和有效地征税，也要花费许多成本。于是，科斯提出：政府只要明确产权就可以了。如果把产权“判给”河边居民，钢铁厂不给居民们赔偿费就别想在此设厂开工；若付出了赔偿费，成本高了，产量就会减少。如果把<a href="http://baike.baidu.com/view/109544.htm" target="_blank">产权界定</a>到钢铁厂，如果居民认为付给钢铁厂一些“赎金”可以使其减少污染，由此换来健康上的好处大于那些赎金的价值，他们就会用“收买”的办法“利诱”厂方减少生产从而减少污染。当厂家多生产钢铁的<a href="http://baike.baidu.com/view/297033.htm" target="_blank">赢利</a>与少生产钢铁但接受“赎买”的收益相等时，它就会减少生产。从理论上说，无论是厂方赔偿，还是居民赎买，最后达成交易时的钢产量和污染排放量会是相同的。但是，<a href="http://baike.baidu.com/view/73580.htm" target="_blank">产权</a>归属不同，在<a href="http://baike.baidu.com/view/9601472.htm" target="_blank">收入分配</a>上当然是不同的：谁得到了产权，谁可以从中获益，而另一方则必须支付费用来“收买”对方。<strong>总之，无论财富分配如何不同，公平与否，只要划分得清楚，资源的利用和配置是相同的——都会生产那么多钢铁、排放那么多污染，而用不着政府从中“插一杠子”。那么政府做什么呢?明确产权，并且有效地保护产权。</strong></div>
<div class="para"><a href="http://baike.baidu.com/view/298321.htm" target="_blank">科斯</a>定理表明，<strong>市场的真谛不是价格，而是产权。只要有了产权，人们自然会“议出”合理的价格来。</strong></div>
<div class="para"></div>
<div class="para">但是，明确产权只是通过市场交易实现资源最优配置的一个必要条件，却不是充分条件。另一个必要条件就是“不存在<a href="http://baike.baidu.com/view/45349.htm" target="_blank">交易成本</a>”。交易成本，简单地说是为达成一项交易、做成一笔买卖所要付出的时间、精力和产品之外的金钱，如市场调查、情报搜集、质量检验、条件谈判、讨价还价、起草合同、聘请律师、请客吃饭，直到最后执行合同、完成一笔交易，都是费时费力的。就河水污染这个问题而论，居民有权索偿，但可能会漫天要价，把污染造成的“肠炎”说成“胃癌”；在钢铁厂有权索要“赎买金”的情况下，它可能把减少生产的<a href="http://baike.baidu.com/view/654238.htm" target="_blank">损失</a>一元说成十元。无论哪种情况，对方都要调查研究一番。如果只是一家工厂和一户居民，事情还好办。当事人的数目一大，麻烦就更多，因为有了“合理分担”的问题。如果是多个厂家，谁排了污水、排了多少，他们如何分摊赔偿金或如何分享“赎买金”就要先扯皮一番；如果是多户居民，谁受害重谁受害轻，怎么分担费用或分享赔偿，也可打得不可开交。正是这些<a href="http://baike.baidu.com/view/45349.htm" target="_blank">交易成本</a>，可能使得前面所说的那种由私人交易达到的资源配置无法实现——或是大家一看有这么多麻烦，望而却步。所以说，<a href="http://baike.baidu.com/view/298321.htm" target="_blank">科斯</a>定理的“逆反”形式是：如果存在交易成本，即使<a href="http://baike.baidu.com/view/73580.htm" target="_blank">产权</a>明确，私人间的交易也不能实现资源的最优配置。</div>
<div class="para">科斯定理的两个前提条件各有所指，但并不是完全独立、没有联系。最根本的是明确产权对减少交易成本的决定性作用。产权不明确，后果就是扯皮永远扯不清楚，意味着交易成本无穷大，任何交易都做不成；而<a href="http://baike.baidu.com/view/109544.htm" target="_blank">产权界定</a>得清楚，即使存在交易成本，人们在一方面可以通过交易来解决各种问题，另一方面还可以有效地选择最有利的<a href="http://baike.baidu.com/view/3823397.htm" target="_blank">交易方式</a>，使交易成本最小化。</div></li>
</ul>
</li>
</ul>
&nbsp;
---
layout: post
title:  "Build the server-side SS" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

---
layout: post
title:  "GFDL Spectral Idealized port on SAVIO" 
categories: Linux HPC GFDL_FMS
tags: Linux HPC GFDL_FMS
author: LZN
---

* content
{:toc}

copy and paste to create

<strong>mkmf.template.savio.without_mpi</strong> in ./bin/

change:

FC CC MPI and NetCDF pathes.

in ./full_dynamics, change:

<strong>compile_full_dynamics_on_savio.csh </strong> to fit savio (usually, just change platform name is okay).

when compile, error:
<h5><span style="color: #ff0000;">ifort: error #10031 error: could not write to argument file</span></h5>
google it:

https://software.intel.com/en-us/forums/intel-math-kernel-library/topic/281453
<blockquote>The MKL libraries are in different directories than the compiler runtime and other libraries. By default, the compiler will not search for libraries in the MKL <b>lib</b> directory. Use the <b>-mkl</b> compiler option for simple jobs, and use the MKL Link Line Advisor for more intricate jobs.</blockquote>
When I tried <strong>-mkl</strong> it doesn't work and appeared another error.

Fortunately, when I tried to module load ant TAB it, a module called

<strong>mkl/2013_sp1.4.211</strong>

just came into my eye.

of course, use it! The problem really solved.

&nbsp;

So what is mkl?

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2016/10/Snap1.jpg"><img class="alignnone size-full wp-image-889" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2016/10/Snap1.jpg" alt="snap1" width="672" height="324" /></a><span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

&nbsp;

&nbsp;
---
layout: post
title:  "Setup SAVIO@Berkeley" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

SAVIO is Berkeley's high performance clusters.

http://research-it.berkeley.edu/services/high-performance-computing/user-guide

1. set up vim/project

2.set up existing module

#--------- Load specific modules --------------
module load intel/2013_sp1.4.211
module load openmpi/1.6.5-intel

#module load netcdf/4.3.2-intel-p System admin only provide C++ lib

module load nco/4.4.6-intel-p
module load ncview/2.1.2

3. set up NetCDF

$nf-config --all

$nc-config --all

can be used to check the installation status.

&nbsp;
---
layout: post
title:  "Neptune met with 403 when push to repo" 
categories: Git&amp;GitHub
tags: Git&amp;GitHub
author: LZN
---

* content
{:toc}

I have found that after the attack to DNS servers in the US, gitrefresh operation seems to be blocked. Got the error:

<span style="color: #ff0000;"><strong> error: The requested URL returned error: 403 Forbidden while accessing https://github.com/Novarizark/project/info/refs</strong></span>

<span style="color: #ff0000;"><strong>fatal: HTTP request failed</strong></span>

Then found this in stackoverflow

http://stackoverflow.com/questions/7438313/pushing-to-git-returning-error-code-403-fatal-http-request-failed

change the https method to ssh method really solved the probleme. Although, I am still confused why this problem happens...
---
layout: post
title:  "Mac OS终端下不能用home和end的解决" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

查了下，可以用bash的快捷键解决这个问题，并且bash快捷键适用范围是跨平台的哦

<strong>行首ctrl+A</strong>

<strong>行尾ctrl+E</strong>

记录下其他有用的<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

&nbsp;
<ul>
	<li><strong><code>ctrl+u</code>: 删除光标左边所有</strong></li>
	<li><strong><code>ctrl+k</code>: 删除光标右边所有</strong></li>
	<li><strong><code>ctrl+xx</code>: 行首到当前光标替换</strong></li>
</ul>
&nbsp;

https://github.com/hokein/Wiki/wiki/Bash-Shell%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE
---
layout: post
title:  "vim将包含关键词的多行进行复制替换" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

vim用了三年了，现在还是在基础命令的水平上。

今天用到了个复杂的，记录下：

<strong>复制包含关键字的所有行</strong>

<strong>%g/KeyWord/normal yyGp</strong>

对于包含 KeyWord 的任何行，执行 normal mode 命令：复制此行yy、跳到文件末尾G、粘贴p

<strong>%g/KeyWord/normal yyp</strong>

对于包含 KeyWord 的任何行，执行 normal mode 命令：复制此行yy、粘贴p<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

复制完后替换下一行的关键字（比如通过var1增加var2经常用到）

<strong>:g/\%(^\1$\n\)\@&lt;=\(.*\)$/s/var1/var2/g</strong>

这个命令太复杂了，前面那堆符号啥意思回来再慢慢研究……
---
layout: post
title:  "Porting CAM3 on SAVIO" 
categories: CESM Fortran Software
tags: CESM Fortran Software
author: LZN
---

* content
{:toc}

When porting cam3, in configure process we meet the error like cannot find "ncdf_xxxx"

In fact, this is not a very serious error because we are using brand new netcdf (after 2012 in fact) that it requires <strong>-lnetcdff </strong>to link to fortran lib instead of only <strong>-lnetcdf</strong>

Change the makefile template, search -lnetcdf and append -lnetcdff to it when using FC

http://www.unidata.ucar.edu/support/help/MailArchives/netcdf/msg11396.html

When finishing compiling, use <a href="http://research-it.berkeley.edu/services/high-performance-computing/running-your-jobs">SLURM method</a> to submit the task with openMP configure, get the error
<pre> 18  READ_NAMELIST: Namelist read returns           -1
 19  ENDRUN: called without a message string</pre>
It seems that the model cannot lock the namelist position.

So I've found that the script moved the cam.exe out of the bld dir after compiling. So it maybe the cam exe cannot find the inside namelist file. Actually it is true!

After moving the exe in, another problem occurs
<pre> 18  READ_NAMELIST: Namelist read returns           19
 19  ENDRUN: called without a message string</pre>
What the hell with 19 code??? Google and got this

http://www.ladon.iqfr.csic.es/intel/doc/main_for/mergedProjects/bldaps_for/ug1l_rt_errors.htm
<table>
<tbody>
<tr>
<td></td>
<td><tt><span style="font-size: medium;">severe (19): Invalid reference to variable in NAMELIST input</span></tt>

FOR$IOS_INVREFVAR. One of the following conditions occurred:
<ul>
	<li class="kadov-p">The variable was not a member of the namelist group.</li>
	<li class="kadov-p">An attempt was made to subscript a scalar variable.</li>
	<li class="kadov-p">A subscript of the array variable was out-of-bounds.</li>
	<li class="kadov-p">An array variable was specified with too many or too few subscripts for the variable.</li>
	<li class="kadov-p">An attempt was made to specify a substring of a noncharacter variable or array name.</li>
	<li class="kadov-p">A substring specifier of the character variable was out-of-bounds.</li>
	<li class="kadov-p">A subscript or substring specifier of the variable was not an integer constant.</li>
	<li class="kadov-p">An attempt was made to specify a substring by using an unsubscripted array variable.</li>
</ul>
</td>
</tr>
</tbody>
</table>
It's possibly that some variables cannot be recognized by the exe.

Find it one by one, stop_option and stop_n!!!!

OMG, CAM3 even doesn't have these two namelist variables!

After deleting that and configuring the running period by NELAPSE, the world back to normal.<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

&nbsp;

&nbsp;
---
layout: post
title:  "port smoke on SAVIO" 
categories: Linux AirQualityModeling
tags: Linux AirQualityModeling
author: LZN
---

* content
{:toc}

https://www.cmascenter.org/smoke/documentation/4.0/html/ch12s02.html

1. download

先找到release timeline

https://www.cmascenter.org/download/release_calendar.cfm

找到最新版本，比如我们看到4.0，进入后可以发现下载链接

https://www.cmascenter.org/download/forms/step_1.cfm

https://www.cmascenter.org/help/model_docs/porting_guide.cfm

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2016/10/Snap2.jpg"><img class="alignnone size-full wp-image-906" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2016/10/Snap2.jpg" alt="snap2" width="856" height="257" /></a>

选择好后，进入下载页，下载安装脚本（Installation script）、源码包以及测试例子数据三个内容。（其实他们用github托管哦）

之后follow <strong>12.3（非常重要一章）</strong>进行安装

https://www.cmascenter.org/smoke/documentation/4.0/html/ch12s03.html

设置<code class="filename"><code class="envar">SMK_HOME</code></code>环境变量指向安装路径，可以将安装脚本和压缩包放入同一路径下，将这个路径设置为安装路径。

在smoke_install.csh最前面加入
<pre>setenv SMK_HOME `pwd`</pre>
不需要source，直接csh运行即可。如果顺利编译，会显示
<pre>NOTE: AUTO_DELETE script setting is not set.
      Default is N to not delete I/O API intermediate and output files
Creating inventory list files...
Installation completed successfully.
 
Please follow the instructions in Section 4.3 of the SMOKE User's Manual
to run the nctox test case.
https://www.cmascenter.org/smoke/documentation/4.0/html/</pre>
再后follow 4.3去run测试用例

https://www.cmascenter.org/smoke/documentation/4.0/html/ch04s03.html

出现错误
<pre>mrggrid.abmp.nctox.20050710.us12-nc.log:     *** ERROR ABORT in subroutine MRGGRID</pre>
后来发现执行语句4.0ug里居然少一个！<strong class="userinput"><code><code class="filename">smk_rateperhour_nctox.csh</code></code></strong>

<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>更改后正常。
---
layout: post
title:  "python实际使用中需要注意的问题" 
categories: Python
tags: Python
author: LZN
---

* content
{:toc}

1.最大区别还是在字符串yinyong
<pre>&gt;&gt;&gt;str='abcde'
&gt;&gt;&gt;print str[0:3]
abc</pre>
注意是不包括第4个字符（码标3）的！

2. 格式化输出不定长度格式<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>
<pre>&gt;&gt;&gt;x=5; y=0.34
<strong>&gt;&gt;&gt;print 'hello%*.1f' % (x,y)</strong>
hello  0.3</pre>
&nbsp;
---
layout: post
title:  "Overseas" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

通

lizhenning7

C6H12+as it always

A<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

lzhenning

sorxxxC6H12xxxx

&nbsp;

&nbsp;
---
layout: post
title:  "CMAQ output files" 
categories: AirQualityModeling
tags: AirQualityModeling
author: LZN
---

* content
{:toc}

CMAQ以ACONC为中缀的输出文件中每天有25个时次，非常诡异，经查UG，

CONC为瞬时文件，最常用；

ACONC通常为小时平均文件；

CGRID为restart文件。

经查ncdump，CONC文件TSTEP在第25步<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>输出了第24时次（下一个输出文件起始时刻）的数据，因此读取的时候丢掉最后一个时次即可。

&nbsp;
---
layout: post
title:  "Shell命令删除指定大小文件" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

空文件

find ./ -size 0 | xarg rm

51字节大小文件

find ./ -size 51c | xarg rm
---
layout: post
title:  "POP output file" 
categories: CESM
tags: CESM
author: LZN
---

* content
{:toc}

pop output files are named as pop.h.xxxx, tavg= averaged over certain time period.
<div align="CENTER">
<table border="1" cellpadding="3"><caption><strong>Table:</strong> Current available tavg fields</caption>
<tbody>
<tr>
<td align="LEFT" valign="TOP"><b>Name</b></td>
<td align="LEFT" valign="TOP"><b>Units</b></td>
<td align="LEFT" valign="TOP"><b>Description</b></td>
</tr>
<tr>
<td align="LEFT" valign="TOP">SHF</td>
<td align="LEFT" valign="TOP"><i>W/m<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">Surface Heat Flux</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">SFWF</td>
<td align="LEFT" valign="TOP"><i>mm/day</i></td>
<td align="LEFT" valign="TOP">Surface Freshwater Flux (p-e)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">SSH</td>
<td align="LEFT" valign="TOP"><i>cm</i></td>
<td align="LEFT" valign="TOP">Sea Surface Height</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">H2
(SSH2 in CESM1)</td>
<td align="LEFT" valign="TOP"><i>cm<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">SSH<sup>2</sup></td>
</tr>
<tr>
<td align="LEFT" valign="TOP">H3</td>
<td align="LEFT" valign="TOP">unitless</td>
<td align="LEFT" valign="TOP"><i>(Δ<sub>x</sub>(SSH))<sup>2</sup> + (Δ<sub>y</sub>(SSH))<sup>2</sup></i></td>
</tr>
<tr>
<td align="LEFT" valign="TOP"><strong>TAUX</strong></td>
<td align="LEFT" valign="TOP"><strong><i>dyne/cm<sup>2</sup></i></strong></td>
<td align="LEFT" valign="TOP"><strong>Zonal windstress</strong></td>
</tr>
<tr>
<td align="LEFT" valign="TOP"><strong>TAUY</strong></td>
<td align="LEFT" valign="TOP"><strong><i>dyne/cm<sup>2</sup></i></strong></td>
<td align="LEFT" valign="TOP"><strong>Meridional windstress</strong></td>
</tr>
<tr>
<td align="LEFT" valign="TOP"><strong>UVEL</strong></td>
<td align="LEFT" valign="TOP"><strong><i>cm/s</i></strong></td>
<td align="LEFT" valign="TOP"><strong>Zonal Velocity</strong></td>
</tr>
<tr>
<td align="LEFT" valign="TOP"><strong>VVEL</strong></td>
<td align="LEFT" valign="TOP"><strong><i>cm/s</i></strong></td>
<td align="LEFT" valign="TOP"><strong>Meridional Velocity</strong></td>
</tr>
<tr>
<td align="LEFT" valign="TOP">KE</td>
<td align="LEFT" valign="TOP"><i>cm<sup>2</sup>/s<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">Horizontal Kinetic Energy (U<sup>2</sup> + V<sup>2</sup>)/2</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">TEMP</td>
<td align="LEFT" valign="TOP"><i><sup>o</sup>C</i></td>
<td align="LEFT" valign="TOP">Potential Temperature</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">SALT</td>
<td align="LEFT" valign="TOP"><i>g/g</i></td>
<td align="LEFT" valign="TOP">Salinity</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">TEMP2</td>
<td align="LEFT" valign="TOP"><i><sup>o</sup>C<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">Temperature<sup>2</sup></td>
</tr>
<tr>
<td align="LEFT" valign="TOP">SALT2</td>
<td align="LEFT" valign="TOP"><i>(g/g)<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">Salt<sup>2</sup></td>
</tr>
<tr>
<td align="LEFT" valign="TOP">UET</td>
<td align="LEFT" valign="TOP"><i><sup>o</sup>C/s</i></td>
<td align="LEFT" valign="TOP">East Flux of Heat</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VNT</td>
<td align="LEFT" valign="TOP"><i><sup>o</sup>C/s</i></td>
<td align="LEFT" valign="TOP">North Flux of Heat</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">WTT</td>
<td align="LEFT" valign="TOP"><i><sup>o</sup>C/s</i></td>
<td align="LEFT" valign="TOP">Top Flux of Heat</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">UES</td>
<td align="LEFT" valign="TOP"><i>g/g/s</i></td>
<td align="LEFT" valign="TOP">East Flux of Salt</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VNS</td>
<td align="LEFT" valign="TOP"><i>g/g/s</i></td>
<td align="LEFT" valign="TOP">North Flux of Salt</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">WTS</td>
<td align="LEFT" valign="TOP"><i>g/g/s</i></td>
<td align="LEFT" valign="TOP">Top Flux of Salt</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">UEU</td>
<td align="LEFT" valign="TOP"><i>cm/s<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">East Flux of Zonal Momentum</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VNU</td>
<td align="LEFT" valign="TOP"><i>cm/s<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">North Flux of Zonal Momentum</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">UEV</td>
<td align="LEFT" valign="TOP"><i>cm/s<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">East Flux of Meridional Momentum</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VNV</td>
<td align="LEFT" valign="TOP"><i>cm/s<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">North Flux of Meridional Momentum</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">PV</td>
<td align="LEFT" valign="TOP"><i>1/s</i></td>
<td align="LEFT" valign="TOP">Potential Vorticity</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">Q</td>
<td align="LEFT" valign="TOP"><i>g/cm<sup>4</sup></i></td>
<td align="LEFT" valign="TOP">z-derivative of potential density</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">PD</td>
<td align="LEFT" valign="TOP"><i>g/cm<sup>3</sup></i></td>
<td align="LEFT" valign="TOP">Potential density referenced to surface</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">UDP</td>
<td align="LEFT" valign="TOP"><i>erg</i></td>
<td align="LEFT" valign="TOP">Pressure work</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">PEC</td>
<td align="LEFT" valign="TOP"><i>g/cm<sup>3</sup></i></td>
<td align="LEFT" valign="TOP">Potential energy release due to convection</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">NCNV</td>
<td align="LEFT" valign="TOP"><i>adjustments/s</i></td>
<td align="LEFT" valign="TOP">Convective adjustments per second</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">WTU</td>
<td align="LEFT" valign="TOP"><i>cm/s<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">Top flux of Zonal Momentum</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">WTV</td>
<td align="LEFT" valign="TOP"><i>cm/s<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">Top flux of Meridional Momentum</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">ST</td>
<td align="LEFT" valign="TOP"><i><sup>o</sup>Cg/g</i></td>
<td align="LEFT" valign="TOP">Temperature*Salinity</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">RHO</td>
<td align="LEFT" valign="TOP"><i>g/cm<sup>3</sup></i></td>
<td align="LEFT" valign="TOP">In-situ density</td>
</tr>
</tbody>
</table>
</div>
&nbsp;
<div align="CENTER">
<table style="height: 6452px;" border="1" width="584" cellpadding="3"><caption><strong>Table:</strong> Additional available <b>CESM1</b> tavg fields</caption>
<tbody>
<tr>
<td align="LEFT" valign="TOP"><b>Name</b></td>
<td align="LEFT" valign="TOP"><b>Units</b></td>
<td align="LEFT" valign="TOP"><b>Description</b></td>
</tr>
<tr>
<td align="LEFT" valign="TOP">QFLUX</td>
<td align="LEFT" valign="TOP"><i>Watts/m<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">Internal Ocean Heat Flux Due to Ice Formation;
heat of fusion &gt; 0 or ice-melting potential &lt; 0</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">BSF</td>
<td align="LEFT" valign="TOP"><i>Sv</i></td>
<td align="LEFT" valign="TOP">Barotropic Stream Function</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">TFW_T</td>
<td align="LEFT" valign="TOP"><i>Watts/m<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">T flux due to freshwater flux</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">TFW_S</td>
<td align="LEFT" valign="TOP"><i>kg/m<sup>2</sup>/s</i></td>
<td align="LEFT" valign="TOP">S flux due to freshwater flux (kg of salt/m^2/s)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">RESID_T</td>
<td align="LEFT" valign="TOP"><i>Watts/m<sup>2</sup> </i></td>
<td align="LEFT" valign="TOP">Free-Surface Residual Flux (T)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">RESID_S</td>
<td align="LEFT" valign="TOP"><i>kg/m<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Free-Surface Residual Flux (S)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">QSW_HTP</td>
<td align="LEFT" valign="TOP"><i>Watts/m<sup>2</sup> </i></td>
<td align="LEFT" valign="TOP">Solar Short-Wave Heat Flux in top layer</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">QSW_HBL</td>
<td align="LEFT" valign="TOP"><i>Watts/m<sup>2</sup> </i></td>
<td align="LEFT" valign="TOP">Solar Short-Wave Heat Flux in boundary layer</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">SHF_QSW</td>
<td align="LEFT" valign="TOP"><i>Watts/m<sup>2</sup> </i></td>
<td align="LEFT" valign="TOP">Solar Short-Wave Heat Flux</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">PREC_F</td>
<td align="LEFT" valign="TOP"><i> kg/m<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Precipitation Flux from Coupler (rain+snow)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">SNOW_F</td>
<td align="LEFT" valign="TOP"><i> kg/m<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Snow Flux from Coupler</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">EVAP_F</td>
<td align="LEFT" valign="TOP"><i> kg/m<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Evaporation Flux from Coupler</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">MELT_F</td>
<td align="LEFT" valign="TOP"><i> kg/m<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Melt Flux from Coupler</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">ROFF_F</td>
<td align="LEFT" valign="TOP"><i> kg/m<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Runoff Flux from Coupler</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">IOFF_F</td>
<td align="LEFT" valign="TOP"><i> kg/m<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Ice Flux from Coupler due to Land-Model Snow Capping</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">SALT_F</td>
<td align="LEFT" valign="TOP"><i> kg/m<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Salt Flux from Coupler (kg of salt/m^2/s)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">SENH_F</td>
<td align="LEFT" valign="TOP"><i> kg/m<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Sensible Heat Flux from Coupler</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">LWUP_F</td>
<td align="LEFT" valign="TOP"><i> Watts/m<sup>2</sup> </i></td>
<td align="LEFT" valign="TOP">Longwave Heat Flux (up) from Coupler</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">LWDN_F</td>
<td align="LEFT" valign="TOP"><i> Watts/m<sup>2</sup> </i></td>
<td align="LEFT" valign="TOP">Longwave Heat Flux (down) from Coupler</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">MELTH_F</td>
<td align="LEFT" valign="TOP"><i> Watts/m<sup>2</sup> </i></td>
<td align="LEFT" valign="TOP">Melt Heat Flux from Coupler</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">IFRAC</td>
<td align="LEFT" valign="TOP"><i> unitless fraction </i></td>
<td align="LEFT" valign="TOP">Ice Fraction from Coupler</td>
</tr>
<tr>
<td align="LEFT" valign="TOP"><strong>HMXL and</strong>
<strong> HMXL_2</strong></td>
<td align="LEFT" valign="TOP"><strong><i> cm </i></strong></td>
<td align="LEFT" valign="TOP"><strong>Mixed-Layer Depth<span id="transmark" style="display: none; width: 0px; height: 0px;"></span></strong></td>
</tr>
<tr>
<td align="LEFT" valign="TOP">XMXL and
XMXL_2</td>
<td align="LEFT" valign="TOP"><i> cm </i></td>
<td align="LEFT" valign="TOP">Maximum Mixed-Layer Depth</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">TMXL</td>
<td align="LEFT" valign="TOP"><i> cm </i></td>
<td align="LEFT" valign="TOP">Minimum Mixed-Layer Depth</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">HBLT</td>
<td align="LEFT" valign="TOP"><i> cm </i></td>
<td align="LEFT" valign="TOP">Boundary-Layer Depth</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">XBLT</td>
<td align="LEFT" valign="TOP"><i> cm </i></td>
<td align="LEFT" valign="TOP">Maximum Boundary-Layer Depth</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">TBLT</td>
<td align="LEFT" valign="TOP"><i> cm </i></td>
<td align="LEFT" valign="TOP">Minimum Boundary-Layer Depth</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">FW</td>
<td align="LEFT" valign="TOP"><i> cm/s </i></td>
<td align="LEFT" valign="TOP">Freshwater Flux</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">ADVT</td>
<td align="LEFT" valign="TOP"><i> cm/<sup>o</sup>C/s </i></td>
<td align="LEFT" valign="TOP">Vertically-Integrated T Advection Tendency</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">ADVS</td>
<td align="LEFT" valign="TOP"><i>cm g/km/s </i></td>
<td align="LEFT" valign="TOP">Vertically-Integrated S Advection Tendency</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">dTEMP_POS_2D</td>
<td align="LEFT" valign="TOP"><i> <sup>o</sup>C </i></td>
<td align="LEFT" valign="TOP">max positive column temperature timestep diff</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">dTEMP_NEG_2D</td>
<td align="LEFT" valign="TOP"><i> <sup>o</sup>C </i></td>
<td align="LEFT" valign="TOP">max negative column temperature timestep diff</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">KAPPA_ISOP</td>
<td align="LEFT" valign="TOP"><i> cm<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Isopycnal diffusion coefficient</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">KAPPA_THIC</td>
<td align="LEFT" valign="TOP"><i> cm<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Thickness diffusion coefficient</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">HOR_DIFF</td>
<td align="LEFT" valign="TOP"><i> cm<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Horizontal diffusion coefficient</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">DIA_DEPTH</td>
<td align="LEFT" valign="TOP"><i>cm </i></td>
<td align="LEFT" valign="TOP">Depth of the Diabatic Region at the Surface</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">TLT</td>
<td align="LEFT" valign="TOP"><i> cm </i></td>
<td align="LEFT" valign="TOP">Transition Layer Thickness</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">INT_DEPTH</td>
<td align="LEFT" valign="TOP"><i> cm </i></td>
<td align="LEFT" valign="TOP">Depth at which the Interior Region Starts</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">UISOP</td>
<td align="LEFT" valign="TOP"><i>cm/s </i></td>
<td align="LEFT" valign="TOP">Bolus Velocity in grid-x direction (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VISOP</td>
<td align="LEFT" valign="TOP"><i>cm/s </i></td>
<td align="LEFT" valign="TOP">Bolus Velocity in grid-y direction (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">WISOP</td>
<td align="LEFT" valign="TOP"><i>cm/s </i></td>
<td align="LEFT" valign="TOP">Vertical Bolus Velocity (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">ADVT_ISOP</td>
<td align="LEFT" valign="TOP"><i> cm/<sup>o</sup>C/s </i></td>
<td align="LEFT" valign="TOP">Vertically-Integrated T Eddy-Induced Advection Tendency (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">ADVS_ISOP</td>
<td align="LEFT" valign="TOP"><i>cm g/km/s </i></td>
<td align="LEFT" valign="TOP">Vertically-Integrated S Eddy-Induced Advection Tendency (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VNT_ISOP</td>
<td align="LEFT" valign="TOP"><i><sup>o</sup>C/s </i></td>
<td align="LEFT" valign="TOP">Heat Flux Tendency in grid-y Dir due to Eddy-Induced Vel (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VNS_ISOP</td>
<td align="LEFT" valign="TOP"><i>g/km/s </i></td>
<td align="LEFT" valign="TOP">Salt Flux Tendency in grid-y Dir due to Eddy-Induced Vel (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">KVMIX</td>
<td align="LEFT" valign="TOP"><i> cm<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Vertical diabatic diffusivity due to background
or Tidal Mixing + background</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">KVMIX_M</td>
<td align="LEFT" valign="TOP"><i> cm<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Vertical viscosity due to background
or Tidal Mixing + background</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">TPOWER</td>
<td align="LEFT" valign="TOP"><i>erg/s </i></td>
<td align="LEFT" valign="TOP">Energy Used by Vertical Mixing</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VVC_BCK</td>
<td align="LEFT" valign="TOP"><i> cm<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Vertical viscosity due to background</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">USUBM</td>
<td align="LEFT" valign="TOP"><i>cm/s </i></td>
<td align="LEFT" valign="TOP">Submeso velocity in grid-x direction (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VSUBM</td>
<td align="LEFT" valign="TOP"><i>cm/s </i></td>
<td align="LEFT" valign="TOP">Submeso velocity in grid-y direction (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">WSUBM</td>
<td align="LEFT" valign="TOP"><i>cm/s </i></td>
<td align="LEFT" valign="TOP">Vertical submeso velocity (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">ADVT_SUBM</td>
<td align="LEFT" valign="TOP"><i> cm/<sup>o</sup>C/s </i></td>
<td align="LEFT" valign="TOP">Vertically-Integrated T submeso Advection Tendency (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">ADVS_SUBM</td>
<td align="LEFT" valign="TOP"><i>cm g/km/s </i></td>
<td align="LEFT" valign="TOP">Vertically-Integrated S submeso Advection Tendency (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VNT_SUBM</td>
<td align="LEFT" valign="TOP"><i> <sup>o</sup>C/s </i></td>
<td align="LEFT" valign="TOP">Heat Flux Tendency in grid-y Dir due to submeso Vel (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VNS_SUBM</td>
<td align="LEFT" valign="TOP"><i> <sup>o</sup>C/s </i></td>
<td align="LEFT" valign="TOP">Salt Flux Tendency in grid-y Dir due to submeso Vel (diagnostic)</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">HLS_SUBM</td>
<td align="LEFT" valign="TOP"><i> cm </i></td>
<td align="LEFT" valign="TOP">Horizontal length scale used in submeso</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VDC_T</td>
<td align="LEFT" valign="TOP"><i>cm<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">total diabatic vertical TEMP diffusivity</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VDC_S</td>
<td align="LEFT" valign="TOP"><i>cm<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">total diabatic vertical SALT diffusivity</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">UVEL2</td>
<td align="LEFT" valign="TOP"><i>cm<sup>2</sup>/s<sup>2</sup> </i></td>
<td align="LEFT" valign="TOP">Velocity in grid-x direction</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VVEL2</td>
<td align="LEFT" valign="TOP"><i>cm<sup>2</sup>/s<sup>2</sup> </i></td>
<td align="LEFT" valign="TOP">Velocity in grid-y direction</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">WVEL2</td>
<td align="LEFT" valign="TOP"><i>cm<sup>2</sup>/s<sup>2</sup> </i></td>
<td align="LEFT" valign="TOP">Vertical Velocity<sup>2</sup></td>
</tr>
<tr>
<td align="LEFT" valign="TOP">RHO_VINT</td>
<td align="LEFT" valign="TOP"><i>g/cm<sup>2</sup> </i></td>
<td align="LEFT" valign="TOP">Vertical Integral of In-Situ Density</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">SFWF_WRST</td>
<td align="LEFT" valign="TOP"><i>kg/m<sup>2</sup>/s </i></td>
<td align="LEFT" valign="TOP">Virtual Salt Flux due to weak restoring</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">TAUX2</td>
<td align="LEFT" valign="TOP"><i>dyne<sup>2</sup>/cm<sup>4</sup> </i></td>
<td align="LEFT" valign="TOP">Windstress<sup>2</sup> in grid-x direction</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">TAUY2</td>
<td align="LEFT" valign="TOP"><i>dyne<sup>2</sup>/cm<sup>4</sup> </i></td>
<td align="LEFT" valign="TOP">Windstress<sup>2</sup> in grid-y direction</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">SSH2
(H2 in LANL POP)</td>
<td align="LEFT" valign="TOP"><i>cm<sup>2</sup></i></td>
<td align="LEFT" valign="TOP">SSH<sup>2</sup></td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VVC</td>
<td align="LEFT" valign="TOP"><i>cm<sup>2</sup>/s</i></td>
<td align="LEFT" valign="TOP">total vertical momentum viscosity</td>
</tr>
<tr>
<td align="LEFT" valign="TOP">VDC_BCK</td>
<td align="LEFT" valign="TOP"><i>cm<sup>2</sup>/s</i></td>
<td align="LEFT" valign="TOP">Vertical diabatic diffusivity due to background</td>
</tr>
</tbody>
</table>
</div>
---
layout: post
title:  "Linux提取路径内容" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

提取路径中的文件名 basename $PATH，路径名 dirname $PATH

${}也可以较好实现：<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

${var##*/} 文件名

${var%/*} 路径名

具体参见：

http://blog.csdn.net/ljianhui/article/details/43128465
---
layout: post
title:  "Start with Jupyter notebook" 
categories: Python
tags: Python
author: LZN
---

* content
{:toc}

开始照着youtube和coursera的视频教程正式学习python啦。

command mode: Adding deleting command cells

edit mode

shortcuts:
<p style="padding-left: 30px;"><strong>ctrl+enter:</strong> execute the command and stay there</p>
<p style="padding-left: 30px;"><strong>alt+enter:</strong> execute the command and create one next</p>
<p style="padding-left: 30px;"><strong>shift+enter:</strong> execute and move to the next cell (or create one in the last)</p>
markdown:

change the cell type to markdown type

! prefix means the following command is bash command.

% magic command

&nbsp;
---
layout: post
title:  "移植DART到NERSC" 
categories: Linux CESM
tags: Linux CESM
author: LZN
---

* content
{:toc}

拖了好多天，Inez开始催了……

好吧，先登录，发现集群居然叫Edison，也是醉了。不用说，先把环境配置好。

vim配置好后发现目录没有高亮显示。

DART官网

http://www.image.ucar.edu/DAReS/DART/DART_Starting.php#requirements_simple

download link

https://www2.cisl.ucar.edu/software/dart/download

官网手册，写的还是挺详细的：

http://www.image.ucar.edu/DAReS/DART/DART_Starting.php#fortran90

照着来，改mkmf，和gfdl的那些鬼东西差不多，nersc上fortran编译器连接器对应都是ftn，改好后继续按要求，去work目录下修改mkmf指定脚本，make编译，貌似没问题。

Okay，下一步采用quickbuild编译所有可执行程序，出现错误提示f77找不到。

尝试1：修改template，加入

F77=ftn行，失败，错误没有变化。

尝试2：链接

链接ftn到f77，并加入环境变量，失败：

lzhenn@edison11:~/soft/dart/lanai/models/lorenz_63/work&gt; make
f77 -c ../../../common/types_mod.f90
<strong>Use either: 'cc', 'CC', or 'ftn'.</strong>

ftn这个傻逼wrapper不认f77

ifort也不行，找不到netcdf库

gfortran也是。

坑了，不过就是一个f77链接的问题，一定有办法解决！

回到mkmf目录，蓦然发现一个mkmf.template.nersc文件，什么鬼，应该有个intel中缀才对，突然意识到是不是修改template指向的时候出了问题，检查了一下，果然是……修改后居然编译通过了……

卧槽那为什么出这种奇奇怪怪告诉我找不到f77的问题啊……

都是泪 = =

下一步，验证：

tutorial：

http://www.image.ucar.edu/DAReS/DART/trunk/tutorial/

Lanai版本的instructions

http://www.image.ucar.edu/DAReS/DART/Lanai_release.html

Jan 6, 2017:

上午与Inez和Stephanie讨论了trunk版本的dart，估计回来得搞个移植上，web上有couple CESM的guide，后面还有的搞。停不下来。
---
layout: post
title:  "落寞" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

网易云搜了各个版本的卡农，然后一并播放。

突然发现很久没有认真听音乐了，一边做着认为不属于自己责任内的事情，一边过着卡农，突然感到非常落寞。<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

可能太关注眼前的事情就会变得迷失吧，积极点。
---
layout: post
title:  "关于rm命令查到的一些好玩内容" 
categories: Linux
tags: Linux
author: LZN
---

* content
{:toc}

想找一下禁用rm -rf类命令误删操作的技巧，搜了几个页面，讲Linux下的危险命令挺好玩，记录下面：<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

https://www.oschina.net/news/46657/10-most-dangerous-commands-you-should-never-execute-on-linux

http://www.ha97.com/5172.html

http://www.jianshu.com/p/2de3f6aaa98f

chattr命令很实用。
---
layout: post
title:  "php上传文件限制" 
categories: PHP&amp;mySQL
tags: PHP&amp;mySQL
author: LZN
---

* content
{:toc}

之前团队服务器一直没修改好，后来查了下，有一个限制没搞定。

修改上传限制如下：

/etc/httpd/conf/httpd.conf 阿帕奇服务修改：

LimitRequestBody 52428800<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

php.in修改：

upload_max_filesize = 8m ;望文生意，即允许上传文件大小的最大值。默认为2M
post_max_size = 8m ;指通过表单POST给PHP的所能接收的最大值，包括表单里的所有值。默认为8M

<strong>注意post项目要大于等于upload设定的阈值。</strong>
---
layout: post
title:  "交易日记" 
categories: Notebook Ecnomics
tags: Notebook Ecnomics
author: LZN
---

* content
{:toc}

#170206

<a href="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2017/02/Snap9.jpg"><img class="alignnone size-full wp-image-961" src="https://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2017/02/Snap9.jpg" alt="Snap9" width="1269" height="754" /></a>

30日均线在17年初反转，12日均线持续在30日均线上方。趋势持续？工行多单浮盈近2%，设了上下2元双向挂单。<strong>如趋势持续涨过274元，计划存金宝出1/3（4000元），用于空单投机。</strong>

应该做日尺度上的小波分析，确定关注几日尺度的MA技术指标。<span id="transmark" style="display: none; width: 0px; height: 0px;"></span>

#170208

昨日横盘良久，开了少量美元空单并设置止损（<strong>没有遵循274线！</strong>），没想到当晚就被止损，国际金涨到1240上方。国内现货也到276，但工行纸黄金没有跟涨！少量白银已挂止损单。存金宝计划卖出7g。33g多头继续持仓（抗浮盈）。2g纸黄金抗浮盈。趋势似乎不会轻易反转，适当减仓后，继续持仓持现观望，<strong>做空要慎重！</strong>
---
layout: post
title:  "anaconda下使用pip包" 
categories: Python
tags: Python
author: LZN
---

* content
{:toc}

发现conda下缺少一些pip包，其实用conda自己的pip安装就可以。

anaconda2-4.1.1/bin/pip

也可以把之前版本python的pip包复制过来

/lib/python2.7/site-packages
---
layout: post
title:  "full-stack development [notebook]" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

---
layout: post
title:  "捕捉shell执行的状态码" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

如果采用shell嵌套调用的方式执行一个复杂的自动化脚步，比如编译运行model，编译的过程很容易出错，那么外层脚本应考虑到这个问题并且在编译出错的情况下退出程序。这时上一条命令的状态码就派上用场了。
<pre>if [ $? -eq 0 ]        [$? 就是上一条命令执行的状态码]
        then  
            echo $i
        fi</pre>
---
layout: post
title:  "GFDL MOIST CORE on SAVIO" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

follow the dry core procedure, the first problem we meet is

<strong>#error: unknown fpp directive.</strong>
<p class="p1"><span class="s1">vi /global/home/groups/co_aiolos/models/spec_moist_idl_gfdl_model/src/shared/include/fms_platform.h</span></p>
<p class="p1">and give two space before the first _, done.</p>
<p class="p1">Next, the model was compiled smoothly, when it hit the link process, throw a problem</p>
<p class="p1"><strong><span class="s1">atmos_model.o: In function `atmos_model_init':</span></strong></p>
<p class="p1"><strong><span class="s1">/global/home/groups/co_aiolos/models/spec_moist_idl_gfdl_model/src/atmos_solo/atmos_model.F90:290: undefined reference to `omp_set_num_threads_'</span></strong></p>
<p class="p1">compared  with dry core, comment corresponding lines</p>
<p class="p1"><strong><span class="s1">vi /global/home/groups/co_aiolos/models/spec_moist_idl_gfdl_model/src/atmos_solo/atmos_model.F90</span></strong></p>
<p class="p1">IT WORKS!</p>
<p class="p1"></p>
<p class="p1"></p>
---
layout: post
title:  "Installing node.js on Mac OS" 
categories: MacOS fullstackdevelopment
tags: MacOS fullstackdevelopment
author: LZN
---

* content
{:toc}

<p class="p1"></p>
<p class="p1"></p>
<p class="p1">Node.js was installed at</p>
<p class="p1"><span class="Apple-converted-space">   </span>/usr/local/bin/node</p>
<p class="p1">npm was installed at</p>
<p class="p1"><span class="Apple-converted-space">   </span>/usr/local/bin/npm</p>
<p class="p1">Make sure that /usr/local/bin is in your $PATH.</p>
---
layout: post
title:  "Earth.NullSchool Package test" 
categories: fullstackdevelopment
tags: fullstackdevelopment
author: LZN
---

* content
{:toc}

After setup node.js, follow the instruction to install earth.nullschool

https://github.com/cambecc/earth

install grib2json

https://github.com/cambecc/grib2json

Steps:

1. set JAVA_HOME

http://www.mkyong.com/java/how-to-set-java_home-environment-variable-on-mac-os-x/
<pre class=" language-bash"><code class=" language-bash"><span class="token function">export</span> JAVA_HOME<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>/usr/libexec/java_home<span class="token variable">)</span></span></code></pre>
<p class="p1">brew install maven</p>
https://github.com/cambecc/grib2json/issues/19

&nbsp;

convert:
<pre><code>grib2json<strong> -d -n -o</strong> current-wind-surface-level-gfs-1.0.json gfs.t00z.pgrb2.1p00.f000</code></pre>
<p class="p1"><span class="s1">Error: Unable to access jarfile /Users/zhenningli/workspace/grib2json/src/bin/../lib/grib2json-*.jar</span></p>
You should use the executable in another folder
<p class="p1"><strong><span class="s1">/Users/zhenningli/workspace/grib2json/target/grib2json-0.8.0-SNAPSHOT/bin</span></strong></p>
---
layout: post
title:  "企业集合：招聘大气科学毕业生的工业界职位" 
categories: Living&amp;thinking
tags: Living&amp;thinking
author: LZN
---

* content
{:toc}

远景能源

坐标：上海

核心业务：智能风机

印象：行业内一线企业，技术优势明显，员工待遇高（2015）

招聘实例

<strong>工作内容：</strong>
1、 负责提升数值气象模式对于风速模拟、预报的准确性；
2、 负责推动中尺度数据在风场设计中的应用。

<strong>职位要求：</strong>
1、大气科学类硕士及以上学历；
2、专业知识扎实，对大气动力学有深入理解以及很强的应用能力；
3、熟练掌握Linux系统操作命令和Shell编程，熟练运用WRF模式，有模式动力或资料同化科研经历者优先；
4、至少熟练掌握MATLAB、NCL等数据处理工具中的一种 ，掌握常见机器学习算法(如Neural Network, SVM等)者优先。

http://recruit.envisioncn.com/join_us/position

http://www.envisioncn.com/

明阳风电
<table class="job_info" border="0" width="100%" cellspacing="0">
<tbody>
<tr>
<td class="job_info1" width="15%">计算流体力学工程师</td>
<td width="24%">计算流体力学/动力学/大气科学</td>
</tr>
</tbody>
</table>
http://www.mywind.com.cn/

国睿集团

http://www.glarun.com/company.asp
---
layout: post
title:  "原油投机" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

NASDAQ OIL

仓位：1200*0.7=840

开仓：300 @ 5.00

止损：4.80

第一加仓位：5.20 止损提升至5.05

止盈：6.0
---
layout: post
title:  "团队服务器升级ssh" 
categories: Linux Internet
tags: Linux Internet
author: LZN
---

* content
{:toc}

注意先解决依赖关系，编译参数如下：

./configure --sysconfdir=/etc/ssh  --with-zlib --with-md5-passwords

make

make install

然后重启sshd服务，基本没什么大问题。

后发现X11 forwarding不可用，调整/etc/sshd_config X11Forwarding为yes还是不行。

最后发现之前删掉了hosts文件，加入

127.0.0.1 localhost.locoldoman localhost

后成功
---
layout: post
title:  "团队服务器升级php" 
categories: Blog&amp;CMS PHP&amp;mySQL
tags: Blog&amp;CMS PHP&amp;mySQL
author: LZN
---

* content
{:toc}

注意先卸载php与依赖关系，然后改用remi的yum源，直接yum install高版本php和所有的依赖包即可。
---
layout: post
title:  "Porting CESM1.2.2 on SAVIO" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

When move all the code from HPC4 to savio, and config all machine related environmental variables, the create_newcase got the error:
<p class="p1"><strong><span class="s1">The perl module XML::LibXML is needed for XML parsing in the CESM script system</span></strong></p>
<p class="p1">search</p>
https://bb.cgd.ucar.edu/warning-cesm122

cesm_setup后出现新错误

<strong>gmake: c: Command not found</strong>

https://bb.cgd.ucar.edu/porting-cesm-120-local-cluster-linux-intel-or-pgi125表示增加几个flag即可，后对比Macro文件发现少很多东西。

原来 config_machine.xml中

&lt;COMPILERS&gt;intel14&lt;/COMPILERS&gt;

我写成intel13在config_compiler的时候找不到标的。换成intel后即可。

后到最后连接过程出现错误

ld: cannot find -lrefblas

找不到库文件，经查为lapack的一个lib flag。需要重命名之。
---
layout: post
title:  "AWS EC2搭建VPS" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

起名为Razortail，剃刀之尾，继续纪念我的D2青春。

私钥需要好好保存。

按这里的来：http://celerysoft.github.io/2016-01-15.html

configure ss出问题，asciidoc找不到，挂--disable-documentation参数。

之后又出现

configure: error: Couldn't find libudns. Try installing libudns-dev or udns-devel

错误，看起来还是缺库，尝试yum安装，发现找不到这个lib。尝试添加remi的yum源：

https://rpms.remirepo.net/wizard/

重新尝试了centos7情景下先安装的yum库

https://www.ifshow.com/centos-7-installation-and-configuration-shadowsocks/

成功configure！

安装后，运行ss-server出现libsodium.so.18 库找不到，从lib下ln到lib64解决，运行出现问题

2017-07-03 14:34:01 ERROR: bind: Cannot assign requested address

经查，居然要把config文件的ip设置为0.0.0.0，无语。

之后可用，启动服务即可。
<pre>systemctl start ss.service
systemctl enable ss.service</pre>
停止服务：
<pre>systemctl stop ss.service</pre>
取消shadowsocks开机自启
<pre>systemctl disable ss.service</pre>
查看日志文件
<pre>less /var/log/shadowsocks.log</pre>
---
layout: post
title:  "porting DART on CORI" 
categories: Linux CESM HPC
tags: Linux CESM HPC
author: LZN
---

* content
{:toc}

When porting DART on CORI, the compiling process of CESM got error:

cannot find -lmemkind
<pre>I checked my error log and found that the compiler cannot find some libraries. After loading memkind, the CESM component can be compiled successfully. It's strange because I cannot find command line like "<strong>module load memkind</strong>" in your related config files. I am working forward and will inform you later.</pre>
<div>After building, when trying to run the model, got segment fault.</div>
&nbsp;
---
layout: post
title:  "客观定量的人生目标" 
categories: Blog&amp;CMS
tags: Blog&amp;CMS
author: LZN
---

* content
{:toc}

可能这一两年一直是一个低谷，最近更是觉得得过且过有何不好？果然迷茫的时候就要看书，李笑来《把时间当作朋友》给了我一些启示。人可以反思。

不应该浑浑噩噩下去，要给自己个理由，或许是应该给自己人生找个意义，因为浑浑噩噩过，尽管舒适懒散，但精神确实是空虚的，而且，比较，peer pressure，并不让人舒适。

所以反思到这点，我想这一低谷或许应该结束了。但我需要给自己一个定量的目标来说服自己，我的欲望，实现到那种程度算是合格呢？今天拿最赤裸裸的来说，财富，金钱。我应该达到怎样的目标算合适呢？

洗澡的时候突然想到，用我的高考成绩排序啊！对哦！有定量的结果，正态分布的成绩结果，自评也是正常（应该说尽力）发挥拿到的理想中的成绩。我自己估分的时候还低估了自己呢！那我理应在所有的正态分布当中，处于与高考成绩相似的地位，作为我的奋斗目标才是合理的！

那么当年的高考情况是怎样呢？

当年652的成绩，按分段表线性插值估算，我的排位应该在2600名左右，全年山东省共有65.6万人，那么我应该处于top 0.40%的位置<strong><span style="color: #ff0000;">（估算有误，见修改）</span></strong>，差不多是250-300人里选一的位置。

假定社会财富分配的总量及任意子集都满足2-8定律幂律分布，根据

&nbsp;
<blockquote><strong>高淨值人士是可投資資產超過1000萬人民幣的個人。</strong>招商银行与贝恩公司（BAIN）的数据，2016年中国高净值人士有158万人，预计2017年底有 187万 人。按照国家统计局最新公布的中国大陆总人口数测算（138271万，不包括港澳台），到今年底，平均100万人有135个高净值人士，比万里挑一的比例略高一些。

什么是可投资资产？它是指金融资产加上非自住的投资性房产。金融资产包括：现金、存款、股票、债券、基金（含专户）、保险、银行理财、黄金、互联网金融、信托、券商资管、私募股权，等等。</blockquote>
我们认为可投资资产应该是处于总资产与净资产之间的一物，因为富人总会融资。2017年拥有1000万以上可投资人民币的个人比例是：<strong>0.135%</strong>
<blockquote>按照招商银行与贝恩公司的报告，2016年他们一共拥有49万亿人民币的可投资资产，相当于人均拥有3100万元可投资资产。预计到2017年底，他们持有的可投资资产规模将达58万亿人民币，人均拥有3670万元可投资资产。

由于2016年全国个人持有的可投资资产总规模为165万亿元，不难算出，高净值人士资产占全国个人资产总量的29.7%。</blockquote>
设财富分布幂律为

W(x)=k*e^(cx)

其中x是分位点，W为总财富

最终需要<a href="https://www.wolframalpha.com">求解超越方程</a>

k=9.826e-7

c=20.7688

最终财富需要<strong>946.450万元 </strong>

好吧，计入3%通胀，按我目前可投资资产为20万人民币。希望能在60岁前实现的话，列表如下.
<table width="744">
<tbody>
<tr>
<td width="72">年份</td>
<td width="72">年龄</td>
<td width="99">目标财富</td>
<td width="237">达到目标年复合增长率（20万起）</td>
<td width="264">60岁实现目标累积财富（20万起）</td>
</tr>
<tr>
<td>2017</td>
<td>26</td>
<td>946.45</td>
<td>N/A</td>
<td>20</td>
</tr>
<tr>
<td>2018</td>
<td>27</td>
<td>974.8435</td>
<td>4774.22%</td>
<td>23.074</td>
</tr>
<tr>
<td>2019</td>
<td>28</td>
<td>1004.088805</td>
<td>608.55%</td>
<td>26.6204738</td>
</tr>
<tr>
<td>2020</td>
<td>29</td>
<td>1034.211469</td>
<td>272.56%</td>
<td>30.71204062</td>
</tr>
<tr>
<td><strong>2021</strong></td>
<td><strong>30</strong></td>
<td><strong>1065.237813</strong></td>
<td><strong>170.15%</strong></td>
<td><strong>35.43248127</strong></td>
</tr>
<tr>
<td>2022</td>
<td>31</td>
<td>1097.194948</td>
<td>122.77%</td>
<td>40.87845364</td>
</tr>
<tr>
<td>2023</td>
<td>32</td>
<td>1130.110796</td>
<td>95.89%</td>
<td>47.16147196</td>
</tr>
<tr>
<td>2024</td>
<td>33</td>
<td>1164.01412</td>
<td>78.70%</td>
<td>54.4101902</td>
</tr>
<tr>
<td>2025</td>
<td>34</td>
<td>1198.934544</td>
<td>66.81%</td>
<td>62.77303644</td>
</tr>
<tr>
<td><strong>2026</strong></td>
<td><strong>35</strong></td>
<td><strong>1234.90258</strong></td>
<td><strong>58.11%</strong></td>
<td><strong>72.42125214</strong></td>
</tr>
<tr>
<td>2027</td>
<td>36</td>
<td>1271.949657</td>
<td>51.48%</td>
<td>83.55239859</td>
</tr>
<tr>
<td>2028</td>
<td>37</td>
<td>1310.108147</td>
<td>46.26%</td>
<td>96.39440225</td>
</tr>
<tr>
<td>2029</td>
<td>38</td>
<td>1349.411391</td>
<td>42.05%</td>
<td>111.2102219</td>
</tr>
<tr>
<td>2030</td>
<td>39</td>
<td>1389.893733</td>
<td>38.58%</td>
<td>128.303233</td>
</tr>
<tr>
<td><strong>2031</strong></td>
<td><strong>40</strong></td>
<td><strong>1431.590545</strong></td>
<td><strong>35.67%</strong></td>
<td><strong>148.0234399</strong></td>
</tr>
<tr>
<td>2032</td>
<td>41</td>
<td>1474.538261</td>
<td>33.20%</td>
<td>170.7746426</td>
</tr>
<tr>
<td>2033</td>
<td>42</td>
<td>1518.774409</td>
<td>31.08%</td>
<td>197.0227052</td>
</tr>
<tr>
<td>2034</td>
<td>43</td>
<td>1564.337642</td>
<td>29.23%</td>
<td>227.305095</td>
</tr>
<tr>
<td>2035</td>
<td>44</td>
<td>1611.267771</td>
<td>27.61%</td>
<td>262.2418881</td>
</tr>
<tr>
<td><strong>2036</strong></td>
<td><strong>45</strong></td>
<td><strong>1659.6058</strong></td>
<td><strong>26.18%</strong></td>
<td><strong>302.5484662</strong></td>
</tr>
<tr>
<td>2037</td>
<td>46</td>
<td>1709.39398</td>
<td>24.91%</td>
<td>349.0501655</td>
</tr>
<tr>
<td>2038</td>
<td>47</td>
<td>1760.6758</td>
<td>23.77%</td>
<td>402.6991759</td>
</tr>
<tr>
<td>2039</td>
<td>48</td>
<td>1813.49607</td>
<td>22.74%</td>
<td>464.5940393</td>
</tr>
<tr>
<td>2040</td>
<td>49</td>
<td>1867.90095</td>
<td>21.81%</td>
<td>536.0021431</td>
</tr>
<tr>
<td><strong>2041</strong></td>
<td><strong>50</strong></td>
<td><strong>1923.93798</strong></td>
<td><strong>20.96%</strong></td>
<td><strong>618.3856725</strong></td>
</tr>
<tr>
<td>2042</td>
<td>51</td>
<td>1981.65612</td>
<td>20.18%</td>
<td>713.4315504</td>
</tr>
<tr>
<td>2043</td>
<td>52</td>
<td>2041.10581</td>
<td>19.47%</td>
<td>823.0859797</td>
</tr>
<tr>
<td>2044</td>
<td>53</td>
<td>2102.33898</td>
<td>18.82%</td>
<td>949.5942948</td>
</tr>
<tr>
<td>2045</td>
<td>54</td>
<td>2165.40915</td>
<td>18.21%</td>
<td>1095.546938</td>
</tr>
<tr>
<td><strong>2046</strong></td>
<td><strong>55</strong></td>
<td><strong>2230.37142</strong></td>
<td><strong>17.65%</strong></td>
<td><strong>1263.932502</strong></td>
</tr>
<tr>
<td>2047</td>
<td>56</td>
<td>2297.28257</td>
<td>17.13%</td>
<td>1458.198928</td>
</tr>
<tr>
<td>2048</td>
<td>57</td>
<td>2366.20104</td>
<td>16.65%</td>
<td>1682.324103</td>
</tr>
<tr>
<td>2049</td>
<td>58</td>
<td>2437.18707</td>
<td>16.19%</td>
<td>1940.897318</td>
</tr>
<tr>
<td>2050</td>
<td>59</td>
<td>2510.30269</td>
<td>15.77%</td>
<td>2239.213235</td>
</tr>
<tr>
<td><strong>2051</strong></td>
<td><strong>60</strong></td>
<td><strong>2585.61177</strong></td>
<td><strong>15.37%</strong></td>
<td><strong>2583.38031</strong></td>
</tr>
</tbody>
</table>
----------------分割线---------------------

补，若根据之前通过支付宝估算的基尼系数，所获得分位点财富幂律指数，同样的幂律分布下：

k*e^(8.8992(1-0.135%))=1000

解得k=0.138148万

带入个人的分位点，得2017年底目标财富要到达<span style="color: #ff0000;"><strong>976.7万（居然差不多啊！这flag立得不好啊……）才能与我高考分位点匹配！</strong></span>

好吧，计入3%通胀，按我目前可投资资产为20万人民币。希望能在60岁前实现的话，列表如下.
<table width="744">
<tbody>
<tr>
<td width="72">年份</td>
<td width="72">年龄</td>
<td width="99">目标财富</td>
<td width="237">达到目标年复合增长率（20万起）</td>
<td width="264">60岁实现目标累积财富（20万起）</td>
</tr>
<tr>
<td>2017</td>
<td>26</td>
<td>976.7</td>
<td>N/A</td>
<td>20</td>
</tr>
<tr>
<td>2018</td>
<td>27</td>
<td>1006.001</td>
<td>4930.01%</td>
<td>23.096</td>
</tr>
<tr>
<td>2019</td>
<td>28</td>
<td>1036.18103</td>
<td>619.79%</td>
<td>26.6712608</td>
</tr>
<tr>
<td>2020</td>
<td>29</td>
<td>1067.266461</td>
<td>276.48%</td>
<td>30.79997197</td>
</tr>
<tr>
<td>2021</td>
<td>30</td>
<td>1099.284455</td>
<td>172.28%</td>
<td>35.56780763</td>
</tr>
<tr>
<td>2022</td>
<td>31</td>
<td>1132.262988</td>
<td>124.17%</td>
<td>41.07370425</td>
</tr>
<tr>
<td>2023</td>
<td>32</td>
<td>1166.230878</td>
<td>96.92%</td>
<td>47.43191367</td>
</tr>
<tr>
<td>2024</td>
<td>33</td>
<td>1201.217804</td>
<td>79.51%</td>
<td>54.77437391</td>
</tr>
<tr>
<td>2025</td>
<td>34</td>
<td>1237.254338</td>
<td>67.47%</td>
<td>63.25344699</td>
</tr>
<tr>
<td>2026</td>
<td>35</td>
<td>1274.371969</td>
<td>58.66%</td>
<td>73.04508059</td>
</tr>
<tr>
<td>2027</td>
<td>36</td>
<td>1312.603128</td>
<td>51.95%</td>
<td>84.35245906</td>
</tr>
<tr>
<td>2028</td>
<td>37</td>
<td>1351.981222</td>
<td>46.68%</td>
<td>97.41021972</td>
</tr>
<tr>
<td>2029</td>
<td>38</td>
<td>1392.540658</td>
<td>42.42%</td>
<td>112.4893217</td>
</tr>
<tr>
<td>2030</td>
<td>39</td>
<td>1434.316878</td>
<td>38.91%</td>
<td>129.9026687</td>
</tr>
<tr>
<td>2031</td>
<td>40</td>
<td>1477.346384</td>
<td>35.98%</td>
<td>150.0116019</td>
</tr>
<tr>
<td>2032</td>
<td>41</td>
<td>1521.666776</td>
<td>33.48%</td>
<td>173.2333978</td>
</tr>
<tr>
<td>2033</td>
<td>42</td>
<td>1567.316779</td>
<td>31.34%</td>
<td>200.0499278</td>
</tr>
<tr>
<td>2034</td>
<td>43</td>
<td>1614.336282</td>
<td>29.47%</td>
<td>231.0176566</td>
</tr>
<tr>
<td>2035</td>
<td>44</td>
<td>1662.766371</td>
<td>27.84%</td>
<td>266.7791899</td>
</tr>
<tr>
<td>2036</td>
<td>45</td>
<td>1712.64936</td>
<td>26.39%</td>
<td>308.0766085</td>
</tr>
<tr>
<td>2037</td>
<td>46</td>
<td>1764.02884</td>
<td>25.10%</td>
<td>355.7668675</td>
</tr>
<tr>
<td>2038</td>
<td>47</td>
<td>1816.94971</td>
<td>23.95%</td>
<td>410.8395786</td>
</tr>
<tr>
<td>2039</td>
<td>48</td>
<td>1871.4582</td>
<td>22.91%</td>
<td>474.4375453</td>
</tr>
<tr>
<td>2040</td>
<td>49</td>
<td>1927.60195</td>
<td>21.97%</td>
<td>547.8804773</td>
</tr>
<tr>
<td>2041</td>
<td>50</td>
<td>1985.43</td>
<td>21.12%</td>
<td>632.6923752</td>
</tr>
<tr>
<td>2042</td>
<td>51</td>
<td>2044.9929</td>
<td>20.33%</td>
<td>730.6331549</td>
</tr>
<tr>
<td>2043</td>
<td>52</td>
<td>2106.34269</td>
<td>19.62%</td>
<td>843.7351673</td>
</tr>
<tr>
<td>2044</td>
<td>53</td>
<td>2169.53297</td>
<td>18.96%</td>
<td>974.3453712</td>
</tr>
<tr>
<td>2045</td>
<td>54</td>
<td>2234.61896</td>
<td>18.34%</td>
<td>1125.174035</td>
</tr>
<tr>
<td>2046</td>
<td>55</td>
<td>2301.65753</td>
<td>17.78%</td>
<td>1299.350975</td>
</tr>
<tr>
<td>2047</td>
<td>56</td>
<td>2370.70726</td>
<td>17.25%</td>
<td>1500.490506</td>
</tr>
<tr>
<td>2048</td>
<td>57</td>
<td>2441.82847</td>
<td>16.76%</td>
<td>1732.766437</td>
</tr>
<tr>
<td>2049</td>
<td>58</td>
<td>2515.08333</td>
<td>16.31%</td>
<td>2000.998681</td>
</tr>
<tr>
<td>2050</td>
<td>59</td>
<td>2590.53583</td>
<td>15.88%</td>
<td>2310.753277</td>
</tr>
<tr>
<td>2051</td>
<td>60</td>
<td>2668.2519</td>
<td>15.48%</td>
<td>2668.457884</td>
</tr>
</tbody>
</table>
线性估计，若资产本身能够产生5%的增速，那么薪资、奖金、外快每年平均必须有12%增速才能在55岁达到目标……
<p style="text-align: center;"><span style="color: #ff0000;">=========知耻而后勇的分割线===========</span></p>
和catpiano讨论的时候发现了一个较大的问题，我在统计rank的时候应该把自己放到理科生排名，而不是报考总人数。这里对结果进行修改：

根据2010年分段表，将总分300分以上的人数作为总量统计，共有<strong>533169</strong>人。其中理科累计人数<strong>317588</strong>人.（把自己从坑里救出来啦）

2600/(656000*(317588/533169))=0.665%

差不多150人取1的位置，带入财富分布公式，可得到可投资净资产约为<strong>895.704万元</strong>
<table width="744">
<tbody>
<tr>
<td width="72">年份</td>
<td width="72">年龄</td>
<td width="99">目标财富</td>
<td width="237">达到目标年复合增长率（20万起）</td>
<td width="264">60岁实现目标累积财富（20万起）</td>
</tr>
<tr>
<td>2017</td>
<td>26</td>
<td>895.704</td>
<td>N/A</td>
<td>20</td>
</tr>
<tr>
<td>2018</td>
<td>27</td>
<td>922.57512</td>
<td>4512.88%</td>
<td>23.038</td>
</tr>
<tr>
<td>2019</td>
<td>28</td>
<td>950.2523736</td>
<td>589.29%</td>
<td>26.5374722</td>
</tr>
<tr>
<td>2020</td>
<td>29</td>
<td>978.7599448</td>
<td>265.78%</td>
<td>30.56851423</td>
</tr>
<tr>
<td><strong>2021</strong></td>
<td><strong>30</strong></td>
<td><strong>1008.122743</strong></td>
<td><strong>166.45%</strong></td>
<td><strong>35.21187154</strong></td>
</tr>
<tr>
<td>2022</td>
<td>31</td>
<td>1038.366425</td>
<td>120.33%</td>
<td>40.56055482</td>
</tr>
<tr>
<td>2023</td>
<td>32</td>
<td>1069.517418</td>
<td>94.10%</td>
<td>46.7217031</td>
</tr>
<tr>
<td>2024</td>
<td>33</td>
<td>1101.602941</td>
<td>77.30%</td>
<td>53.8187298</td>
</tr>
<tr>
<td>2025</td>
<td>34</td>
<td>1134.651029</td>
<td>65.66%</td>
<td>61.99379486</td>
</tr>
<tr>
<td><strong>2026</strong></td>
<td><strong>35</strong></td>
<td><strong>1168.69056</strong></td>
<td><strong>57.14%</strong></td>
<td><strong>71.4106523</strong></td>
</tr>
<tr>
<td>2027</td>
<td>36</td>
<td>1203.751277</td>
<td>50.64%</td>
<td>82.25793039</td>
</tr>
<tr>
<td>2028</td>
<td>37</td>
<td>1239.863815</td>
<td>45.53%</td>
<td>94.75291001</td>
</tr>
<tr>
<td>2029</td>
<td>38</td>
<td>1277.059729</td>
<td>41.39%</td>
<td>109.145877</td>
</tr>
<tr>
<td>2030</td>
<td>39</td>
<td>1315.371521</td>
<td>37.99%</td>
<td>125.7251358</td>
</tr>
<tr>
<td><strong>2031</strong></td>
<td><strong>40</strong></td>
<td><strong>1354.832667</strong></td>
<td><strong>35.14%</strong></td>
<td><strong>144.8227839</strong></td>
</tr>
<tr>
<td>2032</td>
<td>41</td>
<td>1395.477647</td>
<td>32.71%</td>
<td>166.8213648</td>
</tr>
<tr>
<td>2033</td>
<td>42</td>
<td>1437.341976</td>
<td>30.63%</td>
<td>192.1615301</td>
</tr>
<tr>
<td>2034</td>
<td>43</td>
<td>1480.462236</td>
<td>28.81%</td>
<td>221.3508665</td>
</tr>
<tr>
<td>2035</td>
<td>44</td>
<td>1524.876103</td>
<td>27.22%</td>
<td>254.9740631</td>
</tr>
<tr>
<td><strong>2036</strong></td>
<td><strong>45</strong></td>
<td><strong>1570.62239</strong></td>
<td><strong>25.82%</strong></td>
<td><strong>293.7046233</strong></td>
</tr>
<tr>
<td>2037</td>
<td>46</td>
<td>1617.74106</td>
<td>24.56%</td>
<td>338.3183556</td>
</tr>
<tr>
<td>2038</td>
<td>47</td>
<td>1666.27329</td>
<td>23.44%</td>
<td>389.7089138</td>
</tr>
<tr>
<td>2039</td>
<td>48</td>
<td>1716.26149</td>
<td>22.43%</td>
<td>448.9056978</td>
</tr>
<tr>
<td>2040</td>
<td>49</td>
<td>1767.74933</td>
<td>21.51%</td>
<td>517.0944733</td>
</tr>
<tr>
<td><strong>2041</strong></td>
<td><strong>50</strong></td>
<td><strong>1820.78181</strong></td>
<td><strong>20.68%</strong></td>
<td><strong>595.6411238</strong></td>
</tr>
<tr>
<td>2042</td>
<td>51</td>
<td>1875.40527</td>
<td>19.92%</td>
<td>686.1190105</td>
</tr>
<tr>
<td>2043</td>
<td>52</td>
<td>1931.66742</td>
<td>19.22%</td>
<td>790.3404881</td>
</tr>
<tr>
<td>2044</td>
<td>53</td>
<td>1989.61745</td>
<td>18.57%</td>
<td>910.3932083</td>
</tr>
<tr>
<td>2045</td>
<td>54</td>
<td>2049.30597</td>
<td>17.98%</td>
<td>1048.681937</td>
</tr>
<tr>
<td><strong>2046</strong></td>
<td><strong>55</strong></td>
<td><strong>2110.78515</strong></td>
<td><strong>17.43%</strong></td>
<td><strong>1207.976723</strong></td>
</tr>
<tr>
<td>2047</td>
<td>56</td>
<td>2174.1087</td>
<td>16.92%</td>
<td>1391.468387</td>
</tr>
<tr>
<td>2048</td>
<td>57</td>
<td>2239.33197</td>
<td>16.44%</td>
<td>1602.832435</td>
</tr>
<tr>
<td>2049</td>
<td>58</td>
<td>2306.51192</td>
<td>15.99%</td>
<td>1846.302682</td>
</tr>
<tr>
<td>2050</td>
<td>59</td>
<td>2375.70728</td>
<td>15.58%</td>
<td>2126.756059</td>
</tr>
<tr>
<td><strong>2051</strong></td>
<td><strong>60</strong></td>
<td><strong>2446.9785</strong></td>
<td><strong>15.19%</strong></td>
<td><strong>2449.810305</strong></td>
</tr>
</tbody>
</table>
---
layout: post
title:  "AWS网络问题解决"
categories: network
tags:  aws server
author: LZN
---

* content
{:toc}

很郁闷今天去东校修复服务器阵列，发现另一块RAID盘也坏了，wordpress数据库几乎全部丢失，文章只有题目没有内容。没办法，只能随他去了。

终归还是要迁移到AWS的，之前一直没有折腾好的手机端SS问题，今天yum update的时候发现无法连接yum源，怀疑是安全组策略问题，设置出站流量为所有流量后，成功解决这一问题，看起来限制入站流量就可以了嘛～
---
layout: post
title:  "github技术博客搭建"
categories: network
tags:  github blog jekyll
author: LZN
---

* content
{:toc}

还是要搬家啦～

经历了东校实验室RAID1阵列双盘全坏，我的wordpress站点从2014到前几个月数百篇文章香消玉殒，遑论全校关端口更是让在外访问变得不可能。几个重要的系统搭建流程，目前看来只能靠并不靠谱的直觉和印象了。痛定思痛，为下一处站点做好相对周全的考虑，避免再次出现这类问题。

需求端：
1. 类wordpress，框架成熟，索引方便、样式美观，不需要个人太多调整

2. 足够灵活，有单独页面，比如需要有scp/ftp push实时更新、daily refresh的预报图，以及支持脚本控制

3. 安全，两个方面的，一是数据安全……我就没见过RAID一次坏俩的情况！！！二是防范政策风险，这也是为啥放弃在EC2上开443搭wordpress的原因，目前……22口都已经不稳定了，诶

考虑供给端：
1. EC2+wordpress，足够灵活，10G也够用，但是政策风险太大，目前22访问都不稳定了，放弃

2. 简书，不灵活，放弃

3. csdn，已经被边缘化了，放弃

4. github，嘿嘿，就是你了

思想准备结束，开始搭建
follow[这个](http://www.pchou.info/ssgithubPage/2013-01-03-build-github-blog-page-01.htm)来
```bash
$ git checkout --orphan gh-pages
```
语句出错，果然又是git版本问题……坑爹centos

突然发现很多资料都是13-14年的，这段时间应该官方更新了不少，索性还是查官方库吧。

https://pages.github.com/

相当有效。

然后costumize

https://help.github.com/articles/using-jekyll-as-a-static-site-generator-with-github-pages/

模板找到了几个，Jekll安装似乎有点麻烦。

1. 安装ruby，rubygems，安装gems过程中出错，运行中有这么一个提示

> YAML safe loading is not available. Please upgrade psych to a version that supports safe loading (>= 2.0).

> There are no versions of psych (>= 0) compatible with your Ruby & RubyGems. psych requires Ruby version >= 2.2.2. The current ruby version is 1.8.


真是操蛋的centos，不折腾了还是装在ubuntu下好了。

ubuntu下一条apt-get install ruby直接搞定。

安装jekyll的问题是找不到头文件，apt-get install ruby-dev，注意ubuntu下是dev后缀对应头文件。

can't find header files for ruby at /usr/lib/ruby/include/ruby.h

之后
```bash
$jekyll new myblog
```
发现第一次执行非常慢，不过问题不大

然后就是漫长的端口问题。最初以为4000口没有向外开放，折腾了一晚上ufw iptables这些防火墙设置都无效。最后看应用doc，发现应该是在jekyll里设置相应的内容，默认是localhost 127.0.0.1

_config.yml文件下修改host为内网（公网）IP即可。

找到一些不错的介绍防火墙的内容

https://www.rosehosting.com/blog/how-to-set-up-a-firewall-with-iptables-on-ubuntu-and-centos/

搞定内网调试，开始看官方文档调戏github

https://help.github.com/articles/about-jekyll-themes-on-github/

花了一下午时间找了个好模板

https://github.com/Gaohaoyang/gaohaoyang.github.io

直接开服务，出错

> Could not locate Gemfile or .bundle/ directory

不管三七二十一，把示例里面的文件丢过来

之后新的错误

> Deprecation: The 'gems' configuration option has been renamed to 'plugins'. Please update your config file accordingly.

>  Dependency Error: Yikes! It looks like you don't have jekyll-paginate or one of its dependencies installed. In order to use Jekyll as currently configured, you'll need to install this gem. The full error message from Ruby is: 'cannot load such file -- jekyll-paginate' If you run into trouble, you can find helpful resources at https://jekyllrb.com/help/!`

按要求安装之后也不成功。google发现如下stackoverflow帖子

https://stackoverflow.com/questions/35401566/dont-have-jekyll-paginate-or-one-of-its-dependencies-installed

居然有github-pages这种东西……

装完之后，拿掉gemfile即可。

摸索修改之后，发现这个评论解决方案

https://imsun.net/posts/gitment-introduction/

问题是评论页面在我这里会混淆，所以单独设计了一个page给评论，就当留言板吧。

参考

http://www.cnfeat.com/blog/2014/05/11/how-to-build-a-blog/

http://www.pchou.info/ssgithubPage/2013-01-03-build-github-blog-page-01.html（重要）
---
layout: post
title:  "Ubuntu/K4200机器学习系统搭建"
categories: linux machine&nbsp;leanring 
tags:  ubuntu machine&nbsp;learning CUDA deep&nbsp;learning
author: LZN
---

* content
{:toc}

### 记得装desktop版本的ubuntu，否则没有xserver，比较蛋疼
### 安装英伟达显卡驱动，要关掉x server……
默认进入命令行启动

http://blog.topspeedsnail.com/archives/4922

注意16.04用这句：

$sudo systemctl set-default multi-user.target

这是每次开机默认进入命令行模式的方法。单词关闭用

sudo /etc/init.d/lightdm stop

然后遇到了坑爹的linux预装驱动……需要关掉。（谁说ubuntu少折腾来着……）

驱动安装过程这个链接内容比较详细（卸载系统驱动后机器无法完全启动，但是ssh没问题）

http://blog.csdn.net/u012759136/article/details/53355781  

照着来没问题了吧，错了……build driver的时候直接说unable……我去

差了下说我下的版本不对，赶紧去重新找（为啥查到的帖子都是那个340.32版本）

http://www.nvidia.com/content/DriverDownload-March2009/confirmation.php?url=/XFree86/Linux-x86_64/384.98/NVIDIA-Linux-x86_64-384.98.run&lang=us&type=GeForce

这里下载17.11的版本

### 安装cuda toolkit，这次吸取教训，直接英伟达官网下载最新cuda9.1版本。
直接运行安装，居然自带了驱动……去死吧……

后面说我有几个库没装好，记录如下

Missing recommended library: libGLU.so

Missing recommended library: libX11.so

Missing recommended library: libXi.so

Missing recommended library: libXmu.so

搜索下直接apt-get搞定

$ sudo apt-getinstall freeglut3-dev build-essential libx11-dev libxmu-dev libxi-dev libgl1-mesa-glx libglu1-mesa libglu1-mesa-dev

官方参考

https://devtalk.nvidia.com/default/topic/827410/cuda-setup-and-installation/new-installation-of-cuda-7-toolkit-in-ubuntu-12-04-question-about-missing-recommended-libraries-/

重装一遍cuda测试，一并安装了连同cuda的显卡驱动。没有问题。

http://blog.csdn.net/shiorioxy/article/details/52652831

http://blog.csdn.net/jhszh418762259/article/details/52958287

之后写几个配置

环境变量设置

sudo vim ~/.bashrc

在末尾添加

export CUDA_HOME=/usr/local/cuda-8.0

export LD_LIBRARY_PATH=/usr/local/cuda-8.0/lib64:$LD_LIBRARY_PATH

export PATH=/usr/local/cuda-8.0/bin:$PATH

保存退出。

然后刷新。

source ~/.bashrc

动态链接库设置

创建文件：

sudo vim /etc/ld.so.conf.d/cuda.conf

写入：/usr/local/cuda/lib64

保存之后使其立即生效：

sudo ldconfig -v

之后是测试sample，网上教程都是进utility编译，表示直接在根目录下编译了，很长时间……但是似乎没有报错退出。

许久之后，安全完成。



### 安装cuDNN (以下是坑)
直接搜索，英伟达官网注册，下载三个相关deb包，然后

$sudo dpkg -i xxxx.deb

应该就把库给安装好了。

安装anaconda，没啥好说的。

### 安装cuda-based TensorFlow
https://tensorflow.google.cn/install/install_linux

follow来，突然发现我的cuda版本和cuDNN版本都高了……先试试吧

pip install tensorflow-gpu

安全完成

但是使用的时候出现库缺失。然后conda安装我发现了这些……




你妹啊！直接集成了cuda8，我去！
但是用conda安装的tensorflow-gpu版本并不能正确执行，怀疑与环境已安装的有关。

https://devtalk.nvidia.com/default/topic/1026198/cuda-9-0-importerror-libcublas-so-8-0/

所以要重装cuda8...

注意apt-get会拿到一个cuda9.1，我们可以用9.1的驱动，但8还是要装一遍，依然选择用runfile安装。

重装cuda8之后，采用gist一脚本安装cuDNN v6，注意删掉apt-get安装cuda9的段落

https://gist.githubusercontent.com/mjdietzx/0ff77af5ae60622ce6ed8c4d9b419f45/raw/ebcb37e45ba14317330ffc1269159ed076242b9a/waya-dl-setup.sh
```bash
# install cuDNN v6.0
CUDNN_TAR_FILE="cudnn-8.0-linux-x64-v6.0.tgz"
wget http://developer.download.nvidia.com/compute/redist/cudnn/v6.0/${CUDNN_TAR_FILE}
tar -xzvf ${CUDNN_TAR_FILE}
sudo cp -P cuda/include/cudnn.h /usr/local/cuda-8.0/include
sudo cp -P cuda/lib64/libcudnn* /usr/local/cuda-8.0/lib64/
sudo chmod a+r /usr/local/cuda-8.0/lib64/libcudnn*
# set environment variables
export PATH=/usr/local/cuda-8.0/bin${PATH:+:${PATH}}
export LD_LIBRARY_PATH=/usr/local/cuda-8.0/lib64\${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
```
pip安装的预编译TensorFlow可以运行，但是有python版本不匹配，没有最适应CPU编译的提示。

因此TF还是自行编译得好……回来再折腾吧

6.安装opencv-python
pip install opencv-python

安全完成！

可以了，测试一下GTX760水平的cuda能否吊打E5-2643.

neural style风格迁移测试。

https://github.com/cysmith/neural-style-tf

测试成绩赛高，E5-2643 v4 @ 3.40GHz约1500秒，GTX760水平只用500s，约1/3时间。


---
layout: post
title:  "岁末年初"
categories: emotion
tags:  blog thinking
author: LZN
---

* content
{:toc}

犹豫了一下午要不要写点什么，晚上回来还是决定写点吧。
又到了跨年的时候了，2017在印象中过的无比的快。真的是无比的快。记得之前有人解释说，为什么人越长大越觉得时间快，想想小学中学，一个学期四个月都觉得无比漫长，如今一年毫无感觉就结束了。解释说是基数效应，十岁的时候，多过一年，那是生命的十分之一；而25岁的时候，再过一年，也不过是4%的增幅，跟余额宝年化差不多，自然没感觉。
想到了七年前的这个时候，也是坐在床上，当时用着床上书桌，接着网线，也是用着现在的小Y，当时和烨琪一起倒数跨年，两栋宿舍楼，QQ联系，那时还没确定关系。
如今我也是这种状态，不过在南校；烨琪也和我聊着，不过隔着伶仃洋，用着手机。
后来几年，有几次在学校倒数，东校新天地，南校亲新广场，都有。
去年，我在大洋彼岸，16小时时差，一起跨了两次。

去年对我来说，是一个拐点。
从2016年，慢慢关注经济和金融，过去的2017当然投入了更多。
两本对我影响深刻的书：塔勒布《黑天鹅》，Van Tharp《Trade Your Way to Financial Freedom》，思想上对我影响深刻的，反倒是还没有看的塔勒布那本《反脆弱》。
没错，杠铃策略。
2016年还在迷茫挣扎，2017则是明确了自己不想要的，而杠铃策略，给了我最大的启发。
稳定工作应该是保守的一端，而另一端则是激进的机会搜集和备战。
想清楚这些，很多迷茫都迎刃而解；目标明确，接下来就是按部就班操作，焦虑也少了。
想想10年初的目标，现在实现早没什么问题了；如今，可能更多想到的是如何去平衡责任。

说说目标吧。
Van Tharp的规则意识让我明白交易系统是可以机械化操作的，因此也有了写自己交易系统的想法。人性太难克服，随意性，操作瘾性太强。赌多，输多。年末一段时间算是慢慢改掉了坏毛病，看得少了，动的少了，心情起伏也少了。投资以来，总体没亏，年底借了几个标的涨势，今年算勉强跑赢余额宝。大牛市没赚大钱，不过起码没亏。
所以第一个目标就是动手做一个交易系统，ML要上，我只需要概率而已，剩下的交给时间。
第二个目标是完成确保保守端成立，问题不大，但是塔勒布告诉我，不能掉以轻心。plan B还是要有的。
第三个目标算为第二个目标，同时也是Plan B服务，做一套山东半岛预报系统。
第四个目标，也是为第二个服务，完成最低毕业标准。
ML没法立flag了，边学边用吧。很多书要看，看很多书。看书的确能让人思路大开。

听说新年立flag都完成不了，不过我还是信心满满。
知道自己想要什么，也就平和多了，加油！

#### Jan 1 2018 Update
中午和rds师兄吃饭，再次得出稀缺大于一切的结论，无论怎样，潮水退去时，有所栖倚才会留出反应时间，这当然是极其珍贵的。
---
layout: post
title:  "山东半岛预报系统搭建"
categories: modeling linux
tags:  WRF forecast&nbsp;system
author: LZN
---

* content
{:toc}

打算做一个山东半岛的预报系统，以后也算投名状。

### 编译WRF

configure尝试选择20. INTEL (ifort/icc): Xeon (SNB with AVX mods)

之后直接执行编译

```bash
./compile -j 8 em_real
```
执行编译过程卡住。更换15. 不包括avx指令集后成功。

### 编译WPS

编译wps发现无法编译出ungrib，经过多次测试，分别

```bash
yum install libpng-devel
yum install jasper-devel
```
将devel包安装完整后成功。

### 下载geog包并解压。


**Updated 2017-12-31**

### 调整wps设置

完整namelist.wps

``` fortran 
&share
 wrf_core = 'ARW',
 max_dom = 4,
 start_date = '2018-01-05_12:00:00','2018-01-05_12:00:00','2018-01-05_12:00:00','2018-01-05_12:00:00',
 end_date   = '2018-01-10_12:00:00','2018-01-10_12:00:00','2018-01-10_12:00:00','2018-01-10_12:00:00',
 interval_seconds = 21600
 active_grid = .true., .true.,.true.,.true.,
 subgrid_ratio_x = 1
 subgrid_ratio_y = 1
 io_form_geogrid = 2,
 opt_output_from_geogrid_path = './',
 debug_level = 0
/

&geogrid
 parent_id         =   1,   1,   2,   3,
 parent_grid_ratio =   1,   3,   3,   3,
 i_parent_start    =   1, 140,  80, 140,
 j_parent_start    =   1,  80,  50, 110,
 s_we              =   1,   1,   1,   1,
 e_we              = 300, 241, 301, 301,
 s_sn              =   1,   1,   1,   1,
 e_sn              = 220, 202, 283, 301,
 !
 !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!
 ! The default datasets used to produce the HGT_M, GREENFRAC,
 ! and LU_INDEX/LANDUSEF fields have changed in WPS v3.8. The HGT_M field
 ! is now interpolated from 30-arc-second USGS GMTED2010, the GREENFRAC
 ! field is interpolated from MODIS FPAR, and the LU_INDEX/LANDUSEF fields
 ! are interpolated from 21-class MODIS.
 !
 ! To match the output given by the default namelist.wps.all_options 
 ! in WPS v3.7.1, the following setting for geog_data_res may be used:
 !
 ! geog_data_res = 'gtopo_10m+usgs_10m+nesdis_greenfrac+10m','gtopo_2m+usgs_2m+nesdis_greenfrac+2m',
 !
 !!!!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT NOTE !!!!!!!!!!!!!!!!!!!!!!!!!!!!
 !
 geog_data_res = 'default','default','default','default',
 dx        = 27000,
 dy        = 27000,
 map_proj  = 'lambert',
 ref_lat   =  37.00,
 ref_lon   =  110.00,
 ref_x     =  55.0,
 ref_y     =  35.0,
 truelat1  =  30.0,
 truelat2  =  60.0,
 stand_lon =  110.0,
 geog_data_path = '/home/lzhenn/wrf-surface-data/geog'
 opt_geogrid_tbl_path = 'geogrid/'
/
 geog_data_res     = 'modis_lakes+10m','modis_lakes+2m',
 geog_data_res     = 'usgs_lakes+10m','usgs_lakes+2m',

&ungrib
 out_format = 'WPS',
 prefix     = 'GFS',
/

&metgrid
 fg_name         = 'GFS', 'SST'
 constants_name  = './TAVGSFC'
 io_form_metgrid = 2, 
 opt_output_from_metgrid_path = './',
 opt_metgrid_tbl_path         = 'metgrid/',
 process_only_bdy = 5,
/

&mod_levs
 press_pa = 201300 , 200100 , 100000 , 
             95000 ,  90000 , 
             85000 ,  80000 , 
             75000 ,  70000 , 
             65000 ,  60000 , 
             55000 ,  50000 , 
             45000 ,  40000 , 
             35000 ,  30000 , 
             25000 ,  20000 , 
             15000 ,  10000 , 
              5000 ,   1000
/

&plotfmt
 ix = 100
 jx = 100
 ioff = 30
 joff = 30
/

```

domain设置如下：
![](http://ww1.sinaimg.cn/large/73ebdc71gy1fn6ptmsx25j20ug0o9dk8.jpg)


### 执行wps
设置从HKUST ENVR下载GFS输入文件[GFS data archive](http://envf.ust.hk/dataop/data/model_input/gfs_1.00deg_realtime/)

测试加入gfs的SST数据，参考

[http://www2.mmm.ucar.edu/wrf/OnLineTutorial/DATA/SST/index.html](http://www2.mmm.ucar.edu/wrf/OnLineTutorial/DATA/SST/index.html)

后发现并不能用，出现segfault，之后更改namelist和，对应GFS数据为SST变量Vtable，以及SST前缀，sst问题解决。

met data生成过程一切顺利。

**Updated 2018-01-06**

### 调整WRF设置

根据俊文和海洋局的配置调整namelist.input设置，过程中发现V3.9提供了经过测试的参数化suite，果断采用。CONUS代表北美大陆配置。
### 执行real
调整后real过程出错

```
 5   --- ERROR: If sst_update /= 0, one of the auxinput4_interval settings must be /= 0
 6   --- Set auxinput4_interval_s to the same value as interval_seconds (usually a pretty good guess).
```
修改后，执行过程出现段错误。

测试修改环境变量。
``` bash
# set WRF
export WRFIO_NCD_LARGE_FILE_SUPPORT=1
export WRF_EM_CORE=1
export NETCDF4=0

ulimit -s unlimited
ulimit -c unlimited
```
通过第一断点。新错误：

``` bash
-------------- FATAL CALLED ---------------
FATAL CALLED FROM FILE:  <stdin>  LINE:     431 
 Problems, we cannot have excluded middle data from WPS 
 -------------------------------------------
 application called MPI_Abort(MPI_COMM_WORLD, 1) - process 0
 [unset]: write_line error; fd=-1 buf=:cmd=abort exitcode=1
 :
 system msg for write_line failure : Bad file descriptor

```
将SST Update设置为0后可以顺利执行完real。

### 执行wrf
执行过程直接出错,有一个gwd_opt设置为1后可行。

顺利执行，但是积分速度奇慢无比，决定采用180s步长，三层嵌套，速度快了很多。
最终采用的wrf namelist.input
``` fortran
 &time_control
 run_days                            = 5,
 run_hours                           = 0,
 run_minutes                         = 0,
 run_seconds                         = 0,
 start_year                          = 2018, 2018, 2018, 2018,
 start_month                         = 01,   01,   01,   01,
 start_day                           = 05,   05,   05,   05,
 start_hour                          = 12,   12,   12,   12,
 start_minute                        = 00,   00,   00,   00,
 start_second                        = 00,   00,   00,   00,
 end_year                            = 2018, 2018, 2018, 2018,
 end_month                           = 01,   01,   01,   01,
 end_day                             = 10,   10,   10,   10,
 end_hour                            = 12,   12,   12,   12,
 end_minute                          = 00,   00,   00,   00,
 end_second                          = 00,   00,   00,   00,
 interval_seconds                    = 21600
 input_from_file                     = .true.,.true.,.true.,.true.,
 history_interval                    = 60,  60,   60,   60,
 frames_per_outfile                  = 1000, 1000, 1000, 1000,
 restart                             = .false.,
 restart_interval                    = 5000,
 io_form_history                     = 2
 io_form_restart                     = 2
 io_form_input                       = 2
 io_form_auxinput4                   = 0 
 io_form_boundary                    = 2
 auxinput4_interval                  = 0
 debug_level                         = 0
 /

 &domains
 time_step                           = 180,
 time_step_fract_num                 = 0,
 time_step_fract_den                 = 1,
 max_dom                             = 3,
 e_we                                = 300, 241, 301, 301,
 e_sn                                = 220, 202, 283, 301,
 e_vert                              = 39,   39,  39,  39, 
 p_top_requested                     = 5000,
 num_metgrid_levels                  = 32,
 num_metgrid_soil_levels             = 4,
 eta_levels			     = 1.0000, 0.9979, 0.9956, 0.9931,
				       0.9904, 0.9875, 0.9844, 0.9807,
				       0.9763, 0.9711, 0.9649, 0.9575,
				       0.9488, 0.9385, 0.9263, 0.9120,
				       0.8951, 0.8753, 0.8521, 0.8251,
				       0.7937, 0.7597, 0.7229, 0.6833,
				       0.6410, 0.5960, 0.5484, 0.4985,
				       0.4467, 0.3934, 0.3393, 0.2850,
				       0.2316, 0.1801, 0.1324, 0.0903,
                                       0.0542, 0.0241, 0.0000
 dx                                  = 27000,   9000,   3000,	1000,
 dy                                  = 27000, 	9000,   3000,	1000,
 
 grid_id                             = 1,     2,     3,	   4,
 parent_id                           = 1,     1,     2,	   3,
 i_parent_start                      = 1,   140,    80,  140,
 j_parent_start                      = 1,    80,    50,  110,
 parent_grid_ratio                   = 1,     3,     3,    3,
 parent_time_step_ratio              = 1,     3,     3,    3,
 feedback                            = 0,
 smooth_option                       = 2
 /

 &physics
 physics_suite                       = 'CONUS'
 
 cu_physics                          = 6,     6,     0,    0,

 radt                                = 30,    30,    30,  30,
 bldt                                = 0,     0,     0,    0,
 cudt                                = 5,     5,     5,    5,
 icloud                              = 1,
 num_soil_layers                     = 4,
 num_land_cat                        = 21,
 sf_urban_physics                    = 0,     0,     0,    0,
 sst_update	            		     = 0,
 /

 &fdda
 /

 &dynamics
 w_damping                           = 0,
 diff_opt                            = 1,      1,      1,    1,
 km_opt                              = 4,      4,      4,    4,
 diff_6th_opt                        = 0,      0,      0,    0,
 diff_6th_factor                     = 0.12,   0.12,   0.12, 0.12,
 base_temp                           = 290.                          
 damp_opt                            = 0,                            
 zdamp                               = 5000.,  5000.,  5000.,5000.,
 dampcoef                            = 0.2,    0.2,    0.2   0.2
 khdif                               = 0,      0,      0,    0,
 kvdif                               = 0,      0,      0,    0,
 non_hydrostatic                     = .true., .true., .true..true., ,
 moist_adv_opt                       = 1,      1,      1,    1,       
 scalar_adv_opt                      = 1,      1,      1,    1,       
 gwd_opt                             = 0,
 /

 &bdy_control
 spec_bdy_width                      = 5,
 spec_zone                           = 1,
 relax_zone                          = 4,
 specified                           = .true., .false.,.false.,.false.,
 nested                              = .false., .true., .true., .true.,
 /

 &grib2
 /

 &namelist_quilt
 nio_tasks_per_group = 0,
 nio_groups = 1,
 /
```
### 计划任务
之后crontab配合自动运行脚本，每晚0:45开始执行，利用12Z数据，积分步长120s，尝试做未来5天预报。
自动运行脚本：
``` bash
#!/bin/sh

LID=`date -d '1 days ago' +%Y%m%d`
LID_NLS=`date -d '1 days ago' +%Y-%m-%d`
LID_NLE=`date -d '-4 days ago' +%Y-%m-%d` # 5 days later, for forecast

WPSDIR=/home/lzhenn/package/WPS
WRFDIR=/home/lzhenn/array/lzhenn/WRFV3/run
LOGFILE=/home/lzhenn/workspace/wrf-sdpwfe/sys-log/${LID}.log
GFSDIR=/home/lzhenn/array/lzhenn/gfs_fcst/$LID



############ Fetch GFS ##############

echo "Forecast ${LID_NLS} to ${LID_NLE}"
echo "Fetching GFS data..."
python fetch_gfs.py

############## WPS ##################
cd $WPSDIR 
# Clean WPS data

echo "Clean WPS..."
rm -f met_em.*
rm -f GFS:*
rm -f SST:*

# Process GFS

## Modify date and GFS
echo "Working on WPS..."
sed -i "/prefix/s/^.*/ prefix = 'GFS',/g" namelist.wps
sed -i "/start_date/s/^.*$/ start_date = '${LID_NLS}_12:00:00','${LID_NLS}_12:00:00','${LID_NLS}_12:00:00','${LID_NLS}_12:00:00',/g" namelist.wps
sed -i "/end_date/s/^.*$/ end_date = '${LID_NLE}_12:00:00','${LID_NLE}_12:00:00','${LID_NLE}_12:00:00','${LID_NLE}_12:00:00',/g" namelist.wps

echo "Working on WPS->Ungrib GFS..."
ln -sf ungrib/Variable_Tables/Vtable.GFS Vtable
./link_grib.csh $GFSDIR/gfs* 
./ungrib.exe >& $LOGFILE

## Modify  GFS SST
echo "Working on WPS->Ungrib SST..."
sed -i "/prefix/s/^.*/ prefix = 'SST',/g" namelist.wps

ln -sf ungrib/Variable_Tables/Vtable.SST Vtable
./ungrib.exe >& $LOGFILE

echo "Working on WPS->Metgrid..."
./metgrid.exe >& $LOGFILE

############## WRF ##################
echo "Working on WRF->REAL..."
cd $WRFDIR

YYYY_NLS=`date -d '1 days ago' +%Y`
YYYY_NLE=`date -d '-4 days ago' +%Y`

MM_NLS=`date -d '1 days ago' +%m`
MM_NLE=`date -d '-4 days ago' +%m`

DD_NLS=`date -d '1 days ago' +%d`
DD_NLE=`date -d '-4 days ago' +%d`

sed -i "/start_year/s/^.*$/ start_year                          = ${YYYY_NLS}, ${YYYY_NLS}, ${YYYY_NLS}, ${YYYY_NLS},/g" namelist.input
sed -i "/end_year/s/^.*$/ end_year                            = ${YYYY_NLE}, ${YYYY_NLE}, ${YYYY_NLE}, ${YYYY_NLE},/g" namelist.input
sed -i "/start_month/s/^.*$/ start_month                          = ${MM_NLS}, ${MM_NLS}, ${MM_NLS}, ${MM_NLS},/g" namelist.input
sed -i "/end_month/s/^.*$/ end_month                          = ${MM_NLE}, ${MM_NLE}, ${MM_NLE}, ${MM_NLE},/g" namelist.input
sed -i "/start_day/s/^.*$/ start_day                          = ${DD_NLS}, ${DD_NLS}, ${DD_NLS}, ${DD_NLS},/g" namelist.input
sed -i "/end_day/s/^.*$/ end_day                          = ${DD_NLE}, ${DD_NLE}, ${DD_NLE}, ${DD_NLE},/g" namelist.input

rm -f met_em.d0*
rm -f wrfout_d0*
rm -f wrfinput_d0*
rm -f wrflowinp_d0*
rm -f wrfbdy_d0*
ln -sf $WPSDIR/met_em.d0* ./
./real.exe >& $LOGFILE

echo "Working on WRF->WRF..."
mpirun -np 16 ./wrf.exe

```
**Updated 2018-01-07**

### 执行测试

测试预报，发现如下问题：
1. domain区域有问题，竟然d03居然框在勘察加半岛附近，经检查为WPS的ref_x和ref_y的问题，调整为d01中点后，
2. 五天预报利用现有机器完全无法完成，3天大概需要9小时，发现问题1后怀疑为区域设置错误，高纬度地图因子问题，重新调整积分步长为180s进行测试。
``` fortran
ref_x     =  150.0,
ref_y     =  110.0, 
```

**Updated 2018-01-16**

### 运行时间问题

系统按计划任务运行了一天，发现会在运行结束附近提示无法找到更新的边界条件，然后不停写log无法退出。非常不理解，毕竟到这个时候应该终止才对呀。经查发现是wrf的namelist run days依然写的五天。调整后正常。

目前的问题是依然不能在上午九点之前运行完，后面需要考虑调整domain大小。

**Updated 2018-01-16**
---
layout: post
title:  "买房的财务安全边际计算"
categories: economy
tags:  housing thinking accounting
author: LZN
---

* content
{:toc}

我们首先假定长期贷款下总资产负债率在50%一下为财务安全边际。
假设房产目前价值为A，家庭现有净资产为B，总资产为C，首付率为alpha，总资产负债率为

R=((C-B)+(1-alpha)*A)/(A+C)<=0.5

整理可得，净资产
B>(0.5-alpha)*A+0.5*C

假设首付率为0.3

B>0.5*C+0.2*A

假设家庭本身无负债，B=C

B>(2/5)*A

因此，在30%首付、家庭无负债的条件下，对于一套500万的房子，总资产大于200万达到购入的安全边际。对于小户型，假设180万，家庭总资产大于72万为安全边际。

再考虑50%首付的情况，这是个很有意思的阈值，在50%首付的前提下，只要初始家庭负债率小于50%即可满足条件，与房产价格无关。是否矛盾，并不，因为还有一个隐含条件是，家庭能够承担买房首付，若不讨论资产是否具有高流动性，至少有C>0.5A。


---
layout: post
title:  "Ubuntu开机启动"
categories: linux
tags:  ubuntu server
author: LZN
---

* content
{:toc}

想要让本地的个人博客服务开机后即启动，测试了下，路径敏感。
修改rc.local
```bash
$sudo vi rc.local
```
其中加入
```bash
cd $YOUR_REPO
sudo jekyll s
```
---
layout: post
title:  "庞氏骗局不破灭的条件"
categories: economy
tags:  ponzi thinking blog
author: LZN
---

* content
{:toc}

这几天经常听闻各种借新还旧的庞氏骗局玩不下去了。突发奇想，能否构建个模型了解下庞氏骗局不破灭大概要维持个什么样的条件。

假设庞氏骗局的起始资金为a，年规模增长率为i，承诺年化收益率为r，假定非法集资不产生任何收益，集资者也没有挥霍浪费。则第n年末，有：
```   
总资产 A=a*(1+i)^n
总负债 L=a*(1+r)^n
```
很显然，若有i>=r，则庞氏骗局一定不会破灭。也就是说，新韭菜带来的资产增长率大于承诺给老韭菜的收益率即可。这是骗局初期的情况，集资人或者传销者能够以种种手段快速骗取资金，不断扩大自己的资产负债表。
当骗局发展到一定阶段，由于庞大的基数效应，无论怎样都不能保持i>=r，我们将模型进一步复杂化，继续讨论i<r的情况：

一般来说，赎回额应该与骗局规模呈正相关，假定骗局要求只能在年末赎回，且赎回额与总负债（这是承诺应有）的关系为一固定比例k，那么第n年末这一骗局的资产负债状态：
``` 
总资产 A=a(1+i)^n-k*a(1+r)^n
总负债 L=a*(1-k)*(1+r)^n
```
i<r，很明显从现金流角度而言这是一个收不抵支的状态，我们进一步看看上述资产负债情况的一些属性：
若不破灭，要求总资产大于等于0，则要求k
```
k<=((1+i)/(1+r))^n
```
这就有意思了。我们假定某一骗局承诺50%回报，且韭菜资金增长率随时间指数递减，第一年韭菜增长率有4倍的话，给出一个例子如下：

![](http://ww1.sinaimg.cn/large/73ebdc71gy1fn37m4q1sij207707ntae.jpg)

结果非常有趣，很显然对于这样一个骗局，若新韭菜增长率每年都以前一年一半的速度下降的话，那么前4年不存在任何的兑付问题。
而第五年形势急转直下，要求兑付额不能超过承诺额的40%，这是一大坎；而第六年则不到18%，联想到某宝事件能够撑到第七年，当真是牛啊……

---
layout: post
title:  "给博客增加了一个随机展示内容的功能"
categories: network javascript
tags:  json ajax jekyll javascript blog
author: LZN
---

* content
{:toc}

给主页加了一个小模块，随机显示一些自己value的原则性内容，折腾了一下午，记录一下：

首先也是考虑到服务器端传文件下来，然后用javascript解析后post上去，但是代码简单测试了下没有起效。没细究原因，查了下能否用jekyll实现，结果发现jekyll只是在build过程中随机一下，并不能在页面刷新时随机。这样很正常嘛，本身就是静态网页啦。

所以还是回到刚刚的思路，查了下解决方案，发现是自己定义了函数但是木有执行。在定义后加入执行代码后，生效。注意对应的json包不能放在jekyll生成的下划线前缀目录下，否则无法获取到。javascript代码：
``` javascript
function showJson(){  
    var test;  
    if(window.XMLHttpRequest){  
        test = new XMLHttpRequest();  
    }else if(window.ActiveXObject){  
        test = new window.ActiveXObject();  
    }else{  
        alert("Browser not supported!");  
    }  
    
    if(test !=null){  
        test.open("GET","/database/principles.json",true);  
        test.send(null);  
        test.onreadystatechange=function(){  
            if(test.readyState==4&&test.status==200){  
                var obj = JSON.parse(test.responseText);  
                var count = Object.keys(obj).length;
                var rnd_pos = Math.floor(Math.random() * count + 1)-1
                document.getElementById("content-principle").innerHTML = obj[rnd_pos].content;
            }  
        };  
    }  
}  
showJson(); 
```

---
layout: post
title:  "干掉僵死ssh进程"
categories: network linux
tags:  ssh server
author: LZN
---

* content
{:toc}

有的时候网络不稳定，断掉后再登录发现服务器上依然有ssh的会话，按理说应该跳出才对。这时可以用pkill来杀死对应的session，例如：
``` bash
pkill -kill -t pts/2
```
---
layout: post
title:  "Forbes分析与财务目标"
categories: principle 
tags:  thinking blog
author: LZN
---

* content
{:toc}
查了下福布斯实时榜单，居然发现1 Billion以上2000多富豪列表完全就是个硕大的table，果断down下来做点分析啥的。比如富豪里的基尼系数，嘿嘿，两千多样本可以啦。
子样本也可以计算大陆的情况。不过呢，更关心的是个人的排位以及按高考成绩排位对应的财富目标。虽然相关计算早完成了，可惜的是实验室服务器硬盘问题，诶。这次做个更好的。

留坑，回填。

**Updated 2018-01-10**
---
layout: post
title:  "利用imagemagick去除png白边"
categories: linux
tags:  imagemagic
author: LZN
---

* content
{:toc}

给生成的wrf预报图去除白边，搜索发现imagemagick大神级命令直接搞定，当然算法本身不复杂，毕竟plot出的图边框都是255，但是有这个命令实在太方便了。
``` bash
# Add border
convert aaa.png -bordercolor white -border 10%x10% bbb.png 
# Delete border
convert bbb.png -bordercolor white -trim ccc.png
```


**Updated 2018-01-16**
---
layout: post
title:  "利用pandas生成excel文件"
categories: python
tags:  pandas excel 
author: LZN
---

* content
{:toc}
需要将几个pandas生成的csv文件合并到excel的不同sheets里，手动是一件比较蛋疼的工作，查了下python对excel的支持，发现pandas天生支持这类操作，大喜过望。测试之。
pandas写出xls简直像csv一样简单，而且是内生支持，不需要安装任何其他库。

以应用情景为例，写入不同的sheets，具体如下：

``` python
# open a new xlsx writer
writer1 = pd.ExcelWriter(out_dir+get_outfile_name(sta_num, 'Daily'))
for pos, spe in enumerate(species):
    # parser data
    pt=pd.read_csv(in_dir+get_file_name(sta_num, corr_algthm, spe, 'Daily'), parse_dates=True, skiprows=1, names=['time', '10H', '12H', '14H', '16H', 'max'], index_col='time')
    pt.to_excel(writer1, spe)
# save xlsx
writer1.save()
```


**Updated 2018-01-16**
---
layout: post
title:  "2017投资小结与2018年的交易逻辑"
categories: economy investment
tags:   thinking investment
author: LZN
---

* content
{:toc}

17年的交易逻辑的确太嫩了，若不是最后一个月通胀预期起来，恐怕一整年收益跑不过货币基金。最主要的三条经验教训如下：

1. 信仰价投，左侧交易就代表要在市场非理性的时候拿得住，流动性保证和严格按照交易系统策略交易非常重要，止损位置应该在安全边际以下某一范围。如果胆小，仓位控制不超过10%，真破产就当作慈善了吧。毕竟杠铃策略完全可以保证无风险一端的基本cover激进端平均一年一个负面黑天鹅的损失。
2. 逻辑对的情况下，却不能低估市场非理性的时间。上升期更是这样，不要猜顶，不轻易做空头。杠铃策略，与泡沫共舞，用正头寸收益养put。
3. 尽管看准了不少标的，还是要记住，这是牛市给的，不要忘了最大的一个没看准的标的是USD，或许逻辑没错，时间尺度错了，但是教训应该是择时上恪守左侧交易为主，右侧控制好头寸的策略。

2018年逻辑应该基本清晰：油价 通胀 波动率。标的也非常清晰，除了上述三点教训，还是要注意仓位控制和恪守逻辑和策略。不贪不惧，多看书少看盘。毕竟目标很简单，跑赢无风险4%而已，去年目标是不亏，最后却完成了今年的目标不是。


**Updated 2018-01-18**
---
layout: post
title:  "模型化分析职业选择上反脆弱策略的收益条件"
categories: economy investment 
tags:   thinking investment career antifragile
author: LZN
---

* content
{:toc}

今天上午聊天的时候讨论到all in情况下，在领域前端的边际收益无法覆盖去了解其他领域既成知识体系的机会成本，突然想到应该可以建立一个模型去分析，在怎样的条件下，拒绝all in而采用反脆弱策略，效用能够接近all in所可达到的高度？

简单整理下这个模型应该包括的要素：

* 行业的效用收益分布：幂律
* 行业的成本分布：幂律
* all in的时间投入，承担的风险（如何定价？）
* all in情况下的期望位置
* antifragile的分支点位置
* antifragile的情况下其他领域的收益分布和成本分布

时间投入应该是个守恒量，最终效用如何评定？这个模型应该要比收入分布讨论的模型复杂很多。
继续挖坑回填。

应该先建立效用函数，确定几个维度，然后按照边际效用递减原则对各个维度的情况打分，最终应该评价效用最大。
资料：
1. [收入和幸福感](https://www.zhihu.com/question/24123648/answer/27911498)
2. [构建效用函数据](https://www.jianshu.com/p/d3533cf12209)
3. [个人效用函数](http://daily.zhihu.com/story/8280265)

**Updated 2018-01-20**
---
layout: post
title:  "python import其他文件"
categories: python
tags: python_import
author: LZN
---

* content
{:toc}

交易系统下希望将策略(strategy)和评估(evaluator)分离，这样就需要评估系统调用相应的策略，其实可以用简单的import解决，只是注意python仅仅把当前路径加入搜索目录，如果策略不在当前路径的话，则采用sys模块加入策略路径即可：

``` python
import sys
sys.path.append(path_to_strategy)
from buy_and_hold import buy_and_hold as strategy

strategy()
```
就是这么简单。

**Updated 2018-01-25**
---
layout: post
title:  "Mercurius交易策略系统搭建"
categories: economy investment python modeling 
tags: thinking investment career quandl blog
author: LZN
---

* content 
{:toc}

## 楔子

昨晚和老板以及另一位教授吃了顿饭，本来很不想去，结果却有意外收获。教授直言不讳地说明了就业形势（趋势）的严峻程度，无论中美，无论天气气候。如果美国作为小政府大市场的存在能够快速试错转向，那么中国政策性红利的影响可能会造成更严重的错配。

基本印证了我基于搜集到的资料作出的推断。昨天这一事件进一步说明了搜集机会的重要性，还是应该多接触，吃顿饭的时间，机会成本也很低。

事不宜迟，我想时间精力分配上可以从五五开转到七三开了。言归正传，开始试着搭建自己的交易系统。

## 前期准备

交易系统命名是个技术活，找个西方财神的名字吧，最早发现希腊神话里是赫尔墨斯，这个英文拼写后来被爱马仕用了，略坑。对应罗马神话是墨丘利，水星，不错，就用Mercurius好了。维基百科的介绍

> 墨丘利（拉丁语：Mercurius）是罗马神话中为众神传递信息的使者，相对应于希腊神话的赫耳墨斯（Hermes）。他的形象一般是头戴一顶插有双翅的帽子，脚穿飞行鞋，手握魔杖，行走如飞。墨丘利是丘比特和迈亚的儿子，是医药、旅行者、商人和小偷的保护神，西方药店经常用他的缠绕两条蛇的手杖作为标志。

> 此外，由于水星在天上运行的速度很快，所以亦用了他的名字而命名。

以及对赫尔墨斯的描述：

> 变化多端、圆滑机灵的盗贼，他带给人梦境，是夜里守望者，门外的小偷，在长生不老的众神里最先展示善意的人。

### 数据搜集系统

没数据就是无米之炊，首先搭建爬虫系统搜集数据。目前的想法是先写specific脚本把存量拉下来，再用crontab每日update，分辨率到日即可，简单起见先拿大宗下手。

数据源选择quandl和yahoo-finance，国内数据之前在某量化课件上看到个源，后续再说。

**Updated 2018-01-25**
---
layout: post
title:  "利用pandas处理csv文件注意"
categories: python
tags:  pandas
author: LZN
---

* content
{:toc}

写交易系统时为了让credentials在代码里不可见，用pandas读取csv获取，使用中发现一坑，把index_col设置后，竟然无法用`pd['$IND_NAME']`去引用对应idx的行，估计又是各种坑爹对象类型不匹配。
解决方法也很简单，用pandas的loc方法：

``` python
print(pd_cre.loc['quandl','cred'])
```


**Updated 2018-01-25**
---
layout: post
title:  "CESM air-sea decoupling测试"
categories: modeling meteorology 
tags: CESM decoupling
author: LZN
---

* content
{:toc}

在之前MM高原试验基础上，应黄老师要求增加北大西洋SST restoring的试验。因通量计算在海洋模块进行，所以应该在海洋模块计算之前修改并update。

查到论坛[帖子](https://bb.cgd.ucar.edu/how-prescribe-sst-annual-cycle-cesm-pop2)，以及HC师兄提供的code.

看帖子似乎有namelist变量控制。找到一个NCAR的github主页[内容](https://ncar.github.io/POP/doc/build/html/users_guide/running-forcing-options.html),不过是针对只转海洋模式的情况。

经查HC师兄的code，发现思路比较简单，就是在海洋模块每一次积分step后，用人工读入的文件做restoring。不过貌似还有可以优化的地方，读文件模块应该可以放到其他module，避免模式每一积分步都在读写。

测试编译一次通过。Nice.关键是拿到对应的文件，并进一步优化一下程序流程。

POP的history文件比较诡异，不仅有.h文件，还有.h.nday1文件。

在faq找到了[关于nday1的说明](http://www.cesm.ucar.edu/models/cesm1.0/pop2/doc/faq/#tavg_files)

> By default, the daily averaged fields are bundled into monthly timeseries files. These files are relatively small, because they contain only a handful of 2D fields. Out of the box, these fields are: Surface Potential Temperature (SST), SST2, Mixed-Layer Depth, and Maximum Mixed-Layer Depth.

这个文件在之前run ctrl的时候并没有存下，那么接下来的问题就是月平均文件是否足以提供full layer海温，包括SST呢？

瞄了一下h文件，发现第一层代表10m深的水，那么应该是没问题的了，直接restore 10m水深。

**Updated 2018-01-28**

继续看，存储位温的变量是TRACER，但这个变量比较诡异，是一个6维的数据，0 1 2 容易理解，是经纬度，和层次数，第1层为10m水深。3不知道是什么，4是previous/current时间帧，最后一维是iblock用于MPI分片。
问题就是神奇的第3维。

检查了下程序，发现第3维的循环控制变量bound为nt，step_mod.F90内有以下语句：
``` fortran
   SBUFF_SUM(:,:,iblock,index_o2x_So_t ) =   &
      SBUFF_SUM(:,:,iblock,index_o2x_So_t ) + delt*  &
                                   TRACER(:,:,1,1,curtime,iblock)

   SBUFF_SUM(:,:,iblock,index_o2x_So_s ) =   &
      SBUFF_SUM(:,:,iblock,index_o2x_So_s ) + delt*  &
                                   TRACER(:,:,1,2,curtime,iblock)

```
进一步查找，发现prognostic.F90有以下定义
``` fortran

   type (tracer_field), dimension(nt) :: &
      tracer_d   ! descriptors for each tracer

!......
      tracer_d(1)%short_name = 'TEMP'
      tracer_d(1)%long_name  = 'Potential temperature'
      tracer_d(1)%units      = 'degC'
      tracer_d(1)%tend_units = 'degC/s'
      tracer_d(1)%flux_units = 'degC cm/s'
      tracer_d(1)%scale_factor = 1.0_rtavg

      tracer_d(2)%short_name = 'SALT'
      tracer_d(2)%long_name  = 'Salinity'
      tracer_d(2)%units      = 'msu (g/g)'
      tracer_d(2)%tend_units = 'gram/kilogram/s'
      tracer_d(2)%flux_units = 'gram/kilogram cm/s'
      tracer_d(2)%scale_factor = 1000.0_rtavg

```
明白啦，1是位温，2是盐度。所以修改思路就很明确了：
1. 读入SST文件和weight文件
2. 在每一个step后对SST进行overwrite处理

逐一解决！首先看怎么找个合适的地方把文件送进来。这种任务当然在模式initial的时候干。

以read为关键词搜索，锁定文件IO位置。发现不少东西，比如pop设置了专门的forcing模块用于外强迫驱动。但因为forcing模块只有在单独海洋的时候才调用,为保证代码具有较高的可复用性，安全起见，我们还是首先考虑在initial module找读取外强迫场的语句。
然后呢，在initial.F90发现了这么一段可爱的内容：
``` fortran
!-----------------------------------------------------------------------
!
!  read full 3-d t,s from input file
!
!-----------------------------------------------------------------------

   case ('ccsm_startup', 'file')
      first_step = .true.

      if (my_task == master_task) then
         write(stdout,'(a31,a)') 'Initial 3-d T,S read from file:', &
                                 trim(init_ts_file)
         call POP_IOUnitsFlush(POP_stdout) ; call POP_IOUnitsFlush(stdout)
      endif

      allocate(TEMP_DATA(nx_block,ny_block,km,max_blocks_clinic))

      in_file = construct_file(init_ts_file_fmt,             &
                               full_name=trim(init_ts_file), &
                               record_length = rec_type_dbl, &
                               recl_words=nx_global*ny_global)
      call data_set(in_file,'open_read')

      i_dim = construct_io_dim('i',nx_global)
      j_dim = construct_io_dim('j',ny_global)
      k_dim = construct_io_dim('k',km)

      io_temp = construct_io_field('TEMPERATURE', &
                 dim1=i_dim, dim2=j_dim, dim3=k_dim,        &
                 field_loc = field_loc_center,    &
                 field_type = field_type_scalar,  &
                 d3d_array=TEMP_DATA)
      io_salt = construct_io_field('SALINITY',    &
                 dim1=i_dim, dim2=j_dim, dim3=k_dim,        &
                 field_loc = field_loc_center,    &
                 field_type = field_type_scalar,  &
                 d3d_array=TEMP_DATA)

      call data_set(in_file,'define',io_temp)
      call data_set(in_file,'define',io_salt)

      call data_set(in_file,'read'  ,io_temp)
      do iblock=1,nblocks_clinic
         TRACER(:,:,:,1,curtime,iblock) = TEMP_DATA(:,:,:,iblock)
      end do
      call data_set(in_file,'read'  ,io_salt)
      do iblock=1,nblocks_clinic
         TRACER(:,:,:,2,curtime,iblock) = TEMP_DATA(:,:,:,iblock)
      end do

      call destroy_io_field(io_temp)
      call destroy_io_field(io_salt)

      deallocate(TEMP_DATA)

      call data_set(in_file,'close')
      call destroy_file(in_file)

      if (my_task == master_task) then
         write(stdout,blank_fmt)
         write(stdout,'(a12,a)') ' file read: ', trim(init_ts_file)
         call POP_IOUnitsFlush(POP_stdout) ; call POP_IOUnitsFlush(stdout)
      endif

```
嘿嘿，和HC师兄的程序对比，如出一辙。那么我们仅仅需要在某一个合适的地方给出读取forcing场的语句就可以了。注意initial读取的时候是没有时间帧的，所以我们需要读入时间帧，并且把变量传参到step_mod或者main driver程序中。
接下来我们看如何解决这两个问题。时间问题容易解决，HC师兄的程序里给出了，直接通过dim来指定时间维即可，关键是construct_io_field这个语句，查下这个语句的定义。在io_types.F90:
``` fortran
 function construct_io_field (  & 
       short_name,       &    
       dim1, dim2,       &    
       dim3,             &    
       time_dim,         &    
       long_name,        &    
       units,            &    
       coordinates,      &    
       grid_loc,         &    
       valid_range,      &    
       field_loc,        &    
       field_id,         &    
       field_type,       &    
       i0d_array,        &    
       i1d_array,        &    
       i2d_array,        &    
       i3d_array,        &    
       r0d_array,        &    
       r1d_array,        &    
       r2d_array,        &    
       r3d_array,        &    
       d0d_array,        &    
       d1d_array,        &    
       d2d_array,        &    
       d3d_array)        &    
    result (descriptor)
```
dim123时间都给考虑好了，意不意外，惊不惊喜？依葫芦画瓢往里送就行了。

几个神奇的参数：

``` fortran
 character(4), intent(in), optional :: &
    grid_loc                  ! position of field in staggered grid
 
 integer (i4), intent(in), optional :: &  ! for ghost cell updates
    field_loc,               &! staggering location
    field_type,              &! field type (scalar,vector,angle)
    field_id                  ! previously defined id

```
首先的神奇之处是grid_loc，这什么鬼，虽然模板里给了3111代号，但是毕竟好奇，搜索下发现tavg.F90有如下语句：
``` fortran
      if (present(grid_loc)) then 
         !*** try to decode field location from grid_loc
         if (grid_loc(2:2) == '1' .and. grid_loc(3:3) == '1') then 
            tavg_field%field_loc = field_loc_center
         else if (grid_loc(2:2) == '2' .and. grid_loc(3:3) == '2') then 
            tavg_field%field_loc = field_loc_NEcorner
         else if (grid_loc(2:2) == '1' .and. grid_loc(3:3) == '2') then 
            tavg_field%field_loc = field_loc_Nface
         else if (grid_loc(2:2) == '2' .and. grid_loc(3:3) == '1') then 
            tavg_field%field_loc = field_loc_Eface
         endif
      endif
```
东西南北？看起来是位于格点什么位置的指示。还有那些r2d_array, d2d_array代表的是数据精度real,double之类（居然没写注释！也是醉了）
查pop log发现了这个东西
```
                                             2                                        30   
                                          ________                                    31   
                      y ^                |        |                                   32   
                        |               3|   ijk  |1                                  33   
                        +--->            |        |                                   34   
                            x            |________|                                   35   
                                             4                                        36   
```
居然有这么可爱的图示……

**Updated 2018-01-29**

下面我们测试在main driver函数ocn_comp_mct.F90里读入一个既存的NC文件。为了效率，当然不能在run的时候每一步都读入，仅仅在initial的subroutine读入。initial和run都在ocn_mct的大module中，因此变量彼此应当可见互用。

写的时候发现一堆全局变量满天飞，POP的软件工程做得真是醉醉的……

增加namelist变量需要让bld namelist程序认识，根据[这个帖子操作](https://bb.cgd.ucar.edu/how-add-new-namelist-variables)

增加两个subroutine，一个负责在initial的时候读取forcing文件，另一个负责在pop积分步后给出reset。

写好后发现一个大坑，由于IO module默认没有对3D var+时间的变量进行处理，如果手动增加这一功能需要改动非常多的模块，只能退而求其次，仅仅对第一层temp进行处理了。具体代码：

``` fortran
! ***LZN: MOD START***
 subroutine ptempforcing_read
   integer (i4) ::  nml_error
   integer (i4) :: decoupling_days=30

   character (char_len) :: &
   ptempf_file_name, &
   ptempf_file_fmt
   type (datafile) :: &
   ptempf_file
   type (io_field_desc) :: &
   io_temp, io_ce
   type (io_dim) :: &
   t_dim, i_dim, j_dim, k_dim
   namelist /ptempf_forcing_nml/ ptempf_file_name, ptempf_file_fmt
   
   allocate(TEMP_DATA(nx_block, ny_block, decoupling_days, max_blocks_clinic))
   allocate(WGT_DATA(nx_block, ny_block, decoupling_days, max_blocks_clinic))
   WGT_DATA=1.0


   ! Read forcing file path from namelist file
   if (my_task == master_task) then
      open (nml_in, file=nml_filename, status='old', iostat=nml_error)
      if (nml_error /= 0) then
         nml_error = -1
      else
         nml_error =  1
      endif
      do while (nml_error > 0)
         read(nml_in, nml=ptempf_forcing_nml,iostat=nml_error)
      end do 
      if (nml_error == 0) close(nml_in)
   end if
   ! broadcast the scalar to all MPI processors
   call broadcast_scalar(ptempf_file_name, master_task)
   call broadcast_scalar(ptempf_file_fmt, master_task)
      
   ptempf_file = construct_file(ptempf_file_fmt, &
               full_name=trim(ptempf_file_name),&
               record_length=rec_type_real,&
               recl_words=nx_global*ny_global)
   call data_set(ptempf_file, 'open_read')

   i_dim = construct_io_dim('i',nx_global)
   j_dim = construct_io_dim('j',ny_global)
   t_dim = construct_io_dim('time',decoupling_days)

   io_temp = construct_io_field('TEMP',dim1=i_dim,dim2=j_dim,dim3=t_dim,&
               long_name='Potential Temperature', units='degC', grid_loc='3111',&
               field_loc = field_loc_center, &
               field_type = field_type_scalar, r3d_array = TEMP_DATA)
   call data_set(ptempf_file, 'define', io_temp)
   call data_set(ptempf_file, 'read', io_temp)

!   ru_data = construct_io_field('ru', dim1=i_dim, dim2=j_dim,&
!             long_name='nudging coefficients', units='1',&
!             grid_loc=' 3111', field_loc = field_loc_center,&
!             field_type = field_type_scalar, r2d_array = ru)
!   call data_set(sstf_file, 'define', ru_data)
!   call data_set(sstf_file, 'read', ru_data)

   call data_set(ptempf_file, 'close')
   call destroy_io_field(io_temp)
!   call destroy_io_field(ru_data)
   call destroy_file(ptempf_file)

 end subroutine ptempforcing_read
 
 ! fixing the SST!
 subroutine ptempforcing_fix
    integer (int_kind) ::  iblock
    ! debug info
    write(stdout,*) iday_of_year, TEMP_DATA(50,50,iday_of_year,:) 


    ! Operation: override the runtime tracer(temp)
    !$OMP PARALLEL DO PRIVATE(iblock)
    do iblock = 1, nblocks_clinic
       TRACER(:,:,1,1,curtime,iblock) =  &
       TEMP_DATA(:,:,iday_of_year,iblock)*WGT_DATA(:,:,iday_of_year, iblock)+ &
       TRACER(:,:,1,1,curtime,iblock)*(1-WGT_DATA(:,:,iday_of_year, iblock))
    end do
    !$OMP END PARALLEL DO
 end subroutine ptempforcing_fix
 ! ***LZN: MOD END***
```
经测试一个月积分没有问题。


**Updated 2018-01-29**
---
layout: post
title:  "追涨杀跌还是买跌卖涨？几个简单策略的实现与横评"
categories: economy investment 
tags:   thinking investment career
author: LZN
---

* content
{:toc}

（文末有福利）

追涨杀跌还是买跌卖涨？无论是投资者还是投机客，这可能是个永恒的问题。
之前刷华尔街见闻的时候发现一个简单的[右侧交易策略](https://wallstreetcn.com/articles/3059211)

>当目前的价格 ＞ 过去12个月的平均价格，那么保持投资（如果没有投资，那么就买入）；
当目前的价格 ＜ 过去12个月的平均价格，那么就全部卖出，持有现金（或债券）。

很有意思，回测也很不错。感觉原则就是，趋势来了我贪心，趋势走了我就离场，而且坚决不回来。不过对于我这种左侧交易者来说，在上升时期宁可hold也不愿意加仓。这个策略很简单，应可以作为一个出发点，后面按自己的理解来进行一些修正。尤其对于我这种喜欢左侧交易和网格策略的～

**Updated 2018-01-23**

正巧需要构建自己的Mercurius交易系统，不妨先实现几个策略做回测试试，标的的话，就选黄金好了，当然一般来说，黄金并不是什么好的投资标的。不过俺们就是这么俗，土豪金谁人不爱～

一共写了三套策略：

* 佛系策略一把梭：Buy and Hold
* 极端贪心与恐惧：Up in and Down out
* 传说中的网格提款机：Grid Trading

回测采用日均值，还没来得及写年化收益，最大回撤、夏普ratio等统计指标，先简单看图吧。首先我们以满仓10000美元的buy and hold策略，来看黄金自2000年以来的表现情况：

![](http://ww1.sinaimg.cn/large/73ebdc71ly1fnyyomaw8dj21720lwn15.jpg)

很明显，黄金从00年开始，随着全球的货币大宽松走出了一个长期牛市，主升浪在2008金融危机之后。到2011年上半年，净值翻了六倍多，随后由于美国逐渐退出QE，走熊直到2016年初（怎知16-now这波不是反弹？嘿嘿）。

作为对策略的压力测试，当然先看熊市表现啦。

![](https://ws1.sinaimg.cn/large/73ebdc71ly1fnyyxcwibmj216u0l4q8g.jpg)

结果还是很有趣的，从投资（机）总效果来看，up in and down out相比于佛系的buyNhold最终表现仅仅略微好一点点，大概也就少损失个一两百刀。过程中我们可以看到金价多次出现假突破，从而使得策略不断进出，在不计交易费用的情况下相比佛系投资还有一点优势，如果存在交易成本，那怕是必然亏更多的。
当然改进的方法也很简单，比如每隔一个period进行一次检测，这样能够避免频繁假突破时的频繁交易。

值得注意的是，这一贪心策略可以确保在市场急剧下跌期间保持极高的（100%）持现比例，你不爱我绝不回头～一手现金dry powder。充沛的流动性在手给了标的走熊期间去发掘其他资产的机会。

如果我们cover牛市，从2008年到现在呢？看这十年间会发生什么。

![](https://ws1.sinaimg.cn/large/73ebdc71ly1fnyzav3p53j216u0l4tey.jpg)

Oops！居然无法跑赢佛系buy and hold。这还算在木有交易费用的情况下。矬了吧～主要问题在于前期高频箱体振荡期间出现频繁买卖，而买点恰巧错过一批疾速上涨期，随后基本一直落后buy and hold。

我们再看所谓的网格提款机的效果。我喜欢的左侧交易策略表现又如何呢？

![](https://ws1.sinaimg.cn/large/73ebdc71ly1fnyzm26xq6j216u0l4agu.jpg)

嘿嘿！大网格熊市各种睥睨佛系一把梭，我们看到几个酷炫的买点基本都出现在市场底部，然后前期两次出网很酷炫得锁定了收益，随后剧烈走熊阶段不断加仓压低成本，可惜13年中即已满仓，一直到16的市场底部只能不断观望。但是最终到18年初，我们可以看到网格策略仅仅承担了不到10%的账面亏损，而佛系一把梭却有接近20%的账面亏损。

那么牛市呢？

![](https://ws1.sinaimg.cn/large/73ebdc71ly1fnyzri1hp8j216u0l4tf5.jpg)

哎哟不错诶。虽然赶不上一把梭的痴长，但是基本保持了数量级相当的收益。不过值得注意的是，在牛市启动阶段，网格卖出所有的quota之后即因成本持续低于市值而按兵不动，所以后续基本相当于大半仓位下buy and hold。注意到09年的turmoil阶段网格抓到了几次低位买点，那么我们将时间尺度继续拉长，是否还能获得如此不错的表现呢？

![](https://ws1.sinaimg.cn/large/73ebdc71ly1fnyzvibso0j216v0l4dlm.jpg)

显然，从00年到现在，网格策略远远落后于buy and hold，主要原因也很简单，人家满仓，我们却基本半仓走了快二十年，最终大概只能获得佛系一把梭一半多点的收益。

简单总结一下：

* 贪心的up in down out策略在黄金标的上，无论牛熊的表现都差强人意，但是剧烈走熊期间能够确保足够安全，手中握有大量dry powder。
* 网格策略在熊市期间表现出较好的风控能力，低位吸筹，高位抛出，简单机械的操作能够在保持流动性安全以及抓住收益中取得较好平衡。但是单边牛市（或持久熊市）估计会错过机会（输掉裤衩）。
* 如果在市场低位（如何判断，这可是一个大问题）入场，buy and hold可能是非常优秀的交易策略。（事实上李嘉诚先生基本就是这个策略，关键得有他老人家的眼光呀）

总而言之，眼光决定一切。基本面得抓得准呀。不说了，默默啃书。


Left or right, This is a problem.

**要Code？没问题！瞎捣鼓的[交易系统都是完全开源](https://github.com/Novarizark/mercurius)的啦！几个简单的策略在strategy目录下。欢迎star/fork/diss**

**Updated 2018-01-30**
---
layout: post
title:  "爬取Yahoo Finance美股数据"
categories: economy investment python
tags:   yahoo-finance spider investment python_import stock
author: LZN
---

* content
{:toc}

去年5月就试着用python现成包爬取Yahoo Finance的数据，但是发现坑爹的是在我打算搞这个事情前两天，雅虎改了API爬不到。这次想起来查了下发现已经有相应的fix包了，当然只是临时的。不过无所谓，数据先拉到，后面业务化运行时能用多久用多久咯。

先装包：
``` bash
pip install pandas_datareader
pip install yahoo-finance
pip install fix-yahoo-finance
```
然后就可以快乐地爬数据了。Stock ETF代码可以在[Nasdaq官网](https://www.nasdaq.com/screening/companies-by-name.aspx?letter=A)拿到，这玩意儿一共26个英文字母，我居然手动下完了所有才发现有集中到一起的表格可以下载，shit！
对代码先做了个A-Z排序，加上个随机延时，然后就可以开搞啦。源码如下：
``` python
def mainfunc():

    yf.pdr_override() # fix yahoo finance api

    for item in eq_market:
        pd_symbol=pd.read_csv(eq_path+item+'.csv', index_col='Symbol')
        pos=0
        for symb in pd_symbol.index:
            pos=pos+1
            print('Now download %s@%s (%d/%d)' % (symb, item, pos, len(pd_symbol.index)))
            try:
                df = pdr.get_data_yahoo(symb, start=ini_time, end=end_time)
            except:
                print('i\nError while downloading %s@%s' % (symb, item))

            with open(eq_path+item+'/'+symb+'.csv', 'w') as f:
                df.to_csv(f)
            sptime=random.randint(0,50)/10
            print('\nsleep %4.2fs' % sptime)
            time.sleep(sptime)
```


**Updated 2018-02-04**
---
layout: post
title:  "Javascript响应option OnChange事件"
categories: javascript
tags:  javascript html jekyll
author: LZN
---

* content
{:toc}

Side Project中希望能够通过列表选项调整显示的2D map animation，发现JS不去响应OnChange事件，最早以为是单纯改动src不可行，需要ajax方式做请求，检查后发现调用函数时没有给参数括号，不过为啥chrome不报错，奇怪。具体代码：

```javascript
    function change_gif(selectObj) {
        var img_obj = document.getElementById("mapimg");
        var slc_obj = document.getElementById("select01");
        var opt_value = selectObj.value;
        
        switch (opt_value){
            case "precip":
                img_obj.innerHTML='<img src="https://raw.githubusercontent.com/Novarizark/wrf-sdpwfe/master/fig/precip.gif?'+ (new Date().getTime())+'"/>';
                break;
            case "snow_cover":
                img_obj.innerHTML='<img src="https://raw.githubusercontent.com/Novarizark/wrf-sdpwfe/master/fig/snow-cover.gif?'+ (new Date().getTime())+'"/>';
                break;
        }
    }
 
```
``` html
<select style="margin-bottom: 15px" id="select01" onchange="change_gif(this)">
  <option value="precip">Precipitation</option>
  <option value="snow_cover">Snow Cover</option>
</select>
<div id="mapimg"><img src="https://raw.githubusercontent.com/Novarizark/wrf-sdpwfe/master/fig/precip.gif" /></div>
```
**Updated 2018-01-25**
---
layout: post
title:  "20180207交易笔记"
categories: economy investment notebook
tags:   investment stock market&nbspcrash
author: LZN
---

* content
{:toc}

因为不是day trader，也懒得做短线投机，所以一直觉得没必要写交易日记。不过参与market就是一个假设验证的过程，正巧这几天全球股市暴跌，波动性复活，也不妨投资过程中把整理到的资料和自己的一些想法时不时记录下来，以后也是很好的参考。

之前在[2018年的交易逻辑](https://novarizark.github.io/2018/01/18/2018-investment/)一文中已经对今年的大概逻辑体系总结为 油价 通胀预期 以及波动性回归。具体而言就是油价中枢抬升推动通胀（或预期），随后对应着全球央行的货币政策收紧（或预期），之后是普遍的利率中枢抬升，流动性收缩，权益类资产价格受到打压，久违的波动性上升。逻辑都没错，但没想到这么快。

周二一早醒来就看到ZP的消息“妈的这是股灾了”。我还在想不知道之前网格一路拉到怀疑人生的VIX解套没，打开交易软件一看连续五六格网格止盈单全部挂出去了，直愣愣涨了一倍。
portfolio daily return大概-2%，本来觉得没什么，毕竟其他标的都在跌。可是瞄了一眼总亏损居然全都是xiv这一个标的贡献的，如果没有这个标的的话，做多波动性的仓位直接在股灾时给予正盈利。
若不是long xiv也踩了黑天鹅，这波实实在在践行Taleb的杠铃策略gain from disoder。对冲踩上了，醉了醉了。

瞄了下新闻，发现long xiv的厮们全在盘后狠抛，直接砸下90%，我勒个去。搜了下发现这货如果跌80%+会直接清盘，看起来是躲不开了。此处应总结的原则还是，下手前对对标的无论如何了解都不为过。
上周四居然还有5.2亿跑步long xiv，这下估计埋惨了。

交易xiv的逻辑是，满市场都是被动指数型ETF和机器人的时候，波动性自然下降。所谓的smart beta造成了大量的etf标的集中在为数不多的stock上，反倒集中了风险。预期一致转向波动率增大就是这个结果。具体瞄瞄知乎[这个帖子](https://www.zhihu.com/question/266741454/answer/313475488)。
瞄了下几乎没什么交易量的边缘化个股，果然跌幅远远小于大盘。interesting，或许后面会有一波风格转换。

接下来怎么做？做一下假设验证：

1. 历史回溯的话市场转向一般是双顶，后顶低于前顶，在下一次高位时减仓高债务中小个股。
2. 网格挂VIX
3. 低位买入一定金银对冲
4. 保持持现率75%以上



**Updated 2018-02-07**
---
layout: post
title:  "Shell删除一定大小文件"
categories: linux 
tags:  server shell
author: LZN
---

* content
{:toc}

拖了几次Yahoo的美股daily数据，发现有很多Symbol对应的标的没有数据，对应的文件大小为3Byte。打算做一下清理，查了下删除语句：

```bash
find . -size -4 -exec rm {} \;
```
减号代表小于，不带单位默认为byte。exec是find的参数，具体描述

>-exec： find命令对匹配的文件执行该参数所给出的shell命令。相应命令的形式为'command' { } \;，注意{   }和\；之间的空格。

至于为啥后面要有个大括号 空格 反斜线 然后再分号？如此冗余设计实在让人不爽。查了一下[这个帖子](https://www.crifan.com/linux_shell_empty_curly_bracket_meaning/)刨根问底了一番。具体来说，大括号代表占位符，表示对find出的列表元素，每次展开遍历其中一个，反斜线代表参数范围结束符，分号后面是其他参数了。

**Updated 2018-02-14**
---
layout: post
title:  "Shell采用wait和后台执行实现多进程"
categories: linux 
tags:  server shell
author: LZN
---

* content
{:toc}

[山东半岛预报系统](https://novarizark.github.io/2017/12/31/WRF-shandong-setup/)中后处理部分的NCL串行效率很低，大概要二十分钟到半个小时才能完成绘图。既然任务之间都是独立的，很自然的想法就是能否在shell的环境下实现进程级别的并行化。
差了下其实很简单，只需要在语句后面加入 & 符号放到后台执行即可实现异步，但是后台执行无法捕捉结束位置，wait语句可以解决这个问题，其作用就是等待该语句之前的所有后台任务结束之后，再执行此语句后的任务。例子如下：
```bash
ncl -nQ  180205-plot-precip.ncl &
ncl -nQ  180207-plot-T2m.ncl &
ncl -nQ  180207-plot-RH2m.ncl &
ncl -nQ  180207-plot-UV10m.ncl &
wait
echo("Hello world!")
```
前面四个NCL语句会并行执行（&符号将该命令放入后台执行后立刻执行下一个语句），之后碰到wait，会等待前面四个后台任务中最慢的那个结束，再输出Hello world!

原始脚本处理后，大概只需要三四分钟（不算坑爹慢的git push过程）即可完成所有的绘图操作。惊不惊喜？

**Updated 2018-02-17**
---
layout: post
title:  "《非理性繁荣》和《1929年大崩盘》阅读笔记"
categories: notebook reading economy
tags:  blog thinking market&nbspcrash 
author: LZN
---

* content
{:toc}
寒假回家看完了两本书，一本是Kindle中文版的《非理性繁荣》，另一本也是中文版加尔布雷斯的《1929年大崩盘》。在家看完想趁热打铁写下笔记，奈何懒惰，现在补来。

《非理性繁荣》作者罗伯特·席勒（Robert Shiller）是耶鲁大学的行为金融学教授，2013年诺奖得主。除了这本第一版预言了00年科网泡沫和第二版语言了08年金融危机畅销书之外(据[亚马逊](https://www.amazon.com/Irrational-Exuberance-Revised-Expanded-Third/dp/0691173125/ref=sr_1_1?ie=UTF8&qid=1519524992&sr=8-1&keywords=irrational+exuberance+by+robert+shiller)，这本书第三版发于2016年8月16日)，在Coursera和网易上还有他Financial Markets课程也非常有名。

初读这本书，总会脑海里浮现出在Berkeley Mccone Hall五楼看到的那位地理系老教授：白发苍苍的老人坐在窗边，佝偻着腰背，盯着眼前的屏幕，缓缓敲击着键盘，时不时低头去找键盘上遥远的数字与标点符号。
从本书内容上的理性中立客观，旁征博引细致入微的数据支持与证据链构建；直观感受上来讲，席勒教授就是这么一副兢兢业业老学者的形象。
当然[豆瓣上](https://book.douban.com/subject/26803982/)第三版封面图的时候发现老人家居然这么帅的时候还是很惊讶，典型的Stereotype了。

整本书大致先从历史角度去分析投机性泡沫形成，包括引发事件，预期自我实现的正反馈，市场信心转向等；之后分析了文化因素（欧美移民的重商文化）和行为心理因素（人性因素：贪婪和恐惧）的影响。再后则是分析人类对明显泡沫化的资产进行合理化解释归因的动机。最终给出了切实的投资建议。
记忆比较深的还是老人家对股息的阐述，判断泡沫与否的一个简单方法就是看股息回报率（毫无疑问目前是泡沫期了）。最后关于疾病扩散模型的应用也非常有趣，描述了观点的传播和关注机制对泡沫的影响。
老人家同时也强调市场见顶之后可能多年低迷的可能性，这无论对华尔街还是投机客来说都是致命的。所以老人家建议多元化投资、关注低市盈率、高股息的入场时机，以及增加储蓄率等。
整部作品的基调非常像一部关于投机泡沫的大综述，理性中立客观，数据翔实，论据充分，尤其是用真实数据去评估人们一直以来的认知偏差，长期持股未必会有良好收益，如果在漫漫熊市中长期持股而不摊低成本，整个股指会经过十几年才能回到高位，非常之凄惨（不要忘了仅仅是股指，其中还有乐观主义偏差）。

总之，重要的一点教训就是足够理性，谨慎乐观，注意风险敞口的控制，在最近几年的环境下应该是非常重要的素质。

《1929年大崩盘》则是一部以叙事+数据+资料尽调的方式描述了1929年大崩溃的过程，整部作品读起来并不像《非理性繁荣》那般理中客，但是翔实复现了整个崩溃的过程，并做了简单的后果分析，没有进一步外延到与法西斯上台、以及随之而来的二战的关系。
作品很短，着眼很多关于股市崩盘的特征，比如高位放量，波动性上升，反复磨顶等等，这给了大周期近顶部时的逃脱机会。最后还反驳了一下崩溃后自杀率上升的谣言，总之看下来感觉就是，只要前期不作死加杠杆资不抵债，勒紧裤腰带还是照样能过的。


**Updated 2018-02-27**
---
layout: post
title:  "20180228交易笔记"
categories: economy investment notebook
tags:   investment stock ETF market&nbspcrash
author: LZN
---

* content
{:toc}

前几天与ZP和SC一起讨论了一下ETF和波动性的关系，逻辑上应该比较讲得通，记录一下。首先是在知乎上看到如下讨论：

>ETF turnover rate 多少？ 正常在 5%左右， mutual fund 一年 turnover 多少？ 大概在 30%-40% 左右。 一旦市场出现大批量的卖家和买家，市场上 没有足够的liquidity 去吸收吧， 所以股价才会变动的很大。等到有一天，90%的钱都去了ETF， 应该来说 active 更容易找到 alpha, 但是在钱持续往etf 流的今天，难道不是ETF 的 holding 在完全没有 基本面的情况下不停的涨吗？ 一旦出现大批卖家， it is going to be a bloodbath.

有意思，但是逻辑线还是不清楚。想了想应该是这样:
>**ETF通过低换手率抑制了成分股的波动性，从某种意义上来说，使得市场的投机性降低，这是好的方面；但ETF本身对其标的流通股的吸收使得市场上可以自由交易的标的股数量减少。由于可供交易的流通股数量减少，潜在的大宗买卖对股价的影响增大（潜在波动性增大，盘前盘后若交易成功更容易出问题），而这种缺少流动性市场的大幅度调整可能会进一步影响ETF持仓者的预期，一旦预期一致转向将会造成大量抛盘从而引发系统性风险。**

比较好的应对策略：
>正alpha小盘股+高beta指标股去养大盘etf看跌期权？

**Updated 2018-02-27**
---
layout: post
title:  "Jupyter notebook学习记录"
categories: python notebook
tags:  jupyter&nbspnotebook
author: LZN
---

* content
{:toc}

Jupyter Notebook极端强大，可以直接执行Markdown，执行之后即成为document html。

感叹号(exclamation point)可以用于嵌入bash command:
``` python
!pip install xxx
```

Notebook built-in command叫做Magics，单百分号：Line Magics，双百分号：Cell Magics。
``` python
%lsmagic
```
常用的magic func
``` python
%%HTML  #其后的text会被render为html，可以放入iframe等拖视频过来。
%matplotlib inlin #将matplotlib绘图放到notebook的输出中。

%%javascript
%%bash

% %timeit   #可以测试function的速度
```

甚至可以酷炫地render pandas dataframe，看图，效果真是酷炫到爆炸
![](https://ws1.sinaimg.cn/large/73ebdc71gy1fp0wdaobj5j20s50zzgx8.jpg)

更牛逼的是，居然可以通过file->download as存储为html pdf markdown等各种形式，简直牛逼到爆炸。
我们测试一下，发现html直接把图片存成了一串散列值，markdown的话会把图片和md文件放在一个zip包里。

notebook的存储本质是个json file。


**Updated 2018-03-04**
---
layout: post
title:  "CentOS mysql安装"
categories: linux mysql
tags:  server centos database
author: LZN
---

* content
{:toc}

Mercurius系统后续的数据组织必须要用数据库啦，而且SQL作为基本的程序员技能当然要熟悉啦，跟着youtube教学视频在CentOS下安装mysql server，记录如下：
首先切换到root下安装：
``` shell
yum install mysql mysql-server
```
检查服务状态
``` shell
chkconfig mysqld --list
mysqld          0:off   1:off   2:off   3:off   4:off   5:off   6:off
```
启动服务
``` shell
chkconfig mysqld on 
```

启动开机服务
``` shell
service mysqld start
```

之后给出提示信息：
```
PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !
To do so, start the server, then issue the following commands:

/usr/bin/mysqladmin -u root password 'new-password'
/usr/bin/mysqladmin -u root -h localhost.localdomain password 'new-password'

Alternatively you can run:
/usr/bin/mysql_secure_installation
```
采用第二种方法更加安全。

之后需要输入root密码，注意这个root指代是mysql的root用户的密码，不是系统root用户。

然后的选项一路Y。

登录mysql，在root用户下，直接
``` shell
mysql -p
```
登陆后，我们查看一下用户列表。
``` sql
select Host,User from mysql.user;
```
```
+-----------+------+
| Host      | User |
+-----------+------+
| 127.0.0.1 | root |
| localhost | root |
+-----------+------+
2 rows in set (0.00 sec)
```
添加一个非root用户,密码为password
``` sql
CREATE USER 'lzhenn'@'127.0.0.1' IDENTIFIED BY 'password';
CREATE USER 'lzhenn'@'localhost' IDENTIFIED BY 'password';
```
给予新用户相应权限
``` sql
GRANT ALL PRIVILEGES ON *.* TO 'lzhenn'@'localhost' WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON *.* TO 'lzhenn'@'127.0.0.1' WITH GRANT OPTION;
FLUSH PRIVILEGES;
FLUSH HOSTS;

select Host,User from mysql.user;
+-----------+--------+
| Host      | User   |
+-----------+--------+
| 127.0.0.1 | lzhenn |
| 127.0.0.1 | root   |
| localhost | lzhenn |
| localhost | root   |
+-----------+--------+
4 rows in set (0.00 sec)
```
这里遇到一点与视频教程不太一致的地方（补充：其实密码是password，见前面identified by），新建用户的密码与root密码并不相同，查了下解决方法
``` sql
update mysql.user set password=password('$NEW_PWD') where User="$YOUR_USER_NAME" and Host="localhost";
flush privileges;
```

**Updated 2018-03-05**
---
layout: post
title:  "mysql基本操作"
categories: mysql notebook
tags:  server database 
author: LZN
---

* content
{:toc}


常用命令
``` sql
show databases;
create database test;
use test;
select database(); # show what is the selected database
drop database if exists test;
```
建立好数据库之后，则可以开始建立tables啦，这个过程中需要有一些数据库的设计思路，大概是列出各种table，如下图：
![](https://ws1.sinaimg.cn/large/73ebdc71gy1fp2ugsl2uej20nd0gbwka.jpg)

然后我们仿照视频教程建立一个存储学生数据的table
``` sql
mysql> create table student(
    -> first_name varchar(30) not null,
    -> last_name varchar(30) not null,
    -> email varchar(60) null,
    -> street varchar(50) not null,
    -> city varchar(40) not null,
    -> state char(2) not null default "PA",
    -> zip mediumint unsigned not null,
    -> phone varchar(20) not null,
    -> birth_date date not null,
    -> sex enum('M', 'F') not null,
    -> date_entered timestamp,
    -> lunch_cost float null,
    -> student_id int unsigned not null auto_increment primary key);
```
解释一下各关键词：

varchar代表可变长度的string，not null表示不能是空值；

state因为只有两个字母，所以，强制要求char(2)，并且给了default值为PA。mediumint有意思，查了一下，发现mysql提供非常多种类的数据类型，估计是考虑到数据库的空间利用效率的原因。
![](https://ws1.sinaimg.cn/large/73ebdc71gy1fp2v4f3uo0j20wc07c42m.jpg)
我们总结一下数据类型：
```
CHAR		fixed length character string
VARCHAR		a character string with a length that is variable
BLOB		contain 2^16 bytes of data
BIGINT		2^63 to -2^63-1
FLOAT		decimal spaces 1.1e38 to -1.1e38
DOUBLE		decimal spaces, 1.7e308 to -1.7e308
ENUM		A character stirng that has a limited number of total values, which you must define
SET			(Seldom used) A set of legal possible character strings. Unlike ENUM, a SET can contain a multiple values in comparason to the one legal value with ENUM.
DATE		YYYY-MM-DD
TIME		HH:MM:SS
DATETIME	YYYY-MM-DD HH:MM:SS
TIMESTAMP	YYYYMMDDHHMMSS
YEAR		YYYY
```
unsigned 表示非负值。

sex的enum非常清楚了，只有两个选项。

注意入学时间，用的timestamp类型，可以看到数据库软件本身提供了非常体贴的类型，不需要自己parser date string啦。

最后一个student id，被定义为主键。

然后我们看一下student中的情况
``` sql
describe student;

+--------------+-----------------------+------+-----+-------------------+-----------------------------+
| Field        | Type                  | Null | Key | Default           | Extra                       |
+--------------+-----------------------+------+-----+-------------------+-----------------------------+
| first_name   | varchar(30)           | NO   |     | NULL              |                             |
| last_name    | varchar(30)           | NO   |     | NULL              |                             |
| email        | varchar(60)           | YES  |     | NULL              |                             |
| street       | varchar(50)           | NO   |     | NULL              |                             |
| city         | varchar(40)           | NO   |     | NULL              |                             |
| state        | char(2)               | NO   |     | PA                |                             |
| zip          | mediumint(8) unsigned | NO   |     | NULL              |                             |
| phone        | varchar(20)           | NO   |     | NULL              |                             |
| birth_date   | date                  | NO   |     | NULL              |                             |
| sex          | enum('M','F')         | NO   |     | NULL              |                             |
| date_entered | timestamp             | NO   |     | CURRENT_TIMESTAMP | on update CURRENT_TIMESTAMP |
| lunch_cost   | float                 | YES  |     | NULL              |                             |
| student_id   | int(10) unsigned      | NO   | PRI | NULL              | auto_increment              |
+--------------+-----------------------+------+-----+-------------------+-----------------------------+

```

查看table中field值的方法：
``` sql
select first_name from student;
```
可以用逗号隔开多个fields。
清空数据表
``` sql
truncate student;
```
注意truncate和drop的区别，drop直接将table从database拿掉，truncate仅仅是清空field的content。
我们总结一下层级关系
```
databases
	tabels
		fields
			field rows (contents)
```

向student table中插入一条数据记录
``` sql
mysql> insert into student value
    -> ('Dennis', 'Lee', 'dcooper@aol.com', '123 Main St', 'Yakima', 'WA', 95294, '510-365-0383', '1995-2-22', 'M', now(), 3.50, null);
```

查看加入的数据记录
``` sql
slect * from student;
```
Foreign Key的概念

表A中的Primary Key，出现在表B中，则为Foreign Key，可为空值，可重复出现。

如果要对已有的表增加一条数据属性，使用alter table语句
``` sql
mysql> alter table test
    -> add maxscore int not null after type;

describe test;
+----------+------------------+------+-----+---------+----------------+
| Field    | Type             | Null | Key | Default | Extra          |
+----------+------------------+------+-----+---------+----------------+
| date     | date             | NO   |     | NULL    |                |
| type     | enum('T','Q')    | NO   |     | NULL    |                |
| maxscore | int(11)          | NO   |     | NULL    |                |
| class_id | int(10) unsigned | NO   |     | NULL    |                |
| test_id  | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
+----------+------------------+------+-----+---------+----------------+

```
改变已有的数据表中的Field名，
``` sql
mysql> alter table score change event_id test_id
    -> int unsigned not null;
```

**Updated 2018-03-08**
---
layout: post
title:  "mysql创建数据库出错、根目录额满、与数据库存放位置迁移"
categories: mysql notebook linux
tags:  server database centos
author: LZN
---

* content
{:toc}

今天打算创建Mercurius的数据库，神奇的是，输入create database后报错

>ERROR 1006 (HY000): Can't create database 'mercurius' (errno: 28)

换了root账户也不行，查到的信息都是说mysql的数据库权限问题，检查后的确木有问题呀。
注意到google出的关键词errno号不同，很多13号，而我是28号，深度搜索了一番，找到了答案：
>This error means that your mysql server does not have enough free space. You need to check the file system size and please remove unwanted software(s) or installers or files. 

我去，坑我？磁盘满额？df查看一下，果然/根目录满额。奇怪～

利用find找大文件：
``` shell
find / -size +800M
```

发现除了最早丢过来的安装包，就是gdm的log最大，cd过去一看，可了不得，13G的log，应该是图形界面出错后一直在写error，写到了3月5日，果断删掉～并且把安装包移走。目前解决，后面看是否还继续写log。

慎重起见，将mysql的数据库路径进行迁移，然后发现进了个大坑。无论怎样按照[网上的步骤](http://blog.csdn.net/liuchunming033/article/details/51851667)调整，都会遇到mysqld服务无法打开的结果。甚至rsync数据库然后做链接都不行。
折腾了一下午，突然想到，不就是把mercurius数据库拿出来么，不动mysql本身的账户库还不行。好吧，最后给mercurius做了链接搞定，要注意所在的上层目录必须有root用户和用户组的读写权限。


**Updated 2018-03-11**
---
layout: post
title:  "不要使用明文密码！以mysql创建数据库链接为例讨论下密码学"
categories: python mysql notebook linux algorithm
tags:  database AES&nbspEncrypt python_import pymysql
author: LZN
---

* content
{:toc}

终于把基本的数据库组织结构学的差不多啦，上午拖着需要补充的市场数据，测试导入数据！

python3使用pymysql模块连接InnoDB数据库，连接过程中需要用户名密码，可是明文密码再上传github这是找死，决定研究下简单的加密解密过程，从外部读取密文，再decode后给入。


### 对称加密
加密算法分对称加密和非对称加密。对称加密很好理解，就是经典的凯撒密码的套路，采用同样的密钥加密和解密（字幕平移法则）。
![](https://bignerdcoding.com/uhttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/masthttps://raw.githubusercontent.com/Novarizark/Novarizark.github.io/master/uploads/2017/08/3799978773.jpeg)

DES是经典的对称加密算法，64bits为单位然后套轮函数循环，但是DES目前已经被攻破，三重DES（密钥1加密，密钥2解密，密钥3加密）还有应用价值。
AES是取代DES的算法，具体步骤为替换（SubBytes），ShiftRows（平移），MixColumns（混列），最后AddRoundKey（与原数据异或）。此为一轮AES。
如果采用对称加密，推荐AES算法。


### 公钥非对称加密
公钥加密是密码学领域非常牛逼的技术，即加密密钥和解密密钥可以不同，这样可以避免密钥配送过程中的风险。公钥丢失也不怕，神不神奇？

比如用户浏览器和server之间非对称加密过程可以是这样：server给公钥，用户用公钥加密，将密文给server（公钥、密文都被窃取也无法获得明文），server将密文用私钥解密。
经典非对称加密算法RSA。其[数学原理](http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html)在阮一峰的网站有介绍。不再赘述。


以我们的应用情景来说，因为不涉及通讯，直接AES对称加密即可。

构建如下类解决：

``` python
class AESCipher(object):

    def __init__(self, key): 
        self.bs = 32
        self.key = hashlib.sha256(key.encode()).digest()

    def encrypt(self, raw):
        raw = self._pad(raw)
        iv = Random.new().read(AES.block_size)
        cipher = AES.new(self.key, AES.MODE_CBC, iv)
        return base64.b64encode(iv + cipher.encrypt(raw))

    def decrypt(self, enc):
        enc = base64.b64decode(enc)
        iv = enc[:AES.block_size]
        cipher = AES.new(self.key, AES.MODE_CBC, iv)
        return self._unpad(cipher.decrypt(enc[AES.block_size:])).decode('utf-8')

    def _pad(self, s):
        return s + (self.bs - len(s) % self.bs) * chr(self.bs - len(s) % self.bs)

    @staticmethod
    def _unpad(s):
        return s[:-ord(s[len(s)-1:])]
```

[参考资料](https://bignerdcoding.com/archives/33.html)

**Updated 2018-03-12**
---
layout: post
title:  "mysql字段注释"
categories: mysql notebook
tags:  server database 
author: LZN
---

* content
{:toc}

开始组建财报数据表，过程中有必要做一些注释说明字段，比如资产负债表中为了压缩存储空间，现金等字段单位用kdollar。
差了下操作如下：

创建表过程中
``` sql
mysql> cash_equiv int null comment 'Cash and Equivalents (kdollars)',
```

修改表过程中

``` sql
mysql> alter table eqbalance_sheet modify column invest int comment 'Investments (Deficit, kdollars)'; 
```

添加字段过程中

``` sql
alter table eq_balance_sheet add other_income int comment 'Accumulated Other Comprehensive Income (kdollars)';
```

查看说明：

``` sql
mysql> show full columns from eq_balance_sheet;
+----------------+-------------+-----------------+------+-----+---------+-------+---------------------------------+---------------------------------------------------+
| Field          | Type        | Collation       | Null | Key | Default | Extra | Privileges                      | Comment                                           |
+----------------+-------------+-----------------+------+-----+---------+-------+---------------------------------+---------------------------------------------------+
| rhid           | char(36)    | utf8_general_ci | NO   | PRI | NULL    |       | select,insert,update,references |                                                   |
| symbol         | varchar(10) | utf8_general_ci | NO   |     | NULL    |       | select,insert,update,references |                                                   |
| cash_equiv     | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Cash and Equivalents (kdollars)                   |
| invest_curr    | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Investments Current (kdollars)                    |
| cash_st_invest | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Cash and Short Term Investments (kdollars)        |
| receivables    | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Trade and Non-Trade Receivables (kdollars)        |
| inventory      | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Inventory (kdollars)                              |
| curr_ast       | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Current Assets (kdollars)                         |
| ppe_net        | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Property, Plant & Equipment Net (kdollars)        |
| goodwill       | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Goodwill and Intangible Assets (kdollars)         |
| invst_ncurr    | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Investments Non-Current (kdollars)                |
| tax_ast        | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Tax Assets (kdollars)                             |
| ast_ncurr      | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Assets Non-Current (kdollars)                     |
| total_ast      | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Total Assets (kdollars)                           |
| payables       | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Trade and Non-Trade Payables (kdollars)           |
| debt_curr      | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Debt Current (kdollars)                           |
| curr_liab      | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Current Liabilities (kdollars)                    |
| debt_ncurr     | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Debt Non-Current (kdollars)                       |
| total_debt     | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Total Debt (kdollars)                             |
| def_revenue    | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Deferred Revenue (kdollars)                       |
| tax_liab       | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Tax Liabilities (kdollars)                        |
| dep_liab       | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Deposit Liabilities (kdollars)                    |
| liab_ncurr     | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Liabilities Non-Current (kdollars)                |
| total_liab     | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Total Liabilities (kdollars)                      |
| other_income   | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Accumulated Other Comprehensive Income (kdollars) |
| ret_earning    | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Accumulated Retained Earnings (Deficit, kdollars) |
| equity         | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Shareholders Equity (Deficit, kdollars)           |
| invest         | int(11)     | NULL            | YES  |     | NULL    |       | select,insert,update,references | Investments (Deficit, kdollars)                   |
+----------------+-------------+-----------------+------+-----+---------+-------+---------------------------------+---------------------------------------------------+
28 rows in set (0.00 sec)
```



**Updated 2018-03-08**
---
layout: post
title:  "工作信息搜集记录"
categories: notebook 
tags:  thinking career
author: LZN
---

* content
{:toc}

人生有很多重要的选择，常常因信息不足而近似抓阄，又因无法反复尝试而带有巨大风险，交流和搜集信息是降低系统风险的不二法门。
他人提供的后验概率能够降低系统熵，从而使得决策树剪枝切实可行，在这里搜集整理一下目前得到的关于找工作的信息。以为最终决策提供素材。

__交流信息表__

|   Name    |   Date    |   Affiliation |   Position   |Attitude |       Information|
|:---       |:---       |:---           |:---          |:---|:---              |
|ZMS        |20180101   |SYSU           |PhD           |pros|1. ITMM 10月申请公租房，2k以下三室一厅<br/> 2. ITMM有职称后入手10k/m|
|HXM        |20180114   |SYSU           |Asso. R       |cons|1. 被劝服<br/> 2. R系列压力大，待遇被削减，晋升机会偏小|
|HCD        |20180119   |CUIT           |Lecturer      |pros|1. 根据自身和平行经验认可编制重要性<br/> 2. 根据平行经验认可SZ福利待遇（低价房源？）<br />3. 教职（讲师、副教授）6-8年合同<br /> 4. SZ空管终身住房|
|CZS        |20180204   |SCSIO          |Assis. R      |pros|1. SCSIO环境问题<br/> 2. 认可编制的重要性|
|YX         |20180222   |SYSU           |Postdoc       |cons|1. 被劝服<br/> 2. 认可postdoc出站后出路存在问题|
|HC         |20180225   |JNU            |Asso. Prof    |pros|1. 认可ITMM清闲<br /> 2. 否认高校人际简单，认可压力更大<br />3. 认可编制稀缺和价值<br/> 4.ITMM探亲假|
|CJ         |20180225   |ITMM           |Office Dean   |pros|1. ITMM扩编需求，科研业务并举<br /> 2. 强调竞争继续白热化以及编制的稀缺性<br /> 3.强调M PhD的机会|
|JXW        |20180226   |IPM, CMA       |Asso. R       |pros|1. 认可选择，但表示可惜<br/> 2. 不认可ITMM边缘化位置 <br/> 3. ITMM核心位置入职到手200k/a <br/> 4. 推荐SZ，住房（乐观主义偏差？），自由探索 <br/>5. 提供SZ联系方式|
|CSS        |20180301   |MCGILL         |Postdoc       |pros|工作后可quit选择postdoc，反之不行|
|HYJ        |20180303   |CSU            |Postdoc       |pros|1. SZ务实，财政充裕，但是从业务岗起 <br/> 2.多有合作，提供SZ联系方式<br/>|
|LHW        |20180310   |SYSU           |PhD           |pros|1. 关注人才计划<br/> 2. FS中心缺人，待遇稍差<br/> 3.SZ要注意住房问题的后视偏差<br/>4.市一级待遇比省一级高？<br/>5. SZ员工宿舍较差？|
|CYP        |20180312   |DG-CMA         |Engineer      |pros|1. 关注企业机会，天气宝 <br/> 2.FS中心缺人<br/>3.TCent朋友离职做量化|
|LX         |20180321   |BJU            |PhD           |cons|1. 无法劝服，执意继续|
|PB         |20180321   |IAP            |PhD           |pros|1. IAP首选稳定工作 <br/>2. 同样计划稳定工作|
|HCD        |20180325   |CUIT           |Lecturer      |pros|NUIST讲师有编制|
|LMT        |20180326   |BJU            |PhD           |pros|1. BJ毕业生热捧企业岗位<br/> 2. CAMS已经排斥BJU PhD|





**Updated 2018-03-25**
---
layout: post
title:  "Form principles from mistakes"
categories: principle 
tags:  thinking blog
author: LZN
---

* content
{:toc}
如何按照达里奥的《原则》来处理生活、学习、工作、投资？Learn from mistakes非常重要。出错不怕，怕的是知错不改。策略法则的反脆弱性来自于不断试错和快速迭代。快速迭代要求知错而改，而不是在同一条道路上反复撞墙。
这篇文章用于总结经历过的错误，并试图从错误中抽象避免下次出现同样问题的原则。


勘误表

|   ID  |   Date    |   目标    |   失败情况    |   失败原因    |   总结原则    |    
|:---   |:---       |:---       |:---           |:---           |:---           |
|1      |20180105   |因肠胃问题中山二院就医|1. 没携带医保卡（实际并不需要，但不应遗漏）<br/>2. 没有携带病历<br/> 3.粪便检查没有携带纸巾，不得不外出购买|没有条理化检查任务所需准备|1.条理化检查执行任务所需要的准备<br/> 2.随身携带纸巾是具有保险性质的操作|
|2      |20180119   |参加JW婚礼需要一双皮鞋|鞋码购买错误，造成不便|没有细致查看购买条款及介绍，没有联系客服|购买物品时反复查验其属性说明是否合乎要求|
|3      |20180207   |返程火车票学生票|学生证缺少注册章损失187元|学生证拿去注册后没有仔细查验注册章|仔细查验对后续任务有重要影响的任务完成情况|


**Updated 2018-03-26**
---
layout: post
title:  "我的技术博客有救了！"
categories: hardware linux mysql
tags:  server blog jekyll
author: LZN
---

* content
{:toc}
周三助教回到东校，决定去处理一下实验室服务器，看下我的wordpress博客内容到底还有没有救。因为[上次](https://novarizark.github.io/2017/12/30/raid-rebuild/)做了1号盘位的rebuild，这次测试将0号盘位degraded的旧硬盘换下。
可是将0号盘位换下后，1号盘位显示为non-raid磁盘，而0号新盘直接不认，what the fuck。怀疑是上次rebuild没有完成，所以将旧硬盘再次换到0号位置让raid卡自己玩去。
换上旧硬盘后可以正常识别到raid信息并进入系统。测试mysql数据库居然发现wp_posts数据都存在，太幸运了，我的技术博客有救了！果断导出。

``` shell
mysqldump -h localhost -u root -p --database wordpress | gzip > backupfile.sql.gz
gunzip -c backupfile.sql.gz > bck.sql 
```

之后在mysql下导入
``` sql
source ~/bck.sql;
```

查看中文时注意utf8编码
```sql
set names utf8;
```

后面考虑写个python脚本将过去的日志转成markdown放到jekyll博客下。

**Updated 2018-03-28**
---
layout: post
title:  "测试基于tensorflow的图片分类器"
categories: python notebook
tags: tensorflow 
author: LZN
---

* content
{:toc}

开始测试tensorflow的图片分类器！
按[这个视频](https://www.youtube.com/watch?v=gIhUePPFmpY)来，发现train的一步出现问题
```
ERROR:tensorflow:Couldn't understand architecture name ''
```
发现是指定的环境变量读不到，于是将给ARCH赋值的语句和python执行语句一起放到shell脚本里，问题解决。
train的过程大概用了不到五分钟，估计30-60min的经验是CPU-based，tf应该自动选用cuda解决了。

之后做测试，效果很好。

![](https://ws1.sinaimg.cn/large/73ebdc71ly1fpwweqdx63j20fz0790t7.jpg)

**Updated 2018-03-30**
---
layout: post
title:  "Porting WRF v3.8.1 on Tianhe2"
categories: hardware linux notebook
tags: server WRF
author: LZN
---

* content
{:toc}

帮JL移植wrf3.8.1到天河2号。首先调整环境变量。
```bash
if [ -f /etc/bashrc ]; then
        . /etc/bashrc
fi
# edited on Apr 1, 2018 for WRF
# User specific aliases and functions
#bug fix
source /WORK/app/osenv/ln1/set2.sh
export MODULEPATH=/WORK/app/modulefiles

#set COMMON input data path for CESM
#export COMMON_CESM_INPUT=/WORK/app/CESM_inputdata

#set Intel compiler and MPI
module load intel-compilers/13.0.0
module load MPI/Intel/MPICH/3.1-icc13
module load cmake/3.0.2

#set hdf5 and netcdf4 for WRF
module load hdf5/1.8.13/03-CF-13
module load netcdf/4.3.2/02-CF-13

#set jasper
export JASPER=/HOME/sio_goc017/WORKSPACE/jjl/soft/jasper-1.900.1
export JASPERLIB=$JASPER/lib
export JASPERINC=$JASPER/include

#set WRF
export WRFIO_NCD_LARGE_FILE_SUPPORT=1
export WRF_EM_CORE=1
export NETCDF4=0
export BUFR=1
export CRTM=1
export J="-j 12"
export MP_STACK_SIZE=4000000000
export OMP_STACKSIZE=4000000000
export KMP_STACKSIZE=4000000000
ulimit -s unlimited
ulimit -c unlimited

MPI_BUFFER_SIZE=128
```
注意在编译cumulus模块的地方大概要等待20分钟之久。采用上述环境变量出错：

```bash
wrf.o: In function `MAIN__':
wrf.f90:(.text+0x1f): undefined reference to `__intel_new_feature_proc_init'
libwrflib.a(module_check_a_mundo.o): In function `module_check_a_mundo_mp_check_nml_consistency_':
module_check_a_mundo.f90:(.text+0x31fa): undefined reference to `__intel_ssse3_rep_memmove'
module_check_a_mundo.f90:(.text+0x35ea): undefined reference to `__intel_ssse3_rep_memmove'
libwrflib.a(module_mp_etanew.o): In function `module_mp_etanew_mp_etanewinit_':
module_mp_etanew.f90:(.text+0xacb0): undefined reference to `__intel_ssse3_rep_memmove'
libwrflib.a(module_mp_thompson.o): In function `module_mp_thompson_mp_table_ccnact_':
module_mp_thompson.f90:(.text+0x2ed74): undefined reference to `__intel_ssse3_rep_memmove'
libwrflib.a(module_ra_rrtm.o): In function `module_ra_rrtm_mp_rrtm_lookuptable_':
module_ra_rrtm.f90:(.text+0x256ea): undefined reference to `__intel_ssse3_rep_memmove'
libwrflib.a(module_ra_rrtmg_lw.o):module_ra_rrtmg_lw.f90:(.text+0x769bf): more undefined references to `__intel_ssse3_rep_memmove' follow
/WORK/sio_goc017/jjl/wrfdata/WRFV3/external/io_grib_share/libio_grib_share.a(io_grib_share.o): In function `transpose_grib_':
io_grib_share.f90:(.text+0x1ee4): undefined reference to `_intel_fast_memmove'
/WORK/sio_goc017/jjl/wrfdata/WRFV3/external/io_grib_share/libio_grib_share.a(io_grib_share.o): In function `transpose1d_grib_':
io_grib_share.f90:(.text+0x26f5): undefined reference to `_intel_fast_memmove'
io_grib_share.f90:(.text+0x29e3): undefined reference to `_intel_fast_memmove'
0.57user 4.84system 0:08.12elapsed 66%CPU (0avgtext+0avgdata 487696maxresident)k
12392inputs+102200outputs (47major+183178minor)pagefaults 0swaps
make[1]: [em_wrf] Error 1 (ignored)
```
Google以下，发现intel官网的[trouble shooting page](https://software.intel.com/en-us/forums/intel-fortran-compiler-for-linux-and-mac-os-x/topic/494782)
以下内容：
```
I believe the message may be caused by mixing objects built with different compiler versions. The __intel_new_feature_proc_init entry point is only in recent compiler libraries; if you have code built with a recent compiler, but are linking to older run-time libraries, you might encounter such a problem.
```

有道理，可能是之前编译的模块没有删掉。执行
```
$./clean -a
```
再次测试一下.出现难以理解的错误：
```
nup_em.f90(68): error #7002: Error in opening the compiled module file.  Check INCLUDE paths.   [MODULE_INITIALIZE_REAL]
   USE module_initialize_real, only : wrfu_initialize
   -------^
   real_em.f90(12): error #7002: Error in opening the compiled module file.  Check INCLUDE paths.   [MODULE_INITIALIZE_REAL]

```
表示找不到include文件。到相关目录下检查发现文件确实存在，奇葩……重新执行compile语句后编译成功。怀疑是天河的文件系统不稳定造成。

测试WPS编译出错。
```
make[1]: pathf90: Command not found
```
检查了下发现自己选错了architecture，并不是与前面相同的#15，而是#19.

**Updated 2018-04-01**

据CM大哥表示，天河不开NC4编译是不行的。果然，JL运行出错，测试NC4打开后是否能解决。

**Updated 2018-04-03**

---
layout: post
title:  "20180403交易笔记-市场转向信号？"
categories: economy investment notebook
tags:   investment stock ETF market&nbspcrash
author: LZN
---

* content
{:toc}

>逻辑对的情况下，该如何把握节奏？

这段时间最大的感受就逻辑假设在不断验真，可节奏把握的确是一件颇具奇技淫巧，难以搞定的风骚操作。其实本质还是资金仓位管理以及择时判据，逻辑对的情况下（big picture）有定量分析加持才行。

从16年下半年就看空科技股，当然这节奏是严重不对的，不断学习过程中看到smart beta痴痴买入ETF的策略加上投机性买入对价格的不断推升可以持续如此之久。终于憋到今年2月份第一次利率冲击，波动性回归，市场进入震荡格局。

这几天F的信息泄露+川普对A的税收大棒挥起，科技股终于出现像样的下跌了，大概瞄了下QQQ应该是回到去年十一月的水平，会买么？我还不会。FAANG只有PE到20以下我才会心动，G目前EPS 18股价1k，55的PE；被干的F目前PE 29，至少跌倒20以内，才会下手。只有apple目前17+。

看了下最近的资金曲线，基本维持窄幅震荡，大概只有3%左右最大回撤，相比指数的跌宕起伏平缓很多。重新审视了下仓位、标的的分散性和风险敞口，依然不觉得有什么问题。风险投资占总资产比重已经下降到24%左右。

逻辑上接下来应该去验真第二轮的利率上升冲击、国际经贸形势变换冲击以及地缘政治关系紧张冲击等，适当加一些吃backwardation rolling的标的后继续走佛系路线：观察，等待。

我想也可以抛出结论了：

>客观交易系统还不成熟的前提下，不要在乎节奏，减少操作，注意风险敞口和布局即可。

**Updated 2018-04-03**
---
layout: post
title:  "东校实验室服务器阵列rebuild"
categories: hardware
tags:  raid server
author: LZN
---

* content
{:toc}

东校实验室服务器坏掉了一块RAID 1的磁盘，购置新硬盘后测试rebuild发现几个配置页面都没有相关选项。

原RAID没出问题的磁盘被降级为foreign状态，

后查到[官方文档](https://www.dell.com/support/article/cn/zh/cndhs1/sln129828/%E8%A7%A3%E5%86%B3poweredge-raid%E6%8E%A7%E5%88%B6%E5%99%A8%E9%94%99%E8%AF%AF-perc%E6%95%85%E9%9A%9C-?lang=zh)

>Foreign configuration(s) found on adapter. Press any key to continue, or ’C’ to load the configuration utility or ’F’ to import foreign configuration(s) and continue.

按F按键后导入foreign配置，开始进入系统。

进入系统后发现0号盘位闪橙色灯，也处于降级出错状态，妈蛋，这下有的玩了。于是联系L老师再次采购硬盘。
**Updated 2017-12-30**

3月硬盘到货，测试直接将0盘位换成新硬盘，发现无法自动rebuild，无法识别1盘位的系统盘。

重新装回旧有硬盘后能够进入系统，但是只放置1盘位新硬盘，启动后出现无法找到superblock的错误。

怀疑能进入系统的好机会不多，迅速备份了技术博客后，关掉所有的crontab减少读写，希冀RAID卡能够将所有的数据rebuild到1盘位。等下周来看。

**Updated 2018-03-28**

所以希冀是自欺欺人的。满心以为自动rebuild后，可以更换下0盘位，发现还是老样子。

想到新招数偷天换日，将2号盘位的non-RAID disk取下，更换上新硬盘后，把新硬盘做全局热备。[参考资料](https://wenku.baidu.com/view/993960dfbb4cf7ec4afed023.html)

没想到改全局热备后并没有rebuild，而且再次出现找不到superblock无法进入系统的情况。没招了，只有试图解决这个问题。测试[这个解决方案](https://linuxexpresso.wordpress.com/2010/03/31/repair-a-broken-ext4-superblock-in-ubuntu/)

发现牛逼的是所有的备份superblock都挂了。这是没救了？

尝试检查了一下fstab，发现奇怪的地方，fstab中将sda1挂载到/用户/data下，由于data存储较大，**怀疑是2号位硬盘找不到，然后把系统盘sdb误认为是sda才出现superblock不匹配的地方。（上次更换0盘位也出现相同错误，可能更换或取下硬盘后影响了系统自检虚拟磁盘的顺序）**

尝试给回2盘位，可以进入系统；随后尝试删除fstab中对应语句，拔出2盘位，也可以进入系统，有戏，果然是这个原因！

接下来把2盘位更换为新硬盘，由于之前做了热备，现在显示为foreign状态，import foreign configure后，可以进入系统。进入系统后没有看到2盘位在闪烁，说明没有自动rebuild。

关机，将处于2盘位的新硬盘拿下并替换0盘位就硬盘，开机发现提示进入配置页面，进入后发现0盘位开始rebuild，Yeah！成功！

下午助教，去课室发现竟然没人，问了一下才知道换课了，磨叽了一会儿回去差不多两小时，发现rebuild居然卡在37%，奇怪。不管了，今天没时间耗着了，必须搞完。于是重启，突然想到为何不尝试一下之前的1号盘是否能读出。如果1号盘可用的话，那么直接rebuild到更新的时间点岂不是更好。

于是将0盘位换成之前的1号盘，果然可以！慎重起见，迅速备份技术博客，17年2月之后一直到8月底最后一篇博客，一点都不少，太好了！之后设置rebuild到这个盘就去吃饭了，当晚SH说0盘位掉线了，好吧，好在技术博客救回来了。下次去恢复到2月份的系统。

**Updated 2018-04-04**

---
layout: post
title:  "从备份的wordpress数据库重建技术博客"
categories: notebook mysql 
tags: server blog database wordpress jekyll markdown
author: LZN
---

* content
{:toc}

接上篇[东校服务器RAID rebuild](https://novarizark.github.io/2018/04/04/raid-rebuild/),接下来的任务是如何把wordpress的数据库内容导出，转成jekyll的markdown文档。

思路应该很简单直接，sql抽出来内容 日期 关键词（我当时只做了category分类，可以考虑直接充当关键词和分类，后续再调整），然后按jekyll的post格式给出即可。
工具：pymysql

google下，抽出post内容的几个关键语句如下：
```sql

--选出内容，唯一id，和category
>SELECT post_title, wpr.object_id, wp_terms.name
FROM wp_terms
INNER JOIN wp_term_taxonomy ON wp_terms.term_id = wp_term_taxonomy.term_id
INNER JOIN wp_term_relationships wpr ON wpr.term_taxonomy_id = 
wp_term_taxonomy.term_taxonomy_id
INNER JOIN wp_posts ON ID = wpr.object_id
WHERE taxonomy = 'category' 
AND post_type = 'post' 
ORDER by post_title;
```

**Updated 2018-04-13**

---
layout: post
title:  "贝叶斯模型, MC, MC, 与MCMC"
categories: machine&nbsp;leanring 
tags: machine&nbsp;learning CUDA deep&nbsp;learning MCMC Bayes
author: LZN
---

* content
{:toc}

帮老板审稿，这稿子用了个非常牛逼的Bayesian Model+MCMC做降水的突变检验，很明显是个ML的方法，这么好的机会，肯定要抓着搞明白。

整理一些资料如下：

1. **[贝叶斯方法介绍](https://blog.csdn.net/pongba/article/details/2958094)**: 这是篇非常好的科普，从贝叶斯老爷的逆概问题讨论形式化的贝叶斯概型。
2. **[MC, MC, MCMC](https://site.douban.com/182577/widget/notes/10567181/note/292072927/)**: 蒙特卡洛、马尔可夫链，到马尔可夫链蒙特卡洛方法。
3. **[似然函数](https://zh.wikipedia.org/wiki/%E4%BC%BC%E7%84%B6%E5%87%BD%E6%95%B0)**:终于明白了似然函数是什么意思，表征观测结果对应预期分布的似然性。定性的说，一个硬币投了一百次有90次正面，那么这个硬币正常的似然性很低很低。
4. **[最大似然估计]()**:对同一个似然函数，如果存在一个参数值，使得它的函数值达到最大的话，那么这个值就是最为“合理”的参数值。
5. **[MCMC方法小记](http://sunyi514.github.io/2016/03/05/mcmc%E6%96%B9%E6%B3%95%E5%B0%8F%E8%AE%B0/)**：好例子!
6. **[理解MCMC](http://xccds1977.blogspot.kr/2014/07/mcmc.html)**:好例子！


**Updated 2018-04-14**

---
layout: post
title:  "为python增加默认的库搜索路径"
categories: python linux
tags: python_import 
author: LZN
---

* content
{:toc}

明文密码丢到程序里当然是很傻逼的事情（参见斯导新片《头号玩家》），所以访问数据库用了AES加密（[参见](https://novarizark.github.io/2018/03/12/cryptography-python-mysql/)）。

数据库可是个好东西，慢慢很多程序都要开始访问数据库了，那么我们自己的加密模块能否不通过动态方式添加搜索路径，像import其他模块那样引用呢？答案当然是可以的，在bashrc中修改PYTHONPATH环境变量就可以啦。

当然这不是推荐方法，因为具有外部依赖性。推荐方法是在site-packages目录下增加一个扩展名为.pth的文件，在里面写入增加的搜索路径。这里有[很好的介绍](https://blog.csdn.net/liang19890820/article/details/76219560)。

**Updated 2018-04-14**

---
layout: post
title:  "学习与工作日记：关键词"
categories:  notebook linux algorithm
tags:  blog keyword&nbspnotebook
author: LZN
---

* content
{:toc}

### 20180312

* Blockchain
    * Block-->Header-->Nonce-->Hash
    * Double Spending-->6 Confirmation

* Encryption Algorithm
    * Symmetric-key
        * DES-->3DES-->AES
    * Public-key Cryptography
        * RSA

* Python Class
    * \_\_init(self,a,b,c)\_\_ --> cls=class(a, b, c) --> cls.a
    * method(self) --> cls.method() -->class.method(cls)


### 20180313

* pymysql
    * with connection.cursor() as cursor
    * connection.commit()
    * connection.close()

* python-for-teens
    * string
    * if structure

### 20180417

* Bayesian Model
    * Bayesian Model
    * Markov Chain
    * Mento Carlo
    * Markov Chain Mento Carlo (MCMC)

**Updated 2018-04-14**
